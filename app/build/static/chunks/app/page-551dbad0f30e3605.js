(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1931],{73109:function(e,t,s){Promise.resolve().then(s.bind(s,43496))},43496:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Page}});var a=s(72612),l=s(63278),n=s(39634),r=s(2750),i=s(79293),o=s(79146),c=s(83337),d=s(13370),m=s(39164),u=s(41087),x=s(96886),h=s(16277),g=s(81446),p=s(19731),f=s(30365),v=s(58422),b=s(98130),j=s(8930);let findThumbnail=(e,t)=>{let s=null==e?void 0:e.find(e=>e.size>=t);return null==s?null:s},thumbUrl=e=>"http://".concat((0,g.X)(),"/server/files/gcodes/").concat(e.relative_path,"?timestamp=").concat(e),getHistoryStateFillColor=e=>{switch(e){case"error":case"klippy_disconnect":case"klippy_shutdown":case"server_exit":return"bg-rose-500/10 text-rose-500 dark:bg-rose-400/10 dark:text-rose-400";case"interrupted":return"bg-amber-500/10 text-amber-500 dark:bg-amber-400/10 dark:text-amber-400";case"in_progress":return"bg-sky-500/10 text-sky-500 dark:bg-sky-400/10 dark:text-sky-400";default:return"bg-brand-500/10 text-brand-500 dark:bg-brand-400/10 dark:text-brand-400"}},getHistoryStateTextColor=e=>{switch(e){case"error":case"klippy_disconnect":case"klippy_shutdown":case"server_exit":return"text-rose-900/80 dark:text-rose-100/80";case"interrupted":return"text-amber-900/80 dark:text-amber-100/80";case"in_progress":return"text-sky-900/80 dark:text-sky-100/80";default:return"text-brand-900/80 dark:text-brand-100/80"}},y=[{header:()=>(0,a.jsx)("span",{children:"Filename"}),accessorKey:"filename",enableSorting:!1,size:280,cell:e=>{let t=findThumbnail(e.row.original.metadata.thumbnails,32);return(0,a.jsxs)("div",{className:"flex min-w-0 items-center gap-x-4",children:[null==t?null:(0,a.jsx)("img",{src:thumbUrl(t),alt:"",className:"h-8 w-8 rounded-full bg-zinc-800"}),(0,a.jsx)("div",{className:"truncate text-sm font-medium leading-6 text-white",children:e.getValue()})]})}},{header:()=>(0,a.jsx)("span",{children:"Started at"}),sortDescFirst:!0,enableSorting:!0,enableMultiSort:!1,accessorKey:"start_time",cell:e=>{let t=u.ou.fromSeconds(e.getValue()).setLocale("en-GB");return(0,a.jsx)("div",{className:"flex min-w-0 items-center gap-x-3",children:(0,a.jsx)("div",{className:"text-sm leading-6 text-zinc-400",title:t.toLocaleString({dateStyle:"full",timeStyle:"medium"}),children:t.toRelative()})})}},{header:()=>(0,a.jsx)("span",{children:"Status"}),size:200,enableSorting:!1,accessorKey:"status",cell:e=>{let t=e.getValue();return(0,a.jsxs)("div",{className:"flex min-w-0 items-center justify-end gap-x-2  @screen-sm:justify-start",children:[(0,a.jsx)("div",{className:(0,l.m6)(getHistoryStateFillColor(t),"flex-none rounded-full p-1"),children:(0,a.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-current"})}),(0,a.jsx)("div",{className:(0,l.m6)("truncate capitalize text-white",getHistoryStateTextColor(t),"completed"===t?"text-green-100/80":" text-rose-100/80"),children:t.replace("_"," ")})]})}},{header:()=>(0,a.jsx)("span",{children:"Duration"}),accessorKey:"print_duration",enableSorting:!1,cell:e=>(0,a.jsx)("div",{className:"flex min-w-0 items-center text-sm leading-6 text-zinc-400",children:u.nL.fromObject({hours:e.getValue()/60/60},{locale:"en-GB"}).normalize().shiftTo(...["minutes",e.getValue()/60/60>1?"hours":null].filter(Boolean)).toHuman({unitDisplay:"short",listStyle:"narrow",maximumFractionDigits:0})})},{header:()=>(0,a.jsx)("span",{children:"Slicer"}),accessorKey:"slicer",enableSorting:!1,cell:e=>(0,a.jsx)("span",{className:"inline-flex items-center rounded-md bg-zinc-400/10 px-2 py-1 text-xs font-medium text-zinc-400 ring-1 ring-inset ring-zinc-400/20",children:e.row.original.metadata.slicer})},{header:()=>(0,a.jsx)("span",{children:"Filament used"}),accessorKey:"filament_used",enableSorting:!1,cell:e=>{let t=e.getValue()/1e3;return(0,a.jsxs)("div",{className:"flex min-w-0 items-center text-sm leading-6 text-zinc-400",children:[(0,a.jsx)(j.ZP,{start:0,end:t,preserveValue:!0,decimals:2})," meters"]})}}],getColumnSizeClass=e=>{let t=["filament_used","slicer"].includes(e),s=["status","print_duration"].includes(e),a=[""].includes(e),n=["filename"].includes(e);return(0,l.m6)(a&&"@screen-sm:flex hidden",s&&"@screen-md:flex hidden",t&&"@screen-xl:flex hidden",!a&&!s&&!t&&"flex",n&&"flex-shrink flex-grow-[5]")},HistoryTable=()=>{var e,t,s,n,r;let i=(0,x.oK)(),[u,g]=(0,m.useState)([{id:"start_time",desc:!0}]),j=(0,m.useRef)(null),{data:w,fetchNextPage:N,isFetching:k,isFetchingNextPage:_,hasNextPage:S,isLoading:z}=(0,h.N)({queryKey:["history",u],queryFn:async e=>{let{pageParam:t=0}=e,s=await i.query("server.history.list",{limit:25,start:25*t,order:u[0].desc?"desc":"asc"});return s},getNextPageParam:(e,t)=>e.count<=t.length?void 0:t.length,keepPreviousData:!0,refetchOnWindowFocus:!1}),C=(0,m.useMemo)(()=>{var e,t;return null!==(t=null==w?void 0:null===(e=w.pages)||void 0===e?void 0:e.flatMap(e=>e.jobs))&&void 0!==t?t:[]},[w]),T=C.length,P=(0,o.b7)({data:C,columns:y,state:{sorting:u},getCoreRowModel:(0,c.sC)(),getSortedRowModel:(0,c.tj)(),manualSorting:!0,debugTable:!0}),handleSortingChange=e=>{if(g(e),P.getRowModel().rows.length){var t;null===(t=F.scrollToIndex)||void 0===t||t.call(F,0)}};P.setOptions(e=>({...e,onSortingChange:handleSortingChange}));let{rows:B}=P.getRowModel(),F=(0,d.hO)({count:T,estimateSize:()=>64,measureElement:-1===navigator.userAgent.indexOf("Firefox")?e=>null==e?void 0:e.getBoundingClientRect().height:void 0,overscan:3,scrollMargin:null!==(n=null===(e=j.current)||void 0===e?void 0:e.offsetTop)&&void 0!==n?n:0,paddingEnd:null!==(r=null===(t=null===(s=j.current)||void 0===s?void 0:s.offsetParent)||void 0===t?void 0:t.offsetTop)&&void 0!==r?r:0});return((0,m.useEffect)(()=>{let[e]=[...F.getVirtualItems()].reverse();e&&e.index>=T-1&&S&&!_&&N()},[S,N,T,_,F]),z)?(0,a.jsxs)("div",{className:"mt-6 flex h-48 w-full flex-col items-center justify-center space-y-2",children:[(0,a.jsx)(b.$,{}),(0,a.jsx)("h3",{className:"animate-pulse font-normal text-zinc-100",children:"Loading print history..."})]}):(0,a.jsxs)("table",{className:"mt-6 w-full whitespace-nowrap text-left",style:{display:"grid",height:"".concat(F.getTotalSize(),"px"),width:"100%",position:"relative"},ref:j,children:[(0,a.jsx)("thead",{className:"border-b border-white/10 bg-background text-sm leading-6 text-white",style:{display:"grid",position:"sticky",top:0,zIndex:1},children:P.getHeaderGroups().map(e=>(0,a.jsx)("tr",{style:{display:"flex",width:"100%"},children:e.headers.map(e=>{var t;return(0,a.jsx)("th",{scope:"col",className:(0,l.m6)("flex flex-grow items-center truncate px-4 py-2 font-semibold @screen-sm:px-6 @screen-lg:px-8",getColumnSizeClass(e.column.id)),style:{width:e.getSize()},children:(0,a.jsxs)("div",{className:(0,l.m6)(e.column.getCanSort()&&"cursor-pointer select-none","space-x-2 flex items-center"),onClick:e.column.getToggleSortingHandler(),children:[(0,o.ie)(e.column.columnDef.header,e.getContext()),null!==(t=({asc:(0,a.jsx)(p,{className:"h-4 w-4"}),desc:(0,a.jsx)(v,{className:"h-4 w-4"})})[e.column.getIsSorted()])&&void 0!==t?t:e.column.getCanSort()?(0,a.jsx)(f,{className:"h-4 w-4"}):null]})},e.id)})},e.id))}),(0,a.jsxs)("tbody",{className:"divide-y divide-white/5",style:{display:"grid",height:"".concat(F.getTotalSize(),"px"),position:"relative"},children:[F.getVirtualItems().map(e=>{let t=B[e.index];return(0,a.jsx)("tr",{"data-index":e.index,ref:e=>F.measureElement(e),style:{display:"flex",position:"absolute",height:"".concat(e.size,"px"),transform:"translateY(".concat(e.start-F.options.scrollMargin,"px)"),width:"100%"},children:t.getVisibleCells().map(e=>(0,a.jsx)("td",{className:(0,l.m6)("flex-grow p-4 @screen-sm:px-6 @screen-lg:px-8",getColumnSizeClass(e.column.id)),style:{width:e.column.getSize()},children:(0,o.ie)(e.column.columnDef.cell,e.getContext())},e.id))},t.id)}),0===T&&(0,a.jsx)("tr",{children:(0,a.jsxs)("td",{colSpan:y.length,className:"flex h-96 flex-grow flex-col items-center justify-center p-4 text-center text-zinc-100 @screen-sm:px-6 @screen-lg:px-8",children:[(0,a.jsx)("h4",{className:"mb-4 text-4xl font-bold",children:"No print history found"}),(0,a.jsx)("div",{className:"text-xl text-zinc-400",children:"What are you waiting for? Go print something!"})]})})]})]})},w=[{name:"History",href:"#",current:!0}];function Page(){var e,t,s,o,c;let d=(0,r.PF)("general.printername",{initialData:"Loading..."}),h=i.SX.printer.getSavedPrinterName.useQuery(void 0,{initialData:"Loading..."}),g=(0,x.DS)("server.history.totals"),p=(0,x.DS)("server.info"),f=(0,x.hS)("print_stats"),v=null===(e=f.data)||void 0===e?void 0:e.print_stats.state,b=(0,m.useMemo)(()=>{if(null==g.data)return[{name:"Total Print Time",value:0},{name:"Longest Print",value:0},{name:"Avg. Print",value:0},{name:"Total Filament Used",value:0,unit:"meters"}];let e=u.nL.fromObject({hours:0===g.data.job_totals.total_print_time?0:g.data.job_totals.total_print_time/60/60},{locale:"en-GB"}).shiftTo(...["seconds","minutes","hours","days"].filter(Boolean)).normalize().toObject(),t=u.nL.fromObject({hours:0===g.data.job_totals.longest_print?0:g.data.job_totals.longest_print/60/60},{locale:"en-GB"}).shiftTo(...["seconds","minutes","hours"].filter(Boolean)).normalize().toObject(),s=g.data.job_totals.total_print_time/g.data.job_totals.total_jobs,a=u.nL.fromObject({hours:isNaN(s)?0:s/60/60},{locale:"en-GB"}).shiftTo(...["seconds","minutes","hours"].filter(Boolean)).normalize().toObject();return[{name:"Total Print Time",value:[e.days&&{val:e.days,unit:"days"},e.hours&&{val:e.hours,unit:"hrs"},!e.days&&{val:e.minutes,unit:"mins"}].filter(Boolean)},{name:"Longest Print",value:[t.hours&&{val:t.hours,unit:"hrs"},{val:t.minutes,unit:"mins"}].filter(Boolean)},{name:"Avg. Print",value:[a.hours&&{val:a.hours,unit:"hrs"},{val:a.minutes,unit:"mins"}].filter(Boolean)},{name:"Total Filament Used",value:g.data.job_totals.total_filament_used/1e3,unit:"meters"}]},[g.data]);return(0,a.jsxs)("main",{className:"@container",children:[(0,a.jsxs)("header",{children:[(0,a.jsx)("div",{className:"border-b border-white/10",children:(0,a.jsx)("nav",{className:"mx-auto flex max-w-7xl overflow-x-auto py-4",children:(0,a.jsx)("ul",{role:"list",className:"flex min-w-full flex-none gap-x-6 px-4 text-sm font-semibold leading-6 text-zinc-400 @screen-sm:px-6 @screen-lg:px-8",children:w.map(e=>(0,a.jsx)("li",{children:(0,a.jsx)("a",{href:e.href,className:e.current?"text-brand-400":"",children:e.name})},e.name))})})}),(0,a.jsx)("div",{className:"bg-zinc-700/15 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"mx-auto flex max-w-7xl flex-col items-start justify-between gap-x-8 gap-y-4 px-4 py-4 @screen-sm:flex-row @screen-sm:items-center @screen-sm:px-6 @screen-lg:px-8",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"flex items-center gap-x-3",children:[(0,a.jsx)("div",{className:(0,l.m6)("flex-none rounded-full bg-green-400/10 p-1 text-zinc-400",(null===(t=p.data)||void 0===t?void 0:t.klippy_state)==="error"&&"bg-red-400/10 text-red-400",(null===(s=p.data)||void 0===s?void 0:s.klippy_state)==="startup"&&"bg-amber-400/10 text-amber-400",(null===(o=p.data)||void 0===o?void 0:o.klippy_state)==="ready"&&"bg-green-400/10 text-green-400",(null===(c=p.data)||void 0===c?void 0:c.klippy_state)==="shutdown"&&"bg-red-400/10 text-red-400"),children:(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-current"})}),(0,a.jsxs)("h1",{className:"flex gap-x-3 text-base leading-7",children:[(0,a.jsx)("span",{className:"font-semibold text-white",children:d.data}),(0,a.jsx)("span",{className:"text-zinc-600",children:"/"}),(0,a.jsx)("span",{className:"font-semibold text-white",children:h.data})]})]})}),(0,a.jsx)(n.Ct,{className:"order-first capitalize @screen-sm:order-none",color:void 0===v?"gray":"canceled"==v?"pink":"complete"==v?"green":"error"==v?"red":"paused"===v?"sky":"printing"===v?"yellow":"standby"===v?"brand":"gray",children:void 0===v?"Offline":null!=v?v:"Loading..."})]})}),(0,a.jsx)("div",{className:"border-t border-white/5 bg-zinc-700/10 backdrop-blur-sm",children:(0,a.jsx)("div",{className:"mx-auto grid max-w-7xl grid-cols-1 @screen-sm:grid-cols-2 @screen-lg:grid-cols-4",children:b.map((e,t)=>(0,a.jsxs)("div",{className:(0,l.m6)(t%2==1?"@screen-sm:border-l":2===t?"lg:border-l":"","border-white/5 px-4 py-6 @screen-sm:px-6 @screen-lg:px-8"),children:[(0,a.jsx)("p",{className:"text-sm font-medium leading-6 text-zinc-400",children:e.name}),(0,a.jsx)("p",{className:"mt-2 flex items-baseline gap-x-2",children:Array.isArray(e.value)?e.value.map((e,t)=>{let{val:s,unit:l}=e;return(0,a.jsxs)("span",{className:"flex items-baseline gap-x-2",children:[(0,a.jsx)("span",{className:"text-4xl font-semibold tracking-tight text-white",children:(0,a.jsx)(j.ZP,{start:0,end:null!=s?s:0,decimals:0,preserveValue:!0})},t),l?(0,a.jsx)("span",{className:"truncate text-sm text-zinc-400",children:l}):null]},t)}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-4xl font-semibold tracking-tight text-white",children:(0,a.jsx)(j.ZP,{start:0,end:e.value,decimals:2,preserveValue:!0})}),e.unit?(0,a.jsx)("span",{className:"text-sm text-zinc-400",children:e.unit}):null]})})]},e.name))})})]}),(0,a.jsx)("div",{className:"border-t border-white/10 pt-11",children:(0,a.jsxs)("div",{className:"mx-auto max-w-7xl",children:[(0,a.jsx)("h2",{className:"px-4 text-base font-semibold leading-7 text-white @screen-sm:px-6 @screen-lg:px-8",children:"Latest jobs"}),(0,a.jsx)(HistoryTable,{})]})})]})}},98130:function(e,t,s){"use strict";s.d(t,{$:function(){return Spinner}});var a=s(72612),l=s(63278);let Spinner=e=>{var t,s;return(0,a.jsxs)("svg",{className:(0,l.m6)("h-5 w-5 animate-spin text-black/50 dark:text-white/50",e.noMargin?"":"-ml-1 mr-3",e.className),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-20",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:null!==(t=e.strokeWidth)&&void 0!==t?t:4}),(0,a.jsx)("circle",{className:"opacity-100",cx:"12",cy:"12",r:"10",strokeDasharray:10*Math.PI/3,strokeLinecap:"round",stroke:"currentColor",strokeWidth:null!==(s=e.strokeWidth)&&void 0!==s?s:4})]})}},2750:function(e,t,s){"use strict";s.d(t,{PF:function(){return useMainsailQuery}}),s(39164);var a=s(96886);let useMainsailQuery=(e,t)=>(0,a.A4)("mainsail",e,t)}},function(e){e.O(0,[966,8965,5360,453,1087,9146,1863,4595,9321,8458,1744],function(){return e(e.s=73109)}),_N_E=e.O()}]);
//# sourceMappingURL=page-551dbad0f30e3605.js.map