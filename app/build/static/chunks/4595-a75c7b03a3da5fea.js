(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4595],{65660:function(){},98948:function(e,r,t){"use strict";t.d(r,{j:function(){return getLogger}});var n=t(74958),a=t.n(n),o=t(75061),i=t(10187),l=t(31354);let send=async function(e,r){i.u.clientLog.mutate({level:e,logEvent:l.s.parse(r)})},s=null,getLogger=()=>null!=s?s:s=a()({...o.N,browser:{transmit:{send}}})},39634:function(e,r,t){"use strict";t.d(r,{Bd:function(){return l},Ct:function(){return Badge},_1:function(){return s},iA:function(){return u},xU:function(){return c}});var n=t(72612),a=t(73918),o=t(63278),i=t(94594);let l=i.z.union([i.z.literal("rose"),i.z.literal("red"),i.z.literal("yellow"),i.z.literal("orange"),i.z.literal("green"),i.z.literal("lime"),i.z.literal("blue"),i.z.literal("sky"),i.z.literal("indigo"),i.z.literal("purple"),i.z.literal("pink"),i.z.literal("brand"),i.z.literal("gray"),i.z.literal("plain")]),s=(0,a.j)("",{variants:{color:{rose:"text-rose-700 dark:text-rose-400",red:"text-red-700 dark:text-red-400",yellow:"text-yellow-800 dark:text-yellow-500",orange:"text-orange-800 dark:text-orange-500",green:"text-green-700 dark:text-green-400",lime:"text-lime-700 dark:text-lime-400",blue:"text-blue-700 dark:text-blue-400",sky:"text-sky-700 dark:text-sky-400",indigo:"text-indigo-700 dark:text-indigo-400",purple:"text-purple-700 dark:text-purple-400",pink:"text-pink-700 dark:text-pink-400",brand:"text-brand-700 dark:text-brand-400",gray:"text-zinc-600 dark:text-zinc-400",plain:"text-zinc-900 dark:text-zinc-100"}}}),c=(0,a.j)("",{variants:{color:{rose:"bg-rose-50 dark:bg-rose-400/10",red:"bg-red-50 dark:bg-red-400/10",yellow:"bg-yellow-50 dark:bg-yellow-400/10",orange:"bg-orange-50 dark:bg-orange-400/10",green:"bg-green-50 dark:bg-green-500/10",lime:"bg-lime-50 dark:bg-lime-500/10",blue:"bg-blue-50 dark:bg-blue-400/10",sky:"bg-sky-50 dark:bg-sky-400/10",indigo:"bg-indigo-50 dark:bg-indigo-400/10",purple:"bg-purple-50 dark:bg-purple-400/10",pink:"bg-pink-50 dark:bg-pink-400/10",brand:"bg-brand-100 dark:bg-brand-400/10",gray:"bg-zinc-50 dark:bg-zinc-400/10",plain:"bg-zinc-900/10 dark:bg-zinc-100/10"}}}),u=(0,a.j)("",{variants:{color:{rose:"border-rose-600/10 dark:border-rose-400/20 ring-rose-600/10 dark:ring-rose-400/20",red:"border-red-600/10 dark:border-red-400/20 ring-red-600/10 dark:ring-red-400/20",yellow:"border-yellow-600/20 dark:border-yellow-400/20 ring-yellow-600/20 dark:ring-yellow-400/20",orange:"border-orange-600/20 dark:border-orange-400/20 ring-orange-600/20 dark:ring-orange-400/20",green:"border-green-600/20 dark:border-green-500/20 ring-green-600/20 dark:ring-green-500/20",lime:"border-lime-600/20 dark:border-lime-500/20 ring-lime-600/20 dark:ring-lime-500/20",blue:"border-blue-700/10 dark:border-blue-400/30 ring-blue-700/10 dark:ring-blue-400/30",sky:"border-sky-700/10 dark:border-sky-400/30 ring-sky-700/10 dark:ring-sky-400/30",indigo:"border-indigo-700/10 dark:border-indigo-400/30 ring-indigo-700/10 dark:ring-indigo-400/30",purple:"border-purple-700/10 dark:border-purple-400/30 ring-purple-700/10 dark:ring-purple-400/30",pink:"border-pink-700/10 dark:border-pink-400/20 ring-pink-700/10 dark:ring-pink-400/20",brand:"border-brand-600/40 dark:border-brand-400/30 ring-brand-600/40 dark:ring-brand-400/30",gray:"border-zinc-500/10 dark:border-zinc-400/20 ring-zinc-500/10 dark:ring-zinc-400/20",plain:"border-zinc-900 dark:border-zinc-100 ring-zinc-900 dark:ring-zinc-100"}}}),d=(0,a.j)("flex-0 inline-flex w-auto items-center rounded-md font-medium ring-1 ring-inset",{variants:{size:{sm:"px-1.5 gap-1.5 py-1 text-2xs leading-3",md:"px-2 gap-2 py-1 text-xs leading-4",lg:"px-2 gap-2 py-1 text-xs leading-6"},color:{rose:[c({color:"rose"}),u({color:"rose"}),s({color:"rose"})],red:[c({color:"red"}),u({color:"red"}),s({color:"red"})],yellow:[c({color:"yellow"}),u({color:"yellow"}),s({color:"yellow"})],orange:[c({color:"orange"}),u({color:"orange"}),s({color:"orange"})],green:[c({color:"green"}),u({color:"green"}),s({color:"green"})],lime:[c({color:"lime"}),u({color:"lime"}),s({color:"lime"})],blue:[c({color:"blue"}),u({color:"blue"}),s({color:"blue"})],sky:[c({color:"sky"}),u({color:"sky"}),s({color:"sky"})],indigo:[c({color:"indigo"}),u({color:"indigo"}),s({color:"indigo"})],purple:[c({color:"purple"}),u({color:"purple"}),s({color:"purple"})],pink:[c({color:"pink"}),u({color:"pink"}),s({color:"pink"})],brand:[c({color:"brand"}),u({color:"brand"}),s({color:"brand"})],gray:[c({color:"gray"}),u({color:"gray"}),s({color:"gray"})],plain:[c({color:"plain"}),u({color:"plain"}),s({color:"plain"})]}},defaultVariants:{size:"md",color:"gray"}}),Badge=e=>{let{size:r,color:t,className:a,children:i,...l}=e;return(0,n.jsx)("span",{className:(0,o.m6)(d({size:r,color:t}),a),...l,children:i})}},75061:function(e,r,t){"use strict";t.d(r,{N:function(){return n}});let n={timestamp:!0,level:"info"}},10187:function(e,r,t){"use strict";t.d(r,{S:function(){return n.SX},u:function(){return n.uF}});var n=t(79293)},81446:function(e,r,t){"use strict";t.d(r,{X:function(){return getHost},t:function(){return formatBytes}});let getHost=()=>{var e;return""!="".trim()?"":(null===(e=window.location)||void 0===e?void 0:e.hostname)!=null?window.location.hostname:null};function formatBytes(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0==e)return"0 bytes";var t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(r))+" "+["bytes","kb","mb","gb","tb","pb","eb","zb","yb"][t]}},96886:function(e,r,t){"use strict";t.d(r,{oK:function(){return useMoonraker},xH:function(){return useMoonrakerMutation},DS:function(){return useMoonrakerQuery},Fu:function(){return useMoonrakerState},A4:function(){return useNamespacedItemQuery},hS:function(){return usePrinterObjectQuery},Q:function(){return usePrinterObjectSubscription}});var n=t(39164),a=t(9948),o=t(65339),i=t(84634),l=t(81446);let s=[{version:1,description:"Undo double JSON encoding of RatOS's data",up:async()=>{let e=await window.fetch("http://".concat((0,l.X)(),"/server/database/item?namespace=RatOS"));if(!e.ok)return{result:"Nothing to migrate"};{let r=await e.json();if("error"in r)throw Error(r.error.message);let t=[];if(null==r.result.value)return{result:"Nothing to migrate"};for await(let[e,t]of Object.entries(r.result.value))try{let r=JSON.parse(t);console.log("Migrating",e,"from",t,"to",r),await window.fetch("http://".concat((0,l.X)(),"/server/database/item"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({namespace:"RatOS",key:e,value:r})})}catch(r){console.error("Error migrating",e,t,"clearing key"),await window.fetch("http://".concat((0,l.X)(),"/server/database/item?namespace=RatOS&key=").concat(encodeURIComponent(e)),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({namespace:"RatOS",key:e})});continue}return{result:"Succesfully decoded ".concat(t.length," keys.\n").concat(t.join("\n"))}}},down:async()=>{let e=await window.fetch("http://".concat((0,l.X)(),"/server/database/item?namespace=RatOS"));if(e.ok){let r=await e.json();if("error"in r)throw Error(r.error.message);if(null==r.result.value)return{result:"Nothing to migrate"};let t=[];for await(let[e,n]of Object.entries(r.result.value)){let r=JSON.stringify(n);await window.fetch("http://".concat((0,l.X)(),"/server/database/item"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({namespace:"RatOS",key:e,value:r})}),t.push("Re-encoded ".concat(e))}return{result:"Succesfully re-encoded ".concat(t.length," keys.\n").concat(t.join("\n"))}}return{result:"Nothing to migrate"}}},{version:2,description:"Change caramba printers to v-core-4 / v-chonk",up:async()=>{let e=await window.fetch("http://".concat((0,l.X)(),"/server/database/item?namespace=RatOS"));if(!e.ok)return{result:"Nothing to migrate"};{let r=await e.json();if("error"in r)throw Error(r.error.message);let t=[];if(null==r.result.value)return{result:"Nothing to migrate"};for await(let[e,n]of Object.entries(r.result.value))if("Printer"===e&&"string"==typeof n){let e=n.replace(/caramba-chonk/g,"v-chonk").replace(/caramba/g,"v-core-4");if(e===n)continue;await window.fetch("http://".concat((0,l.X)(),"/server/database/item"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({namespace:"RatOS",key:"Printer",value:e})}),t.push("Migrated ".concat(n," to ").concat(e))}return{result:"Succesfully migrated ".concat(t.length," keys.\n").concat(t.join("\n"))}}},down:async()=>{let e=await window.fetch("http://".concat((0,l.X)(),"/server/database/item?namespace=RatOS"));if(!e.ok)return{result:"Nothing to migrate"};{let r=await e.json();if("error"in r)throw Error(r.error.message);let t=[];if(null==r.result.value)return{result:"Nothing to migrate"};for await(let[e,n]of Object.entries(r.result.value))if("Printer"===e&&"string"==typeof n){let e=n.replace(/v-chonk/g,"caramba-chonk").replace(/v-core-4/g,"caramba");if(e===n)continue;await window.fetch("http://".concat((0,l.X)(),"/server/database/item"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({namespace:"RatOS",key:"Printer",value:e})}),t.push("Migrated ".concat(n," to ").concat(e))}return{result:"Succesfully migrated ".concat(t.length," keys.\n").concat(t.join("\n"))}}}}],getCurrentVersion=async()=>{let e=await window.fetch("http://".concat((0,l.X)(),"/server/database/item?namespace=RatOS&key=__db_version"));if(e.ok){let r=await e.json();return"error"in r?0:r.result.value}return 0},setCurrentVersion=async e=>{await window.fetch("http://".concat((0,l.X)(),"/server/database/item"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({namespace:"RatOS",key:"__db_version",value:e})})},c=!1,migrate=async(e,r)=>{if(c)return console.log("Already migrating, ignoring..");if(e===r)return console.log("Already at target version");c=!0;try{let t=s.filter(t=>t.version>e&&t.version<=r).sort((t,n)=>e<=r?t.version-n.version:n.version-t.version);for await(let n of t){let t=await (e<r?n.up():n.down());console.log("Migrated to version ".concat(n.version,": ").concat(t.result))}await setCurrentVersion(r)}finally{c=!1}},u=!1,migrateToLatest=async()=>{if(u)return console.log("Already migrated, ignoring..");let e=await getCurrentVersion(),r=Math.max(...s.map(e=>e.version));if(e===r){console.log("Already at latest version");return}if(c){console.log("Already migrating, ignoring..");return}console.log("Migrating to latest version...",e,r),await migrate(e,r),u=!0,console.log("Migration complete.")};var d=t(52540),g=t(86736),b=t.n(g),p=t(98948);let f=0,getWsURL=()=>{let e=(0,l.X)();return null==e||""==e.trim()?null:"ws://".concat(e,"/websocket")},y={},useMoonraker=e=>{let r=(0,n.useRef)({}),t=(0,n.useRef)({}),a=(0,n.useRef)([]),o=(0,n.useRef)([]),[l,s]=(0,n.useState)(getWsURL());(0,n.useEffect)(()=>{s(getWsURL())},[]);let c=(0,n.useCallback)(e=>{if("error"in e)return!1;if("notify_status_update"===e.method&&null!=e.params){let r=e.params[0];if(null!=r)for(let e of a.current){let t=y[e];if(null!=t){for(let e in t)if(null!=r[e])return!0}}}return!1},[]),{lastJsonMessage:u,sendJsonMessage:d,readyState:g}=(0,i.ZP)(l,{filter:t=>{if("connected"!==m)return!0;try{var n;let a=JSON.parse(t.data);if(null!=r.current[a.id]||(null==e?void 0:null===(n=e.passThroughUpdateMethods)||void 0===n?void 0:n.length)&&"method"in a&&e.passThroughUpdateMethods.includes(a.method))return!0}catch(e){(0,p.j)().warn({e,messageData:t.data},"Filter: Failed to parse message")}return!1},onMessage:r=>{if(null==e?void 0:e.onStatusUpdate)try{let n=JSON.parse(r.data);if(c(n)){var t;let r=n.params[0];null===(t=e.onStatusUpdate)||void 0===t||t.call(e,r)}}catch(e){(0,p.j)().warn({e,messageData:r.data},"OnMessage: Failed to parse message")}},shouldReconnect:e=>!0,reconnectAttempts:1/0,reconnectInterval:3e3,share:!0}),b=(0,n.useRef)(g);b.current=g;let[m,k]=(0,n.useState)(1===g?"connected":"connecting"),h=(0,n.useCallback)((e,r)=>{1===b.current?e():o.current.push({resolve:e,reject:r})},[]),v=(0,n.useCallback)(()=>new Promise((e,r)=>{h(e,r)}),[h]),w=(0,n.useCallback)(async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=++f;return await v(),new Promise((o,i)=>{r.current[a]=(e,r)=>e?i(e):r&&"object"==typeof r&&"error"in r&&r.error?i(r.error):null==r?i(Error("No result. Unknown response format.")):void o(r);let l=1e4;"printer.gcode.script"===e&&(l=6e5),t.current[a]=window.setTimeout(()=>{var e,n;null===(e=(n=r.current)[a])||void 0===e||e.call(n,Error("Request timed out"),null),delete r.current[a],delete t.current[a]},l),d({jsonrpc:"2.0",method:e,params:n,id:a})})},[v,d]),j=(0,n.useCallback)(async function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];let n=Object.fromEntries(r.map(e=>[e,null])),o=Object.assign({},n,...Object.values(y).filter(e=>null!=e)),i=w("printer.objects.subscribe",{objects:o}),l=f;y[l]=n,a.current.push(l);let s=(await i).status;return{res:s,unsuscribe:async()=>{if(a.current=a.current.filter(e=>e!==l),null==y[l]){delete y[l];let e=Object.assign({},...Object.values(y).filter(e=>null!=e));await w("printer.objects.subscribe",{objects:e})}}}},[w]),O=(0,n.useCallback)(async(e,r,t)=>(await v(),await w("server.database.post_item",{namespace:e,key:r,value:t})),[w,v]),S=(0,n.useCallback)(async(e,r)=>{await v();try{var t;let n=await w("server.database.get_item",{namespace:e,key:r});return null!==(t=null==n?void 0:n.value)&&void 0!==t?t:null}catch(e){return(0,p.j)().warn(e),null}},[w,v]);return(0,n.useEffect)(()=>{1===g?(async()=>{await migrateToLatest(),o.current.forEach(e=>e.resolve()),o.current=[],k("connected")})():k("connecting")},[g]),(0,n.useEffect)(()=>{(null==u?void 0:u.id)&&r.current[u.id]&&(window.clearTimeout(t.current[u.id]),"error"in u?r.current[u.id](Error(u.error.message),null):r.current[u.id](null,u.result),delete t.current[u.id],delete r.current[u.id])},[u]),(0,n.useEffect)(()=>()=>{for(let e in t.current)delete t.current[e],delete r.current[e];if(a.current.length>0){a.current.forEach(e=>{delete y[e]}),a.current=[];let e=Object.assign({},...Object.values(y).filter(e=>null!=e));w("printer.objects.subscribe",{objects:Object.keys(e).length>0?e:null}).catch(e=>{})}o.current.forEach(e=>e.reject()),o.current=[]},[]),{query:w,saveItem:O,getItem:S,subscribeToObject:j,status:m,lastMessage:u,isReady:1===g}},useNamespacedItemQuery=(e,r,t)=>{let{getItem:n}=useMoonraker();return(0,a.a)({...t,queryKey:[e,r],queryFn:async()=>n(e,r)})},useMoonrakerQuery=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];let{query:n}=useMoonraker(),o=3===r.length?r[2]:r[1],i=3===r.length?r[1]:void 0,l=r[0],s=3===r.length?[l,i]:[l];return(0,a.a)({...null!=o?o:{},queryKey:[r[0]],queryFn:async()=>n(...s)})},useMoonrakerMutation=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];let{query:n}=useMoonraker(),a=r[1],i=r[0];return(0,o.D)({...a,mutationKey:[r[0]],mutationFn:async e=>{let r=e?[i,e]:[i];return n(...r)}})},usePrinterObjectQuery=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];let{query:n}=useMoonraker();return(0,a.a)({queryKey:r,queryFn:async()=>{let e=Object.fromEntries(r.map(e=>[e,null]));return(await n("printer.objects.query",{objects:e})).status}})},usePrinterObjectSubscription=function(e){for(var r=arguments.length,t=Array(r>1?r-1:0),a=1;a<r;a++)t[a-1]=arguments[a];let[o,i]=(0,n.useState)(null),l=(0,n.useRef)(o);l.current=o;let s=(0,n.useRef)(e);s.current=e;let c=(0,n.useCallback)(e=>{var r;return null==s.current?e:null===(r=s.current)||void 0===r?void 0:r.call(s,e)},[]),u=(0,n.useMemo)(()=>Object.fromEntries(t.map(e=>[e,null])),[JSON.stringify(t.sort())]),{subscribeToObject:g}=useMoonraker({onStatusUpdate:(0,n.useCallback)(e=>{let r={};for(let t in u)null!=e[t]&&(r[t]=e[t]);let t=c(r);if(null==t||"object"!=typeof t)throw Error("Invalid selection function, must return object, got "+typeof t);Object.keys(r).length>0&&!1===b()(t,l.current)&&i(e=>(0,d.T)(null!=e?e:{},t))},[c,u])});return(0,n.useEffect)(()=>{let e=g(...Object.keys(u));return e.then(e=>{i(c(e.res))}).catch(e=>{e instanceof Error&&(0,p.j)().error(e)}),()=>{e.then(e=>e.unsuscribe()).catch(e=>{e instanceof Error&&(0,p.j)().error(e)})}},[c,u,g]),o},useNamespacedItemMutation=(e,r,t)=>{let{saveItem:n}=useMoonraker();return(0,o.D)({...t,mutationKey:[e,r],mutationFn:t=>n(e,r,t)})},useMoonrakerState=function(e,r){var t;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=useNamespacedItemQuery(e,r,{initialData:a}),i=useNamespacedItemMutation(e,r),l=(0,n.useCallback)(async e=>{var r;let t="function"==typeof e?e(null!==(r=o.data)&&void 0!==r?r:a):e;await i.mutateAsync(t,{onSuccess:()=>{o.refetch()}})},[a,i,o]);return[null!==(t=o.data)&&void 0!==t?t:a,l,o,i]}},79293:function(e,r,t){"use strict";t.d(r,{SX:function(){return o},uF:function(){return i}});var n=t(67763),a=t(61863);function getBaseUrl(){return"/configure"}t(28070);let o=(0,a.t)({config:()=>({links:[(0,n.N8)({url:"".concat(getBaseUrl(),"/api/trpc"),maxURLLength:2083})]}),overrides:{useMutation:{async onSuccess(e){await e.originalFn(),await e.queryClient.invalidateQueries()}}},ssr:!1}),i=(0,n.K5)({links:[(0,n.N8)({url:"".concat(getBaseUrl(),"/api/trpc"),maxURLLength:2083})]})},31354:function(e,r,t){"use strict";t.d(r,{s:function(){return o}});var n=t(94594);let a=n.z.enum(["trace","debug","info","warn","error","fatal"]),o=n.z.object({ts:n.z.number(),messages:n.z.array(n.z.any()),bindings:n.z.array(n.z.record(n.z.string(),n.z.any())),level:n.z.object({label:a,value:n.z.number()})})}}]);
//# sourceMappingURL=4595-a75c7b03a3da5fea.js.map