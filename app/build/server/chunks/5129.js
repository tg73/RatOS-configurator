"use strict";exports.id=5129,exports.ids=[5129],exports.modules={96303:(e,t,r)=>{r.d(t,{$:()=>InfoMessage});var a=r(96603),i=r(2465);r(51495);var n=r(29340);let InfoMessage=e=>a.jsx(n.j,{color:"blue",Icon:i,title:e.title?e.title:"Info",className:e.className,children:e.children})},35273:(e,t,r)=>{r.d(t,{wq:()=>PrinterConnectionHeader,Ch:()=>PrinterStateHeader});var a=r(96603),i=r(61418),n=r(30240),l=r(61331),s=r(21957),o=r(99234),d=r(51495);let useKlippyStateHandler=()=>{let{query:e,lastMessage:t}=(0,o.oK)({passThroughUpdateMethods:["notify_klippy_ready","notify_klippy_shutdown","notify_klippy_disconnected"]}),[r,a]=(0,d.useState)("unknown"),i=(0,d.useCallback)(async()=>{if(null!=e)try{let t=await e("server.info");if(t?.klippy_state==null)return;let r=t.klippy_state;a(r),"startup"===r&&setTimeout(()=>{i()},2e3)}catch(e){a("unknown")}},[e,a]);return(0,d.useEffect)(()=>{null!=e&&i()},[e,i]),(0,d.useEffect)(()=>{t&&"method"in t&&"notify_klippy_ready"===t.method&&a("ready"),t&&"method"in t&&"notify_klippy_shutdown"===t.method&&a("shutdown"),t&&"method"in t&&"notify_klippy_disconnected"===t.method&&(a("unknown"),i())},[t,i,a]),r},klipperStateToText=e=>{switch(e){case"error":return"Klipper State: Error";case"ready":return"Klipper State: Ready";case"shutdown":return"Klipper State: Shutdown";case"startup":return"Klipper State: Startup";default:return"Klipper State: Unknown"}},KlippyStateBadge=e=>{let t=useKlippyStateHandler(),r="orange";switch(t){case"error":r="red";break;case"ready":r="brand";break;case"shutdown":case"unknown":default:r="orange";break;case"startup":r="yellow"}return(0,a.jsxs)(l.Ct,{color:r,title:klipperStateToText(t),children:[a.jsx("svg",{className:(0,i.dV)((0,l._1)({color:r}),"h-2 w-2"),fill:"currentColor",viewBox:"0 0 8 8",children:a.jsx("circle",{cx:4,cy:4,r:3})}),"Klipper"]})},moonrakerStatusToText=e=>{switch(e){case"not-running":return"Moonraker State: Not Running";case"connected":return"Moonraker State: Connected";case"connecting":return"Moonraker State: Connecting";default:return"Moonraker State: Unknown"}},MoonrakerStateBadge=e=>{let{status:t}=(0,o.oK)(),r="orange";switch(t){case"not-running":r="red";break;case"connected":r="brand";break;case"connecting":r="yellow";break;default:r="orange"}return(0,a.jsxs)(l.Ct,{color:r,title:moonrakerStatusToText(t),children:[a.jsx("svg",{className:(0,i.dV)((0,l._1)({color:r}),"h-2 w-2"),fill:"currentColor",viewBox:"0 0 8 8",children:a.jsx("circle",{cx:4,cy:4,r:3})}),"Moonraker"]})};var c=r(86053),u=r(36986);let PrinterHeader=e=>(0,a.jsxs)("div",{className:"mt-6 @container",children:[a.jsx("div",{className:"border-t border-white/10 bg-zinc-700/15 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"mx-auto flex max-w-7xl flex-row items-center justify-between gap-x-8 gap-y-4 px-4 py-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-3",children:[a.jsx("div",{className:(0,i.m6)("flex-none rounded-full bg-green-400/10 p-1 text-zinc-400",e.stateColorClass),children:a.jsx("div",{className:"h-2 w-2 rounded-full bg-current"})}),a.jsx("h1",{className:"flex gap-x-3 text-base leading-7",children:e.breadcrumb?.map((t,r)=>a.jsxs(d.Fragment,{children:[a.jsx("span",{className:"font-semibold text-white",children:t}),r<(e.breadcrumb?.length??0)-1&&a.jsx("span",{className:"text-zinc-400",children:"/"})]},r))})]}),a.jsx("div",{className:"capitalize",children:e.badges})]})}),a.jsx("header",{className:"sticky top-14 z-10 flex flex-grow-0 items-center gap-1 border-y border-b-white/10 border-t-white/5 bg-zinc-700/10 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"mx-auto w-full max-w-7xl gap-x-8 px-4 py-4",children:[a.jsx("h3",{className:"dark:focus-ring-0 flex h-auto flex-1 border-none p-0 text-xl font-medium focus:ring-0 focus:ring-offset-0",children:e.title}),a.jsx("p",{className:"dark:focus-ring-0 flex h-auto flex-1 border-none p-0 text-base font-medium text-muted-foreground focus:ring-0 focus:ring-offset-0 dark:text-muted-foreground",children:e.description})]})})]}),PrinterStateHeader=e=>{let t=(0,s.PF)("general.printername",{initialData:"Loading..."}),r=(0,u.useRecoilValue)(c.Xu),p=(0,o.DS)("server.info"),x=(0,o.hS)("print_stats"),m=x.data?.print_stats.state,h=(0,d.useMemo)(()=>{let e=[t.data??"RatOS"];return p.isLoading?e.push("Loading..."):r?.name&&e.push(r.name),e},[p.isLoading,t.data,r?.name]),f=(0,n.O)();return f?a.jsx(PrinterHeader,{stateColorClass:(0,i.dV)(p.data?.klippy_state==="error"&&"bg-red-400/10 text-red-400",p.data?.klippy_state==="startup"&&"bg-amber-400/10 text-amber-400",p.data?.klippy_state==="ready"&&"bg-green-400/10 text-green-400",p.data?.klippy_state==="shutdown"&&"bg-red-400/10 text-red-400"),breadcrumb:h,badges:a.jsx(l.Ct,{className:"order-first capitalize @screen-sm:order-none",color:void 0===m?"gray":"canceled"==m?"pink":"complete"==m?"green":"error"==m?"red":"paused"===m?"sky":"printing"===m?"yellow":"standby"===m?"brand":"gray",children:void 0===m?"Offline":m??"Loading..."}),title:e.title,description:e.description}):a.jsx(PrinterStateLoadingHeader,{})},PrinterConnectionHeader=e=>{let t=(0,s.PF)("general.printername",{initialData:"Loading..."}),r=(0,u.useRecoilValue)(c.Xu),l=(0,o.DS)("server.info"),p=(0,n.O)(),x=(0,d.useMemo)(()=>{let e=[t.data??"RatOS"];return l.isLoading?e.push("Loading..."):r?.name&&e.push(r.name),e},[l.isLoading,t.data,r?.name]);return p?a.jsx(PrinterHeader,{stateColorClass:(0,i.dV)(l.data?.klippy_state==="error"&&"bg-red-400/10 text-red-400",l.data?.klippy_state==="startup"&&"bg-amber-400/10 text-amber-400",l.data?.klippy_state==="ready"&&"bg-green-400/10 text-green-400",l.data?.klippy_state==="shutdown"&&"bg-red-400/10 text-red-400"),breadcrumb:x,badges:(0,a.jsxs)("div",{className:"inline-flex space-x-1 sm:flex-row-reverse sm:justify-end sm:space-x-2 sm:space-y-0 md:flex-row",children:[a.jsx(KlippyStateBadge,{}),a.jsx(MoonrakerStateBadge,{})]}),title:e.title,description:e.description}):a.jsx(PrinterStateLoadingHeader,{})},PrinterStateLoadingHeader=()=>a.jsx(PrinterHeader,{stateColorClass:"bg-gray-400/10 text-gray-400",breadcrumb:["RatOS","Loading..."],title:"Loading printer state...",description:"Please wait while RatOS loads your printer state",badges:(0,a.jsxs)("div",{className:"flex space-x-1 sm:flex-row-reverse sm:justify-end sm:space-x-2 sm:space-y-0 md:flex-row",children:[a.jsx(KlippyStateBadge,{}),a.jsx(MoonrakerStateBadge,{})]})})},78765:(e,t,r)=>{r.d(t,{o:()=>QueryStatus});var a=r(96603),i=r(50089),n=r(24240),l=r(78438);let QueryStatus=e=>{let t=null;return e.isError&&(t=a.jsx("div",{className:"mb-4",children:a.jsx(i.B,{children:e.error?.message})})),e.isLoading&&(t=a.jsx("div",{className:"mb-4 flex items-center justify-center",children:a.jsx(n.$,{})})),a.jsx(l.i,{children:t})}},18303:(e,t,r)=>{r.d(t,{o:()=>FileChanges});var a=r(96603),i=r(51495),n=r(76461),l=r(68797),s=r(41380);r(18089);var o=r(61418),d=r(71521),c=r(42928),u=r(81297),p=r(36707),x=r(28544);let m={up:e=>(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:(0,o.dV)("lucide lucide-arrow-up-from-line",e.className),children:[a.jsx("path",{d:"m18 9-6-6-6 6"}),a.jsx("path",{d:"M12 3v14"}),a.jsx("path",{d:"M5 21h14",strokeDasharray:"2,4"})]}),down:e=>(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:(0,o.dV)("lucide lucide-arrow-up-from-line rotate-180",e.className),children:[a.jsx("path",{d:"m18 9-6-6-6 6"}),a.jsx("path",{d:"M12 3v14"}),a.jsx("path",{d:"M5 21h14",strokeDasharray:"2,4"})]}),none:x.Z};function Unfold({start:e,end:t,direction:r,onExpand:n,collapsedLines:l,floatUp:o,...d}){let c=(0,i.useCallback)(()=>n(e,t),[n,e,t]),u=m[r];return(0,a.jsxs)(s.p,{...d,children:[a.jsx("div",{className:"flex cursor-pointer items-center justify-center gap-1 bg-sky-400/20 p-3 font-sans text-base font-medium text-slate-400 hover:bg-sky-400/50 hover:text-foreground",onClick:c,title:`Expand${"none"===r?"":" "+r}`,children:a.jsx(u,{className:"size-4"})}),a.jsx("div",{className:"flex h-full w-full items-center justify-center bg-sky-400/5 p-3 text-[1rem] font-normal leading-4 text-slate-600",children:null==l?a.jsx("span",{className:"inline-block h-4"}):(0,a.jsxs)("span",{className:o?"relative -top-1 -translate-y-full":void 0,children:["<--"," ",l," collapsed line",1===l?"":"s"," ","-->"]})})]})}function UnfoldCollapsed({previousHunk:e,currentHunk:t,linesCount:r,onExpand:i}){if(!t){let t=e.oldStart+e.oldLines,n=r-t+1;return n<=0?null:a.jsx(Unfold,{direction:"down",start:t,end:n>20?t+20:r+1,collapsedLines:n,onExpand:i})}let n=(0,s.sy)(e,t);if(!e){if(!n)return null;let e=Math.max(t.oldStart-20,1);return a.jsx(Unfold,{direction:"up",start:n>20?e:1,end:t.oldStart,collapsedLines:n,onExpand:i})}let l=e.oldStart+e.oldLines,o=t.oldStart;return n<20?a.jsx(Unfold,{direction:"none",start:l,end:o,onExpand:i,collapsedLines:n}):(0,a.jsxs)(a.Fragment,{children:[a.jsx(Unfold,{direction:"down",start:l,end:l+20,onExpand:i,collapsedLines:null}),a.jsx(Unfold,{direction:"up",start:o-20,end:o,onExpand:i,floatUp:!0,collapsedLines:n})]})}var h=r(96303);let f=new Worker(new URL(r.p+r.u(8131),r.b)),TwoColumns=e=>a.jsx("svg",{viewBox:"0 0 24 24",fill:"none",strokeWidth:"1.5",stroke:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:(0,o.m6)("h-6 w-6",e.className),children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M 12 4.5 L 12 19.5 M 4.125 19.5 L 19.875 19.5 C 20.496 19.5 21 18.996 21 18.375 L 21 5.625 C 21 5.004 20.496 4.5 19.875 4.5 L 4.125 4.5 C 3.504 4.5 3 5.004 3 5.625 L 3 18.375 C 3 18.996 3.504 19.5 4.125 19.5 Z"})}),SingleColumn=e=>a.jsx("svg",{viewBox:"0 0 24 24",fill:"none",strokeWidth:"1.5",stroke:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:(0,o.m6)("h-6 w-6",e.className),children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M 4.125 19.5 L 19.875 19.5 C 20.496 19.5 21 18.996 21 18.375 L 21 5.625 C 21 5.004 20.496 4.5 19.875 4.5 L 4.125 4.5 C 3.504 4.5 3 5.004 3 5.625 L 3 18.375 C 3 18.996 3.504 19.5 4.125 19.5 Z"})}),DiffModal=e=>{let{isOpen:t,setIsOpen:r}=e,[n,l]=(0,i.useState)("unified"),x=(0,i.useCallback)(()=>{r(!1)},[r]),m=(0,i.useMemo)(()=>(0,s.z2)(e.diff)[0],[e.diff]),g=e.source?e.source.split("\n").length:0,{tokens:v,expandRange:k,hunks:j}=function(e,t){let[r,a]=(0,s._8)(e,t),i=(0,s.RP)(0,r,t),{tokens:n}=(0,s.P2)(f,{oldSource:t,language:"properties",hunks:i});return{expandRange:a,tokens:n,hunks:i}}(m.hunks,e.source??""),b=(0,i.useCallback)(({change:e,side:t})=>{let r="old"===t?(0,s.Hp)(e):(0,s.am)(e),i="delete"===e.type&&"old"===t?a.jsx(c.Z,{className:"h-4 w-4"}):"insert"===e.type&&"new"===t?a.jsx(u.Z,{className:"h-4 w-4"}):"";return(0,a.jsxs)("div",{className:"flex flex-1 items-center gap-1 text-left",children:[a.jsx("span",{className:"flex-1",children:-1===r?null:r}),i]})},[]),renderHunk=(t,r,i,n)=>{let l=t[t.length-1],o=e.source?a.jsx(UnfoldCollapsed,{previousHunk:l&&l.props.hunk,currentHunk:r,linesCount:g,onExpand:k},`decoration-${r.content}`):a.jsx(a.Fragment,{});t.push(o);let d=a.jsx(s.SC,{hunk:r},`hunk-${r.content}`);if(t.push(d),i===n.length-1&&e.source){let e=a.jsx(UnfoldCollapsed,{previousHunk:r,linesCount:g,onExpand:k},"decoration-tail");t.push(e)}return t},y="changed"===e.state?"modify":"created"===e.state?"add":"delete";return t&&a.jsx(d.u,{title:`Changes to ${e.fileName}`,onClosed:x,noClose:!0,wide:"screen",buttons:e.buttons,body:`RatOS wants to make the following changes to ${e.fileName}. Do you want to accept these changes?`,dismissText:"Close",titleActions:(0,a.jsxs)("div",{className:"relative flex flex-nowrap items-center gap-2 text-muted-foreground",children:[a.jsx("button",{className:(0,o.dV)("unified"===n?"cursor-default text-sky-600 dark:text-sky-400":"hover:text-zinc-800 dark:hover:text-zinc-100"),onClick:()=>l("unified"),title:"Unified View",children:a.jsx(SingleColumn,{className:"h-6 w-6"})}),a.jsx("button",{className:(0,o.dV)("split"===n?"cursor-default text-sky-600 dark:text-sky-400":"hover:text-zinc-800 dark:hover:text-zinc-100"),onClick:()=>l("split"),title:"Split View",children:a.jsx(TwoColumns,{className:"h-6 w-6"})}),a.jsx("div",{className:"!ml-2 !mr-1 h-6 border-l border-l-zinc-200 dark:border-l-zinc-800"}),a.jsx("button",{className:"hover:text-zinc-800 dark:hover:text-zinc-100",onClick:x,children:a.jsx(p.Z,{className:"h-6 w-6"})})]}),content:a.jsx(a.Fragment,{children:(0,a.jsxs)("div",{className:"git-diff flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-400 scrollbar-thumb-rounded-md dark:scrollbar-thumb-zinc-600",children:["printer.cfg"===e.fileName&&e.changedOnDisk&&a.jsx(h.$,{title:"You might not need these changes",className:"mb-4",children:"RatOS currently does not have the ability to port your customizations to generated code, and printer.cfg is usually only regenerated when printer limit defaults have changed or you swap hardware type. If you haven't changed hardware types, you can most likely ignore these changes."}),a.jsx(s.zI,{hunks:j,viewType:n,diffType:y,tokens:v,renderGutter:b,children:e=>e.reduce(renderHunk,[])})]})})})};var g=r(5955),v=r(61709);let k=(0,v.j)("flex-none rounded-full p-1 relative flex",{variants:{state:{success:"dark:text-green-400 text-green-500 bg-green-400/20",info:"dark:text-sky-400 text-sky-500 bg-sky-400/20",warning:"dark:text-yellow-400 text-yellow-500 bg-yellow-400/20",danger:"dark:text-rose-400 text-rose-500 bg-rose-400/20",indeterminate:"dark:text-zinc-400 text-zinc-500 bg-zinc-500/20",plain:"dark:text-zinc-400 text-zinc-500 bg-zinc-500/20",primary:"dark:text-brand-400 text-brand-500 bg-brand-500/20"}}}),StateCircle=e=>(0,a.jsxs)("div",{className:k(e),children:[a.jsx("div",{title:e.title,className:(0,o.m6)("absolute inset-0 transition-all duration-700",e.ping?"opacity-100":"opacity-0",e.pingClassName??"z-2"),children:a.jsx("div",{className:(0,o.m6)("absolute inset-0 inline-flex animate-ping rounded-full bg-current opacity-0 ease-out")})}),a.jsx("div",{className:"h-2 w-2 rounded-full bg-current"})]});var j=r(61331),b=r(19623),y=r(63728),w=r(28986),S=r(78765),N=r(60991),R=r(7837),C=r(55428),D=r(42135),M=r(99060),L=r(41193);let ChangedFile=e=>{let{addFileToIgnore:t,addFileToOverwrite:r,file:n,removeFileToIgnore:l,removeFileToOverwrite:s,isMarkedIgnored:o,isMarkedOverwritten:d}=e,[c,p]=(0,i.useState)(!1),x=(0,i.useCallback)(e=>{p(!0)},[]),m="changed"===n.state&&(n.overwrite||d)||"created"===n.state||"removed"===n.state,h="changed"===n.state,f="created"===n.state||"removed"===n.state||"changed"===n.state,v=d||n.overwrite&&n.exists,k=f&&!o&&!v&&!m&&!0===n.changedFromConfig;n.state,n.state,n.state;let S=(0,i.useMemo)(()=>{if("RatOS.cfg"===n.fileName)return[];let e=null,a=null,i=null,c=null,p=null;return v&&!o?e={title:"Skip",intent:"indeterminate",icon:R.Z,action:d?s:t}:h&&(i={title:"Accept changes",intent:"warning",icon:C.Z,action:o?e=>{l(e),r(e)}:r}),!f||o||v?o&&("removed"===n.state?p={title:"Delete",intent:"danger",icon:M.Z,action:l}:f&&!h&&(c={title:"Write",icon:u.Z,intent:"success",action:l})):a={title:"Keep existing file",icon:D.Z,intent:k?"printer.cfg"===n.fileName?"info":"danger":"indeterminate",action:t},[e,a,i,c,p].filter(Boolean)},[t,r,n.fileName,n.state,f,o,o,d,h,v,k,l,s]),z=(0,i.useMemo)(()=>k?"danger":"changed"===n.state?o&&n.overwrite||v&&!n.overwrite?"warning":v?"success":"indeterminate":"created"===n.state?o?"danger":"success":"removed"!==n.state||o?"indeterminate":"warning",[n.overwrite,n.state,o,v,k]),[_]=(0,y.S)([z],4e3);return(0,a.jsxs)("li",{className:"flex items-center justify-between gap-x-6 py-5",children:[n?.diff!=null&&a.jsx(DiffModal,{diff:n.diff,fileName:n.fileName,state:n.state,changedOnDisk:n.changedOnDisk,source:n.diskContent,setIsOpen:p,buttons:S.map(e=>(0,a.jsxs)(b.z,{onClick:()=>{e.action(n.fileName),p(!1)},variant:e.intent,children:[a.jsx(e.icon,{className:"h-4 w-4"}),e.title]},e.title)),isOpen:c}),(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-3",children:[a.jsx(StateCircle,{state:z,ping:_}),a.jsx("p",{className:"text-sm font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:n.fileName}),a.jsx(j.Ct,{size:"sm",color:"changed"===n.state?n.changedFromConfig?"yellow":"sky":"created"===n.state?"green":"removed"===n.state?"rose":"gray",children:"changed"===n.state?n.changedFromConfig?"Pending changes":"Changed on disk":"created"===n.state?"New file":"removed"===n.state?"Deleted":"No updates"}),n.changedOnDisk&&a.jsx(j.Ct,{size:"sm",color:"sky",children:"Changed on disk"})]}),a.jsx("div",{className:"mt-1 flex items-center gap-x-2 text-xs leading-5 text-zinc-500 dark:text-zinc-400",children:(0,a.jsxs)("p",{className:"",children:["changed"===n.state&&(v&&!o?"File will be backed up and overwritten."+("RatOS.cfg"!=n.fileName?" Any changes you've made can be recovered from the backup.":""):k?"Please review the changes and make a decision.":"File will be skipped."),"created"===n.state&&(o?"File will be skipped.":"File will be created."),"removed"===n.state&&(o?"File will remain untouched.":"File will be deleted."),"unchanged"===n.state&&(n.changedOnDisk?"File has user modifications.":"File remains untouched.")]})})]}),(0,a.jsxs)("div",{className:"flex flex-none items-center gap-x-4",children:[a.jsx("div",{className:"flex flex-none items-center",children:k?a.jsx(b.z,{variant:"info",onClick:()=>x(n),children:"Review changes"}):a.jsx(w,{className:"h-5 w-5 text-green-500 dark:text-brand-500","aria-hidden":"true"})}),(0,a.jsxs)(N.h_,{children:[(0,a.jsxs)(N.$F,{className:"-m-2.5 block p-2.5 text-zinc-500 hover:text-zinc-900 dark:text-zinc-400 dark:hover:text-zinc-100",children:[a.jsx("span",{className:"sr-only",children:"Open options"}),a.jsx(g,{className:"h-5 w-5","aria-hidden":"true"})]}),(0,a.jsxs)(N.AW,{children:[S.map(e=>(0,a.jsxs)(N.Xi,{onClick:()=>e.action(n.fileName),className:"gap-2",children:[a.jsx(e.icon,{className:"h-4 w-4 text-muted-foreground"}),e.title]},e.title)),(0,a.jsxs)(N.Xi,{disabled:null==n.diff,onClick:()=>x(n),className:"gap-2",children:[a.jsx(L.Z,{className:"h-4 w-4 text-muted-foreground"}),"View diff"]})]})]})]})]},n.fileName)},FileChanges=e=>{let{serializedConfig:t,onFilesToIgnoreChange:r,onFilesToOverwriteChange:s}=e,[o,d]=(0,i.useState)([]),c=(0,i.useCallback)(e=>{d(t=>t.includes(e)?t:[...t,e])},[]),u=(0,i.useCallback)(e=>{d(t=>t.includes(e)?t.filter(t=>t!==e):t)},[]),[p,x]=(0,i.useState)([]),m=(0,i.useCallback)(e=>{x(t=>t.includes(e)?t:[...t,e])},[]),h=(0,i.useCallback)(e=>{x(t=>t.includes(e)?t.filter(t=>t!==e):t)},[]);(0,i.useEffect)(()=>{s(o)},[o,s]),(0,i.useEffect)(()=>{r(p)},[p,r]);let f=n.SX.useUtils().client,g=(0,l.a)({queryKey:["printer.filesToWrite",t],queryFn:async()=>{let e=await f.printer.getFilesToWrite.mutate({config:t??{}});return e},enabled:null!=t});return(0,a.jsxs)(a.Fragment,{children:[a.jsx("ul",{role:"list",className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:g.data?.map(e=>a.jsx(ChangedFile,{file:e,isMarkedIgnored:p.includes(e.fileName),isMarkedOverwritten:o.includes(e.fileName),addFileToIgnore:m,addFileToOverwrite:c,removeFileToIgnore:h,removeFileToOverwrite:u},e.fileName))}),a.jsx(S.o,{...g})]})}},75310:(e,t,r)=>{r.d(t,{l:()=>PrinterRailSettings});var a=r(96603),i=r(30006),n=r(51495),l=r(95597),s=r(4106),o=r(61331),d=r(55260),c=r(29340),u=r(18391),p=r(62108),x=r(36986),m=r(74321),h=r(30819),f=r(79030),g=r(86053),v=r(82251),k=r(76461),j=r(61418),b=r(13728),y=r(30413),w=r(47994),S=r(73367);b.z.array(h.g6);let PrinterRailSettings=e=>{let t=(0,v.YC)(),r=t.find(t=>t.getExtruderAxis()===e.printerRail.axis),b=t.every(e=>e.hasToolboard()),N=r?.getExtruderAxis()===e.printerRailDefault.axis&&r?.hasToolboard(),R=N?r.getToolboard():e.selectedBoard,[C,D]=(0,n.useState)(!!e.performanceMode),M=(0,x.useSetRecoilState)((0,g.ew)(e.printerRail.axis)),L=(0,x.useRecoilValue)(g.q7),[z,_]=(0,n.useState)(e.printerRail.motorSlot&&e.selectedBoard?.motorSlots?.[e.printerRail.motorSlot]?e.printerRail.motorSlot:void 0),T=R?.integratedDrivers?R.integratedDrivers[z??(e.printerRail.axis.startsWith("extruder")?h.po.extruder:e.printerRail.axis)]??R.integratedDrivers[e.printerRail.axis.startsWith("extruder")?h.po.extruder:e.printerRail.axis]:null,[F,O]=(0,n.useState)(null!=T?(0,f.Df)(T)??e.printerRail.driver:e.printerRail.driver),[P,E]=(0,n.useState)(e.printerRail.stepper),[B,U]=(0,n.useState)(C?e.printerRailDefault.performanceMode?.homingSpeed??e.printerRailDefault.homingSpeed:e.printerRailDefault.homingSpeed),H=null==e.errors?0:Object.keys(e.errors).reduce((t,r)=>{let a=e.errors?.[r];if(null==a)return t;let i=Array.isArray(a)?a.length:a._errors.length;return t+i},0),A=(0,n.useCallback)(r=>null!=r&&L.some(a=>{let i=t.find(e=>e.getExtruderAxis()===a.axis);return!(a.axis===e.printerRail.axis||i?.hasToolboard())&&a.motorSlot===r}),[L,e.printerRail.axis,t]),I=k.SX.mcu.reversePinLookup.useQuery({axis:e.printerRail.axis,canUseExtruderlessConfigs:b,boardPath:R?.path??""},{enabled:!!R});(0,n.useEffect)(()=>{I.data&&null==z&&R?.motorSlots?.[I.data]!=null&&(0,n.startTransition)(()=>{if(_(I.data?I.data:void 0),I.data&&R?.integratedDrivers?.[I.data]!=null){let e=(0,f.Df)(R.integratedDrivers[I.data]);e&&O(e)}})},[R,I.data,z,e.printerRailDefault.axis]);let V=(0,h.Wx)(R,F).map(e=>({...e,badge:null!=(0,s.a)(P,F,e.id,void 0,C)?{children:"Tuned Preset",color:"sky"}:void 0})),[W,K]=(0,n.useState)(V.find(t=>t.id===e.printerRail.voltage)??V.find(t=>t.id===(C&&e.printerRailDefault.performanceMode?.voltage?e.printerRailDefault.performanceMode.voltage:e.printerRailDefault.voltage))??V[0]),[Z,$]=(0,n.useState)(e.printerRail.current),Y=(0,n.useMemo)(()=>(0,s.a)(e.printerRailDefault.stepper,e.printerRailDefault.driver,e.printerRailDefault.voltage,e.printerRailDefault.current),[e.printerRailDefault]),X=(0,n.useMemo)(()=>(0,s.a)(P,F,W.id,void 0,C),[P,F,W,C]),Q=(0,n.useMemo)(()=>(0,s.a)(P,F,W.id,Z,C),[P,F,W,C,Z]),q=l.N.filter(e=>"UART"===e.protocol||R?.stepperSPI!=null).map(e=>({...e,badge:null!=(0,s.a)(P,e,W.id,void 0,C)?{children:"Tuned Preset",color:"sky"}:void 0})),G=s.B.map(e=>({...e,badge:null!=(0,s.a)(e,F,W.id,void 0,C)?{children:"Tuned Preset",color:"sky"}:void 0}));(0,n.useEffect)(()=>{(0,h.R_)(e.printerRail,e.printerRailDefault,!e.performanceMode)&&(e.performanceMode&&e.printerRailDefault.performanceMode?(U(e.printerRailDefault.performanceMode.homingSpeed??e.printerRail.homingSpeed),null!=e.printerRailDefault.performanceMode.voltage&&K(V.find(t=>t.id===(e.printerRailDefault.performanceMode?.voltage??e.printerRailDefault.voltage))??V[0]),null!=e.printerRailDefault.performanceMode.current&&$(e.printerRailDefault.performanceMode.current)):(U(e.printerRailDefault.homingSpeed),K(V.find(t=>t.id===e.printerRailDefault.voltage)??V[0]),$(e.printerRailDefault.current))),D(!!e.performanceMode)},[e.performanceMode]),(0,n.useEffect)(()=>{let e=V.find(e=>e.id===W.id);!e&&(K(X?V.find(e=>e.id===X.voltage)??V[0]:V[0]),X&&$(X.run_current))},[V,W,X]),(0,n.useEffect)(()=>{let t={axis:e.printerRail.axis,axisDescription:e.printerRail.axisDescription,rotationDistance:e.printerRail.rotationDistance,invertStepperDirection:e.printerRail.invertStepperDirection,axisMinimum:e.printerRail.axisMinimum,axisMaximum:e.printerRail.axisMaximum,axisEndstop:e.printerRail.axisEndstop,homingSpeed:B,motorSlot:z,microstepping:e.printerRail.microstepping,gearRatio:e.printerRail.gearRatio,driver:F,voltage:W.id,stepper:P,current:Z},r=(0,f.Yz)(t),a=(0,f.Yz)(e.printerRail),i=Object.keys(r).some(e=>r[e]!==a[e]);i&&(0,n.startTransition)(()=>{M(r)})},[Z,F,e.printerRail,B,M,P,W.id,z]);let J=X&&X.run_current===Z,ee="extruder"===e.printerRail.axis?"Extruder T0":e.printerRail.axis===h.po.extruder1?"Extruder T1":"Stepper "+e.printerRail.axis.toLocaleUpperCase(),et=R?.motorSlots!=null&&Object.keys(R.motorSlots).length>0?Object.keys(R.motorSlots).map(t=>{if(R.motorSlots?.[t].title==null)return null;let r=R.motorSlots?.[t].diag_pin!=null,a=R.motorSlots?.[t].endstop_pin!=null,i=A(t),n=(e.printerRailDefault.axis.startsWith("x")||e.printerRailDefault.axis.startsWith("y"))&&!r;return{id:t,title:R.motorSlots?.[t].title,disabled:n,badge:[r?void 0:{children:"No diag pin",color:n?"red":"gray"},a?void 0:{children:"No endstop pin",color:"gray"},!0===i?{children:"In use",color:"orange"}:void 0].filter(Boolean)}}).filter(Boolean):null,er=(0,n.useMemo)(()=>{if(null==z||R?.motorSlots?.[z].title==null)return;let t=R.motorSlots?.[z].diag_pin!=null,r=(e.printerRailDefault.axis.startsWith("x")||e.printerRailDefault.axis.startsWith("y"))&&!t;return!t&&r?{children:"No diag pin",color:"red"}:void 0},[R,z,e.printerRailDefault.axis]);return a.jsx(y.M,{children:e.isVisible&&(0,a.jsxs)(w.Card,{exit:{opacity:0,scale:.9,y:-40},initial:{opacity:0,scale:.9,y:40},animate:{opacity:1,scale:1,y:0},className:(0,j.m6)("break-inside-avoid-column",H>0&&(0,o.iA)({color:"red"}),H>0&&(0,o.xU)({color:"red"}),H>0&&"ring-1"),children:[(0,a.jsxs)(S.Ol,{className:"",children:[a.jsx(S.ll,{className:(0,j.m6)(H>0&&"text-red-900/80 dark:text-red-100"),children:ee}),a.jsx(S.SZ,{className:(0,j.m6)(H>0&&"text-red-800/80 dark:text-red-100/60"),children:e.printerRail.axisDescription})]}),(0,a.jsxs)(S.aY,{className:"grid grid-cols-1 gap-4 @2xs:grid-cols-2",children:[et&&a.jsx("div",{className:"col-span-full",children:a.jsx(i.Lt,{label:"Motor Slot",options:et,error:e.errors?.motorSlot?._errors.join("\n"),onSelect:e=>{_(e.id),R?.integratedDrivers?.[e.id]!=null&&O((0,f.Df)(R.integratedDrivers[e.id])??F)},value:z?et.find(e=>e.id===z):void 0,badge:er})}),a.jsx("div",{className:"col-span-full",children:a.jsx(i.Lt,{label:"Driver",options:q,onSelect:O,value:F,disabled:null!=T,badge:[null!=T?{children:"Integrated",color:"sky"}:void 0,N?{children:"Toolboard",color:"yellow"}:void 0].filter(Boolean)})}),a.jsx("div",{className:"col-span-full",children:a.jsx(i.Lt,{label:"Stepper",options:G,onSelect:E,value:P})}),a.jsx("div",{className:"col-span-1",children:a.jsx(i.Lt,{label:"Voltage",options:V,onSelect:K,value:W})}),a.jsx("div",{className:"col-span-1",children:a.jsx(d.o,{type:"number",label:"Current",value:Z,onChange:$,inputMode:"decimal",step:"any",min:0,max:F.maxCurrent})}),P.maxPeakCurrent/1.41<Z&&(0,a.jsxs)(c.j,{Icon:m,color:"yellow",title:"Stepper overcurrent!",className:"col-span-full",children:["Your stepper motor is rated for ",Math.floor(100*P.maxPeakCurrent/1.41)/100,"A RMS, but you are using ",Z,"A."]}),null!=Q&&a.jsx(c.j,{Icon:u,color:"brand",title:"Driver tuning applied!",className:"col-span-full",children:"RatOS preset applied automatically."}),Q?.run_current!==Y?.run_current&&X&&!J&&(0,a.jsxs)(c.j,{Icon:p,color:"sky",title:"Recommended tuning preset available at different current",className:"col-span-full",children:["RatOS has a recommended preset for your current settings at ",X.run_current,"A. You can"," ",(0,a.jsxs)("span",{className:"cursor-pointer font-bold underline hover:no-underline",onClick:()=>$(X.run_current),children:["change the current to ",X.run_current,"A"]})," ","to apply the preset automatically."]})]})]},e.printerRail.axis)})}},21957:(e,t,r)=>{r.d(t,{PF:()=>useMainsailQuery}),r(51495);var a=r(99234);let useMainsailQuery=(e,t)=>(0,a.A4)("mainsail",e,t)}};