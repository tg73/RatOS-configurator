exports.id=2017,exports.ids=[2017,3926],exports.modules={26004:(e,r,t)=>{var o={"./extras/sensorless-homing":[24851,4851],"./extras/sensorless-homing.ts":[24851,4851],"./prusa-mini":[35224,5224],"./prusa-mini.ts":[35224,5224],"./prusa-mk3s":[5155,5155],"./prusa-mk3s.ts":[5155,5155],"./v-chonk":[2422,2422],"./v-chonk-3z":[5309,5309],"./v-chonk-3z.ts":[5309,5309],"./v-chonk.ts":[2422,2422],"./v-core-3":[89321,9321],"./v-core-3-idex":[35085,5085],"./v-core-3-idex.ts":[35085,5085],"./v-core-3.ts":[89321,9321],"./v-core-4":[94231,4231],"./v-core-4-hybrid":[95024,5024],"./v-core-4-hybrid.ts":[95024,5024],"./v-core-4-idex":[40589,589],"./v-core-4-idex.ts":[40589,589],"./v-core-4.ts":[94231,4231],"./v-core-pro":[16264,6264],"./v-core-pro.ts":[16264,6264],"./v-minion":[93751,3751],"./v-minion.ts":[93751,3751],"./voron-v01":[19884,9884],"./voron-v01.ts":[19884,9884],"./voron-v24":[21788,1788],"./voron-v24.ts":[21788,1788]};function webpackAsyncContext(e){if(!t.o(o,e))return Promise.resolve().then(()=>{var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r});var r=o[e],i=r[0];return t.e(r[1]).then(()=>t(i))}webpackAsyncContext.keys=()=>Object.keys(o),webpackAsyncContext.id=26004,e.exports=webpackAsyncContext},20031:(e,r,t)=>{Promise.resolve().then(t.bind(t,96434)),Promise.resolve().then(t.bind(t,78303))},42784:(e,r,t)=>{Promise.resolve().then(t.bind(t,24014))},90587:(e,r,t)=>{Promise.resolve().then(t.bind(t,70661))},91364:(e,r,t)=>{Promise.resolve().then(t.t.bind(t,53685,23)),Promise.resolve().then(t.t.bind(t,29655,23)),Promise.resolve().then(t.t.bind(t,81703,23)),Promise.resolve().then(t.t.bind(t,99360,23)),Promise.resolve().then(t.t.bind(t,88221,23)),Promise.resolve().then(t.t.bind(t,6080,23))},78894:()=>{},83926:(e,r,t)=>{"use strict";t.d(r,{j:()=>getLogger});var o=t(27789),i=t.n(o),n=t(94369),a=t(99027),s=t(46164);let send=async function(e,r){a.u.clientLog.mutate({level:e,logEvent:s.s.parse(r)})},l=null,getLogger=()=>null!=l?l:l=i()({...n.N,browser:{transmit:{send}}})},18339:(e,r,t)=>{"use strict";t.d(r,{N:()=>useDebounce});var o=t(51495);let useDebounce=(e,r,t=!1)=>{let i=(0,o.useRef)(),n=(0,o.useRef)([]);return(0,o.useEffect)(()=>()=>{i.current&&clearTimeout(i.current)},[]),(0,o.useCallback)((...o)=>{if(n.current=o,i.current){if(!t)return;clearTimeout(i.current),i.current=void 0}i.current=setTimeout(()=>{e(...n.current),i.current=void 0},r)},[r,t,e])}},96434:(e,r,t)=>{"use strict";t.r(r),t.d(r,{Redirecter:()=>Redirecter,useIsRouteActive:()=>useIsRouteActive,useLocalPathname:()=>useLocalPathname,useNavigation:()=>useNavigation});var o=t(32518),i=t(51495),n=t(5481),a=t(47875),s=t(68579),l=t(38443),d=t(24501);let useLocalPathname=()=>{let e=((0,o.usePathname)()??"/").replace("/configure","");return e},useIsRouteActive=()=>{let e=useLocalPathname();return(0,i.useCallback)(r=>e.startsWith(r),[e])},c=[{name:"Setup Wizard",href:"/wizard",current:!1,icon:n.Z},{name:"Dashboard",href:"/",current:!1,icon:a.Z},{name:"Motion",href:"/motion",current:!1,icon:s.Z},{name:"Visual Calibration (BETA)",href:"/calibration",current:!1,icon:l.Z},{name:"Realtime Analysis (BETA)",href:"/analysis",current:!1,icon:d.Z}],useNavigation=()=>{let e=useIsRouteActive(),r=null,t=[];return c.forEach((o,i)=>{o.current=e(o.href),o.current&&(null!==r&&t[r]?.href.length<o.href.length?(t[r].current=!1,r=i):null!==r?o.current=!1:r=i),t.push(o)}),t},Redirecter=e=>{let r=(0,o.useRouter)(),t=useIsRouteActive();if(e.hasLastPrinterSettings||t("/wizard"))return e.children;r.replace("/wizard")}},24014:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>Error});var o=t(96603),i=t(19623),n=t(47994),a=t(50089),s=t(51495),l=t(83926),d=t(36731),c=t.n(d),p=t(78438),u=t(71521),g=t(24240),h=t(76461),m=t(42135),f=t(86399),b=t(61746),_=t(41620);function Error({error:e,reset:r}){return(0,s.useEffect)(()=>{(0,l.j)().error(e)},[e]),o.jsx("div",{className:"mx-auto flex h-full items-center justify-center",children:(0,o.jsxs)(n.Card,{className:"min-w-96 max-w-7xl p-4",children:[o.jsx("h2",{className:"mb-4 font-semibold",children:"Uh oh, something went wrong!"}),(0,o.jsxs)(a.B,{title:"An unexpected error occured",children:['If this keeps happening, click "Download Debug Info" below and post it on'," ",o.jsx(c(),{className:"font-medium underline",href:"https://discord.gg/ratrig",target:"_blank",children:"the RatOS support channel on discord"}),"."]}),(0,o.jsxs)("div",{className:"mt-4 flex justify-end gap-2",children:[o.jsx(i.z,{variant:"info",onClick:()=>r(),children:"Try again"}),o.jsx(u.u,{onClick:()=>window.location.href="/configure/api/debug-zip",title:"This archive may contain sensitive information",wide:!0,body:"Please inspect the contents of the zip before posting it publically. Make sure you use Moonraker Secrets if configuring moonraker for third party services.",content:(0,o.jsxs)(p.i,{children:[o.jsx("h3",{className:"mb-1 font-medium tracking-tight",children:"The following files will be zipped"}),o.jsx("ul",{className:"grid gap-2 pb-2 text-muted-foreground ",children:o.jsx(s.Suspense,{fallback:o.jsx(g.$,{}),children:h.SX.debugFileList.useSuspenseQuery()[0].map(e=>(0,o.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[(e.name.endsWith(".log")||"log"===e.name.split(".").slice(-2)[0])&&o.jsx(m.Z,{className:"h-4 w-4 flex-shrink-0 text-zinc-100/40","aria-hidden":"true"}),e.name.endsWith(".cfg")&&o.jsx(f.Z,{className:"h-4 w-4 flex-shrink-0 text-zinc-100/40","aria-hidden":"true"}),e.name.endsWith(".json")&&o.jsx(b.Z,{className:"h-4 w-4 flex-shrink-0 text-zinc-100/40","aria-hidden":"true"}),(0,o.jsxs)("span",{children:[e.orgPath.replace("/home/pi","~")," (",(0,_.t)(e.size),")"]})]},e.path))})})]}),buttonLabel:"I understand",children:o.jsx(i.z,{variant:"indeterminate",children:"Download Debug Info"})})]})]})})}},70661:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>O});var o=t(96603),i=t(51495),n=t(39470),a=t(24042),s=t(61418),l=t(28361),d=t(36815),c=t.n(d),p=t(76461),u=t(36986),g=t(50592),h=t(44592),m=t(21846);function HeroPattern(){return o.jsx("div",{className:"absolute inset-0 -z-10 mx-auto max-w-7xl overflow-hidden lg:left-72",children:(0,o.jsxs)("div",{className:"absolute left-1/2 top-0 -ml-[50%] h-[25rem] w-full bg-background dark:[mask-image:linear-gradient(white,transparent)]",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-brand-400/60 to-lime-400/15 [mask-image:radial-gradient(farthest-side_at_top,white,transparent)]"}),o.jsx("div",{className:"relative flex h-full w-full items-center justify-center bg-grid-small-black/[0.2] [mask-image:radial-gradient(farthest-side_at_top,white,transparent)] dark:bg-grid-small-brand-400/[0.3]",children:o.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center [mask-image:radial-gradient(ellipse_at_center,transparent_20%,black)]"})})]})})}var f=t(50502),b=t(36731),_=t.n(b),x=t(96434),z=t(70502),v=t(51381),y=t(71521),T=t(78438),w=t(42135),P=t(86399),S=t(61746),C=t(24240),R=t(41620);let k=[{name:"Donate",href:"https://github.com/sponsors/miklschmidt",icon:z},{name:"Documentation",href:"https://os.ratrig.com/docs/introduction",icon:z},{name:"Blog",href:"https://os.ratrig.com/blog",icon:z}],SidebarNav=()=>{let e=(0,x.useNavigation)();return o.jsx("nav",{className:"flex flex-1 flex-col",children:(0,o.jsxs)("ul",{role:"list",className:"flex flex-1 flex-col gap-y-7",children:[o.jsx("li",{children:o.jsx("ul",{role:"list",className:"-mx-2 space-y-1",children:e.map(e=>o.jsx("li",{children:(0,o.jsxs)(_(),{href:e.href,className:(0,s.m6)(e.current?"bg-zinc-800 text-white":"text-zinc-400 hover:bg-zinc-800 hover:text-white","group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6"),children:[o.jsx(e.icon,{className:(0,s.dV)("h-6 w-6 shrink-0",e.iconClass),"aria-hidden":"true"}),e.name]})},e.name))})}),(0,o.jsxs)("li",{children:[o.jsx("div",{className:"text-xs font-semibold leading-6 text-zinc-400",children:"External Links"}),(0,o.jsxs)("ul",{role:"list",className:"-mx-2 mt-2 space-y-1",children:[o.jsx(y.u,{onClick:()=>window.location.href="/configure/api/debug-zip",title:"This archive may contain sensitive information",wide:!0,body:"Please inspect the contents of the zip before posting it publically. Make sure you use Moonraker Secrets if configuring moonraker for third party services.",content:(0,o.jsxs)(T.i,{children:[o.jsx("h3",{className:"mb-1 font-medium tracking-tight",children:"The following files will be zipped"}),o.jsx("ul",{className:"grid gap-2 pb-2 text-muted-foreground",children:o.jsx(i.Suspense,{fallback:o.jsx(C.$,{}),children:p.SX.debugFileList.useSuspenseQuery()[0].map(e=>(0,o.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[(e.name.endsWith(".log")||"log"===e.name.split(".").slice(-2)[0])&&o.jsx(w.Z,{className:"h-4 w-4 flex-shrink-0 text-zinc-100/40","aria-hidden":"true"}),e.name.endsWith(".cfg")&&o.jsx(P.Z,{className:"h-4 w-4 flex-shrink-0 text-zinc-100/40","aria-hidden":"true"}),e.name.endsWith(".json")&&o.jsx(S.Z,{className:"h-4 w-4 flex-shrink-0 text-zinc-100/40","aria-hidden":"true"}),(0,o.jsxs)("span",{children:[e.orgPath.replace("/home/pi","~")," (",(0,R.t)(e.size),")"]})]},e.path))})})]}),buttonLabel:"I understand",children:o.jsx("li",{children:(0,o.jsxs)("span",{className:(0,s.dV)("cursor-pointer text-zinc-400 hover:bg-zinc-800 hover:text-white","group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6"),children:[o.jsx("span",{className:"flex h-6 w-6 shrink-0 items-center justify-center rounded-lg border border-zinc-700 bg-zinc-800 text-[0.625rem] font-medium text-zinc-400 group-hover:text-white",children:o.jsx(v,{className:"h-4 w-4","aria-hidden":"true"})}),o.jsx("span",{className:"truncate",children:"Debug Zip"})]})})}),k.map(e=>o.jsx("li",{children:(0,o.jsxs)("a",{href:e.href,target:"_blank",className:(0,s.dV)("text-zinc-400 hover:bg-zinc-800 hover:text-white","group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6"),children:[o.jsx("span",{className:"flex h-6 w-6 shrink-0 items-center justify-center rounded-lg border border-zinc-700 bg-zinc-800 text-[0.625rem] font-medium text-zinc-400 group-hover:text-white",children:o.jsx(e.icon,{className:"h-4 w-4","aria-hidden":"true"})}),o.jsx("span",{className:"truncate",children:e.name})]})},e.name))]})]}),o.jsx("li",{className:"mt-auto",children:(0,o.jsxs)("a",{href:"/",className:"group -mx-2 flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-zinc-400 hover:bg-zinc-800 hover:text-white",children:[o.jsx(f,{className:"h-6 w-6 shrink-0","aria-hidden":"true"}),"Mainsail"]})})]})})};var N=t(43435),j=t(74258),E=t(11476);let Toaster=({...e})=>o.jsx(E.x,{theme:"dark",className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:border-border group-[.toaster]:shadow-lg items-start",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground",icon:"mt-0.5"}},...e});var $=t(41891);let A=new h.S,O=p.SX.withTRPC(function({children:e}){let[r,t]=(0,i.useState)(!1),d=(0,N.Er)(),p=o.jsx("div",{className:(0,s.dV)("fixed inset-0 z-50 flex h-14 items-center justify-between gap-12 transition lg:left-72 lg:z-30","border-b border-zinc-900/10 backdrop-blur-sm dark:border-white/10 dark:backdrop-blur lg:left-72",!r&&"backdrop-blur-sm dark:backdrop-blur lg:left-72",r?"bg-background":"bg-background/80 dark:bg-background/50")});return o.jsx(m.aH,{client:A,children:o.jsx(u.RecoilRoot,{children:o.jsx(g.YG,{children:o.jsx(j.pn,{children:(0,o.jsxs)(N.Q,{...d.providerProps,children:[(0,o.jsxs)("div",{className:"relative flex min-h-full",children:[(0,o.jsxs)("div",{className:"ml-0 min-h-full flex-1 pt-14 transition-all lg:ml-72",children:[o.jsx(HeroPattern,{}),e]}),o.jsx(n.u.Root,{show:r,as:i.Fragment,children:(0,o.jsxs)(a.V,{as:"div",className:"relative z-40 lg:hidden",onClose:t,children:[o.jsx(n.u.Child,{as:i.Fragment,enter:"transition-opacity ease-linear duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity ease-linear duration-300",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:o.jsx("div",{className:"fixed inset-0 bg-background/80"})}),o.jsx("div",{className:"fixed inset-0 flex",children:o.jsx(n.u.Child,{as:i.Fragment,enter:"transition ease-in-out duration-300 transform",enterFrom:"-translate-x-full",enterTo:"translate-x-0",leave:"transition ease-in-out duration-300 transform",leaveFrom:"translate-x-0",leaveTo:"-translate-x-full",children:o.jsx(a.V.Panel,{className:"relative mr-16 flex w-full max-w-xs flex-1",children:(0,o.jsxs)("div",{className:"flex grow flex-col gap-y-5 overflow-y-auto border-r border-zinc-900 bg-background px-6 pb-4 dark:border-white/10",children:[o.jsx("div",{className:"flex h-16 shrink-0 items-center",children:o.jsx(c(),{width:160,height:40,className:"h-8 w-auto",src:l.Z,alt:"Workflow"})}),o.jsx(SidebarNav,{})]})})})})]})}),o.jsx("div",{className:"pointer-events-none fixed inset-y-0 z-40 flex w-72 flex-col opacity-0 transition-all lg:pointer-events-auto lg:opacity-100",children:(0,o.jsxs)("div",{className:(0,s.dV)("scrollable flex grow flex-col gap-y-5 overflow-y-auto border-r border-zinc-900/10 bg-background/80 px-6 pb-4 dark:border-white/10 dark:bg-background"),children:[o.jsx("div",{className:"relative -top-1 flex h-16 shrink-0 items-center transition-all lg:top-0",children:o.jsx(c(),{width:160,height:40,className:"h-8 w-auto",src:l.Z,alt:"Workflow"})}),o.jsx(SidebarNav,{})]})}),o.jsx($.NoSSR,{fallback:p,children:o.jsx(i.Suspense,{fallback:p,children:o.jsx(N.Ff,{setSidebarOpen:t,sidebarOpen:r,...d.topMenuProps})})})]}),o.jsx(Toaster,{})]})})})})})})},43435:(e,r,t)=>{"use strict";t.d(r,{Q:()=>MenuBarProvider,Ff:()=>TopMenu,Er:()=>useMenuBarProvider,Ty:()=>useTopMenu});var o={};t.r(o),t.d(o,{Menubar:()=>P,MenubarCheckboxItem:()=>A,MenubarContent:()=>E,MenubarContentIcon:()=>k,MenubarGroup:()=>v,MenubarIcon:()=>C,MenubarItem:()=>$,MenubarLabel:()=>M,MenubarMenu:()=>MenubarMenu,MenubarPortal:()=>y,MenubarRadioGroup:()=>w,MenubarRadioItem:()=>O,MenubarSeparator:()=>F,MenubarShortcut:()=>MenubarShortcut,MenubarSub:()=>T,MenubarSubContent:()=>j,MenubarSubTrigger:()=>N,MenubarTrigger:()=>R});var i=t(96603),n=t(76871),a=t(20259),s=t(39238),l=t(51495),d=t.n(l),c=t(61418),p=t(36815),u=t.n(p),g=t(28361),h=t(73835),m=t(67224),f=t(368),b=t(30413),_=t(55428),x=t(40147);let z=l.createContext({value:null}),v=m.ZA,y=m.h_,T=m.Tr,w=m.Ee,P=l.forwardRef(({className:e,children:r,...t},o)=>{let[n,a]=l.useState(null);return i.jsx(z.Provider,{value:{value:n},children:i.jsx(m.fC,{ref:o,value:n??void 0,className:(0,f.cn)("flex items-center space-x-1 rounded-md shadow-sm",e),onValueChange:a,...t,children:r})})});(0,f.h)(P,m.fC.displayName);let S=l.createContext({id:""}),MenubarMenu=e=>{let r=l.useId();return i.jsx(S.Provider,{value:{id:r},children:i.jsx(m.v2,{...e,value:r})})},C=l.forwardRef(({className:e,Icon:r,...t},o)=>l.cloneElement(i.jsx(r,{ref:o,className:(0,f.cn)("size-4 text-white transition-colors group-data-[state=open]:text-white lg:text-white/60",e),...t}))),R=l.forwardRef(({className:e,children:r,asChild:t,...o},n)=>{let{value:a}=l.useContext(z),{id:d}=l.useContext(S),p=t?x.g7:"div";return(0,i.jsxs)(m.xz,{ref:n,className:(0,f.cn)("group relative flex cursor-default select-none items-center outline-none data-[state=open]:text-accent-foreground focus:text-accent-foreground",o.disabled?"cursor-not-allowed opacity-50":"cursor-pointer",e),...o,children:[i.jsx(b.M,{children:a?.replace("radix-","")==d&&!o.disabled&&i.jsx(s.E.div,{layoutId:"menubarTrigger",initial:{opacity:0},animate:{opacity:1,transition:{duration:.1,ease:"easeOut"}},exit:{opacity:0,transition:{duration:.1,delay:.1,ease:"easeIn"}},transition:{type:"spring",damping:20,mass:.5,stiffness:450},className:(0,c.dV)("pointer-events-none absolute inset-0 rounded-sm bg-brand-700")})}),i.jsx(p,{className:"relative z-20 flex flex-1 items-center gap-2 rounded-sm p-3 text-sm font-medium text-accent-foreground",children:r})]})});(0,f.h)(R,m.xz.displayName);let k=l.forwardRef(({className:e,Icon:r,...t},o)=>l.cloneElement(i.jsx(r,{ref:o,className:(0,f.cn)("size-4 flex-shrink-0 text-white/60",e),...t}))),N=l.forwardRef(({className:e,inset:r,children:t,...o},n)=>(0,i.jsxs)(m.fF,{ref:n,className:(0,f.cn)("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent data-[state=open]:text-accent-foreground focus:bg-accent focus:text-accent-foreground",r&&"pl-8",e),...o,children:[t,i.jsx(h.XCv,{className:"ml-auto h-4 w-4"})]}));(0,f.h)(N,m.fF.displayName);let j=l.forwardRef(({className:e,...r},t)=>i.jsx(m.tu,{ref:t,sideOffset:4,alignOffset:-5,className:(0,f.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r}));(0,f.h)(j,m.tu.displayName);let E=l.forwardRef(({className:e,align:r="start",alignOffset:t=-4,sideOffset:o=8,...n},a)=>i.jsx(m.h_,{children:i.jsx(m.VY,{ref:a,align:r,alignOffset:t,sideOffset:o,className:(0,f.cn)("z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));(0,f.h)(E,m.VY.displayName);let $=l.forwardRef(({className:e,inset:r,...t},o)=>i.jsx(m.ck,{ref:o,className:(0,f.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r&&"pl-8",e),...t}));(0,f.h)($,m.ck.displayName);let A=l.forwardRef(({className:e,children:r,checked:t,...o},n)=>(0,i.jsxs)(m.oC,{ref:n,className:(0,f.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),checked:t,...o,children:[i.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(m.wU,{children:i.jsx(h.nQG,{className:"h-4 w-4"})})}),r]}));(0,f.h)(A,m.oC.displayName);let O=l.forwardRef(({className:e,children:r,...t},o)=>(0,i.jsxs)(m.Rk,{ref:o,className:(0,f.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...t,children:[i.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(m.wU,{children:i.jsx(_.Z,{className:"h-4 w-4 text-brand-400"})})}),r]}));(0,f.h)(O,m.Rk.displayName);let M=l.forwardRef(({className:e,inset:r,...t},o)=>i.jsx(m.__,{ref:o,className:(0,f.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",e),...t}));(0,f.h)(M,m.__.displayName);let F=l.forwardRef(({className:e,...r},t)=>i.jsx(m.Z0,{ref:t,className:(0,f.cn)("-mx-1 my-1 h-px bg-muted",e),...r}));(0,f.h)(F,m.Z0.displayName);let MenubarShortcut=({className:e,...r})=>i.jsx("span",{className:(0,f.cn)("ml-auto text-xs tracking-widest text-muted-foreground",e),...r});MenubarShortcut.displayname="MenubarShortcut";var I=t(36731),D=t.n(I),L=t(91055),H=t(67758),B=t(99027),W=t(74611),V=t(78591),U=t(64338),G=t(36986),q=t(78303),K=t(71521),Z=t(50089),X=t(29340);let useHelpActions=()=>{let[e,r]=(0,l.useState)(!1),[t,o]=(0,l.useState)(!1),[n,a]=(0,l.useState)(!1),[s,d]=(0,l.useState)({title:"",body:"",content:null,dismissText:"OK",dismissVariant:"primary"}),[c,p]=(0,l.useState)({title:"",body:"",content:null,dismissText:"OK",dismissVariant:"primary"}),[u,g]=(0,l.useState)({title:"",body:"",content:null,dismissText:"OK",dismissVariant:"primary"}),h=(0,G.useRecoilValue)(q.LoadablePrinterConfigurationState),m=B.S["klippy-extensions"].symlink.useMutation(),f=B.S.mcu.flashAllConnected.useMutation(),b=B.S.printer.flashBeacon.useMutation(),_=e?i.jsx(K.u,{...c,onClose:()=>setTimeout(()=>r(!1),250),success:!m.isError,isLoading:m.isLoading}):null,x=t?i.jsx(K.u,{...s,onClose:()=>setTimeout(()=>o(!1),250),success:!f.isError,isLoading:f.isLoading}):null,z=n?i.jsx(K.u,{...u,onClose:()=>setTimeout(()=>a(!1),250),success:!b.isError,isLoading:b.isLoading}):null,v=(0,l.useCallback)(()=>{d({title:"Flash Firmware",body:"Please wait while RatOS is flashing your connected boards...",dismissText:"Close",dismissVariant:"primary"}),o(!0),f.mutateAsync().then(e=>{o(!0),d({title:"Flashing Complete",body:"The connected boards have been flashed successfully.",content:i.jsx(X.j,{title:"Script output",color:"gray",className:"whitespace-pre-wrap",Icon:W.Z,children:e.report}),dismissText:"OK",dismissVariant:"primary"})},e=>{o(!0),d({title:"Flashing Failed",body:"Something wen't wrong while flashing the connected boards, please try again.",content:i.jsx(Z.B,{children:null!=e&&"message"in e?e.message:"Unknown error"}),dismissText:"OK",dismissVariant:"primary"})})},[f]),y=(0,l.useCallback)(()=>{p({title:"Symlink Extensions",body:"Please wait while RatOS is symlinking klippy extensions...",dismissText:"Close",dismissVariant:"primary"}),r(!0),m.mutateAsync({}).then(e=>{r(!0),p({title:"Symlink Complete",body:"The klippy extensions have been symlinked successfully.",content:i.jsx(X.j,{title:"Script output",color:"gray",className:"whitespace-pre-wrap",Icon:W.Z,children:e.report}),dismissText:"OK",dismissVariant:"primary"})},e=>{r(!0),p({title:"Symlink Failed",body:"Something wen't wrong while symlinking the klippy extensions, please try again.",content:i.jsx(Z.B,{children:null!=e&&"message"in e?e.message:"Unknown error"}),dismissText:"OK",dismissVariant:"primary"})})},[m]),T=(0,l.useCallback)(e=>{g({title:"Flashing Beacon Firmware",body:"Please wait while RatOS runs the beacon update script...",dismissText:"Close"}),a(!0),b.mutateAsync().then(e=>{a(!0),g({title:"Flashing Complete",body:"The beacon firmware script completed succesfully.",content:i.jsx(X.j,{title:"Script output",color:"gray",className:"whitespace-pre-wrap",Icon:W.Z,children:i.jsx("div",{className:"whitespace-pre-wrap font-mono",children:e})}),dismissText:"OK",dismissVariant:"primary"})},e=>{a(!0),g({title:"Flashing Failed",body:"Something wen't wrong while flashing the beacon firmware, please try again.",content:i.jsx(Z.B,{children:i.jsx("div",{className:"font-mono",children:null!=e&&"message"in e?e.message:"Unknown error"})}),dismissText:"OK",dismissVariant:"primary"})})},[b]);return{menuItems:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)($,{onClick:y,className:"gap-2",children:[i.jsx(V.Z,{className:"h-4 w-4 text-zinc-400"})," Symlink Extensions"]}),(0,i.jsxs)($,{onClick:v,className:"gap-2",children:[i.jsx(U.Z,{className:"h-4 w-4 text-zinc-400"})," Flash Connected Boards"]}),h?.toolheads?.some(e=>e?.probe?.id==="beacon")&&(0,i.jsxs)($,{onClick:T,className:"gap-2",children:[i.jsx(U.Z,{className:"h-4 w-4 text-zinc-400"})," Flash Beacon Firmware"]})]}),modals:(0,i.jsxs)(i.Fragment,{children:[_,x,z]})}},Y=(0,l.createContext)({registerMenu:()=>{throw Error("No menu registered in context")},unregisterMenu:()=>{throw Error("No menu registered in context")},changed:()=>()=>{}}),useMenuBarProvider=()=>{let e=d().useRef(new Map),r=function(){let e=(0,l.useRef)(new Set);return(0,l.useCallback)(r=>{if("function"==typeof r)return e.current.add(r),()=>{e.current.delete(r)};e.current.forEach(e=>e(r))},[])}(),t=(0,l.useCallback)((t,o)=>{e.current.has(t)&&o===e.current.get(t)?.render||(e.current=new Map(e.current).set(t,{render:o,id:t}),r())},[r]),o=(0,l.useCallback)(t=>{e.current.delete(t),r()},[r]);return{topMenuProps:{menus:e,menusChanged:r},providerProps:{registerMenu:t,unregisterMenu:o,changed:r}}},MenuBarProvider=e=>i.jsx(Y.Provider,{value:e,children:e.children}),useTopMenu=(e,r)=>{let{registerMenu:t,unregisterMenu:o}=(0,l.useContext)(Y);(0,l.useEffect)(()=>(t(e,r),()=>o(e)),[e,t,r,o])},TopMenu=e=>{let{sidebarOpen:r,setSidebarOpen:t,menus:p,menusChanged:h}=e,[,m]=(0,l.useState)(Array.from(p.current.values()));!function(e,r){(0,l.useEffect)(()=>{let t=e(r);return t},[e,r])}(h,(0,l.useCallback)(()=>{m(Array.from(p.current.values()))},[p]));let f=useHelpActions();return i.jsx(s.E.div,{className:(0,c.dV)("fixed inset-0 z-50 flex h-14 items-center justify-between gap-12 transition lg:left-72 lg:z-30","border-b border-zinc-900/10 backdrop-blur-sm dark:border-white/10 dark:backdrop-blur lg:left-72",!r&&"backdrop-blur-sm dark:backdrop-blur lg:left-72",r?"bg-background":"bg-background/80 dark:bg-background/50"),children:(0,i.jsxs)("div",{className:"mx-auto flex-1",children:[(0,i.jsxs)("div",{className:"flex h-16 items-center px-4 lg:justify-between",children:[i.jsx("div",{className:"flex flex-1 items-center justify-between space-x-4 lg:hidden",children:i.jsx("div",{className:"flex h-16 shrink-0 items-center",children:i.jsx(u(),{width:160,height:40,className:"h-8 w-auto",src:g.Z,alt:"Workflow"})})}),(0,i.jsxs)(P,{className:"lg:flex-1",children:[p.current.size>0&&Array.from(p.current.values()).map(({id:e,render:r})=>i.jsx(d().Fragment,{children:r(o)},e)),i.jsx(F,{className:"flex-1 bg-transparent"}),(0,i.jsxs)(MenubarMenu,{children:[(0,i.jsxs)(R,{className:"flex-nowrap whitespace-nowrap text-nowrap",children:[i.jsx(C,{Icon:L.Z})," ",i.jsx("span",{className:"hidden lg:inline",children:"Help"})]}),(0,i.jsxs)(E,{onCloseAutoFocus:e=>e.preventDefault(),children:[f.menuItems,i.jsx(F,{}),i.jsx($,{asChild:!0,className:"gap-2",children:(0,i.jsxs)(D(),{href:"https://os.ratrig.com/docs/introduction",target:"_blank",rel:"noreferrer",children:[i.jsx(k,{Icon:H.Z})," Docs"]})}),i.jsx($,{asChild:!0,className:"gap-2",children:(0,i.jsxs)(D(),{href:"https://github.com/sponsors/miklschmidt",target:"_blank",rel:"noreferrer",children:[i.jsx(k,{Icon:H.Z})," Donate"]})})]})]}),i.jsx(MenubarMenu,{children:(0,i.jsxs)(R,{onClick:()=>t(e=>!e),className:"flex-nowrap whitespace-nowrap text-nowrap lg:hidden",children:[i.jsx("span",{className:"sr-only",children:"Open main menu"}),r?i.jsx(n,{className:(0,c.dV)("block","-m-0.5 h-5 w-5"),"aria-hidden":"true"}):i.jsx(a,{className:(0,c.dV)("block","-m-0.5 h-5 w-5"),"aria-hidden":"true"})]})})]})]}),f.modals]})})}},78438:(e,r,t)=>{"use strict";t.d(r,{i:()=>AnimatedContainer});var o=t(96603),i=t(18339),n=t(25973),a=t(39238),s=t(51495),l=t(61418);let AnimatedContainer=e=>{let[r,t]=(0,s.useState)(0),d=(0,s.useRef)(r);d.current=r;let[c,p]=(0,s.useState)(!1),u=(0,s.useRef)(c);u.current=c;let g=(0,s.useRef)(null);(0,n.Z)(g,e=>{e.contentRect.height!==d.current&&t(e.contentRect.height)});let h=(0,i.N)((0,s.useCallback)(()=>{p(!0)},[]),200,!0),m=(0,i.N)((0,s.useCallback)(()=>{p(!1)},[]),200,!0);return o.jsx(a.E.div,{className:(0,l.m6)(c?"overflow-visible":"overflow-hidden",e.containerClassName),style:{height:r},onAnimationComplete:h,onAnimationStart:m,animate:{height:r},transition:e.transition,children:o.jsx("div",{ref:g,className:e.className,children:e.children})})}},61331:(e,r,t)=>{"use strict";t.d(r,{Bd:()=>s,Ct:()=>Badge,_1:()=>l,iA:()=>c,xU:()=>d});var o=t(96603),i=t(61709),n=t(61418),a=t(13728);let s=a.z.union([a.z.literal("rose"),a.z.literal("red"),a.z.literal("yellow"),a.z.literal("orange"),a.z.literal("green"),a.z.literal("lime"),a.z.literal("blue"),a.z.literal("sky"),a.z.literal("indigo"),a.z.literal("purple"),a.z.literal("pink"),a.z.literal("brand"),a.z.literal("gray"),a.z.literal("plain")]),l=(0,i.j)("",{variants:{color:{rose:"text-rose-700 dark:text-rose-400",red:"text-red-700 dark:text-red-400",yellow:"text-yellow-800 dark:text-yellow-500",orange:"text-orange-800 dark:text-orange-500",green:"text-green-700 dark:text-green-400",lime:"text-lime-700 dark:text-lime-400",blue:"text-blue-700 dark:text-blue-400",sky:"text-sky-700 dark:text-sky-400",indigo:"text-indigo-700 dark:text-indigo-400",purple:"text-purple-700 dark:text-purple-400",pink:"text-pink-700 dark:text-pink-400",brand:"text-brand-700 dark:text-brand-400",gray:"text-zinc-600 dark:text-zinc-400",plain:"text-zinc-900 dark:text-zinc-100"}}}),d=(0,i.j)("",{variants:{color:{rose:"bg-rose-50 dark:bg-rose-400/10",red:"bg-red-50 dark:bg-red-400/10",yellow:"bg-yellow-50 dark:bg-yellow-400/10",orange:"bg-orange-50 dark:bg-orange-400/10",green:"bg-green-50 dark:bg-green-500/10",lime:"bg-lime-50 dark:bg-lime-500/10",blue:"bg-blue-50 dark:bg-blue-400/10",sky:"bg-sky-50 dark:bg-sky-400/10",indigo:"bg-indigo-50 dark:bg-indigo-400/10",purple:"bg-purple-50 dark:bg-purple-400/10",pink:"bg-pink-50 dark:bg-pink-400/10",brand:"bg-brand-100 dark:bg-brand-400/10",gray:"bg-zinc-50 dark:bg-zinc-400/10",plain:"bg-zinc-900/10 dark:bg-zinc-100/10"}}}),c=(0,i.j)("",{variants:{color:{rose:"border-rose-600/10 dark:border-rose-400/20 ring-rose-600/10 dark:ring-rose-400/20",red:"border-red-600/10 dark:border-red-400/20 ring-red-600/10 dark:ring-red-400/20",yellow:"border-yellow-600/20 dark:border-yellow-400/20 ring-yellow-600/20 dark:ring-yellow-400/20",orange:"border-orange-600/20 dark:border-orange-400/20 ring-orange-600/20 dark:ring-orange-400/20",green:"border-green-600/20 dark:border-green-500/20 ring-green-600/20 dark:ring-green-500/20",lime:"border-lime-600/20 dark:border-lime-500/20 ring-lime-600/20 dark:ring-lime-500/20",blue:"border-blue-700/10 dark:border-blue-400/30 ring-blue-700/10 dark:ring-blue-400/30",sky:"border-sky-700/10 dark:border-sky-400/30 ring-sky-700/10 dark:ring-sky-400/30",indigo:"border-indigo-700/10 dark:border-indigo-400/30 ring-indigo-700/10 dark:ring-indigo-400/30",purple:"border-purple-700/10 dark:border-purple-400/30 ring-purple-700/10 dark:ring-purple-400/30",pink:"border-pink-700/10 dark:border-pink-400/20 ring-pink-700/10 dark:ring-pink-400/20",brand:"border-brand-600/40 dark:border-brand-400/30 ring-brand-600/40 dark:ring-brand-400/30",gray:"border-zinc-500/10 dark:border-zinc-400/20 ring-zinc-500/10 dark:ring-zinc-400/20",plain:"border-zinc-900 dark:border-zinc-100 ring-zinc-900 dark:ring-zinc-100"}}}),p=(0,i.j)("flex-0 inline-flex w-auto items-center rounded-md font-medium ring-1 ring-inset",{variants:{size:{sm:"px-1.5 gap-1.5 py-1 text-2xs leading-3",md:"px-2 gap-2 py-1 text-xs leading-4",lg:"px-2 gap-2 py-1 text-xs leading-6"},color:{rose:[d({color:"rose"}),c({color:"rose"}),l({color:"rose"})],red:[d({color:"red"}),c({color:"red"}),l({color:"red"})],yellow:[d({color:"yellow"}),c({color:"yellow"}),l({color:"yellow"})],orange:[d({color:"orange"}),c({color:"orange"}),l({color:"orange"})],green:[d({color:"green"}),c({color:"green"}),l({color:"green"})],lime:[d({color:"lime"}),c({color:"lime"}),l({color:"lime"})],blue:[d({color:"blue"}),c({color:"blue"}),l({color:"blue"})],sky:[d({color:"sky"}),c({color:"sky"}),l({color:"sky"})],indigo:[d({color:"indigo"}),c({color:"indigo"}),l({color:"indigo"})],purple:[d({color:"purple"}),c({color:"purple"}),l({color:"purple"})],pink:[d({color:"pink"}),c({color:"pink"}),l({color:"pink"})],brand:[d({color:"brand"}),c({color:"brand"}),l({color:"brand"})],gray:[d({color:"gray"}),c({color:"gray"}),l({color:"gray"})],plain:[d({color:"plain"}),c({color:"plain"}),l({color:"plain"})]}},defaultVariants:{size:"md",color:"gray"}}),Badge=e=>{let{size:r,color:t,className:i,children:a,...s}=e;return o.jsx("span",{className:(0,n.m6)(p({size:r,color:t}),i),...s,children:a})}},29340:(e,r,t)=>{"use strict";t.d(r,{j:()=>Banner});var o=t(96603);t(51495);var i=t(61331),n=t(61418),a=t(61709);let s=(0,a.j)("rounded-md p-4 border",{variants:{color:{red:[(0,i.xU)({color:"red"}),(0,i.iA)({color:"red"}),(0,i._1)({color:"red"})],yellow:[(0,i.xU)({color:"yellow"}),(0,i.iA)({color:"yellow"}),(0,i._1)({color:"yellow"})],orange:[(0,i.xU)({color:"orange"}),(0,i.iA)({color:"orange"}),(0,i._1)({color:"orange"})],green:[(0,i.xU)({color:"green"}),(0,i.iA)({color:"green"}),(0,i._1)({color:"green"})],lime:[(0,i.xU)({color:"lime"}),(0,i.iA)({color:"lime"}),(0,i._1)({color:"lime"})],blue:[(0,i.xU)({color:"blue"}),(0,i.iA)({color:"blue"}),(0,i._1)({color:"blue"})],sky:[(0,i.xU)({color:"sky"}),(0,i.iA)({color:"sky"}),(0,i._1)({color:"sky"})],indigo:[(0,i.xU)({color:"indigo"}),(0,i.iA)({color:"indigo"}),(0,i._1)({color:"indigo"})],purple:[(0,i.xU)({color:"purple"}),(0,i.iA)({color:"purple"}),(0,i._1)({color:"purple"})],pink:[(0,i.xU)({color:"pink"}),(0,i.iA)({color:"pink"}),(0,i._1)({color:"pink"})],brand:[(0,i.xU)({color:"brand"}),(0,i.iA)({color:"brand"}),(0,i._1)({color:"brand"})],gray:[(0,i.xU)({color:"gray"}),(0,i.iA)({color:"gray"}),(0,i._1)({color:"gray"})]}},defaultVariants:{color:"gray"}}),Banner=e=>{let{Icon:r,className:t,title:i}=e;return o.jsx("div",{className:(0,n.m6)(s({color:e.color}),e.className),children:(0,o.jsxs)("div",{className:"flex",children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx(r,{className:(0,n.dV)("h-5 w-5"),"aria-hidden":"true"})}),(0,o.jsxs)("div",{className:"ml-3 flex-1",children:[o.jsx("h3",{className:(0,n.dV)("text-sm font-bold"),children:e.title}),o.jsx("div",{className:"mt-2 text-sm",children:e.children})]})]})})}},19623:(e,r,t)=>{"use strict";t.d(r,{d:()=>u,z:()=>g});var o=t(96603),i=t(36731),n=t.n(i),a=t(61418),s=t(51495),l=t(61709),d=t(6957),c=t(39470),p=t(16146);let u=(0,l.j)("inline-flex items-center justify-center border font-semibold rounded-md shadow-sm focus:outline-none focus:ring-2 capitalize relative active:translate-y-px active:scale-[99%] active:outline-none transition-all",{variants:{variant:{danger:(0,a.dV)("text-red-50 bg-red-500/70 hover:bg-red-600 border-transparent focus:ring-offset-2 focus:ring-red-400 dark:focus:ring-offset-zinc-900","shadow-[0px_0px_0px_1px_rgba(9,9,11,0.07),0px_2px_2px_0px_rgba(9,9,11,0.05)] dark:shadow-[0px_0px_0px_1px_rgba(255,255,255,0.05)]","dark:before:-inset-px dark:before:rounded-lg","dark:before:pointer-events-none dark:before:absolute dark:before:shadow-[0px_2px_8px_0px_hsl(var(--red-900)),_0px_1px_0px_0px_hsl(var(--red-400)_/_50%)_inset]"),warning:(0,a.dV)("text-yellow-50 bg-yellow-400/70 hover:bg-yellow-600 border-transparent focus:ring-offset-2 focus:ring-yellow-400 dark:focus:ring-offset-zinc-900","shadow-[0px_0px_0px_1px_rgba(9,9,11,0.07),0px_2px_2px_0px_rgba(9,9,11,0.05)] dark:shadow-[0px_0px_0px_1px_rgba(255,255,255,0.05)]","dark:before:-inset-px dark:before:rounded-lg","dark:before:pointer-events-none dark:before:absolute dark:before:shadow-[0px_2px_8px_0px_hsl(var(--yellow-900)),_0px_1px_0px_0px_hsl(var(--yellow-400)_/_50%)_inset]"),info:(0,a.dV)("text-blue-50 bg-sky-400/70 hover:bg-sky-600 border-transparent focus:ring-offset-2 focus:ring-sky-400 dark:focus:ring-offset-zinc-900","shadow-[0px_0px_0px_1px_rgba(9,9,11,0.07),0px_2px_2px_0px_rgba(9,9,11,0.05)] dark:shadow-[0px_0px_0px_1px_rgba(255,255,255,0.05)]","dark:before:-inset-px dark:before:rounded-lg","dark:before:pointer-events-none dark:before:absolute dark:before:shadow-[0px_2px_8px_0px_hsl(var(--sky-900)),_0px_1px_0px_0px_hsl(var(--sky-400)_/_50%)_inset]"),primary:(0,a.dV)("text-white bg-brand-400/50 hover:bg-brand-700 border-transparent focus:ring-offset-2 focus:ring-brand-400 dark:focus:ring-offset-zinc-900","shadow-[0px_0px_0px_1px_rgba(9,9,11,0.07),0px_2px_2px_0px_rgba(9,9,11,0.05)] dark:shadow-[0px_0px_0px_1px_rgba(255,255,255,0.05)]","dark:before:-inset-px dark:before:rounded-lg","dark:before:pointer-events-none dark:before:absolute dark:before:shadow-[0px_2px_8px_0px_hsl(var(--brand-900)),_0px_1px_0px_0px_hsl(var(--brand-400)_/_50%)_inset]"),success:"text-green-100 bg-green-500 hover:bg-green-600 border-transparent focus:ring-offset-2 focus:ring-brand-400 dark:focus:ring-offset-zinc-900",indeterminate:(0,a.dV)("border-transparent bg-zinc-100 hover:bg-zinc-200 text-black dark:text-zinc-300 dark:bg-zinc-800 dark:transparent dark:hover:bg-zinc-700 dark:hover:text-zinc-100 dark:hover:transparent focus:ring-offset-2 focus:ring-brand-400 dark:focus:ring-offset-zinc-900","shadow-[0px_0px_0px_1px_rgba(9,9,11,0.07),0px_2px_2px_0px_rgba(9,9,11,0.05)] dark:shadow-[0px_0px_0px_1px_rgba(255,255,255,0.05)]","dark:before:-inset-px dark:before:rounded-lg","dark:before:pointer-events-none dark:before:absolute dark:before:shadow-[0px_2px_8px_0px_hsl(var(--zinc-900)),_0px_1px_0px_0px_hsl(var(--zinc-400)_/_20%)_inset]"),outline:"border-zinc-700 shadow-none bg-transparent text-zinc-700 dark:text-zinc-300 hover:bg-zinc-500/30 hover:border-zinc-500/50 hover:text-zinc-800 dark:hover:text-zinc-200 focus:ring-offset-2 focus:ring-brand-400 dark:focus:ring-offset-zinc-900",plain:"border-transparent shadow-none bg-transparent text-zinc-700 dark:text-zinc-300 hover:underline hover:text-zinc-800 dark:hover:text-zinc-200 focus:ring-offset-2 focus:ring-brand-400 dark:focus:ring-offset-zinc-900"},disabled:{true:"opacity-60 cursor-not-allowed"},size:{sm:"px-2 py-1 text-xs gap-2",lg:"px-6 py-3 text-lg gap-4",default:"px-3 py-2 text-sm gap-2",icon:"h-9 w-9","icon-sm":"h-6 w-6","icon-xs":"h-4 w-4"}},compoundVariants:[{variant:"primary",disabled:!0,class:"hover:bg-brand-400/50"},{variant:"danger",disabled:!0,class:"hover:bg-red-500/70"},{variant:"warning",disabled:!0,class:"hover:bg-yellow-500"},{variant:"indeterminate",disabled:!0,class:"hover:bg-zinc-100 dark:hover:bg-zinc-800"},{variant:"info",disabled:!0,class:"hover:bg-sky-400/70"}],defaultVariants:{variant:"primary",size:"default",disabled:!1}}),g=(0,s.forwardRef)(function(e,r){let{variant:t,disabled:i,size:l,href:g,target:h,onClick:m,title:f,rel:b,dropdownItems:_,className:x,children:z,...v}=e,y=(0,a.m6)(u({variant:t,disabled:i,size:l}),x);return g?o.jsx(n(),{href:g,ref:r,className:y,target:h,onClick:m,title:f,rel:b,children:z}):_&&_.length&&null==m?(0,o.jsxs)(d.v,{as:"span",className:"relative inline-block text-left",children:[(0,o.jsxs)(d.v.Button,{className:y,title:f,disabled:!!i,children:[z,o.jsx(p,{className:"-mr-2 h-5 w-5","aria-hidden":"true"})]}),o.jsx(c.u,{as:s.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:o.jsx(d.v.Items,{className:"absolute right-0 z-10 mt-2 w-56 origin-top-right divide-y divide-zinc-100 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none dark:divide-zinc-800 dark:bg-zinc-900 dark:shadow-black dark:ring-zinc-800",children:_.map(e=>o.jsx("div",{className:"py-1",children:o.jsx(d.v.Item,{children:({active:r})=>o.jsx("span",{onClick:e.onClick,className:(0,a.dV)(r?"bg-zinc-100 text-zinc-900 dark:bg-zinc-800 dark:text-zinc-100":"text-zinc-700 dark:text-zinc-300","block cursor-pointer break-words px-4 py-2 text-sm"),children:e.title})})},e.title))})})]}):o.jsx("button",{ref:r,className:y,onClick:i?void 0:m,title:f,...v,children:z})})},47994:(e,r,t)=>{"use strict";t.r(r),t.d(r,{Card:()=>Card});var o=t(96603),i=t(61709);t(51495);var n=t(39238),a=t(61418);let s=(0,i.j)(["relative rounded-lg bg-white dark:bg-zinc-900/60 @container","shadow-[0px_0px_0px_1px_rgba(9,9,11,0.07),0px_2px_2px_0px_rgba(9,9,11,0.05)] dark:shadow-[0px_0px_0px_1px_rgba(255,255,255,0.05)]","dark:before:-inset-px dark:before:rounded-xl","dark:before:pointer-events-none dark:before:absolute dark:before:shadow-[0px_2px_8px_0px_rgba(0,_0,_0,_0.20),_0px_1px_0px_0px_rgba(255,_255,_255,_0.07)_inset]"]),Card=e=>o.jsx(n.E.div,{...e,className:(0,a.m6)(s(),e.className),children:e.children})},50089:(e,r,t)=>{"use strict";t.d(r,{B:()=>ErrorMessage});var o=t(96603),i=t(31401);t(51495);var n=t(61418),a=t(29340);let ErrorMessage=e=>o.jsx(a.j,{color:"red",Icon:i,title:e.title?"Error: "+e.title:"Error",className:(0,n.m6)(e.className,"whitespace-pre-wrap"),children:e.children})},72016:(e,r,t)=>{"use strict";t.d(r,{I:()=>FullLoadScreen});var o=t(96603),i=t(24240),n=t(61418);let FullLoadScreen=e=>o.jsx("div",{className:(0,n.dV)("flex h-full w-full flex-1 items-center justify-center",e.className),children:o.jsx(i.$,{className:"h-8 w-8"})})},71521:(e,r,t)=>{"use strict";t.d(r,{u:()=>Modal});var o=t(96603),i=t(51495),n=t.n(i),a=t(85085),s=t(57860),l=t(37931),d=t(368);let Drawer=({shouldScaleBackground:e=!0,...r})=>o.jsx(l.Drawer.Root,{shouldScaleBackground:e,...r});Drawer.displayName="Drawer";let c=l.Drawer.Trigger,p=l.Drawer.Portal,u=l.Drawer.Close,g=i.forwardRef(({className:e,...r},t)=>o.jsx(l.Drawer.Overlay,{ref:t,className:(0,d.cn)("fixed inset-0 z-50 bg-black/80",e),...r}));(0,d.h)(g,l.Drawer.Overlay.displayName);let h=i.forwardRef(({className:e,children:r,...t},i)=>(0,o.jsxs)(p,{children:[o.jsx(g,{}),(0,o.jsxs)(l.Drawer.Content,{ref:i,className:(0,d.cn)("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background outline-none focus:outline-none focus:ring-0 focus:ring-offset-0",e),...t,children:[o.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),r]})]}));(0,d.h)(h,"DrawerContent");let DrawerHeader=({className:e,...r})=>o.jsx("div",{className:(0,d.cn)("grid gap-1.5 p-4 text-center sm:text-left",e),...r});DrawerHeader.displayName="DrawerHeader";let DrawerFooter=({className:e,...r})=>o.jsx("div",{className:(0,d.cn)("mt-auto flex flex-col gap-2 p-4",e),...r});DrawerFooter.displayName="DrawerFooter";let m=i.forwardRef(({className:e,...r},t)=>o.jsx(l.Drawer.Title,{ref:t,className:(0,d.cn)("text-lg font-semibold leading-none tracking-tight",e),...r}));(0,d.h)(m,l.Drawer.Title.displayName);let f=i.forwardRef(({className:e,...r},t)=>o.jsx(l.Drawer.Description,{ref:t,className:(0,d.cn)("text-sm text-muted-foreground",e),...r}));(0,d.h)(f,l.Drawer.Description.displayName);var b=t(24240),_=t(55428),x=t(13162),z=t(61418),v=t(11476),y=t(78438);let ModalButton=e=>{let[r,t]=(0,i.useState)(!1),{hide:a}=e,{onClick:s,children:l}=e.button.props,d=(0,i.useCallback)(async()=>{let e=s?.();if(e instanceof Promise){t(1);try{await e,a()}catch(e){throw e instanceof Error&&v.A.error(e.message),e}finally{t(!1)}}else a()},[s,a]);return n().cloneElement(e.button,{onClick:d,style:{direction:"ltr"},children:(0,o.jsxs)(o.Fragment,{children:[l,1===r&&o.jsx(b.$,{className:"inline-block",noMargin:!0})]})})};function Modal(e){let{onClick:r,onClose:t,onClosed:n,onClickSecondButton:l}=e,[d,p]=(0,i.useState)(null==e.children),g=(0,i.useCallback)(()=>{t?.(),p(!1),n&&setTimeout(()=>{n()},250)},[n,t]),v=(0,i.useCallback)(()=>{p(!0)},[]),T=e.isLoading?o.jsx("div",{className:"flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-zinc-100 dark:bg-zinc-700",children:o.jsx(b.$,{className:"h-6 w-6",noMargin:!0,"aria-hidden":"true"})}):!0===e.success?o.jsx("div",{className:"flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-lime-100 dark:bg-lime-700",children:o.jsx(_.Z,{className:"h-6 w-6 text-lime-600 dark:text-lime-100","aria-hidden":"true"})}):!1===e.success?o.jsx("div",{className:"flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-rose-100 dark:bg-rose-700",children:o.jsx(x.Z,{className:"h-6 w-6 text-rose-600 dark:text-rose-100","aria-hidden":"true"})}):null,w=function(e){let[r,t]=(0,i.useState)((void 0)??!1);return(0,i.useEffect)(()=>{},[null]),r}(0),P=e.buttons??[];return(e.buttonLabel&&r&&P.push(o.jsx(a.z,{variant:e.buttonVariant??"info",onClick:r,children:e.buttonLabel})),e.secondButtonLabel&&l&&P.push(o.jsx(a.z,{variant:e.secondButtonVariant??"indeterminate",onClick:l,children:e.secondButtonLabel})),w)?(0,o.jsxs)(s.Vq,{open:d,onOpenChange:e=>{e?v():g()},children:[e.children&&o.jsx(s.hg,{asChild:!0,children:e.children}),(0,o.jsxs)(s.cZ,{className:(0,z.dV)("screen"===e.wide?"max-w-screen-2xl":e.wide?"max-w-6xl":"max-w-[600px]","flex max-h-[90vh] flex-col"),noClose:e.noClose,children:[(0,o.jsxs)("div",{className:"flex flex-grow-0 items-center gap-4",children:[T,(0,o.jsxs)(s.fK,{className:"flex-1",children:[(0,o.jsxs)(s.$N,{className:"flex items-center",children:[o.jsx("div",{className:"flex-1",children:e.title}),e.titleActions&&o.jsx("div",{className:"shrink-0",children:e.titleActions})]}),o.jsx(s.Be,{children:e.body})]})]}),o.jsx(y.i,{containerClassName:"flex-1 flex",className:"scrollable -mr-4 grid flex-1 gap-2 overflow-hidden overflow-y-scroll pr-1.5",children:e.content}),(0,o.jsxs)("div",{style:{direction:"rtl"},className:(0,z.dV)("grid flex-grow-0 grid-flow-col justify-end gap-2",P.length>1||"screen"===e.wide?"grid-cols-3 lg:grid-cols-4 xl:grid-cols-5":1===P.length?"grid-cols-2":"grid-cols-1"),children:[o.jsx(a.z,{variant:e.dismissVariant??"outline",onClick:g,style:{direction:"revert"},children:e.dismissText??"Cancel"}),P.map((e,r)=>o.jsx(ModalButton,{button:e,hide:g},r))]})]})]}):(0,o.jsxs)(Drawer,{open:d,onOpenChange:e=>{e?v():g()},children:[e.children&&o.jsx(c,{asChild:!0,children:e.children}),(0,o.jsxs)(h,{className:"flex max-h-[90vh] flex-col",children:[(0,o.jsxs)(DrawerHeader,{className:"flex flex-grow-0 items-center gap-4 text-left",children:[T,(0,o.jsxs)("div",{children:[o.jsx(m,{children:e.title}),o.jsx(f,{children:e.body})]})]}),e.content&&o.jsx("div",{className:"scrollable col-span-2 -mr-4 grid flex-1 gap-2 overflow-hidden overflow-y-scroll px-4 pb-2",children:e.content}),(0,o.jsxs)(DrawerFooter,{className:"flex-grow-0 pt-2",children:[P.map((e,r)=>o.jsx(ModalButton,{button:e,hide:g},r)),o.jsx(u,{asChild:!0,children:o.jsx(a.z,{variant:e.dismissVariant??"outline",onClick:g,children:e.dismissText??"Cancel"})})]})]})]})}},41891:(e,r,t)=>{"use strict";t.r(r),t.d(r,{NoSSR:()=>NoSSR});var o=t(96603),i=t(30240),n=t(51495),a=t(72016);let NoSSR=e=>{let r=(0,i.O)();return r?o.jsx(s,{children:e.children}):e.fallback??o.jsx(a.I,{})},s=(0,n.lazy)(()=>Promise.resolve({default:e=>o.jsx(o.Fragment,{children:e.children})}))},24240:(e,r,t)=>{"use strict";t.d(r,{$:()=>Spinner});var o=t(96603),i=t(61418);let Spinner=e=>(0,o.jsxs)("svg",{className:(0,i.m6)("h-5 w-5 animate-spin text-black/50 dark:text-white/50",e.noMargin?"":"-ml-1 mr-3",e.className),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-20",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:e.strokeWidth??4}),o.jsx("circle",{className:"opacity-100",cx:"12",cy:"12",r:"10",strokeDasharray:10*Math.PI/3,strokeLinecap:"round",stroke:"currentColor",strokeWidth:e.strokeWidth??4})]})},50592:(e,r,t)=>{"use strict";t.d(r,{YG:()=>SyncWithMoonraker,rR:()=>moonrakerWriteEffect});var o=t(96603),i=t(51495),n=t(99234),a=t(24880),s=t(36986);let l=new EventTarget,DispatchSaveAtomEvent=(e,r)=>{l.dispatchEvent(new CustomEvent("saveAtom",{detail:{itemKey:e,value:r}}))},moonrakerWriteEffect=()=>e=>{e.onSet(r=>{DispatchSaveAtomEvent(e.node.key,null==r?"null":r)})},SyncWithMoonraker=({children:e})=>{let r=(0,n.oK)(),t=(0,i.useCallback)(async e=>{let t=await r.getItem("RatOS",e);return null!=t&&"null"!=t?t:new s.DefaultValue},[r]),d=(0,i.useCallback)(async e=>{let{itemKey:t,value:o}=e.detail;await r.saveItem("RatOS",t,o)},[r]);return(0,i.useEffect)(()=>(l.addEventListener("saveAtom",d),()=>{l.removeEventListener("saveAtom",d)}),[d]),o.jsx(a.J1,{read:t,children:e})}},85085:(e,r,t)=>{"use strict";t.d(r,{d:()=>o.d,z:()=>o.z});var o=t(19623);(0,t(368).h)(o.z,"Button")},57860:(e,r,t)=>{"use strict";t.d(r,{$N:()=>g,Be:()=>h,Vq:()=>l,cZ:()=>u,fK:()=>DialogHeader,hg:()=>d});var o=t(96603),i=t(51495),n=t(2049),a=t(73835),s=t(368);let l=n.fC,d=n.xz,c=n.h_;n.x8;let p=i.forwardRef(({className:e,...r},t)=>o.jsx(n.aV,{ref:t,className:(0,s.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...r}));p.displayName=n.aV.displayName;let u=i.forwardRef(({className:e,children:r,noClose:t,...i},l)=>(0,o.jsxs)(c,{children:[o.jsx(p,{}),(0,o.jsxs)(n.VY,{ref:l,className:(0,s.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...i,children:[r,!t&&(0,o.jsxs)(n.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[o.jsx(a.Pxu,{className:"h-4 w-4"}),o.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));u.displayName=n.VY.displayName;let DialogHeader=({className:e,...r})=>o.jsx("div",{className:(0,s.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...r});DialogHeader.displayName="DialogHeader";let g=i.forwardRef(({className:e,...r},t)=>o.jsx(n.Dx,{ref:t,className:(0,s.cn)("text-lg font-semibold leading-none tracking-tight",e),...r}));g.displayName=n.Dx.displayName;let h=i.forwardRef(({className:e,...r},t)=>o.jsx(n.dk,{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",e),...r}));h.displayName=n.dk.displayName},74258:(e,r,t)=>{"use strict";t.d(r,{_v:()=>c,aJ:()=>d,pn:()=>s,u:()=>l});var o=t(96603),i=t(51495),n=t(60970),a=t(368);let s=n.zt,l=n.fC,d=n.xz,c=i.forwardRef(({className:e,sideOffset:r=4,...t},i)=>o.jsx(n.VY,{ref:i,sideOffset:r,className:(0,a.cn)("z-50 overflow-hidden rounded-md border-border bg-background px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));(0,a.h)(c,n.VY.displayName)},95597:(e,r,t)=>{"use strict";t.d(r,{N:()=>n});var o=t(13728),i=t(30819);let n=o.z.array(i.HB).parse([{id:"LDO-TMC2209",title:"LDO TMC2209",type:"TMC2209",protocol:"UART",senseResistor:.11,coolingCurrentThreshold:1.1,voltages:[24],maxCurrent:2},{id:"LDO-NITEHAWK-TMC2209",title:"LDO TMC2209",type:"TMC2209",protocol:"UART",senseResistor:.1,coolingCurrentThreshold:1.1,voltages:[24],maxCurrent:2},{id:"LDO-TMC5160-HV",title:"LDO TMC5160 HV",type:"TMC5160",protocol:"SPI",senseResistor:.075,voltages:[24,36,48],maxCurrent:3,coolingCurrentThreshold:1.5},{id:"BTT-KRAKEN-2160-PLUS",title:"BTT TMC2160 PLUS",type:"TMC5160",protocol:"SPI",senseResistor:.022,voltages:[24,36,48,56,60],maxCurrent:8,coolingCurrentThreshold:3},{id:"BTT-KRAKEN-2160",title:"BTT TMC2160",type:"TMC5160",protocol:"SPI",senseResistor:.075,voltages:[24,36,48,56,60],maxCurrent:3,coolingCurrentThreshold:1.5},{id:"BTT-TMC2209-13",title:"BTT TMC2209 v1.3",type:"TMC2209",protocol:"UART",senseResistor:.11,coolingCurrentThreshold:1.1,voltages:[24],maxCurrent:2},{id:"BTT-TMC2226-10",title:"BTT TMC2226 v1.0",type:"TMC2209",protocol:"UART",senseResistor:.11,coolingCurrentThreshold:1.1,voltages:[24],maxCurrent:2},{id:"BTT-TMC5160-PRO-11",title:"BTT TMC5160(T) Pro v1.1",type:"TMC5160",protocol:"SPI",senseResistor:.075,voltages:[24,36,48,56],maxCurrent:3,coolingCurrentThreshold:1.5},{id:"BTT-TMC5160T-PLUS-10",title:"BTT TMC5160T Plus v1.0",type:"TMC5160",protocol:"SPI",senseResistor:.022,voltages:[24,36,48,56,60],maxCurrent:10.6,coolingCurrentThreshold:3,external:!0},{id:"BTT-EZ2209",title:"BTT EZ2209",type:"TMC2209",protocol:"UART",senseResistor:.11,coolingCurrentThreshold:1.3,voltages:[24],maxCurrent:2},{id:"BTT-EZ2226",title:"BTT EZ2226",type:"TMC2209",protocol:"UART",senseResistor:.11,coolingCurrentThreshold:1.3,voltages:[24],maxCurrent:2},{id:"BTT-EZ2130",title:"BTT EZ2130",type:"TMC2130",protocol:"SPI",senseResistor:.11,coolingCurrentThreshold:.9,voltages:[24],maxCurrent:2},{id:"BTT-EZ5160-PRO",title:"BTT EZ5160 Pro",type:"TMC5160",protocol:"SPI",senseResistor:.075,coolingCurrentThreshold:1.6,voltages:[24,36,48],maxCurrent:2.5},{id:"BTT-EZ5160-RGB",title:"BTT EZ5160 RGB",type:"TMC5160",protocol:"SPI",senseResistor:.05,coolingCurrentThreshold:3,voltages:[24,48,36,56],maxCurrent:4.7},{id:"BTT-TMC2240-10",title:"BTT TMC2240 v1.0",type:"TMC2240",protocol:"SPI",coolingCurrentThreshold:1.1,voltages:[24,36],maxCurrent:2.1},{id:"LDO-2240-UART",title:"LDO TMC2240 UART",type:"TMC2240",protocol:"UART",coolingCurrentThreshold:1.1,voltages:[24,36],maxCurrent:2.1},{id:"MELLOW-FLY-HV-TMC5160-PRO-12",title:"Mellow FLY HV TMC5160 Pro v1.2",type:"TMC5160",protocol:"SPI",senseResistor:.033,coolingCurrentThreshold:3,voltages:[24,36,48],maxCurrent:4.25,external:!0},{id:"MELLOW-FLY-TMC2209",title:"Mellow FLY TMC2209",type:"TMC2209",protocol:"UART",senseResistor:.11,coolingCurrentThreshold:1.1,voltages:[24],maxCurrent:2},{id:"PRUSA-EINSY-RAMBO-TMC2130",title:"Prusa Einsy Rambo TMC2130",type:"TMC2130",protocol:"SPI",senseResistor:.22,coolingCurrentThreshold:.9,voltages:[24],maxCurrent:2},{id:"PRUSA-BUDDY-TMC2209",title:"Prusa Buddy TMC2209",type:"TMC2209",protocol:"UART",senseResistor:.11,coolingCurrentThreshold:1.1,voltages:[24],maxCurrent:2}])},89909:(e,r,t)=>{"use strict";t.d(r,{z2:()=>c,Ie:()=>d,Yo:()=>hotendFanOptions,gL:()=>partFanOptions});var o=t(96603),i=t(30819),n=t(368),a=t(51495),s=t.n(a);let l=s().forwardRef(({className:e,...r},t)=>o.jsx("strong",{ref:t,className:(0,n.cn)("font-semibold",e),...r}));(0,n.h)(l,"Strong");let d=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("p",{children:[o.jsx(l,{className:"dark:text-sky-300/70",children:"Input Voltage PWM"})," is used on fans that have no dedicated pwm pin (2 and 3-pin fans)."]}),(0,o.jsxs)("p",{children:[o.jsx(l,{className:"dark:text-sky-300/70",children:"Digital PWM"})," is used for fans that have a dedicated PWM signal wire (requires a 4-pin fan)."]})]}),partFanOptions=(e,r)=>{let t=[];return(null==r||r?.axis===i.po.x||r?.axis===null)&&(t.push({id:"2pin",title:"Input Voltage PWM",badge:[{color:"purple",children:e?.controlboard?.name??"Control Board"}]}),t.push({id:"4pin",title:"Digital PWM on 2-pin port",badge:[{color:"purple",children:e?.controlboard?.name??"Control Board"}]})),e?.controlboard?.fourPinFanConnectorCount!=null&&e.controlboard.fourPinFanConnectorCount>0&&t.push({id:"4pin-dedicated",title:"Digital PWM on 4-pin port",badge:[{color:"purple",children:e.controlboard.name}]}),r?.toolboard!=null&&(t.push({id:"2pin-toolboard",title:"Input Voltage PWM",badge:[{color:"sky",children:`${r.toolboard.name}${null!=r.toolNumber&&` T${r.toolNumber}`}`}]}),t.push({id:"4pin-toolboard",title:"Digital PWM on 2-pin port",badge:[{color:"sky",children:`${r.toolboard.name}${null!=r.toolNumber&&` T${r.toolNumber}`}`}]}),r?.toolboard.fourPinFanConnectorCount!=null&&r.toolboard.fourPinFanConnectorCount>0&&t.push({id:"4pin-dedicated-toolboard",title:"Digital PWM on 4-pin port",badge:[{color:"sky",children:`${r.toolboard.name}${null!=r.toolNumber&&` T${r.toolNumber}`}`}]})),t},hotendFanOptions=(e,r)=>{let t=[];return(null==r||r?.axis===i.po.x)&&(t.push({id:"2pin",title:"Input Voltage PWM",badge:[{color:"purple",children:e?.controlboard?.name??"Control Board"}]}),t.push({id:"4pin",title:"Digital PWM on 2-pin port",badge:[{color:"purple",children:e?.controlboard?.name??"Control Board"}]})),(e?.controlboard?.fourPinFanConnectorCount!=null&&e.controlboard.fourPinFanConnectorCount>2||e?.controlboard?.fourPinFanConnectorCount!=null&&e.controlboard.fourPinFanConnectorCount>1&&e.controllerFan?.id!=="4pin-dedicated")&&t.push({id:"4pin-dedicated",title:"Digital PWM on 4-pin port",badge:[{color:"purple",children:e?.controlboard?.name??"Control Board"}]}),r?.toolboard!=null&&(t.push({id:"2pin-toolboard",title:"Input Voltage PWM",badge:[{color:"sky",children:`${r.toolboard.name}${null!=r.toolNumber&&` T${r.toolNumber}`}`}]}),t.push({id:"4pin-toolboard",title:"Digital PWM on 2-pin port",badge:[{color:"sky",children:`${r.toolboard.name}${null!=r.toolNumber&&` T${r.toolNumber}`}`}]}),r?.toolboard.fourPinFanConnectorCount!=null&&r.toolboard.fourPinFanConnectorCount>1&&t.push({id:"4pin-dedicated-toolboard",title:"Digital PWM on 4-pin port",badge:[{color:"sky",children:`${r.toolboard.name}${null!=r.toolNumber&&` T${r.toolNumber}`}`}]})),t},c={id:"2pin",title:"Input Voltage PWM",badge:[{color:"purple",children:"Control Board"}]}},63942:(e,r,t)=>{"use strict";t.d(r,{S:()=>getDefaultNozzle});let getDefaultNozzle=()=>({diameter:.4,type:"Regular"})},4106:(e,r,t)=>{"use strict";t.d(r,{B:()=>n,a:()=>findPreset});var o=t(13728),i=t(30819);let findPreset=(e,r,t,o,i)=>e.presets?.slice().sort((e,r)=>i?r.run_current-e.run_current:e.run_current-r.run_current).find(e=>e.driver===r.type&&e.voltage===t&&("TMC2240"===r.type||"sense_resistor"in e&&e.sense_resistor===r.senseResistor)&&(null==o||e.run_current===o)),n=o.z.array(i.vF).parse([{id:"generic",title:"Generic Stepper",maxPeakCurrent:2.8},{id:"BONDTECH-42H025H-0704-002",title:"Bondtech LGX Stepper",maxPeakCurrent:.7},{id:"LDO-42STH48-2504AC",title:"LDO-42STH48-2504AC",maxPeakCurrent:2.5,presets:[{run_current:1.1,voltage:24,driver:"TMC2209",sense_resistor:.11,driver_TBL:1,driver_TOFF:3,driver_HEND:0,driver_HSTRT:0},{run_current:1.6,voltage:24,driver:"TMC2209",sense_resistor:.11,driver_TBL:2,driver_TOFF:3,driver_HEND:0,driver_HSTRT:6},{run_current:1.6,voltage:24,driver:"TMC5160",sense_resistor:.075,driver_TBL:2,driver_TOFF:3,driver_HEND:0,driver_HSTRT:6},{run_current:1.768,voltage:48,driver:"TMC5160",sense_resistor:.075,driver_TBL:0,driver_TOFF:4,driver_HEND:0,driver_HSTRT:4}]},{id:"LDO-42STH40-1684AC",title:"LDO-42STH40-1684AC",maxPeakCurrent:1.68,presets:[{run_current:.4,voltage:24,driver:"TMC2130",sense_resistor:.22,driver_IHOLDDELAY:8,driver_TPOWERDOWN:0,driver_TBL:2,driver_TOFF:3,driver_HEND:1,driver_HSTRT:5,driver_PWM_FREQ:2,driver_PWM_GRAD:2,driver_PWM_AMPL:230,driver_PWM_AUTOSCALE:!0,driver_SGT:5},{run_current:.52,voltage:24,driver:"TMC2130",sense_resistor:.22,driver_IHOLDDELAY:8,driver_TPOWERDOWN:0,driver_TBL:2,driver_TOFF:3,driver_HEND:1,driver_HSTRT:5,driver_PWM_FREQ:2,driver_PWM_GRAD:4,driver_PWM_AMPL:240,driver_PWM_AUTOSCALE:!0,driver_SGT:3},{run_current:.8,voltage:24,driver:"TMC2209",sense_resistor:.11,driver_TBL:1,driver_TOFF:3,driver_HEND:3,driver_HSTRT:0},{run_current:1.188,voltage:24,driver:"TMC2209",sense_resistor:.11,driver_TBL:0,driver_TOFF:3,driver_HEND:0,driver_HSTRT:0}]},{id:"LDO-42STH48-2004MAH",title:"LDO-42STH48-2004MAH",maxPeakCurrent:2,fullStepsPerRotation:400},{id:"LDO-42STH48-2004AC",title:"LDO-42STH48-2004AC",maxPeakCurrent:2},{id:"LDO-42STH25-1404MAC",title:"LDO-42STH25-1404MAC",maxPeakCurrent:1.4,fullStepsPerRotation:400,presets:[{voltage:24,driver:"TMC2209",sense_resistor:.11,run_current:.85,driver_TBL:1,driver_TOFF:3,driver_HEND:2,driver_HSTRT:0},{voltage:24,driver:"TMC2209",sense_resistor:.11,run_current:1,driver_TBL:2,driver_TOFF:3,driver_HEND:3,driver_HSTRT:0}]},{id:"LDO-42STH25-1004CL200E",title:"LDO-42STH25-1004CL200E",maxPeakCurrent:1},{id:"LDO-36STH20-1004AHG",title:"LDO-36STH20-1004AHG",maxPeakCurrent:1,presets:[{voltage:24,driver:"TMC2209",sense_resistor:.11,run_current:.707,driver_TBL:0,driver_HEND:6,driver_HSTRT:7,driver_TOFF:4}]},{id:"LDO-36STH17-1004AHG",title:"LDO-36STH17-1004AHG",maxPeakCurrent:1},{id:"LDO-35STH48-1684AH",title:"LDO-35STH48-1684AH",maxPeakCurrent:1.68}])},45041:(e,r,t)=>{"use strict";t.d(r,{D:()=>ToolheadHelper});var o=t(79030),i=t(30819),n=t(93073),a=t(63942),s=t(32012),l=t.n(s);let ToolheadHelper=class ToolheadHelper{constructor(e){this.config=e}hasToolboard(){return null!=this.config.toolboard}getToolboard(){return this.config.toolboard}getMotionStepperName(){return this.config.axis===i.po.dual_carriage?"dual_carriage":`stepper_${this.getMotionAxis()}`}getToolboardName(){if(null==this.config.toolboard)throw Error(`Toolhead T${this.getTool()} does not have a toolboard`);return`toolboard_${this.getShortToolName()}`}getShortToolName(){return`t${this.getTool()}`}getDescription(){return this.config.description??"the printer's toolhead"}getMotionAxis(){return this.config.axis===i.po.dual_carriage?i.po.dual_carriage:i.po.x}getExtruderAxis(){return this.config.axis===i.po.dual_carriage?i.po.extruder1:i.po.extruder}getToolCommand(){return`T${this.getTool()}`}getTool(){return this.config.axis===i.po.dual_carriage?1:0}getSerialSuffix(){return`t${this.getTool()}`}getExtruder(){return this.config.extruder}getHotend(){return this.config.hotend}getNozzle(){return this.config.nozzle??(0,a.S)()}getThermistor(){return this.config.thermistor}getXEndstop(){return this.config.xEndstop}getYEndstop(){return this.config.yEndstop}getXAccelerometer(){return this.config.xAccelerometer}getYAccelerometer(){return this.config.yAccelerometer}getXAccelerometerName(){switch(this.getXAccelerometer()?.id){case"controlboard":return"controlboard";case"toolboard":if(this.hasToolboard())return this.getToolboardName();case"sbc":return"rpi";case"beacon":return"beacon";default:return"controlboard"}}getYAccelerometerName(){switch(this.getYAccelerometer()?.id){case"controlboard":return"controlboard";case"toolboard":if(this.hasToolboard())return this.getToolboardName();case"sbc":return"rpi";case"beacon":return"beacon";default:return"controlboard"}}getChangeSet(e){if(null==e)return null;let r={};Object.keys(e).forEach(t=>{let o=this.getConfig()[t],i=e[t];if(null!=o&&null==i||null==o&&null!=i){r[t]=i;return}o&&i&&("object"==typeof o&&"id"in o&&"object"==typeof i&&"id"in i?o.id!==i.id&&(r[t]=i):l()(o,i)||(r[t]=i))});let t=n.b2.safeParse(r);return t}getProbe(){return this.config.probe}getPartFan(){return this.config.partFan}getHotendFan(){return this.config.hotendFan}serialize(){return(0,o.m6)(this.config)}getConfig(){return{...this.config}}}},99027:(e,r,t)=>{"use strict";t.d(r,{S:()=>o.SX,u:()=>o.uF});var o=t(76461)},41620:(e,r,t)=>{"use strict";t.d(r,{X:()=>getHost,t:()=>formatBytes});let getHost=()=>""!="".trim()?"":null;function formatBytes(e,r=2){if(0==e)return"0 bytes";var t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(r))+" "+["bytes","kb","mb","gb","tb","pb","eb","zb","yb"][t]}},368:(e,r,t)=>{"use strict";t.d(r,{cn:()=>cn,h:()=>setDisplayName});var o=t(4790),i=t(61418);function cn(...e){return(0,i.m6)((0,o.clsx)(e))}function setDisplayName(e,r){e.displayName=r}},30240:(e,r,t)=>{"use strict";t.d(r,{O:()=>useIsClient});var o=t(51495);let useIsClient=()=>{let[e,r]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{},[]),e}},78303:(e,r,t)=>{"use strict";t.r(r),t.d(r,{ControllerFanState:()=>x,LoadablePrinterConfigurationState:()=>v,PerformanceModeState:()=>f,PrinterConfigurationState:()=>z,StandstillStealthState:()=>_,StealthchopState:()=>b,serializePartialPrinterConfiguration:()=>serializePartialPrinterConfiguration,serializePrinterConfiguration:()=>serializePrinterConfiguration,usePrinterConfiguration:()=>usePrinterConfiguration,useSerializedPrinterConfiguration:()=>useSerializedPrinterConfiguration});var o=t(36986),i=t(13728),n=t(43700),a=t(41018),s=t(24880),l=t(64567),d=t(51495),c=t(79030),p=t(86053),u=t(86128),g=t(89909),h=t(50592),m=t(83926);let f=(0,o.atom)({key:"PerformanceMode",default:!1,effects:[(0,h.rR)(),(0,s.ok)({refine:(0,l.getRefineCheckerForZodSchema)(i.z.boolean().optional().nullable())})]}),b=(0,o.atom)({key:"Stealchop",default:!1,effects:[(0,h.rR)(),(0,s.ok)({refine:(0,l.getRefineCheckerForZodSchema)(i.z.boolean().optional().nullable())})]}),_=(0,o.atom)({key:"StandstillStealth",default:!1,effects:[(0,h.rR)(),(0,s.ok)({refine:(0,l.getRefineCheckerForZodSchema)(i.z.boolean().optional().nullable())})]}),x=(0,o.atom)({key:"ControllerFan",default:g.z2,effects:[(0,h.rR)(),(0,s.ok)({refine:(0,l.getRefineCheckerForZodSchema)(n.XG.nullable())})]}),z=(0,o.selector)({key:"PrinterConfiguration",get:async({get:e})=>{let{printer:r,printerSize:t,performanceMode:i,stealthchop:n,standstillStealth:s,rails:l,controlboard:d,controllerFan:g,toolheads:h}=e((0,o.waitForAll)({printer:p.H6,printerSize:p.hq,performanceMode:f,stealthchop:b,standstillStealth:_,rails:p.q7,controlboard:p.OS,controllerFan:x,toolheads:u.$T})),z={printer:null==r?null:{...r,defaults:{...r.defaults,toolheads:r?.defaults.toolheads.map(e=>c.m6(e))}},size:t,performanceMode:i,stealthchop:n,standstillStealth:s,rails:l,controlboard:d,controllerFan:g,toolheads:h.length>0?h:void 0},v=a.jz.safeParse(z);return!1===v.success&&(0,m.j)().error({errors:v.error.flatten().fieldErrors,data:z},"Couldn't parse printer configuration"),v.success?v.data:null}}),v=(0,o.selector)({key:"LoadablePrinterConfigurationState",get:async({get:e})=>{let r=e((0,o.noWait)(z));return({hasValue:()=>r.contents,hasError:()=>null,loading:()=>null})[r.state]()}}),serializePrinterConfiguration=e=>{let r={printer:e.printer.id,toolheads:e.toolheads.map(e=>(0,c.m6)(e)),size:e.size,controlboard:e.controlboard.id,controllerFan:e.controllerFan.id,performanceMode:e.performanceMode,stealthchop:e.stealthchop,standstillStealth:e.standstillStealth,rails:e.rails.map(e=>(0,c.Yz)(e))};return a.q_.parse(r)},serializePartialPrinterConfiguration=e=>{let r=e?.toolheads?.map(e=>c.od(e)),t={printer:e?.printer?.id,toolheads:r,size:e?.size,controlboard:e?.controlboard?.id,controllerFan:e?.controllerFan?.id,performanceMode:e?.performanceMode,stealthchop:e?.stealthchop,standstillStealth:e?.standstillStealth};return a.NN.parse(t)},useSerializedPrinterConfiguration=()=>{let e=(0,o.useRecoilValue)(z),r=(0,d.useMemo)(()=>serializePartialPrinterConfiguration(e??{}),[e]);return r},usePrinterConfiguration=()=>{let[e,r]=(0,o.useRecoilState)(p.H6),[t,i]=(0,o.useRecoilState)(p.hq),[n,s]=(0,o.useRecoilState)(p.OS),[l,d]=(0,o.useRecoilState)(f),[c,u]=(0,o.useRecoilState)(b),[g,h]=(0,o.useRecoilState)(_),[m,v]=(0,o.useRecoilState)(x),y=(0,o.useRecoilValue)(p.q7),T=(0,o.useRecoilValue)(z),w=useSerializedPrinterConfiguration(),P=a.dl.safeParse(T);return{selectedPrinter:e,setSelectedPrinter:r,selectedPrinterOption:t,setSelectedPrinterOption:i,selectedBoard:n,setSelectedBoard:s,performanceMode:l,setPerformanceMode:d,stealthchop:c,setStealthchop:u,standstillStealth:g,setStandstillStealth:h,selectedPrinterRails:y,selectedControllerFan:m,setSelectedControllerFan:v,partialPrinterConfiguration:T,serializedPrinterConfiguration:w,parsedPrinterConfiguration:P}}},99234:(e,r,t)=>{"use strict";t.d(r,{oK:()=>useMoonraker,xH:()=>useMoonrakerMutation,DS:()=>useMoonrakerQuery,Fu:()=>useMoonrakerState,A4:()=>useNamespacedItemQuery,hS:()=>usePrinterObjectQuery,Q:()=>usePrinterObjectSubscription});var o=t(51495),i=t(68797),n=t(7786),a=t(80385),s=t(41620);let l=[{version:1,description:"Undo double JSON encoding of RatOS's data",up:async()=>{let e=await window.fetch(`http://${(0,s.X)()}/server/database/item?namespace=RatOS`);if(!e.ok)return{result:"Nothing to migrate"};{let r=await e.json();if("error"in r)throw Error(r.error.message);let t=[];if(null==r.result.value)return{result:"Nothing to migrate"};for await(let[e,t]of Object.entries(r.result.value))try{let r=JSON.parse(t);console.log("Migrating",e,"from",t,"to",r),await window.fetch(`http://${(0,s.X)()}/server/database/item`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({namespace:"RatOS",key:e,value:r})})}catch(r){console.error("Error migrating",e,t,"clearing key"),await window.fetch(`http://${(0,s.X)()}/server/database/item?namespace=RatOS&key=${encodeURIComponent(e)}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({namespace:"RatOS",key:e})});continue}return{result:`Succesfully decoded ${t.length} keys.
${t.join("\n")}`}}},down:async()=>{let e=await window.fetch(`http://${(0,s.X)()}/server/database/item?namespace=RatOS`);if(e.ok){let r=await e.json();if("error"in r)throw Error(r.error.message);if(null==r.result.value)return{result:"Nothing to migrate"};let t=[];for await(let[e,o]of Object.entries(r.result.value)){let r=JSON.stringify(o);await window.fetch(`http://${(0,s.X)()}/server/database/item`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({namespace:"RatOS",key:e,value:r})}),t.push(`Re-encoded ${e}`)}return{result:`Succesfully re-encoded ${t.length} keys.
${t.join("\n")}`}}return{result:"Nothing to migrate"}}},{version:2,description:"Change caramba printers to v-core-4 / v-chonk",up:async()=>{let e=await window.fetch(`http://${(0,s.X)()}/server/database/item?namespace=RatOS`);if(!e.ok)return{result:"Nothing to migrate"};{let r=await e.json();if("error"in r)throw Error(r.error.message);let t=[];if(null==r.result.value)return{result:"Nothing to migrate"};for await(let[e,o]of Object.entries(r.result.value))if("Printer"===e&&"string"==typeof o){let e=o.replace(/caramba-chonk/g,"v-chonk").replace(/caramba/g,"v-core-4");if(e===o)continue;await window.fetch(`http://${(0,s.X)()}/server/database/item`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({namespace:"RatOS",key:"Printer",value:e})}),t.push(`Migrated ${o} to ${e}`)}return{result:`Succesfully migrated ${t.length} keys.
${t.join("\n")}`}}},down:async()=>{let e=await window.fetch(`http://${(0,s.X)()}/server/database/item?namespace=RatOS`);if(!e.ok)return{result:"Nothing to migrate"};{let r=await e.json();if("error"in r)throw Error(r.error.message);let t=[];if(null==r.result.value)return{result:"Nothing to migrate"};for await(let[e,o]of Object.entries(r.result.value))if("Printer"===e&&"string"==typeof o){let e=o.replace(/v-chonk/g,"caramba-chonk").replace(/v-core-4/g,"caramba");if(e===o)continue;await window.fetch(`http://${(0,s.X)()}/server/database/item`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({namespace:"RatOS",key:"Printer",value:e})}),t.push(`Migrated ${o} to ${e}`)}return{result:`Succesfully migrated ${t.length} keys.
${t.join("\n")}`}}}}],getCurrentVersion=async()=>{let e=await window.fetch(`http://${(0,s.X)()}/server/database/item?namespace=RatOS&key=__db_version`);if(e.ok){let r=await e.json();return"error"in r?0:r.result.value}return 0},setCurrentVersion=async e=>{await window.fetch(`http://${(0,s.X)()}/server/database/item`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({namespace:"RatOS",key:"__db_version",value:e})})},d=!1,migrate=async(e,r)=>{if(d)return console.log("Already migrating, ignoring..");if(e===r)return console.log("Already at target version");d=!0;try{let t=l.filter(t=>t.version>e&&t.version<=r).sort((t,o)=>e<=r?t.version-o.version:o.version-t.version);for await(let o of t){let t=await (e<r?o.up():o.down());console.log(`Migrated to version ${o.version}: ${t.result}`)}await setCurrentVersion(r)}finally{d=!1}},c=!1,migrateToLatest=async()=>{if(c)return console.log("Already migrated, ignoring..");let e=await getCurrentVersion(),r=Math.max(...l.map(e=>e.version));if(e===r){console.log("Already at latest version");return}if(d){console.log("Already migrating, ignoring..");return}console.log("Migrating to latest version...",e,r),await migrate(e,r),c=!0,console.log("Migration complete.")};var p=t(73992),u=t(32012),g=t.n(u),h=t(83926);let m=0,getWsURL=()=>{let e=(0,s.X)();return null==e||""==e.trim()?null:`ws://${e}/websocket`},f={},useMoonraker=e=>{let r=(0,o.useRef)({}),t=(0,o.useRef)({}),i=(0,o.useRef)([]),n=(0,o.useRef)([]),[s,l]=(0,o.useState)(getWsURL());(0,o.useEffect)(()=>{l(getWsURL())},[]);let d=(0,o.useCallback)(e=>{if("error"in e)return!1;if("notify_status_update"===e.method&&null!=e.params){let r=e.params[0];if(null!=r)for(let e of i.current){let t=f[e];if(null!=t){for(let e in t)if(null!=r[e])return!0}}}return!1},[]),{lastJsonMessage:c,sendJsonMessage:p,readyState:u}=(0,a.ZP)(s,{filter:t=>{if("connected"!==b)return!0;try{let o=JSON.parse(t.data);if(null!=r.current[o.id]||e?.passThroughUpdateMethods?.length&&"method"in o&&e.passThroughUpdateMethods.includes(o.method))return!0}catch(e){(0,h.j)().warn({e,messageData:t.data},"Filter: Failed to parse message")}return!1},onMessage:r=>{if(e?.onStatusUpdate)try{let t=JSON.parse(r.data);if(d(t)){let r=t.params[0];e.onStatusUpdate?.(r)}}catch(e){(0,h.j)().warn({e,messageData:r.data},"OnMessage: Failed to parse message")}},shouldReconnect:e=>!0,reconnectAttempts:1/0,reconnectInterval:3e3,share:!0}),g=(0,o.useRef)(u);g.current=u;let[b,_]=(0,o.useState)(1===u?"connected":"connecting"),x=(0,o.useCallback)((e,r)=>{1===g.current?e():n.current.push({resolve:e,reject:r})},[]),z=(0,o.useCallback)(()=>new Promise((e,r)=>{x(e,r)}),[x]),v=(0,o.useCallback)(async(e,o={})=>{let i=++m;return await z(),new Promise((n,a)=>{r.current[i]=(e,r)=>e?a(e):r&&"object"==typeof r&&"error"in r&&r.error?a(r.error):null==r?a(Error("No result. Unknown response format.")):void n(r);let s=1e4;"printer.gcode.script"===e&&(s=6e5),t.current[i]=window.setTimeout(()=>{r.current[i]?.(Error("Request timed out"),null),delete r.current[i],delete t.current[i]},s),p({jsonrpc:"2.0",method:e,params:o,id:i})})},[z,p]),y=(0,o.useCallback)(async(...e)=>{let r=Object.fromEntries(e.map(e=>[e,null])),t=Object.assign({},r,...Object.values(f).filter(e=>null!=e)),o=v("printer.objects.subscribe",{objects:t}),n=m;f[n]=r,i.current.push(n);let a=(await o).status;return{res:a,unsuscribe:async()=>{if(i.current=i.current.filter(e=>e!==n),null==f[n]){delete f[n];let e=Object.assign({},...Object.values(f).filter(e=>null!=e));await v("printer.objects.subscribe",{objects:e})}}}},[v]),T=(0,o.useCallback)(async(e,r,t)=>(await z(),await v("server.database.post_item",{namespace:e,key:r,value:t})),[v,z]),w=(0,o.useCallback)(async(e,r)=>{await z();try{let t=await v("server.database.get_item",{namespace:e,key:r});return t?.value??null}catch(e){return(0,h.j)().warn(e),null}},[v,z]);return(0,o.useEffect)(()=>{1===u?(async()=>{await migrateToLatest(),n.current.forEach(e=>e.resolve()),n.current=[],_("connected")})():_("connecting")},[u]),(0,o.useEffect)(()=>{c?.id&&r.current[c.id]&&(window.clearTimeout(t.current[c.id]),"error"in c?r.current[c.id](Error(c.error.message),null):r.current[c.id](null,c.result),delete t.current[c.id],delete r.current[c.id])},[c]),(0,o.useEffect)(()=>()=>{for(let e in t.current)delete t.current[e],delete r.current[e];if(i.current.length>0){i.current.forEach(e=>{delete f[e]}),i.current=[];let e=Object.assign({},...Object.values(f).filter(e=>null!=e));v("printer.objects.subscribe",{objects:Object.keys(e).length>0?e:null}).catch(e=>{})}n.current.forEach(e=>e.reject()),n.current=[]},[]),{query:v,saveItem:T,getItem:w,subscribeToObject:y,status:b,lastMessage:c,isReady:1===u}},useNamespacedItemQuery=(e,r,t)=>{let{getItem:o}=useMoonraker();return(0,i.a)({...t,queryKey:[e,r],queryFn:async()=>o(e,r)})},useMoonrakerQuery=(...e)=>{let{query:r}=useMoonraker(),t=3===e.length?e[2]:e[1],o=3===e.length?e[1]:void 0,n=e[0],a=3===e.length?[n,o]:[n];return(0,i.a)({...t??{},queryKey:[e[0]],queryFn:async()=>r(...a)})},useMoonrakerMutation=(...e)=>{let{query:r}=useMoonraker(),t=e[1],o=e[0];return(0,n.D)({...t,mutationKey:[e[0]],mutationFn:async e=>{let t=e?[o,e]:[o];return r(...t)}})},usePrinterObjectQuery=(...e)=>{let{query:r}=useMoonraker();return(0,i.a)({queryKey:e,queryFn:async()=>{let t=Object.fromEntries(e.map(e=>[e,null]));return(await r("printer.objects.query",{objects:t})).status}})},usePrinterObjectSubscription=(e,...r)=>{let[t,i]=(0,o.useState)(null),n=(0,o.useRef)(t);n.current=t;let a=(0,o.useRef)(e);a.current=e;let s=(0,o.useCallback)(e=>null==a.current?e:a.current?.(e),[]),l=(0,o.useMemo)(()=>Object.fromEntries(r.map(e=>[e,null])),[JSON.stringify(r.sort())]),{subscribeToObject:d}=useMoonraker({onStatusUpdate:(0,o.useCallback)(e=>{let r={};for(let t in l)null!=e[t]&&(r[t]=e[t]);let t=s(r);if(null==t||"object"!=typeof t)throw Error("Invalid selection function, must return object, got "+typeof t);Object.keys(r).length>0&&!1===g()(t,n.current)&&i(e=>(0,p.T)(e??{},t))},[s,l])});return(0,o.useEffect)(()=>{let e=d(...Object.keys(l));return e.then(e=>{i(s(e.res))}).catch(e=>{e instanceof Error&&(0,h.j)().error(e)}),()=>{e.then(e=>e.unsuscribe()).catch(e=>{e instanceof Error&&(0,h.j)().error(e)})}},[s,l,d]),t},useNamespacedItemMutation=(e,r,t)=>{let{saveItem:o}=useMoonraker();return(0,n.D)({...t,mutationKey:[e,r],mutationFn:t=>o(e,r,t)})},useMoonrakerState=(e,r,t=null)=>{let i=useNamespacedItemQuery(e,r,{initialData:t}),n=useNamespacedItemMutation(e,r),a=(0,o.useCallback)(async e=>{let r="function"==typeof e?e(i.data??t):e;await n.mutateAsync(r,{onSuccess:()=>{i.refetch()}})},[t,n,i]);return[i.data??t,a,i,n]}},86053:(e,r,t)=>{"use strict";t.d(r,{H6:()=>m,OS:()=>_,Xu:()=>f,ew:()=>x,hq:()=>b,q7:()=>z});var o=t(24880),i=t(53197),n=t(99027),a=t(36986),s=t(13728),l=t(64567),d=t(79030),c=t(30819),p=t(49614),u=t(50592),g=t(41018);let h={},readPrinterAtom=async({read:e})=>{let r=await e(m.key);if(null!=r){let e=s.z.object({id:i.Ox.shape.id}).safeParse(r);if(e.success||(e=s.z.object({id:i.Ox.shape.id}).safeParse({id:r})),e.success){let r=h[e.data.id];return null==r&&(r=await n.u.printer.printer.query(e.data.id,{}))&&(h[e.data.id]=r),r??null}}return null},readPrinterRailAtom=e=>async({read:r})=>{let t=await r(x(e).key);if(null!=t){let o=c.Ah.safeParse(t);if(o.success)return o.data;let i=await readPrinterAtom({read:r}),n=i?.defaults.rails.find(r=>r.axis===e);if(null!=n){let e=c.Ah.safeParse({...n,...t});if(e.success)return e.data}}return null},m=(0,a.atom)({key:"Printer",default:null,effects:[(0,u.rR)(),(0,o.ok)({read:readPrinterAtom,write:async({write:e},r)=>{await new Promise(t=>{r instanceof a.DefaultValue?e(m.key,null):e(m.key,r??null),setTimeout(()=>{},500)})},refine:(0,l.getRefineCheckerForZodSchema)(i.Ox.nullable())})]}),f=(0,a.selector)({key:"LoadablePrinterState",get:async({get:e})=>{let r=e((0,a.noWait)(m));return({hasValue:()=>r.contents,hasError:()=>[],loading:()=>[]})[r.state]()}}),b=(0,a.atom)({key:"PrinterOption",default:null,effects:[(0,u.rR)(),(0,o.ok)({refine:(0,l.getRefineCheckerForZodSchema)(g.LN.nullable())})]}),_=(0,a.atom)({key:"Controlboard",default:null,effects:[(0,u.rR)(),(0,o.ok)({read:async({read:e})=>{let r=await e(_.key);if(null!=r){let e=s.z.object({id:p.WQ}).safeParse(r);if(e.success){let r=await n.u.mcu.boards.query({boardFilters:{toolboard:!1}}),t=r.find(r=>r.id===e.data.id);return t??null}}return null},refine:(0,l.getRefineCheckerForZodSchema)(p.$l.nullable())})]}),x=(0,a.atomFamily)({key:"PrinterRail",default:null,effects:e=>[(0,u.rR)(),(0,o.ok)({read:readPrinterRailAtom(e),refine:(0,l.getRefineCheckerForZodSchema)(c.Ah.nullable())})]}),z=(0,a.selector)({key:"PrinterRails",get:({get:e})=>{let r=e(m),t=r?.defaults.rails.map(r=>{let t=e(x(r.axis));return d.Ak(t??r)});return t??[]},set:({set:e},r)=>{if(r instanceof a.DefaultValue){Object.values(c.po).forEach(r=>{e(x(r),null)});return}r.forEach(r=>{e(x(r.axis),(0,d.Yz)(r))})}});(0,a.selector)({key:"LoadablePrinterRailsState",get:async({get:e})=>{let r=e((0,a.noWait)(z));return({hasValue:()=>r.contents,hasError:()=>[],loading:()=>[]})[r.state]()}})},86128:(e,r,t)=>{"use strict";t.d(r,{$T:()=>h,AF:()=>g,wm:()=>m});var o=t(36986),i=t(24880),n=t(13728),a=t(64567),s=t(99027),l=t(49614);t(30819);var d=t(93073),c=t(86053),p=t(50592),u=t(83926);let g=(0,o.atomFamily)({key:"PrinterToolhead",default:null,effects:e=>[(0,p.rR)(),(0,i.ok)({read:async({read:r})=>{let t=await r(g(e).key);if("object"!=typeof t||null==t)return null;let{toolNumber:o,...i}=t;if(null!=i){let r=d.x8.safeParse(i);if(r.success){let t=r.data.toolboard;if(t&&null!=t){let e=n.z.object({id:l.WQ}).safeParse(t);if(e.success){let r=await s.u.mcu.boards.query({boardFilters:{toolboard:!0}}),o=r.find(r=>r.id===e.data.id);o&&(t=l.MG.parse(o))}}return{...r.data,toolboard:t,toolNumber:e}}(0,u.j)().debug("RecoilSync: failed to read toolhead!",g(e).key,r.error,i)}return null},refine:(0,a.getRefineCheckerForZodSchema)(d.PY.extend({toolNumber:d.Qr}).nullable())})]});(0,o.selectorFamily)({key:"DeserializeToolheadQuery",get:e=>async({get:r})=>{let t=d.x8.safeParse(await s.u.printer.deserializeToolheadConfiguration.query({config:e.th,printerConfig:{controlboard:e.boardId}}));return t.success?{...t.data,toolNumber:e.toolNumber}:null}});let h=(0,o.selector)({key:"PrinterToolheadsState",get:({get:e})=>{let r=e(c.H6);return null==r?[]:e((0,o.waitForAll)(r.defaults.toolheads.map((e,r)=>g(r)))).filter(Boolean)},set:({set:e,reset:r},t)=>{if(t instanceof o.DefaultValue)throw Error("ToolheadsState cannot be reset, please reset the individual ToolheadState instead");t.forEach(r=>{e(g(r.toolNumber),{...r,toolNumber:r.toolNumber})})}}),m=(0,o.selector)({key:"LoadablePrinterToolheadsState",get:async({get:e})=>{let r=e((0,o.noWait)(h));return({hasValue:()=>r.contents,hasError:()=>[],loading:()=>[]})[r.state]()}})},79030:(e,r,t)=>{"use strict";t.d(r,{Ak:()=>deserializePrinterRail,DX:()=>stringToTitleObject,Df:()=>deserializeDriver,Oj:()=>deserializePrinterRailDefinition,WZ:()=>deserializeStepper,Yz:()=>serializePrinterRail,m6:()=>serializeToolheadConfiguration,od:()=>serializePartialToolheadConfiguration});var o=t(95597),i=t(30819),n=t(4106);t(93073),t(45041);let deserializeDriver=e=>o.N.find(r=>r.id===e)??null,deserializeStepper=e=>n.B.find(r=>r.id===e)??null,deserializePrinterRail=e=>{let r=deserializeStepper(e.stepper),t=deserializeDriver(e.driver);if(null==r)throw Error(`Stepper ${e.stepper} not found in database`);if(null==t)throw Error(`Driver ${e.driver} not found in database`);return i.g6.parse({...e,stepper:r,driver:t})},deserializePrinterRailDefinition=e=>{let r=deserializeStepper(e.stepper),t=deserializeDriver(e.driver);if(null==r)throw Error(`Stepper ${e.stepper} not found in database`);if(null==t)throw Error(`Driver ${e.driver} not found in database`);return i.P6.parse({...e,stepper:r,driver:t})},stringToTitleObject=e=>({id:e,title:e}),serializePrinterRail=e=>i.Ah.parse({...e,driver:e.driver.id,stepper:e.stepper.id}),serializeToolheadConfiguration=e=>({...e,toolboard:e.toolboard?.id,hotend:e.hotend.id,thermistor:e.thermistor,extruder:e.extruder.id,probe:e.probe?.id,xEndstop:e.xEndstop.id,yEndstop:e.yEndstop.id,partFan:e.partFan.id,hotendFan:e.hotendFan.id,xAccelerometer:e.xAccelerometer?.id,yAccelerometer:e.yAccelerometer?.id}),serializePartialToolheadConfiguration=e=>null==e?void 0:{...e,toolboard:e.toolboard?.id,hotend:e.hotend?.id,thermistor:e.thermistor,extruder:e.extruder?.id,probe:e.probe?.id,xEndstop:e.xEndstop?.id,yEndstop:e.yEndstop?.id,partFan:e.partFan?.id,hotendFan:e.hotendFan?.id,xAccelerometer:e.xAccelerometer?.id,yAccelerometer:e.yAccelerometer?.id}},76461:(e,r,t)=>{"use strict";t.d(r,{SX:()=>n,uF:()=>a});var o=t(68445),i=t(9122);function getBaseUrl(){return process.env.RENDER_INTERNAL_HOSTNAME?`http://${process.env.RENDER_INTERNAL_HOSTNAME}:${process.env.PORT}/configure`:`http://127.0.0.1:${process.env.PORT??3e3}/configure`}let n=(0,i.t)({config:()=>({links:[(0,o.N8)({url:`${getBaseUrl()}/api/trpc`,maxURLLength:2083})]}),overrides:{useMutation:{async onSuccess(e){await e.originalFn(),await e.queryClient.invalidateQueries()}}},ssr:!1}),a=(0,o.K5)({links:[(0,o.N8)({url:`${getBaseUrl()}/api/trpc`,maxURLLength:2083})]})},49614:(e,r,t)=>{"use strict";t.d(r,{$l:()=>x,MG:()=>z,WQ:()=>h});var o,i=t(13728),n=t(30819);let a={x_step_pin:i.z.string().optional(),x_dir_pin:i.z.string().optional(),x_enable_pin:i.z.string().optional(),x_uart_pin:i.z.string().optional(),x_diag_pin:i.z.string().optional(),x_endstop_pin:i.z.string().optional(),x1_step_pin:i.z.string().optional(),x1_dir_pin:i.z.string().optional(),x1_enable_pin:i.z.string().optional(),x1_uart_pin:i.z.string().optional(),x1_diag_pin:i.z.string().optional(),x1_endstop_pin:i.z.string().optional(),dual_carriage_step_pin:i.z.string().optional(),dual_carriage_dir_pin:i.z.string().optional(),dual_carriage_enable_pin:i.z.string().optional(),dual_carriage_uart_pin:i.z.string().optional(),dual_carriage_diag_pin:i.z.string().optional(),dual_carriage_endstop_pin:i.z.string().optional(),y_step_pin:i.z.string().optional(),y_dir_pin:i.z.string().optional(),y_enable_pin:i.z.string().optional(),y_uart_pin:i.z.string().optional(),y_diag_pin:i.z.string().optional(),y_endstop_pin:i.z.string().optional(),y1_step_pin:i.z.string().optional(),y1_dir_pin:i.z.string().optional(),y1_enable_pin:i.z.string().optional(),y1_uart_pin:i.z.string().optional(),y1_diag_pin:i.z.string().optional(),y1_endstop_pin:i.z.string().optional(),y2_step_pin:i.z.string().optional(),y2_dir_pin:i.z.string().optional(),y2_enable_pin:i.z.string().optional(),y2_uart_pin:i.z.string().optional(),y2_diag_pin:i.z.string().optional(),y2_endstop_pin:i.z.string().optional(),z0_step_pin:i.z.string().optional(),z0_dir_pin:i.z.string().optional(),z0_enable_pin:i.z.string().optional(),z0_uart_pin:i.z.string().optional(),z0_diag_pin:i.z.string().optional(),z1_step_pin:i.z.string().optional(),z1_dir_pin:i.z.string().optional(),z1_enable_pin:i.z.string().optional(),z1_uart_pin:i.z.string().optional(),z1_diag_pin:i.z.string().optional(),z2_step_pin:i.z.string().optional(),z2_dir_pin:i.z.string().optional(),z2_enable_pin:i.z.string().optional(),z2_uart_pin:i.z.string().optional(),z2_diag_pin:i.z.string().optional(),z3_step_pin:i.z.string().optional(),z3_dir_pin:i.z.string().optional(),z3_enable_pin:i.z.string().optional(),z3_uart_pin:i.z.string().optional(),z3_diag_pin:i.z.string().optional(),e_step_pin:i.z.string().optional(),e_dir_pin:i.z.string().optional(),e_enable_pin:i.z.string().optional(),e_uart_pin:i.z.string().optional(),e_diag_pin:i.z.string().optional(),e_heater_pin:i.z.string().optional(),e_sensor_pin:i.z.string().optional(),stepper_spi_mosi_pin:i.z.string().optional(),stepper_spi_miso_pin:i.z.string().optional(),stepper_spi_sclk_pin:i.z.string().optional(),adxl345_cs_pin:i.z.string().optional(),bltouch_sensor_pin:i.z.string().optional(),bltouch_control_pin:i.z.string().optional(),probe_pin:i.z.string().optional(),fan_part_cooling_pin:i.z.string().optional(),fan_toolhead_cooling_pin:i.z.string().optional(),fan_controller_board_pin:i.z.string().optional(),heater_bed_heating_pin:i.z.string().optional(),heater_bed_sensor_pin:i.z.string().optional(),"4p_fan_part_cooling_pin":i.z.string().optional(),"4p_fan_part_cooling_tach_pin":i.z.string().optional(),"4p_toolhead_cooling_pin":i.z.string().optional(),"4p_toolhead_cooling_tach_pin":i.z.string().optional(),"4p_controller_board_pin":i.z.string().optional(),"4p_controller_board_tach_pin":i.z.string().optional()},s=i.z.object(a);!function(e){e.x="x",e.x1="x1",e.y="y",e.y1="y1",e.y2="y2",e.z0="z0",e.z1="z1",e.z2="z2",e.z3="z3",e.e="e",e.e1="e1",e.dual_carriage="dual_carriage"}(o||(o={}));let l={x:n.po.x,x1:n.po.x1,y:n.po.y,y1:n.po.y1,y2:n.po.y2,z0:n.po.z,z1:n.po.z1,z2:n.po.z2,z3:n.po.z3,e:n.po.extruder,e1:n.po.extruder1,dual_carriage:n.po.dual_carriage};i.z.nativeEnum(o).transform(e=>l[e]??null),i.z.nativeEnum(n.po).transform(e=>Object.keys(l).find(r=>l[r]===e)??null),s.extend({x_step_pin:i.z.string(),x_dir_pin:i.z.string(),x_enable_pin:i.z.string(),x_uart_pin:i.z.string(),x_endstop_pin:i.z.string(),y_step_pin:i.z.string(),y_dir_pin:i.z.string(),y_enable_pin:i.z.string(),y_uart_pin:i.z.string(),y_endstop_pin:i.z.string(),z0_step_pin:i.z.string(),z0_dir_pin:i.z.string(),z0_enable_pin:i.z.string(),z0_uart_pin:i.z.string(),e_step_pin:i.z.string(),e_dir_pin:i.z.string(),e_enable_pin:i.z.string(),e_uart_pin:i.z.string(),e_heater_pin:i.z.string(),e_sensor_pin:i.z.string(),probe_pin:i.z.string(),heater_bed_heating_pin:i.z.string(),heater_bed_sensor_pin:i.z.string()}).and(i.z.object({fan_part_cooling_pin:i.z.string(),fan_toolhead_cooling_pin:i.z.string()}).or(i.z.object({"4p_fan_part_cooling_pin":i.z.string(),"4p_fan_part_cooling_tach_pin":i.z.string(),"4p_toolhead_cooling_pin":i.z.string(),"4p_toolhead_cooling_tach_pin":i.z.string()}))),s.extend({x_step_pin:i.z.string(),x_dir_pin:i.z.string(),x_enable_pin:i.z.string(),x_uart_pin:i.z.string(),x_endstop_pin:i.z.string(),y_step_pin:i.z.string(),y_dir_pin:i.z.string(),y_enable_pin:i.z.string(),y_uart_pin:i.z.string(),y_endstop_pin:i.z.string(),z0_step_pin:i.z.string(),z0_dir_pin:i.z.string(),z0_enable_pin:i.z.string(),z0_uart_pin:i.z.string(),z1_step_pin:i.z.string(),z1_dir_pin:i.z.string(),z1_enable_pin:i.z.string(),z1_uart_pin:i.z.string(),z2_step_pin:i.z.string(),z2_dir_pin:i.z.string(),z2_enable_pin:i.z.string(),z2_uart_pin:i.z.string(),probe_pin:i.z.string(),heater_bed_heating_pin:i.z.string(),heater_bed_sensor_pin:i.z.string()}).and(i.z.object({fan_part_cooling_pin:i.z.string(),fan_toolhead_cooling_pin:i.z.string()}).or(i.z.object({"4p_fan_part_cooling_pin":i.z.string(),"4p_fan_part_cooling_tach_pin":i.z.string(),"4p_toolhead_cooling_pin":i.z.string(),"4p_toolhead_cooling_tach_pin":i.z.string()}))),s.extend({e_step_pin:i.z.string(),e_dir_pin:i.z.string(),e_enable_pin:i.z.string(),e_uart_pin:i.z.string(),e_heater_pin:i.z.string(),e_sensor_pin:i.z.string(),adxl345_cs_pin:i.z.string(),probe_pin:i.z.string()}).and(i.z.object({fan_part_cooling_pin:i.z.string(),fan_toolhead_cooling_pin:i.z.string()}).or(i.z.object({"4p_fan_part_cooling_pin":i.z.string(),"4p_fan_part_cooling_tach_pin":i.z.string(),"4p_toolhead_cooling_pin":i.z.string(),"4p_toolhead_cooling_tach_pin":i.z.string()})));let d=i.z.object({uart_pin:i.z.string(),uart_address:i.z.string().optional(),rx_pin:i.z.string().optional(),tx_pin:i.z.string().optional()}),c=i.z.object({cs_pin:i.z.string()}).and(i.z.object({spi_bus:i.z.string()}).or(i.z.object({spi_software_mosi_pin:i.z.string().optional(),spi_software_miso_pin:i.z.string().optional(),spi_software_sclk_pin:i.z.string().optional()}))),hasSPI=e=>c.safeParse(e).success,hasUART=e=>d.safeParse(e).success,p=i.z.object({step_pin:i.z.string(),dir_pin:i.z.string(),enable_pin:i.z.string(),diag_pin:i.z.string().optional(),endstop_pin:i.z.string().optional(),uart_pin:i.z.string().optional(),rx_pin:i.z.string().optional(),tx_pin:i.z.string().optional(),cs_pin:i.z.string().optional()}),u=p.extend({title:i.z.string(),uart_address:i.z.string().optional(),spi_bus:i.z.string().optional(),spi_software_mosi_pin:i.z.string().optional(),spi_software_miso_pin:i.z.string().optional(),spi_software_sclk_pin:i.z.string().optional()}).refine(e=>hasSPI(e)||hasUART(e),{message:"Motor slot must have either SPI or UART pins"});u.innerType().omit({title:!0}).partial();let g=i.z.string(),h=i.z.string().brand("BoardID"),m=i.z.string().brand("BoardPath"),f=i.z.string().brand("BoardSerialPath"),b=i.z.record(i.z.nativeEnum(n.po).or(i.z.string()),n.MI),_=i.z.record(g,u),x=i.z.object({id:h,isToolboard:i.z.boolean().optional(),isHost:i.z.boolean().optional(),serialPath:f.optional(),boardImageFileName:i.z.string().optional(),manualFileName:i.z.string().optional(),wireDiagramFileName:i.z.string().optional(),name:i.z.string(),manufacturer:i.z.string(),firmwareBinaryName:i.z.string(),compileScript:i.z.string(),flashScript:i.z.string().optional(),flashInstructions:i.z.string().optional(),disableAutoFlash:i.z.boolean().optional(),documentationLink:i.z.string().optional(),hasQuirksFiles:i.z.boolean().optional(),driverCount:i.z.number(),integratedDrivers:b.optional(),extruderlessConfig:i.z.string().optional(),fourPinFanConnectorCount:i.z.number().optional(),driverVoltages:n.v6.array().default([24]),hasMcuTempSensor:i.z.boolean().default(!0),thermistorPullup:i.z.number().default(4700),alternativePT1000Resistor:i.z.number().optional(),invertPinLogic:i.z.array(i.z.string()).default([]),customSections:i.z.record(i.z.string().regex(/^\S+$/),i.z.object({name:i.z.string().optional(),parameters:i.z.record(i.z.string().regex(/^\S+$/),i.z.string().or(i.z.number()).or(i.z.boolean())),comments:i.z.array(i.z.string()).default([])})).optional(),motorSlots:i.z.record(g,u).optional(),outputPins:i.z.array(i.z.object({pin:i.z.string(),name:i.z.string(),value:i.z.number().min(0).max(1)})).optional(),dfu:i.z.object({dfuBootImage:i.z.string(),flashDevice:i.z.string(),instructions:i.z.array(i.z.string()),reminder:i.z.string().optional(),hasBoot0Jumper:i.z.boolean()}).optional(),stepperSPI:i.z.object({software:i.z.object({sclk:i.z.string(),mosi:i.z.string(),miso:i.z.string()})}).or(i.z.object({hardware:i.z.object({bus:i.z.string()})})).optional(),ADXL345SPI:i.z.object({cs_pin:i.z.string()}).and(i.z.object({software:i.z.object({sclk:i.z.string(),mosi:i.z.string(),miso:i.z.string()})}).or(i.z.object({hardware:i.z.object({bus:i.z.string()})}))).optional(),LIS2DW:i.z.object({cs_pin:i.z.string()}).and(i.z.object({software:i.z.object({sclk:i.z.string(),mosi:i.z.string(),miso:i.z.string()})}).or(i.z.object({hardware:i.z.object({bus:i.z.string()})}))).optional(),path:m}).and(i.z.object({isToolboard:i.z.literal(!0),motorSlots:i.z.undefined()}).or(i.z.object({motorSlots:_})).or(i.z.object({isHost:i.z.literal(!0),motorSlots:i.z.undefined()})));x.and(i.z.object({detected:i.z.boolean()})),i.z.object({id:i.z.string(),disableAutoFlash:i.z.literal(!1).optional(),isToolboard:i.z.boolean().optional(),compileScript:i.z.string(),flashScript:i.z.string(),path:m});let z=x.and(i.z.object({isToolboard:i.z.literal(!0),isHost:i.z.literal(!1).optional(),integratedDrivers:b.and(i.z.object({[n.po.extruder]:i.z.string()}))}));z.and(i.z.object({detected:i.z.boolean()}))},43700:(e,r,t)=>{"use strict";t.d(r,{M3:()=>_,Mf:()=>c,U3:()=>g,U9:()=>x,Uy:()=>p,XG:()=>z,Yx:()=>f,lV:()=>h,ow:()=>u,ws:()=>m});var o=t(13728),i=t(17561),n=t(30819),a=t(61331);let s=["EPCOS 100K B57560G104F","ATC Semitec 104GT-2","ATC Semitec 104NT-4-R025H42G","Generic 3950","Honeywell 100K 135-104LAG-J01","NTC 100K MGB18-104F39050L32","SliceEngineering 450","TDK NTCG104LH104JT1","PT1000"],l="";if(process.env.RATOS_CONFIGURATION_PATH){let e=i.Rz.parse(process.env);l=e.RATOS_CONFIGURATION_PATH}let d=o.z.object({path:o.z.string().startsWith(l).endsWith(".cfg"),id:o.z.string()}),c=o.z.enum(s),p=d.extend({type:o.z.literal("hotend"),title:o.z.string(),thermistor:o.z.enum(s),flowType:o.z.union([o.z.literal("sf"),o.z.literal("hf"),o.z.literal("uhf")])}),u=o.z.object({type:o.z.enum(["Regular","CHT"]),diameter:o.z.number().min(.2).max(1.8)}),g=d.extend({type:o.z.literal("extruder"),stepper:n.vF.shape.id.optional(),current:n.P6.shape.current.optional(),title:o.z.string()}),h=d.extend({type:o.z.literal("static-probe").or(o.z.literal("stowable-probe")),title:o.z.string()}),m=o.z.object({id:o.z.enum(["endstop","endstop-toolboard","sensorless"]),title:o.z.string(),badge:o.z.array(o.z.object({children:o.z.string(),color:a.Bd})).optional()}),f=o.z.union([o.z.literal("toolboard_t0"),o.z.literal("toolboard_t1"),o.z.literal("controlboard"),o.z.literal("rpi"),o.z.literal("beacon")]),b=o.z.union([o.z.literal("adxl345"),o.z.literal("lis2dw"),o.z.literal("beacon")]),_=o.z.object({id:o.z.enum(["toolboard","controlboard","sbc","none","beacon"]),title:o.z.string(),accelerometerType:b.default("adxl345").optional()}),x=o.z.object({name:f,type:b});_.extend({accelerometerType:b});let z=o.z.object({id:o.z.enum(["2pin","4pin","4pin-dedicated","2pin-toolboard","4pin-toolboard","4pin-dedicated-toolboard","none"]),title:o.z.string(),badge:o.z.array(o.z.object({children:o.z.string(),color:a.Bd})).optional()})},30819:(e,r,t)=>{"use strict";t.d(r,{Ah:()=>b,HB:()=>d,JQ:()=>f,MI:()=>l,P6:()=>h,R_:()=>matchesDefaultRail,Wx:()=>getSupportedVoltages,g6:()=>g,po:()=>i,r:()=>m,v6:()=>s,vF:()=>u});var o,i,n=t(13728);!function(e){e[e["24V"]=24]="24V",e[e["36V"]=36]="36V",e[e["48V"]=48]="48V",e[e["56V"]=56]="56V",e[e["60V"]=60]="60V"}(o||(o={}));let a=[{id:24,title:"24V"},{id:36,title:"36V"},{id:48,title:"48V"},{id:56,title:"56V"},{id:60,title:"60V"}],getSupportedVoltages=(e,r)=>r?.external?a.filter(e=>r?.voltages?.includes(e.id)||24===e.id):a.filter(r=>e?.driverVoltages?.includes(r.id)||24===r.id).filter(e=>r?.voltages?.includes(e.id)||24===e.id),matchesDefaultRail=(e,r,t)=>e.axis===r.axis&&e.driver.id===r.driver.id&&e.stepper.id===r.stepper.id&&(t&&r.performanceMode&&e.voltage===r.performanceMode?.voltage&&e.current===r.performanceMode?.current||!t&&e.voltage===r.voltage&&e.current===r.current),s=n.jb(o),l=n.Z_(),d=n.Ry({id:l,title:n.Z_(),protocol:n.Km(["SPI","UART"]),coolingCurrentThreshold:n.Rx(),voltages:s.array(),maxCurrent:n.Rx().min(0),external:n.O7().optional()}).and(n.Ry({type:n.Km(["TMC2209","TMC2226","TMC5160","TMC2130"]),senseResistor:n.Rx().min(0)}).or(n.Ry({type:n.Km(["TMC2240"])}))),c=n.Ry({voltage:s,run_current:n.Rx(),driver:l}),p=c.extend({driver_MSLUT0:n.Rx().optional(),driver_MSLUT1:n.Rx().optional(),driver_MSLUT2:n.Rx().optional(),driver_MSLUT3:n.Rx().optional(),driver_MSLUT4:n.Rx().optional(),driver_MSLUT5:n.Rx().optional(),driver_MSLUT6:n.Rx().optional(),driver_MSLUT7:n.Rx().optional(),driver_W0:n.Rx().optional(),driver_W1:n.Rx().optional(),driver_W2:n.Rx().optional(),driver_W3:n.Rx().optional(),driver_X1:n.Rx().optional(),driver_X2:n.Rx().optional(),driver_X3:n.Rx().optional(),driver_START_SIN:n.Rx().optional(),driver_START_SIN90:n.Rx().optional(),driver_IHOLDDELAY:n.Rx().optional(),driver_TPOWERDOWN:n.Rx().optional(),driver_TBL:n.Rx().optional(),driver_TOFF:n.Rx().optional(),driver_HEND:n.Rx().optional(),driver_HSTRT:n.Rx().optional(),driver_PWM_AUTOSCALE:n.O7().optional(),driver_PWM_FREQ:n.Rx().optional(),driver_PWM_GRAD:n.Rx().optional(),driver_PWM_AMPL:n.Rx().optional(),driver_SGT:n.Rx().optional()}),u=n.Ry({id:n.Z_(),title:n.Z_(),fullStepsPerRotation:n.Rx().default(200),maxPeakCurrent:n.Rx().min(0),presets:n.IX(n.VK("driver",[p.extend({driver:n.Km(["TMC2130","TMC5160"]),sense_resistor:n.Rx()}),p.extend({driver:n.Km(["TMC2240"])}),c.extend({driver:n.Km(["TMC2209"]),driver_TBL:n.Rx().optional(),driver_TOFF:n.Rx().optional(),driver_HEND:n.Rx().optional(),driver_HSTRT:n.Rx().optional(),sense_resistor:n.Rx()})])).optional().describe("Stepper presets are tightly coupled to the driver type, sense_resistor, stepper, voltage and current.")});!function(e){e.x="x",e.dual_carriage="dual_carriage",e.x1="x1",e.y="y",e.y1="y1",e.y2="y2",e.z="z",e.z1="z1",e.z2="z2",e.z3="z3",e.extruder="extruder",e.extruder1="extruder1"}(i||(i={}));let g=n.Ry({axis:n.jb(i).describe("Axis of the rail"),axisDescription:n.Z_().optional().describe("Description of the axis"),driver:d.describe("Stepper driver used on this axis"),voltage:s.default(24).describe("Voltage of the stepper driver"),stepper:u.describe("Stepper motor connected to this axis"),invertStepperDirection:n.O7().default(!1).describe("Invert the default direction of the stepper motor"),axisMinimum:n.Rx().optional().describe("Minimum position of the axis in mm"),axisMaximum:n.Rx().optional().describe("Maximum position of the axis in mm"),axisEndstop:n.Rx().optional().describe("Endstop position of the axis in mm"),motorSlot:n.Z_().optional().describe("Optional board motor slot of the stepper driver"),current:n.Rx().min(0),rotationDistance:n.Rx().min(0).describe("Distance in mm the axis travels per stepper rotation"),gearRatio:n.Z_().regex(/^\d+:\d+$/).optional().describe("Optional gear ratio of the axis"),homingSpeed:n.Rx().min(0).default(10).describe("Axis speed during homing in mm/s"),microstepping:n.Rx().min(16).max(256).default(64).describe("Microstepping of the stepper driver, higher values increase resolution and lower noise but increases load on the MCU")}),h=g.extend({motorSlot:n.S1(),performanceMode:n.Ry({current:n.Rx().min(0),voltage:s.default(24).describe("Voltage of the stepper driver in performance mode"),homingSpeed:n.Rx().min(0).optional().describe("Axis speed during homing in mm/s in performance mode")}).optional()}),m=h.extend({driver:l,stepper:u.shape.id}),f=g.refine(e=>e.current<=e.driver.maxCurrent,"Current must be less than max current of the driver"),b=g.extend({driver:l,stepper:u.shape.id});n.Ry({min:n.Rx(),max:n.Rx(),endstop:n.Rx()})},41018:(e,r,t)=>{"use strict";t.d(r,{LN:()=>c,NN:()=>m,dl:()=>u,jz:()=>h,q_:()=>g});var o=t(49614),i=t(43700),n=t(53197),a=t(30819),s=t(93073),l=t(45041),d=t(13728);let c=d.z.union([n.A5,d.z.number(),d.z.string()]).nullable().optional(),p=d.z.object({printer:n.Qu,controlboard:o.$l,toolheads:d.z.array(s.x8).min(1).max(2),size:c,controllerFan:i.XG,performanceMode:d.z.boolean().default(!1),stealthchop:d.z.boolean().default(!1),standstillStealth:d.z.boolean().default(!1),rails:d.z.array(a.JQ)}).strict().transform((e,r)=>{if(null==e.size)e.size=e.printer.sizes[Object.keys(e.printer.sizes)[0]];else if("number"==typeof e.size||"string"==typeof e.size){let t=e.printer.sizes[e.size.toString()];if(null==t)return r.addIssue({code:d.z.ZodIssueCode.custom,message:`Size ${e.size} is not a valid size for a ${e.printer.name} config`}),d.z.NEVER;e.size=t}return e}),u=p.superRefine((e,r)=>{let t=e.toolheads.map(e=>e.toolboard).filter(Boolean).length;t+e.controlboard.driverCount<e.printer.driverCountRequired&&r.addIssue({code:d.z.ZodIssueCode.too_small,message:`Your combination of controlboard and toolboards do not have enough stepper drivers for a ${e.printer.name} config`,minimum:e.printer.driverCountRequired,inclusive:!0,type:"number"})}).superRefine((e,r)=>{let t=e.toolheads.map(e=>new l.D(e)),o=e.rails.map((o,i)=>{let n=t.find(e=>e.getExtruderAxis()===o.axis);if(null!=o.motorSlot){let s=e.rails.filter(e=>{let r=t.find(r=>r.getExtruderAxis()===e.axis);return e.axis!==o.axis&&n?.hasToolboard()==null&&r?.hasToolboard==null&&e.motorSlot===o.motorSlot}),railName=e=>"extruder"===e?"Extruder T0":e===a.po.extruder1?"Extruder T1":"Stepper "+e.toLocaleUpperCase();return 1===s.length?r.addIssue({code:d.z.ZodIssueCode.custom,message:`Motor slot ${o.motorSlot} is already in use on ${railName(s[0].axis)}`,path:["rails",i,"motorSlot"]}):s.length>1&&r.addIssue({code:d.z.ZodIssueCode.custom,message:`Motor slot ${o.motorSlot} is already in use on ${s.slice(0,-1).map(e=>railName(e.axis)).join(", ")} and ${railName(s[s.length-1].axis)}`,path:["rails",i,"motorSlot"]}),s.length>0?{rail:o,conflicts:s}:0}return null}).filter(Boolean);o.length>0&&r.addIssue({code:d.z.ZodIssueCode.custom,message:"Motor slot conflicts detected"})}),g=p.innerType().extend({printer:n.Qu.shape.id,controlboard:o.WQ,toolheads:d.z.array(s.Qk).min(1).max(2),controllerFan:i.XG.shape.id,rails:d.z.array(a.Ah)}).strict(),h=p.innerType().extend({toolheads:d.z.array(s.b2).min(1).max(2)}).strict().partial().optional(),m=g.extend({toolheads:d.z.array(s.ZF).min(1).max(2)}).strict().partial()},53197:(e,r,t)=>{"use strict";t.d(r,{A5:()=>g,Ox:()=>m,Qu:()=>h});var o=t(13728),i=t(17561),n=t(71017),a=t.n(n),s=t(30819),l=t(93073),d=t(43700),c=t(49614);let p="";if(process.env.RATOS_CONFIGURATION_PATH){let e=i.Rz.parse(process.env);p=a().join(e.RATOS_CONFIGURATION_PATH,"printers")}let u=o.z.object({velocity:o.z.number().min(0).describe("Maximum velocity for this printer"),accel:o.z.number().min(0).describe("Maximum acceleration for this printer"),z_velocity:o.z.number().min(0).describe("Maximum z velocity for this printer"),z_accel:o.z.number().min(0).describe("Maximum z acceleration for this printer"),square_corner_velocity:o.z.number().min(0).default(5).describe("Maximum square corner velocity for this printer"),travel_velocity:o.z.number().min(0).default(200).describe("Maximum travel velocity for this printer"),travel_accel:o.z.number().min(0).default(3e3).describe("Maximum travel velocity for this printer")}).strict(),g=o.z.object({x:o.z.number().min(0).describe("The print volume in X"),y:o.z.number().min(0).describe("The print volume in Y"),z:o.z.number().min(0).describe("The print volume in Z")}).describe("The print volume of a printer"),h=o.z.object({id:o.z.string().transform(e=>"caramba-chonk"===e?"v-chonk":e.startsWith("caramba-")?e.replace("caramba-","v-core-4-"):e),name:o.z.string().describe("The name of the printer"),releaseDate:o.z.string().optional().describe("The release date of the printer in ISO 8601/RFC3339 eg. 2023-12-31"),description:o.z.string().describe("A description of the printer"),manufacturer:o.z.string().describe("The name of the manufacturer of this printer"),documentationLink:o.z.string().describe("Link to the RatOS documentation for this printer"),image:o.z.string().describe("Link to an image of the printer"),sizes:o.z.record(o.z.string(),g).describe("Size options for this printer"),template:o.z.string().describe("Printer.cfg template for this printer"),path:o.z.string().startsWith(p),driverCountRequired:o.z.number().describe("Number of drivers required for this printer"),kinematics:o.z.union([o.z.literal("cartesian"),o.z.literal("corexy"),o.z.literal("hybrid-corexy"),o.z.literal("hybrid-corexy-idex")]).optional(),bedMargin:o.z.object({x:o.z.tuple([o.z.number().default(0),o.z.number().default(0)]),y:o.z.tuple([o.z.number().default(0),o.z.number().default(0)])}).describe("Margin of available movement around the bed for this printer").default({x:[0,0],y:[0,0]}),speedLimits:o.z.object({basic:u,performance:u.optional()}).strict().describe("Speed limits for this printer"),defaults:o.z.object({toolheads:o.z.array(l.Qk).describe("Default toolheads for this printer"),board:c.WQ.describe("Default board for this printer. Should be the name of the board directory."),rails:o.z.array(s.r).describe("Default rails for this printer"),controllerFan:d.XG.shape.id.optional().describe("Default controller fan for this printer")}).strict().describe("Default hardware for this printer")}).describe("A RatOS supported 3d printer"),m=h.extend({defaults:h.shape.defaults.extend({toolheads:o.z.array(l.x8)}).strict()})},93073:(e,r,t)=>{"use strict";t.d(r,{PY:()=>l,Qk:()=>g,Qr:()=>d,ZF:()=>h,b2:()=>u,x8:()=>p});var o=t(13728),i=t(49614),n=t(43700),a=t(30819),s=t(63942);let l=o.z.object({hotend:n.Uy,thermistor:n.Mf,extruder:n.U3,xEndstop:n.ws,yEndstop:n.ws,hotendFan:n.XG,partFan:n.XG,nozzle:n.ow.default((0,s.S)()),xAccelerometer:n.M3.optional().nullable(),yAccelerometer:n.M3.optional().nullable(),toolboard:i.MG.nullable(),probe:n.lV.optional(),axis:o.z.literal(a.po.x).or(o.z.literal(a.po.dual_carriage)),description:o.z.string().optional(),toolNumber:o.z.number().optional()}).strict(),d=o.z.union([o.z.literal(0),o.z.literal(1)]),c=o.z.union([o.z.literal(a.po.x),o.z.literal(a.po.dual_carriage),o.z.literal(a.po.extruder),o.z.literal(a.po.extruder1)]);o.z.union([c,d]);let p=l.refine(e=>null!==e.toolboard||"endstop-toolboard"!==e.xEndstop.id,"Cannot use toolboard endstop without a toolboard").refine(e=>null!==e.toolboard||!["2pin-toolboard","4pin-toolboard","4pin-dedicated-toolboard"].includes(e.hotendFan.id),"Cannot use toolboard hotend fan without a toolboard").refine(e=>null!==e.toolboard||!["2pin-toolboard","4pin-toolboard","4pin-dedicated-toolboard"].includes(e.partFan.id),"Cannot use toolboard part cooling fan without a toolboard"),u=l.partial().optional(),g=l.extend({hotend:n.Uy.shape.id,extruder:n.U3.shape.id,thermistor:n.Mf,xEndstop:n.ws.shape.id,yEndstop:n.ws.shape.id,hotendFan:n.XG.shape.id,partFan:n.XG.shape.id,xAccelerometer:n.M3.shape.id.optional().nullable(),yAccelerometer:n.M3.shape.id.optional().nullable(),toolboard:i.WQ.optional().nullable(),probe:n.lV.shape.id.optional().nullable()}).strict(),h=g.partial().optional()},43086:(e,r,t)=>{"use strict";t.r(r),t.d(r,{$$typeof:()=>a,__esModule:()=>n,default:()=>l});var o=t(97175);let i=(0,o.createProxy)(String.raw`/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/error.tsx`),{__esModule:n,$$typeof:a}=i,s=i.default,l=s},69113:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>RootLayout,metadata:()=>rS});var o,i,n,a,s,l,d,c=t(8632),p=t(57147),u=t.n(p),g=t(12051);let h=g.z.object({USER:g.z.string().default("pi"),NODE_ENV:g.z.enum(["development","test","production"]),RATOS_CONFIGURATION_PATH:g.z.string(),RATOS_SCRIPT_DIR:g.z.string(),KLIPPER_CONFIG_PATH:g.z.string(),KLIPPER_DIR:g.z.string(),KLIPPER_ENV:g.z.string(),MOONRAKER_DIR:g.z.string(),LOG_FILE:g.z.string(),RATOS_DATA_DIR:g.z.string()});g.z.object({NEXT_PUBLIC_KLIPPER_HOSTNAME:g.z.string().optional()});var m=t(50535),f=t.n(m);let b={timestamp:!0,level:"info"},_=null,getLogger=()=>{if(null!=_)return _;let e=h.parse(process.env),r={target:"pino/file",options:{destination:e.LOG_FILE,append:!0}};return _=f()({...b,transport:r})};var x=t(32081),z=t(71017),v=t.n(z),y=t(14521),T=t(73837);!function(e){e[e["24V"]=24]="24V",e[e["36V"]=36]="36V",e[e["48V"]=48]="48V",e[e["56V"]=56]="56V",e[e["60V"]=60]="60V"}(a||(a={}));let matchesDefaultRail=(e,r,t)=>e.axis===r.axis&&e.driver.id===r.driver.id&&e.stepper.id===r.stepper.id&&(t&&r.performanceMode&&e.voltage===r.performanceMode?.voltage&&e.current===r.performanceMode?.current||!t&&e.voltage===r.voltage&&e.current===r.current),w=g.jb(a),P=g.Z_(),S=g.Ry({id:P,title:g.Z_(),protocol:g.Km(["SPI","UART"]),coolingCurrentThreshold:g.Rx(),voltages:w.array(),maxCurrent:g.Rx().min(0),external:g.O7().optional()}).and(g.Ry({type:g.Km(["TMC2209","TMC2226","TMC5160","TMC2130"]),senseResistor:g.Rx().min(0)}).or(g.Ry({type:g.Km(["TMC2240"])}))),C=g.Ry({voltage:w,run_current:g.Rx(),driver:P}),R=C.extend({driver_MSLUT0:g.Rx().optional(),driver_MSLUT1:g.Rx().optional(),driver_MSLUT2:g.Rx().optional(),driver_MSLUT3:g.Rx().optional(),driver_MSLUT4:g.Rx().optional(),driver_MSLUT5:g.Rx().optional(),driver_MSLUT6:g.Rx().optional(),driver_MSLUT7:g.Rx().optional(),driver_W0:g.Rx().optional(),driver_W1:g.Rx().optional(),driver_W2:g.Rx().optional(),driver_W3:g.Rx().optional(),driver_X1:g.Rx().optional(),driver_X2:g.Rx().optional(),driver_X3:g.Rx().optional(),driver_START_SIN:g.Rx().optional(),driver_START_SIN90:g.Rx().optional(),driver_IHOLDDELAY:g.Rx().optional(),driver_TPOWERDOWN:g.Rx().optional(),driver_TBL:g.Rx().optional(),driver_TOFF:g.Rx().optional(),driver_HEND:g.Rx().optional(),driver_HSTRT:g.Rx().optional(),driver_PWM_AUTOSCALE:g.O7().optional(),driver_PWM_FREQ:g.Rx().optional(),driver_PWM_GRAD:g.Rx().optional(),driver_PWM_AMPL:g.Rx().optional(),driver_SGT:g.Rx().optional()}),k=g.Ry({id:g.Z_(),title:g.Z_(),fullStepsPerRotation:g.Rx().default(200),maxPeakCurrent:g.Rx().min(0),presets:g.IX(g.VK("driver",[R.extend({driver:g.Km(["TMC2130","TMC5160"]),sense_resistor:g.Rx()}),R.extend({driver:g.Km(["TMC2240"])}),C.extend({driver:g.Km(["TMC2209"]),driver_TBL:g.Rx().optional(),driver_TOFF:g.Rx().optional(),driver_HEND:g.Rx().optional(),driver_HSTRT:g.Rx().optional(),sense_resistor:g.Rx()})])).optional().describe("Stepper presets are tightly coupled to the driver type, sense_resistor, stepper, voltage and current.")});!function(e){e.x="x",e.dual_carriage="dual_carriage",e.x1="x1",e.y="y",e.y1="y1",e.y2="y2",e.z="z",e.z1="z1",e.z2="z2",e.z3="z3",e.extruder="extruder",e.extruder1="extruder1"}(s||(s={}));let N=g.Ry({axis:g.jb(s).describe("Axis of the rail"),axisDescription:g.Z_().optional().describe("Description of the axis"),driver:S.describe("Stepper driver used on this axis"),voltage:w.default(24).describe("Voltage of the stepper driver"),stepper:k.describe("Stepper motor connected to this axis"),invertStepperDirection:g.O7().default(!1).describe("Invert the default direction of the stepper motor"),axisMinimum:g.Rx().optional().describe("Minimum position of the axis in mm"),axisMaximum:g.Rx().optional().describe("Maximum position of the axis in mm"),axisEndstop:g.Rx().optional().describe("Endstop position of the axis in mm"),motorSlot:g.Z_().optional().describe("Optional board motor slot of the stepper driver"),current:g.Rx().min(0),rotationDistance:g.Rx().min(0).describe("Distance in mm the axis travels per stepper rotation"),gearRatio:g.Z_().regex(/^\d+:\d+$/).optional().describe("Optional gear ratio of the axis"),homingSpeed:g.Rx().min(0).default(10).describe("Axis speed during homing in mm/s"),microstepping:g.Rx().min(16).max(256).default(64).describe("Microstepping of the stepper driver, higher values increase resolution and lower noise but increases load on the MCU")}),j=N.extend({motorSlot:g.S1(),performanceMode:g.Ry({current:g.Rx().min(0),voltage:w.default(24).describe("Voltage of the stepper driver in performance mode"),homingSpeed:g.Rx().min(0).optional().describe("Axis speed during homing in mm/s in performance mode")}).optional()}),E=j.extend({driver:P,stepper:k.shape.id}),$=N.refine(e=>e.current<=e.driver.maxCurrent,"Current must be less than max current of the driver"),A=N.extend({driver:P,stepper:k.shape.id});g.Ry({min:g.Rx(),max:g.Rx(),endstop:g.Rx()});let O={x_step_pin:g.z.string().optional(),x_dir_pin:g.z.string().optional(),x_enable_pin:g.z.string().optional(),x_uart_pin:g.z.string().optional(),x_diag_pin:g.z.string().optional(),x_endstop_pin:g.z.string().optional(),x1_step_pin:g.z.string().optional(),x1_dir_pin:g.z.string().optional(),x1_enable_pin:g.z.string().optional(),x1_uart_pin:g.z.string().optional(),x1_diag_pin:g.z.string().optional(),x1_endstop_pin:g.z.string().optional(),dual_carriage_step_pin:g.z.string().optional(),dual_carriage_dir_pin:g.z.string().optional(),dual_carriage_enable_pin:g.z.string().optional(),dual_carriage_uart_pin:g.z.string().optional(),dual_carriage_diag_pin:g.z.string().optional(),dual_carriage_endstop_pin:g.z.string().optional(),y_step_pin:g.z.string().optional(),y_dir_pin:g.z.string().optional(),y_enable_pin:g.z.string().optional(),y_uart_pin:g.z.string().optional(),y_diag_pin:g.z.string().optional(),y_endstop_pin:g.z.string().optional(),y1_step_pin:g.z.string().optional(),y1_dir_pin:g.z.string().optional(),y1_enable_pin:g.z.string().optional(),y1_uart_pin:g.z.string().optional(),y1_diag_pin:g.z.string().optional(),y1_endstop_pin:g.z.string().optional(),y2_step_pin:g.z.string().optional(),y2_dir_pin:g.z.string().optional(),y2_enable_pin:g.z.string().optional(),y2_uart_pin:g.z.string().optional(),y2_diag_pin:g.z.string().optional(),y2_endstop_pin:g.z.string().optional(),z0_step_pin:g.z.string().optional(),z0_dir_pin:g.z.string().optional(),z0_enable_pin:g.z.string().optional(),z0_uart_pin:g.z.string().optional(),z0_diag_pin:g.z.string().optional(),z1_step_pin:g.z.string().optional(),z1_dir_pin:g.z.string().optional(),z1_enable_pin:g.z.string().optional(),z1_uart_pin:g.z.string().optional(),z1_diag_pin:g.z.string().optional(),z2_step_pin:g.z.string().optional(),z2_dir_pin:g.z.string().optional(),z2_enable_pin:g.z.string().optional(),z2_uart_pin:g.z.string().optional(),z2_diag_pin:g.z.string().optional(),z3_step_pin:g.z.string().optional(),z3_dir_pin:g.z.string().optional(),z3_enable_pin:g.z.string().optional(),z3_uart_pin:g.z.string().optional(),z3_diag_pin:g.z.string().optional(),e_step_pin:g.z.string().optional(),e_dir_pin:g.z.string().optional(),e_enable_pin:g.z.string().optional(),e_uart_pin:g.z.string().optional(),e_diag_pin:g.z.string().optional(),e_heater_pin:g.z.string().optional(),e_sensor_pin:g.z.string().optional(),stepper_spi_mosi_pin:g.z.string().optional(),stepper_spi_miso_pin:g.z.string().optional(),stepper_spi_sclk_pin:g.z.string().optional(),adxl345_cs_pin:g.z.string().optional(),bltouch_sensor_pin:g.z.string().optional(),bltouch_control_pin:g.z.string().optional(),probe_pin:g.z.string().optional(),fan_part_cooling_pin:g.z.string().optional(),fan_toolhead_cooling_pin:g.z.string().optional(),fan_controller_board_pin:g.z.string().optional(),heater_bed_heating_pin:g.z.string().optional(),heater_bed_sensor_pin:g.z.string().optional(),"4p_fan_part_cooling_pin":g.z.string().optional(),"4p_fan_part_cooling_tach_pin":g.z.string().optional(),"4p_toolhead_cooling_pin":g.z.string().optional(),"4p_toolhead_cooling_tach_pin":g.z.string().optional(),"4p_controller_board_pin":g.z.string().optional(),"4p_controller_board_tach_pin":g.z.string().optional()},M=g.z.object(O);!function(e){e.x="x",e.x1="x1",e.y="y",e.y1="y1",e.y2="y2",e.z0="z0",e.z1="z1",e.z2="z2",e.z3="z3",e.e="e",e.e1="e1",e.dual_carriage="dual_carriage"}(l||(l={}));let F={x:s.x,x1:s.x1,y:s.y,y1:s.y1,y2:s.y2,z0:s.z,z1:s.z1,z2:s.z2,z3:s.z3,e:s.extruder,e1:s.extruder1,dual_carriage:s.dual_carriage},I=g.z.nativeEnum(l).transform(e=>F[e]??null),D=g.z.nativeEnum(s).transform(e=>Object.keys(F).find(r=>F[r]===e)??null),L=M.extend({x_step_pin:g.z.string(),x_dir_pin:g.z.string(),x_enable_pin:g.z.string(),x_uart_pin:g.z.string(),x_endstop_pin:g.z.string(),y_step_pin:g.z.string(),y_dir_pin:g.z.string(),y_enable_pin:g.z.string(),y_uart_pin:g.z.string(),y_endstop_pin:g.z.string(),z0_step_pin:g.z.string(),z0_dir_pin:g.z.string(),z0_enable_pin:g.z.string(),z0_uart_pin:g.z.string(),e_step_pin:g.z.string(),e_dir_pin:g.z.string(),e_enable_pin:g.z.string(),e_uart_pin:g.z.string(),e_heater_pin:g.z.string(),e_sensor_pin:g.z.string(),probe_pin:g.z.string(),heater_bed_heating_pin:g.z.string(),heater_bed_sensor_pin:g.z.string()}).and(g.z.object({fan_part_cooling_pin:g.z.string(),fan_toolhead_cooling_pin:g.z.string()}).or(g.z.object({"4p_fan_part_cooling_pin":g.z.string(),"4p_fan_part_cooling_tach_pin":g.z.string(),"4p_toolhead_cooling_pin":g.z.string(),"4p_toolhead_cooling_tach_pin":g.z.string()}))),H=M.extend({x_step_pin:g.z.string(),x_dir_pin:g.z.string(),x_enable_pin:g.z.string(),x_uart_pin:g.z.string(),x_endstop_pin:g.z.string(),y_step_pin:g.z.string(),y_dir_pin:g.z.string(),y_enable_pin:g.z.string(),y_uart_pin:g.z.string(),y_endstop_pin:g.z.string(),z0_step_pin:g.z.string(),z0_dir_pin:g.z.string(),z0_enable_pin:g.z.string(),z0_uart_pin:g.z.string(),z1_step_pin:g.z.string(),z1_dir_pin:g.z.string(),z1_enable_pin:g.z.string(),z1_uart_pin:g.z.string(),z2_step_pin:g.z.string(),z2_dir_pin:g.z.string(),z2_enable_pin:g.z.string(),z2_uart_pin:g.z.string(),probe_pin:g.z.string(),heater_bed_heating_pin:g.z.string(),heater_bed_sensor_pin:g.z.string()}).and(g.z.object({fan_part_cooling_pin:g.z.string(),fan_toolhead_cooling_pin:g.z.string()}).or(g.z.object({"4p_fan_part_cooling_pin":g.z.string(),"4p_fan_part_cooling_tach_pin":g.z.string(),"4p_toolhead_cooling_pin":g.z.string(),"4p_toolhead_cooling_tach_pin":g.z.string()}))),B=M.extend({e_step_pin:g.z.string(),e_dir_pin:g.z.string(),e_enable_pin:g.z.string(),e_uart_pin:g.z.string(),e_heater_pin:g.z.string(),e_sensor_pin:g.z.string(),adxl345_cs_pin:g.z.string(),probe_pin:g.z.string()}).and(g.z.object({fan_part_cooling_pin:g.z.string(),fan_toolhead_cooling_pin:g.z.string()}).or(g.z.object({"4p_fan_part_cooling_pin":g.z.string(),"4p_fan_part_cooling_tach_pin":g.z.string(),"4p_toolhead_cooling_pin":g.z.string(),"4p_toolhead_cooling_tach_pin":g.z.string()}))),W=g.z.object({uart_pin:g.z.string(),uart_address:g.z.string().optional(),rx_pin:g.z.string().optional(),tx_pin:g.z.string().optional()}),V=g.z.object({cs_pin:g.z.string()}).and(g.z.object({spi_bus:g.z.string()}).or(g.z.object({spi_software_mosi_pin:g.z.string().optional(),spi_software_miso_pin:g.z.string().optional(),spi_software_sclk_pin:g.z.string().optional()}))),hasSPI=e=>V.safeParse(e).success,hasUART=e=>W.safeParse(e).success,U=g.z.object({step_pin:g.z.string(),dir_pin:g.z.string(),enable_pin:g.z.string(),diag_pin:g.z.string().optional(),endstop_pin:g.z.string().optional(),uart_pin:g.z.string().optional(),rx_pin:g.z.string().optional(),tx_pin:g.z.string().optional(),cs_pin:g.z.string().optional()}),G=U.extend({title:g.z.string(),uart_address:g.z.string().optional(),spi_bus:g.z.string().optional(),spi_software_mosi_pin:g.z.string().optional(),spi_software_miso_pin:g.z.string().optional(),spi_software_sclk_pin:g.z.string().optional()}).refine(e=>hasSPI(e)||hasUART(e),{message:"Motor slot must have either SPI or UART pins"});G.innerType().omit({title:!0}).partial();let q=g.z.string(),reversePinLookup=(e,r)=>{let t=Object.entries(r.motorSlots??{});for(let[r,o]of t)if(Object.entries(e).every(([e,r])=>o[e]===r))return r},K=g.z.string().brand("BoardID"),Z=g.z.string().brand("BoardPath"),X=g.z.string().brand("BoardSerialPath"),Y=g.z.record(g.z.nativeEnum(s).or(g.z.string()),P),Q=g.z.record(q,G),J=g.z.object({id:K,isToolboard:g.z.boolean().optional(),isHost:g.z.boolean().optional(),serialPath:X.optional(),boardImageFileName:g.z.string().optional(),manualFileName:g.z.string().optional(),wireDiagramFileName:g.z.string().optional(),name:g.z.string(),manufacturer:g.z.string(),firmwareBinaryName:g.z.string(),compileScript:g.z.string(),flashScript:g.z.string().optional(),flashInstructions:g.z.string().optional(),disableAutoFlash:g.z.boolean().optional(),documentationLink:g.z.string().optional(),hasQuirksFiles:g.z.boolean().optional(),driverCount:g.z.number(),integratedDrivers:Y.optional(),extruderlessConfig:g.z.string().optional(),fourPinFanConnectorCount:g.z.number().optional(),driverVoltages:w.array().default([24]),hasMcuTempSensor:g.z.boolean().default(!0),thermistorPullup:g.z.number().default(4700),alternativePT1000Resistor:g.z.number().optional(),invertPinLogic:g.z.array(g.z.string()).default([]),customSections:g.z.record(g.z.string().regex(/^\S+$/),g.z.object({name:g.z.string().optional(),parameters:g.z.record(g.z.string().regex(/^\S+$/),g.z.string().or(g.z.number()).or(g.z.boolean())),comments:g.z.array(g.z.string()).default([])})).optional(),motorSlots:g.z.record(q,G).optional(),outputPins:g.z.array(g.z.object({pin:g.z.string(),name:g.z.string(),value:g.z.number().min(0).max(1)})).optional(),dfu:g.z.object({dfuBootImage:g.z.string(),flashDevice:g.z.string(),instructions:g.z.array(g.z.string()),reminder:g.z.string().optional(),hasBoot0Jumper:g.z.boolean()}).optional(),stepperSPI:g.z.object({software:g.z.object({sclk:g.z.string(),mosi:g.z.string(),miso:g.z.string()})}).or(g.z.object({hardware:g.z.object({bus:g.z.string()})})).optional(),ADXL345SPI:g.z.object({cs_pin:g.z.string()}).and(g.z.object({software:g.z.object({sclk:g.z.string(),mosi:g.z.string(),miso:g.z.string()})}).or(g.z.object({hardware:g.z.object({bus:g.z.string()})}))).optional(),LIS2DW:g.z.object({cs_pin:g.z.string()}).and(g.z.object({software:g.z.object({sclk:g.z.string(),mosi:g.z.string(),miso:g.z.string()})}).or(g.z.object({hardware:g.z.object({bus:g.z.string()})}))).optional(),path:Z}).and(g.z.object({isToolboard:g.z.literal(!0),motorSlots:g.z.undefined()}).or(g.z.object({motorSlots:Q})).or(g.z.object({isHost:g.z.literal(!0),motorSlots:g.z.undefined()}))),ee=J.and(g.z.object({detected:g.z.boolean()})),er=g.z.object({id:g.z.string(),disableAutoFlash:g.z.literal(!1).optional(),isToolboard:g.z.boolean().optional(),compileScript:g.z.string(),flashScript:g.z.string(),path:Z}),et=J.and(g.z.object({isToolboard:g.z.literal(!0),isHost:g.z.literal(!1).optional(),integratedDrivers:Y.and(g.z.object({[s.extruder]:g.z.string()}))})),eo=et.and(g.z.object({detected:g.z.boolean()}));var ei=t(73292),en=t(22037);let getScriptRoot=()=>process.env.RATOS_SCRIPT_DIR??__dirname.split("configurator/")[0]+"configurator/scripts/",replaceInFileByLine=async(e,r,t)=>{if(!(0,p.existsSync)(e))throw Error("File does not exist: "+e);let o=(0,p.createReadStream)(e,{highWaterMark:1048576}),i=(0,p.createWriteStream)(e+".tmp",{flags:"w"}),n=(0,y.createInterface)({input:o,crlfDelay:1/0}),a=new Promise((e,r)=>{n.on("close",()=>{e(null)})}),s=0,l=0,d=0;try{for await(let o of n){d++;let n=o;r instanceof Function?n=r(o,d):null===t?(r instanceof RegExp?o.match(r):o.includes(r))&&(n=null):null==t?getLogger().warn(`replaceInFileByLine (${e}): replacer wasn't provided, writing line as is`):n=o.replace(r,t),null!==n?(i.write(n+en.EOL),n!==o&&s++):l++}}catch(r){throw getLogger().error(`replaceInFileByLine (${e}): error encountered during replace operation, original file will not be changed. ${r instanceof Error?r.message:r instanceof String?r:"Unknown error"}`),o.destroy(),i.destroy(),r}finally{n.close(),await a,await new Promise((e,r)=>{i.close(t=>{if(t)throw r(t);e(null)})}),await new Promise((e,r)=>{o.close(t=>{if(t)throw r(t);e(null)})})}return s+l>0&&await (0,ei.copyFile)(e+".tmp",e),await (0,ei.unlink)(e+".tmp"),{linesChanged:s,linesDeleted:l,linesTotal:d}},searchFileByLine=async(e,r)=>{if(!(0,p.existsSync)(e))throw Error("File does not exist: "+e);let t=(0,p.createReadStream)(e),o=(0,y.createInterface)({input:t,crlfDelay:1/0}),i=!1,n=0;for await(let e of o)!i&&(n++,(r instanceof RegExp?e.match(r):e.includes(r))&&(i=n));return await new Promise((e,r)=>{t.close(t=>{if(t)throw r(t);e(null)})}),i},extractLinesFromFile=async(e,r,t)=>{if(!(0,p.existsSync)(e))throw Error("File does not exist: "+e);let o=(0,p.createReadStream)(e),i=(0,y.createInterface)({input:o,crlfDelay:1/0}),n=[],a=0;for await(let e of i)++a>=r&&a<=(t??1/0)&&n.push(e);return await new Promise((e,r)=>{o.close(t=>{if(t)throw r(t);e(null)})}),n.join("\n")};var ea=t(83536),es=t.n(ea);let el=new(es())({useClones:!1}),ed=new Map,ec=new(es())({useClones:!1}),ep=new Map,cacheAsyncMetadataFn=(e,r,t)=>async o=>{let i=t.get(`${r}-${o}`);if(null==i){let i=ep.get(`${r}-${o}`);null==i&&(i=e(o),ep.set(`${r}-${o}`,i));let n=await i;return t.set(`${r}-${o}`,n),n}return i},parseMetadata=async(e,r)=>{if(""===e.trim())return null;let t=await (0,T.promisify)(x.exec)(`sed -n '/^# {/{:a; N; /\\n# }/!ba; p}' ${e}`),o=t.stdout.split("\n").map(e=>e.trim()).filter(e=>""!==e).map(e=>0===e.indexOf("#")?e.substring(1):e);if(0===o.length)return null;try{let t=JSON.parse(o.join("\n"));t.path=e;let i=e.split("/").pop();if(null==i)throw Error("File name couldn't be parsed from path: "+e);return t.id=i.replace(/\.cfg$/g,""),r.parse(t)}catch(r){throw r instanceof Error&&getLogger().error(r.message),Error("Failed to parse JSON from file: "+e+" with content: "+o.join("\n"))}},parsePinValue=e=>{if(!("null"===e||e.startsWith("<")&&e.endsWith(">")))return e},eu=cacheAsyncMetadataFn(async e=>{let r=getScriptRoot(),t=await (0,T.promisify)(x.exec)(`python3 ${v().join(r,"initojson.py")} ${e}`),o=JSON.parse(t.stdout);if(null==o)throw Error("Failed to parse config file: "+e);let i=Object.keys(o).find(e=>e.startsWith("board_pins"));if(null==i)throw Error("Failed to find board pin section in config file: "+e);let n=o[i].aliases.map(e=>e.replace(",","")),a=o[i].aliases.filter(e=>!e.includes("="));if(a.length>0)throw Error('Board pin aliases do not parse correctly, got "'+a.join(", ")+'"');let s={};return n.forEach(e=>{let r=e.split("=");if(r.length>2)throw Error('Board pin aliases do not parse correctly, got "'+e+'"');s[r[0]]=parsePinValue(r[1])}),s},"parsePinAlias",ec),parseBoardPinConfig=async(e,r)=>{let t=v().join(e.path,e.isToolboard?"toolboard-config.cfg":r&&null!=e.extruderlessConfig?e.extruderlessConfig:"config.cfg"),o=e.isToolboard?B:r?H:L;return o.parse(await eu(t))};cacheAsyncMetadataFn(async e=>{if(!(0,p.existsSync)(e))throw Error("Firmware config file does not exist: "+e);let r=(0,p.createReadStream)(e),t=(0,y.createInterface)({input:r,crlfDelay:1/0}),o='CONFIG_MCU="';for await(let e of t)if(e.startsWith(o))return e.substring(o.length,e.length-2);throw Error("Failed to find MCU in firmware config file: "+e)},"extractMcuFromFirmwareConfig",ec);let eg=(o=e=>{let r=h.parse(process.env),t=v().join(r.RATOS_CONFIGURATION_PATH,"extruders",e+".cfg"),o=getScriptRoot(),i=(0,x.execSync)(`python3 ${v().join(o,"initojson.py")} ${t}`),n=JSON.parse(i.toString());if(null==n)throw Error("Failed to parse config file: "+t);let a=Object.keys(n).find(e=>e.startsWith("extruder"));if(null==a)throw Error("Failed to find extruder section in config file: "+t);let s=n[a];if(null==s||null==s.rotation_distance)throw Error("Failed to find extruder rotation distance");return s.rotation_distance},i="getExtruderRotationDistance",e=>{let r=ec.get(`${i}-${e}`);if(null==r){let r=o(e);return ec.set(`${i}-${e}`,r),r}return r}),readInclude=e=>{let r=h.parse(process.env),t=v().join(r.RATOS_CONFIGURATION_PATH,e);if(!(0,p.existsSync)(t))throw Error("Included file doesn't exist: "+e);return(0,p.readFileSync)(t,"utf-8")},stripIncludes=e=>stripLinesStartingWith(e,"[include"),stripCommentLines=e=>stripLinesStartingWith(e,"#"),stripLinesStartingWith=(e,r)=>e.split("\n").filter(e=>!e.trim().startsWith(r)).join("\n"),stripDriverSections=e=>{let r=!1;return e.split("\n").map(e=>{if(e.trim().startsWith("[tmc")&&(r=!0),r){if(!e.trim().startsWith("["))return null;r=!1}return e}).filter(e=>null!=e).join("\n")},replaceLinesStartingWith=(e,r,t)=>e.split("\n").map(e=>e.trim().startsWith(r)?t:e).filter(e=>null!==e).join("\n");var eh=t(17052);let em=g.z.union([g.z.literal("rose"),g.z.literal("red"),g.z.literal("yellow"),g.z.literal("orange"),g.z.literal("green"),g.z.literal("lime"),g.z.literal("blue"),g.z.literal("sky"),g.z.literal("indigo"),g.z.literal("purple"),g.z.literal("pink"),g.z.literal("brand"),g.z.literal("gray"),g.z.literal("plain")]),ef=(0,eh.j)("",{variants:{color:{rose:"text-rose-700 dark:text-rose-400",red:"text-red-700 dark:text-red-400",yellow:"text-yellow-800 dark:text-yellow-500",orange:"text-orange-800 dark:text-orange-500",green:"text-green-700 dark:text-green-400",lime:"text-lime-700 dark:text-lime-400",blue:"text-blue-700 dark:text-blue-400",sky:"text-sky-700 dark:text-sky-400",indigo:"text-indigo-700 dark:text-indigo-400",purple:"text-purple-700 dark:text-purple-400",pink:"text-pink-700 dark:text-pink-400",brand:"text-brand-700 dark:text-brand-400",gray:"text-zinc-600 dark:text-zinc-400",plain:"text-zinc-900 dark:text-zinc-100"}}}),eb=(0,eh.j)("",{variants:{color:{rose:"bg-rose-50 dark:bg-rose-400/10",red:"bg-red-50 dark:bg-red-400/10",yellow:"bg-yellow-50 dark:bg-yellow-400/10",orange:"bg-orange-50 dark:bg-orange-400/10",green:"bg-green-50 dark:bg-green-500/10",lime:"bg-lime-50 dark:bg-lime-500/10",blue:"bg-blue-50 dark:bg-blue-400/10",sky:"bg-sky-50 dark:bg-sky-400/10",indigo:"bg-indigo-50 dark:bg-indigo-400/10",purple:"bg-purple-50 dark:bg-purple-400/10",pink:"bg-pink-50 dark:bg-pink-400/10",brand:"bg-brand-100 dark:bg-brand-400/10",gray:"bg-zinc-50 dark:bg-zinc-400/10",plain:"bg-zinc-900/10 dark:bg-zinc-100/10"}}}),e_=(0,eh.j)("",{variants:{color:{rose:"border-rose-600/10 dark:border-rose-400/20 ring-rose-600/10 dark:ring-rose-400/20",red:"border-red-600/10 dark:border-red-400/20 ring-red-600/10 dark:ring-red-400/20",yellow:"border-yellow-600/20 dark:border-yellow-400/20 ring-yellow-600/20 dark:ring-yellow-400/20",orange:"border-orange-600/20 dark:border-orange-400/20 ring-orange-600/20 dark:ring-orange-400/20",green:"border-green-600/20 dark:border-green-500/20 ring-green-600/20 dark:ring-green-500/20",lime:"border-lime-600/20 dark:border-lime-500/20 ring-lime-600/20 dark:ring-lime-500/20",blue:"border-blue-700/10 dark:border-blue-400/30 ring-blue-700/10 dark:ring-blue-400/30",sky:"border-sky-700/10 dark:border-sky-400/30 ring-sky-700/10 dark:ring-sky-400/30",indigo:"border-indigo-700/10 dark:border-indigo-400/30 ring-indigo-700/10 dark:ring-indigo-400/30",purple:"border-purple-700/10 dark:border-purple-400/30 ring-purple-700/10 dark:ring-purple-400/30",pink:"border-pink-700/10 dark:border-pink-400/20 ring-pink-700/10 dark:ring-pink-400/20",brand:"border-brand-600/40 dark:border-brand-400/30 ring-brand-600/40 dark:ring-brand-400/30",gray:"border-zinc-500/10 dark:border-zinc-400/20 ring-zinc-500/10 dark:ring-zinc-400/20",plain:"border-zinc-900 dark:border-zinc-100 ring-zinc-900 dark:ring-zinc-100"}}});(0,eh.j)("flex-0 inline-flex w-auto items-center rounded-md font-medium ring-1 ring-inset",{variants:{size:{sm:"px-1.5 gap-1.5 py-1 text-2xs leading-3",md:"px-2 gap-2 py-1 text-xs leading-4",lg:"px-2 gap-2 py-1 text-xs leading-6"},color:{rose:[eb({color:"rose"}),e_({color:"rose"}),ef({color:"rose"})],red:[eb({color:"red"}),e_({color:"red"}),ef({color:"red"})],yellow:[eb({color:"yellow"}),e_({color:"yellow"}),ef({color:"yellow"})],orange:[eb({color:"orange"}),e_({color:"orange"}),ef({color:"orange"})],green:[eb({color:"green"}),e_({color:"green"}),ef({color:"green"})],lime:[eb({color:"lime"}),e_({color:"lime"}),ef({color:"lime"})],blue:[eb({color:"blue"}),e_({color:"blue"}),ef({color:"blue"})],sky:[eb({color:"sky"}),e_({color:"sky"}),ef({color:"sky"})],indigo:[eb({color:"indigo"}),e_({color:"indigo"}),ef({color:"indigo"})],purple:[eb({color:"purple"}),e_({color:"purple"}),ef({color:"purple"})],pink:[eb({color:"pink"}),e_({color:"pink"}),ef({color:"pink"})],brand:[eb({color:"brand"}),e_({color:"brand"}),ef({color:"brand"})],gray:[eb({color:"gray"}),e_({color:"gray"}),ef({color:"gray"})],plain:[eb({color:"plain"}),e_({color:"plain"}),ef({color:"plain"})]}},defaultVariants:{size:"md",color:"gray"}});let ex=["EPCOS 100K B57560G104F","ATC Semitec 104GT-2","ATC Semitec 104NT-4-R025H42G","Generic 3950","Honeywell 100K 135-104LAG-J01","NTC 100K MGB18-104F39050L32","SliceEngineering 450","TDK NTCG104LH104JT1","PT1000"],ez="";if(process.env.RATOS_CONFIGURATION_PATH){let e=h.parse(process.env);ez=e.RATOS_CONFIGURATION_PATH}let ev=g.z.object({path:g.z.string().startsWith(ez).endsWith(".cfg"),id:g.z.string()}),ey=g.z.enum(ex),eT=ev.extend({type:g.z.literal("hotend"),title:g.z.string(),thermistor:g.z.enum(ex),flowType:g.z.union([g.z.literal("sf"),g.z.literal("hf"),g.z.literal("uhf")])}),ew=g.z.object({type:g.z.enum(["Regular","CHT"]),diameter:g.z.number().min(.2).max(1.8)}),eP=ev.extend({type:g.z.literal("extruder"),stepper:k.shape.id.optional(),current:j.shape.current.optional(),title:g.z.string()}),eS=ev.extend({type:g.z.literal("static-probe").or(g.z.literal("stowable-probe")),title:g.z.string()}),eC=g.z.object({id:g.z.enum(["endstop","endstop-toolboard","sensorless"]),title:g.z.string(),badge:g.z.array(g.z.object({children:g.z.string(),color:em})).optional()}),eR=g.z.union([g.z.literal("toolboard_t0"),g.z.literal("toolboard_t1"),g.z.literal("controlboard"),g.z.literal("rpi"),g.z.literal("beacon")]),ek=g.z.union([g.z.literal("adxl345"),g.z.literal("lis2dw"),g.z.literal("beacon")]),eN=g.z.object({id:g.z.enum(["toolboard","controlboard","sbc","none","beacon"]),title:g.z.string(),accelerometerType:ek.default("adxl345").optional()}),ej=g.z.object({name:eR,type:ek});eN.extend({accelerometerType:ek});let eE=g.z.object({id:g.z.enum(["2pin","4pin","4pin-dedicated","2pin-toolboard","4pin-toolboard","4pin-dedicated-toolboard","none"]),title:g.z.string(),badge:g.z.array(g.z.object({children:g.z.string(),color:em})).optional()}),getDefaultNozzle=()=>({diameter:.4,type:"Regular"}),e$=g.z.object({hotend:eT,thermistor:ey,extruder:eP,xEndstop:eC,yEndstop:eC,hotendFan:eE,partFan:eE,nozzle:ew.default(getDefaultNozzle()),xAccelerometer:eN.optional().nullable(),yAccelerometer:eN.optional().nullable(),toolboard:et.nullable(),probe:eS.optional(),axis:g.z.literal(s.x).or(g.z.literal(s.dual_carriage)),description:g.z.string().optional(),toolNumber:g.z.number().optional()}).strict(),eA=g.z.union([g.z.literal(0),g.z.literal(1)]),eO=g.z.union([g.z.literal(s.x),g.z.literal(s.dual_carriage),g.z.literal(s.extruder),g.z.literal(s.extruder1)]),eM=g.z.union([eO,eA]),eF=e$.refine(e=>null!==e.toolboard||"endstop-toolboard"!==e.xEndstop.id,"Cannot use toolboard endstop without a toolboard").refine(e=>null!==e.toolboard||!["2pin-toolboard","4pin-toolboard","4pin-dedicated-toolboard"].includes(e.hotendFan.id),"Cannot use toolboard hotend fan without a toolboard").refine(e=>null!==e.toolboard||!["2pin-toolboard","4pin-toolboard","4pin-dedicated-toolboard"].includes(e.partFan.id),"Cannot use toolboard part cooling fan without a toolboard"),eI=e$.partial().optional(),eD=e$.extend({hotend:eT.shape.id,extruder:eP.shape.id,thermistor:ey,xEndstop:eC.shape.id,yEndstop:eC.shape.id,hotendFan:eE.shape.id,partFan:eE.shape.id,xAccelerometer:eN.shape.id.optional().nullable(),yAccelerometer:eN.shape.id.optional().nullable(),toolboard:K.optional().nullable(),probe:eS.shape.id.optional().nullable()}).strict(),eL=eD.partial().optional(),eH="";if(process.env.RATOS_CONFIGURATION_PATH){let e=h.parse(process.env);eH=v().join(e.RATOS_CONFIGURATION_PATH,"printers")}let eB=g.z.object({velocity:g.z.number().min(0).describe("Maximum velocity for this printer"),accel:g.z.number().min(0).describe("Maximum acceleration for this printer"),z_velocity:g.z.number().min(0).describe("Maximum z velocity for this printer"),z_accel:g.z.number().min(0).describe("Maximum z acceleration for this printer"),square_corner_velocity:g.z.number().min(0).default(5).describe("Maximum square corner velocity for this printer"),travel_velocity:g.z.number().min(0).default(200).describe("Maximum travel velocity for this printer"),travel_accel:g.z.number().min(0).default(3e3).describe("Maximum travel velocity for this printer")}).strict(),eW=g.z.object({x:g.z.number().min(0).describe("The print volume in X"),y:g.z.number().min(0).describe("The print volume in Y"),z:g.z.number().min(0).describe("The print volume in Z")}).describe("The print volume of a printer"),eV=g.z.object({id:g.z.string().transform(e=>"caramba-chonk"===e?"v-chonk":e.startsWith("caramba-")?e.replace("caramba-","v-core-4-"):e),name:g.z.string().describe("The name of the printer"),releaseDate:g.z.string().optional().describe("The release date of the printer in ISO 8601/RFC3339 eg. 2023-12-31"),description:g.z.string().describe("A description of the printer"),manufacturer:g.z.string().describe("The name of the manufacturer of this printer"),documentationLink:g.z.string().describe("Link to the RatOS documentation for this printer"),image:g.z.string().describe("Link to an image of the printer"),sizes:g.z.record(g.z.string(),eW).describe("Size options for this printer"),template:g.z.string().describe("Printer.cfg template for this printer"),path:g.z.string().startsWith(eH),driverCountRequired:g.z.number().describe("Number of drivers required for this printer"),kinematics:g.z.union([g.z.literal("cartesian"),g.z.literal("corexy"),g.z.literal("hybrid-corexy"),g.z.literal("hybrid-corexy-idex")]).optional(),bedMargin:g.z.object({x:g.z.tuple([g.z.number().default(0),g.z.number().default(0)]),y:g.z.tuple([g.z.number().default(0),g.z.number().default(0)])}).describe("Margin of available movement around the bed for this printer").default({x:[0,0],y:[0,0]}),speedLimits:g.z.object({basic:eB,performance:eB.optional()}).strict().describe("Speed limits for this printer"),defaults:g.z.object({toolheads:g.z.array(eD).describe("Default toolheads for this printer"),board:K.describe("Default board for this printer. Should be the name of the board directory."),rails:g.z.array(E).describe("Default rails for this printer"),controllerFan:eE.shape.id.optional().describe("Default controller fan for this printer")}).strict().describe("Default hardware for this printer")}).describe("A RatOS supported 3d printer"),eU=eV.extend({defaults:eV.shape.defaults.extend({toolheads:g.z.array(eF)}).strict()}),eG=g.z.array(S).parse([{id:"LDO-TMC2209",title:"LDO TMC2209",type:"TMC2209",protocol:"UART",senseResistor:.11,coolingCurrentThreshold:1.1,voltages:[24],maxCurrent:2},{id:"LDO-NITEHAWK-TMC2209",title:"LDO TMC2209",type:"TMC2209",protocol:"UART",senseResistor:.1,coolingCurrentThreshold:1.1,voltages:[24],maxCurrent:2},{id:"LDO-TMC5160-HV",title:"LDO TMC5160 HV",type:"TMC5160",protocol:"SPI",senseResistor:.075,voltages:[24,36,48],maxCurrent:3,coolingCurrentThreshold:1.5},{id:"BTT-KRAKEN-2160-PLUS",title:"BTT TMC2160 PLUS",type:"TMC5160",protocol:"SPI",senseResistor:.022,voltages:[24,36,48,56,60],maxCurrent:8,coolingCurrentThreshold:3},{id:"BTT-KRAKEN-2160",title:"BTT TMC2160",type:"TMC5160",protocol:"SPI",senseResistor:.075,voltages:[24,36,48,56,60],maxCurrent:3,coolingCurrentThreshold:1.5},{id:"BTT-TMC2209-13",title:"BTT TMC2209 v1.3",type:"TMC2209",protocol:"UART",senseResistor:.11,coolingCurrentThreshold:1.1,voltages:[24],maxCurrent:2},{id:"BTT-TMC2226-10",title:"BTT TMC2226 v1.0",type:"TMC2209",protocol:"UART",senseResistor:.11,coolingCurrentThreshold:1.1,voltages:[24],maxCurrent:2},{id:"BTT-TMC5160-PRO-11",title:"BTT TMC5160(T) Pro v1.1",type:"TMC5160",protocol:"SPI",senseResistor:.075,voltages:[24,36,48,56],maxCurrent:3,coolingCurrentThreshold:1.5},{id:"BTT-TMC5160T-PLUS-10",title:"BTT TMC5160T Plus v1.0",type:"TMC5160",protocol:"SPI",senseResistor:.022,voltages:[24,36,48,56,60],maxCurrent:10.6,coolingCurrentThreshold:3,external:!0},{id:"BTT-EZ2209",title:"BTT EZ2209",type:"TMC2209",protocol:"UART",senseResistor:.11,coolingCurrentThreshold:1.3,voltages:[24],maxCurrent:2},{id:"BTT-EZ2226",title:"BTT EZ2226",type:"TMC2209",protocol:"UART",senseResistor:.11,coolingCurrentThreshold:1.3,voltages:[24],maxCurrent:2},{id:"BTT-EZ2130",title:"BTT EZ2130",type:"TMC2130",protocol:"SPI",senseResistor:.11,coolingCurrentThreshold:.9,voltages:[24],maxCurrent:2},{id:"BTT-EZ5160-PRO",title:"BTT EZ5160 Pro",type:"TMC5160",protocol:"SPI",senseResistor:.075,coolingCurrentThreshold:1.6,voltages:[24,36,48],maxCurrent:2.5},{id:"BTT-EZ5160-RGB",title:"BTT EZ5160 RGB",type:"TMC5160",protocol:"SPI",senseResistor:.05,coolingCurrentThreshold:3,voltages:[24,48,36,56],maxCurrent:4.7},{id:"BTT-TMC2240-10",title:"BTT TMC2240 v1.0",type:"TMC2240",protocol:"SPI",coolingCurrentThreshold:1.1,voltages:[24,36],maxCurrent:2.1},{id:"LDO-2240-UART",title:"LDO TMC2240 UART",type:"TMC2240",protocol:"UART",coolingCurrentThreshold:1.1,voltages:[24,36],maxCurrent:2.1},{id:"MELLOW-FLY-HV-TMC5160-PRO-12",title:"Mellow FLY HV TMC5160 Pro v1.2",type:"TMC5160",protocol:"SPI",senseResistor:.033,coolingCurrentThreshold:3,voltages:[24,36,48],maxCurrent:4.25,external:!0},{id:"MELLOW-FLY-TMC2209",title:"Mellow FLY TMC2209",type:"TMC2209",protocol:"UART",senseResistor:.11,coolingCurrentThreshold:1.1,voltages:[24],maxCurrent:2},{id:"PRUSA-EINSY-RAMBO-TMC2130",title:"Prusa Einsy Rambo TMC2130",type:"TMC2130",protocol:"SPI",senseResistor:.22,coolingCurrentThreshold:.9,voltages:[24],maxCurrent:2},{id:"PRUSA-BUDDY-TMC2209",title:"Prusa Buddy TMC2209",type:"TMC2209",protocol:"UART",senseResistor:.11,coolingCurrentThreshold:1.1,voltages:[24],maxCurrent:2}]),findPreset=(e,r,t,o,i)=>e.presets?.slice().sort((e,r)=>i?r.run_current-e.run_current:e.run_current-r.run_current).find(e=>e.driver===r.type&&e.voltage===t&&("TMC2240"===r.type||"sense_resistor"in e&&e.sense_resistor===r.senseResistor)&&(null==o||e.run_current===o)),eq=g.z.array(k).parse([{id:"generic",title:"Generic Stepper",maxPeakCurrent:2.8},{id:"BONDTECH-42H025H-0704-002",title:"Bondtech LGX Stepper",maxPeakCurrent:.7},{id:"LDO-42STH48-2504AC",title:"LDO-42STH48-2504AC",maxPeakCurrent:2.5,presets:[{run_current:1.1,voltage:24,driver:"TMC2209",sense_resistor:.11,driver_TBL:1,driver_TOFF:3,driver_HEND:0,driver_HSTRT:0},{run_current:1.6,voltage:24,driver:"TMC2209",sense_resistor:.11,driver_TBL:2,driver_TOFF:3,driver_HEND:0,driver_HSTRT:6},{run_current:1.6,voltage:24,driver:"TMC5160",sense_resistor:.075,driver_TBL:2,driver_TOFF:3,driver_HEND:0,driver_HSTRT:6},{run_current:1.768,voltage:48,driver:"TMC5160",sense_resistor:.075,driver_TBL:0,driver_TOFF:4,driver_HEND:0,driver_HSTRT:4}]},{id:"LDO-42STH40-1684AC",title:"LDO-42STH40-1684AC",maxPeakCurrent:1.68,presets:[{run_current:.4,voltage:24,driver:"TMC2130",sense_resistor:.22,driver_IHOLDDELAY:8,driver_TPOWERDOWN:0,driver_TBL:2,driver_TOFF:3,driver_HEND:1,driver_HSTRT:5,driver_PWM_FREQ:2,driver_PWM_GRAD:2,driver_PWM_AMPL:230,driver_PWM_AUTOSCALE:!0,driver_SGT:5},{run_current:.52,voltage:24,driver:"TMC2130",sense_resistor:.22,driver_IHOLDDELAY:8,driver_TPOWERDOWN:0,driver_TBL:2,driver_TOFF:3,driver_HEND:1,driver_HSTRT:5,driver_PWM_FREQ:2,driver_PWM_GRAD:4,driver_PWM_AMPL:240,driver_PWM_AUTOSCALE:!0,driver_SGT:3},{run_current:.8,voltage:24,driver:"TMC2209",sense_resistor:.11,driver_TBL:1,driver_TOFF:3,driver_HEND:3,driver_HSTRT:0},{run_current:1.188,voltage:24,driver:"TMC2209",sense_resistor:.11,driver_TBL:0,driver_TOFF:3,driver_HEND:0,driver_HSTRT:0}]},{id:"LDO-42STH48-2004MAH",title:"LDO-42STH48-2004MAH",maxPeakCurrent:2,fullStepsPerRotation:400},{id:"LDO-42STH48-2004AC",title:"LDO-42STH48-2004AC",maxPeakCurrent:2},{id:"LDO-42STH25-1404MAC",title:"LDO-42STH25-1404MAC",maxPeakCurrent:1.4,fullStepsPerRotation:400,presets:[{voltage:24,driver:"TMC2209",sense_resistor:.11,run_current:.85,driver_TBL:1,driver_TOFF:3,driver_HEND:2,driver_HSTRT:0},{voltage:24,driver:"TMC2209",sense_resistor:.11,run_current:1,driver_TBL:2,driver_TOFF:3,driver_HEND:3,driver_HSTRT:0}]},{id:"LDO-42STH25-1004CL200E",title:"LDO-42STH25-1004CL200E",maxPeakCurrent:1},{id:"LDO-36STH20-1004AHG",title:"LDO-36STH20-1004AHG",maxPeakCurrent:1,presets:[{voltage:24,driver:"TMC2209",sense_resistor:.11,run_current:.707,driver_TBL:0,driver_HEND:6,driver_HSTRT:7,driver_TOFF:4}]},{id:"LDO-36STH17-1004AHG",title:"LDO-36STH17-1004AHG",maxPeakCurrent:1},{id:"LDO-35STH48-1684AH",title:"LDO-35STH48-1684AH",maxPeakCurrent:1.68}]),deserializeDriver=e=>eG.find(r=>r.id===e)??null,deserializeStepper=e=>eq.find(r=>r.id===e)??null,deserializePrinterRail=e=>{let r=deserializeStepper(e.stepper),t=deserializeDriver(e.driver);if(null==r)throw Error(`Stepper ${e.stepper} not found in database`);if(null==t)throw Error(`Driver ${e.driver} not found in database`);return N.parse({...e,stepper:r,driver:t})},deserializePrinterRailDefinition=e=>{let r=deserializeStepper(e.stepper),t=deserializeDriver(e.driver);if(null==r)throw Error(`Stepper ${e.stepper} not found in database`);if(null==t)throw Error(`Driver ${e.driver} not found in database`);return j.parse({...e,stepper:r,driver:t})},stringToTitleObject=e=>({id:e,title:e}),serializeToolheadConfiguration=e=>({...e,toolboard:e.toolboard?.id,hotend:e.hotend.id,thermistor:e.thermistor,extruder:e.extruder.id,probe:e.probe?.id,xEndstop:e.xEndstop.id,yEndstop:e.yEndstop.id,partFan:e.partFan.id,hotendFan:e.hotendFan.id,xAccelerometer:e.xAccelerometer?.id,yAccelerometer:e.yAccelerometer?.id}),extractToolheadsFromPrinterConfiguration=e=>{let r=e?.toolheads?.map(e=>{if(null==e)throw Error("Toolhead can not be null");return new ToolheadHelper(eF.parse(e))}).filter(Boolean);if(null==r)throw Error("No toolheads found");return r},extractToolheadFromPrinterConfiguration=(e,r)=>{if(r?.toolheads==null||0===r.toolheads.length)throw Error("No toolheads preset in supplied printer config");let t=extractToolheadsFromPrinterConfiguration(r),o="number"==typeof e?t.find(r=>r.getTool()===e):t.find(r=>r.getExtruderAxis()===e||r.getMotionAxis()===e);return o};var eK=t(24540),eZ=t.n(eK);let ToolheadHelper=class ToolheadHelper{constructor(e){this.config=e}hasToolboard(){return null!=this.config.toolboard}getToolboard(){return this.config.toolboard}getMotionStepperName(){return this.config.axis===s.dual_carriage?"dual_carriage":`stepper_${this.getMotionAxis()}`}getToolboardName(){if(null==this.config.toolboard)throw Error(`Toolhead T${this.getTool()} does not have a toolboard`);return`toolboard_${this.getShortToolName()}`}getShortToolName(){return`t${this.getTool()}`}getDescription(){return this.config.description??"the printer's toolhead"}getMotionAxis(){return this.config.axis===s.dual_carriage?s.dual_carriage:s.x}getExtruderAxis(){return this.config.axis===s.dual_carriage?s.extruder1:s.extruder}getToolCommand(){return`T${this.getTool()}`}getTool(){return this.config.axis===s.dual_carriage?1:0}getSerialSuffix(){return`t${this.getTool()}`}getExtruder(){return this.config.extruder}getHotend(){return this.config.hotend}getNozzle(){return this.config.nozzle??getDefaultNozzle()}getThermistor(){return this.config.thermistor}getXEndstop(){return this.config.xEndstop}getYEndstop(){return this.config.yEndstop}getXAccelerometer(){return this.config.xAccelerometer}getYAccelerometer(){return this.config.yAccelerometer}getXAccelerometerName(){switch(this.getXAccelerometer()?.id){case"controlboard":return"controlboard";case"toolboard":if(this.hasToolboard())return this.getToolboardName();case"sbc":return"rpi";case"beacon":return"beacon";default:return"controlboard"}}getYAccelerometerName(){switch(this.getYAccelerometer()?.id){case"controlboard":return"controlboard";case"toolboard":if(this.hasToolboard())return this.getToolboardName();case"sbc":return"rpi";case"beacon":return"beacon";default:return"controlboard"}}getChangeSet(e){if(null==e)return null;let r={};Object.keys(e).forEach(t=>{let o=this.getConfig()[t],i=e[t];if(null!=o&&null==i||null==o&&null!=i){r[t]=i;return}o&&i&&("object"==typeof o&&"id"in o&&"object"==typeof i&&"id"in i?o.id!==i.id&&(r[t]=i):eZ()(o,i)||(r[t]=i))});let t=eI.safeParse(r);return t}getProbe(){return this.config.probe}getPartFan(){return this.config.partFan}getHotendFan(){return this.config.hotendFan}serialize(){return serializeToolheadConfiguration(this.config)}getConfig(){return{...this.config}}};let eX=g.z.union([eW,g.z.number(),g.z.string()]).nullable().optional(),eY=g.z.object({printer:eV,controlboard:J,toolheads:g.z.array(eF).min(1).max(2),size:eX,controllerFan:eE,performanceMode:g.z.boolean().default(!1),stealthchop:g.z.boolean().default(!1),standstillStealth:g.z.boolean().default(!1),rails:g.z.array($)}).strict().transform((e,r)=>{if(null==e.size)e.size=e.printer.sizes[Object.keys(e.printer.sizes)[0]];else if("number"==typeof e.size||"string"==typeof e.size){let t=e.printer.sizes[e.size.toString()];if(null==t)return r.addIssue({code:g.z.ZodIssueCode.custom,message:`Size ${e.size} is not a valid size for a ${e.printer.name} config`}),g.z.NEVER;e.size=t}return e}),eQ=eY.superRefine((e,r)=>{let t=e.toolheads.map(e=>e.toolboard).filter(Boolean).length;t+e.controlboard.driverCount<e.printer.driverCountRequired&&r.addIssue({code:g.z.ZodIssueCode.too_small,message:`Your combination of controlboard and toolboards do not have enough stepper drivers for a ${e.printer.name} config`,minimum:e.printer.driverCountRequired,inclusive:!0,type:"number"})}).superRefine((e,r)=>{let t=e.toolheads.map(e=>new ToolheadHelper(e)),o=e.rails.map((o,i)=>{let n=t.find(e=>e.getExtruderAxis()===o.axis);if(null!=o.motorSlot){let a=e.rails.filter(e=>{let r=t.find(r=>r.getExtruderAxis()===e.axis);return e.axis!==o.axis&&n?.hasToolboard()==null&&r?.hasToolboard==null&&e.motorSlot===o.motorSlot}),railName=e=>"extruder"===e?"Extruder T0":e===s.extruder1?"Extruder T1":"Stepper "+e.toLocaleUpperCase();return 1===a.length?r.addIssue({code:g.z.ZodIssueCode.custom,message:`Motor slot ${o.motorSlot} is already in use on ${railName(a[0].axis)}`,path:["rails",i,"motorSlot"]}):a.length>1&&r.addIssue({code:g.z.ZodIssueCode.custom,message:`Motor slot ${o.motorSlot} is already in use on ${a.slice(0,-1).map(e=>railName(e.axis)).join(", ")} and ${railName(a[a.length-1].axis)}`,path:["rails",i,"motorSlot"]}),a.length>0?{rail:o,conflicts:a}:0}return null}).filter(Boolean);o.length>0&&r.addIssue({code:g.z.ZodIssueCode.custom,message:"Motor slot conflicts detected"})}),eJ=eY.innerType().extend({printer:eV.shape.id,controlboard:K,toolheads:g.z.array(eD).min(1).max(2),controllerFan:eE.shape.id,rails:g.z.array(A)}).strict(),e0=eY.innerType().extend({toolheads:g.z.array(eI).min(1).max(2)}).strict().partial().optional(),e1=eJ.extend({toolheads:g.z.array(eL).min(1).max(2)}).strict().partial(),xEndstopOptions=(e,r)=>{let t=[];return r?.toolboard!=null&&t.push({id:"endstop-toolboard",title:"Physical Endstop",badge:[{color:"sky",children:`${r.toolboard.name}${null!=r.toolNumber&&` T${r.toolNumber}`}`}]}),r?.axis===s.x&&(t.push({id:"endstop",title:"Physical Endstop",badge:[{color:"purple",children:e?.controlboard?.name??"Control Board"}]}),t.push({id:"sensorless",title:"Sensorless Homing",badge:[{color:"purple",children:e?.controlboard?.name??"Control Board"}]})),t},yEndstopOptions=(e,r)=>[{id:"endstop",title:"Physical Endstop",badge:[{color:"purple",children:e?.controlboard?.name??"Control Board"}]},{id:"sensorless",title:"Sensorless Homing",badge:[{color:"purple",children:e?.controlboard?.name??"Control Board"}]}],sensorlessXTemplate=(e,r)=>`
# Sensorless homing.
#
# Tune the sensorless_x_current variable and the SGTHRS/SGT value in this file untill you get reliable homing.
# Beware of false instant triggering which can make it look like the homing procedure is skipping an axis, when in fact it's not.
# This is especially true for the Y axis on CoreXY machines.
#
# Read the klipper documentation for more info: https://www.klipper3d.org/TMC_Drivers.html#sensorless-homing
#
# Note: if your board has diag jumpers, you would need to insert them for the specific drivers you want to use for sensorless homing on.
# Note: Sensorless homing does NOT work if you drivers have a missing DIAG pins.    
# Check https://www.klipper3d.org/TMC_Drivers.html#sensorless-homing for tuning instructions.

[${r.getAxisDriverSectionName(s.x)}]
${r.getAxisDriverDiagConfig(s.x)}
${r.getAxisDriverStallGuardThreshold(s.x,.5)}

[${r.getAxisStepperName(s.x)}]
endstop_pin: ${r.getAxisVirtualEndstop(s.x)}
homing_retract_dist: 0

[gcode_macro RatOS]
variable_homing_x: "sensorless"
variable_sensorless_x_current: ${r.getAxisDriverHomingCurrent(s.x,.35)}
`,sensorlessYTemplate=(e,r)=>`
# Sensorless homing.
#
# Tune the current variable and the SGTHRS value in the included file(s) untill you get reliable homing.
# Beware of false instant triggering which can make it look like the homing procedure is skipping an axis, when in fact it's not.
# This is especially true for the Y axis on CoreXY machines.
#
# Read the klipper documentation for more info: https://www.klipper3d.org/TMC_Drivers.html#sensorless-homing
#
# Note: if your board has diag jumpers, you would need to insert them for the specific drivers you want to use for sensorless homing on.
# Note: Sensorless homing does NOT work if you drivers have a missing DIAG pins.
# Check https://www.klipper3d.org/TMC_Drivers.html#sensorless-homing for tuning instructions.

[${r.getAxisDriverSectionName(s.y)}]
${r.getAxisDriverDiagConfig(s.y)}
${r.getAxisDriverStallGuardThreshold(s.y,.5)}

[stepper_y]
endstop_pin: ${r.getAxisVirtualEndstop(s.y)}
homing_retract_dist: 0

[gcode_macro RatOS]
variable_homing_y: "sensorless"
variable_sensorless_y_current: ${r.getAxisDriverHomingCurrent(s.y,.51)}
`,getBoardSerialPath=(e,r)=>e.isHost&&"serialPath"in e&&null!=e.serialPath?e.serialPath:"/dev/RatOS/"+getBoardChipId(e,r),getBoardChipId=(e,r)=>{if(e.isHost)throw Error("Cannot get chip ID for a host board");return e.id+(r?`-${r.getSerialSuffix()}`:"")};let ToolheadGenerator=class ToolheadGenerator extends ToolheadHelper{static async fromConfig(e,r,t,o){let i=e.toolboard?await parseBoardPinConfig(e.toolboard):null;return new ToolheadGenerator(e,i,r,t,o)}constructor(e,r,t,o,i){super(e),this.toolboardPins=r,this.controlboardPins=t,this.printer=o,this.size=i}requireControlboardPin(e){if(this.controlboardPins?.[e]==null)throw Error(`Toolhead ${this.getTool()} is configured to use the controlboard for ${e}, but the controlboard does not define a pin with that name.`)}requireToolboardPin(e){if(this.toolboardPins?.[e]==null)throw Error(`Toolhead ${this.getTool()} is configured to use the toolboard for ${e}, but the toolboard does not define a pin with that name.`)}getExtruderToolAxisPinPrefix(){return 0===this.getTool()?"":this.getTool()}getToolboardPins(){if(null==this.toolboardPins)throw Error(`Toolboard pins not available for toolhead ${this.getToolCommand()}`);return this.toolboardPins}getToolheadPin(e,r){let t=e===this.getExtruderAxis()?this.getPinPrefix():"",o=e===s.z?"z0":e!==this.getExtruderAxis()?e:null!=this.getToolboard()?"e":"e"+this.getExtruderToolAxisPinPrefix(),i=o+r,n=null;try{n=this.getPinFromAlias(i)}catch(e){n=null}if(null==n)throw Error(`Pin name "${i}" constructed from axis "${e}" and alias "${r}" not found on toolhead ${this.getToolCommand()} with extruder axis ${this.getExtruderAxis()}. Resolved axis alias ${o}. Searched in ${this.getToolboard()?"toolboard":"controlboard"}`);return t+n}getPinFromAlias(e){let r=null;if(this.getToolboard()){if(this.toolboardPins?.[e]!=null)r=this.toolboardPins[e];else throw Error(`Alias "${e}" not found in toolboard pin definition.`)}else this.controlboardPins?.[e]!=null&&(r=this.controlboardPins[e]);if(null!=r)return r;throw Error(`Unknown pin alias ${e}`)}getPinFromToolboardAlias(e){let r=null,t="e1"===e.split("_")[0]?"e"+this.getExtruderToolAxisPinPrefix():e;if(!this.hasToolboard())throw Error(`Toolhead ${this.getTool()} is not configured to use a toolboard`);if(this.toolboardPins?.[t]!=null)r=this.toolboardPins[t];else throw Error(`Alias "${t}" not found in toolboard pin definition.`);if(null!=r)return r;throw Error(`Unknown pin alias ${t}`)}getXEndstopPin(){let e;switch(this.getXEndstop().id){case"endstop":if(this.controlboardPins?.x_endstop_pin==null)throw Error(`Toolhead ${this.getTool()} is configured to use the controlboard for the x endstop, but the controlboard has no x_endstop_pin`);e=this.controlboardPins.x_endstop_pin;break;case"endstop-toolboard":if(this.toolboardPins?.x_endstop_pin==null)throw Error(`Toolhead ${this.getTool()} is configured to use a toolboard for the x endstop, but the toolboard has no x_endstop_pin`);e=this.getPinPrefix()+this.toolboardPins.x_endstop_pin;break;default:throw Error(`Unknown endstop type ${this.getXEndstop().id}`)}return e}getYEndstopPin(){let e;switch(this.getYEndstop().id){case"endstop":if(this.controlboardPins?.y_endstop_pin==null)throw Error(`Toolhead ${this.getTool()} is configured to use the controlboard for the x endstop, but the controlboard has no y_endstop_pin`);e=this.controlboardPins.y_endstop_pin;break;case"endstop-toolboard":if(this.toolboardPins?.y_endstop_pin==null)throw Error(`Toolhead ${this.getTool()} is configured to use a toolboard for the x endstop, but the toolboard has no y_endstop_pin`);e=this.getPinPrefix()+this.toolboardPins.y_endstop_pin;break;default:throw Error(`Unknown endstop type ${this.getXEndstop().id}`)}return e}getPinPrefix(){return this.config.toolboard?`${this.getToolboardName()}:`:""}isToolboardPinInverted(e){return null!=e&&!!this.config.toolboard?.invertPinLogic.includes(e)}renderToolboard(e){let r=this.toolboardPins,t=this.config.toolboard;if(null==t||null==r)return"";if(null==e)throw Error("exportPinsFn is required when rendering toolboard");let o=["",e(this.getToolboardName(),t,this,this.getToolboardName()),"",`[mcu ${this.getToolboardName()}]`,`serial: ${getBoardSerialPath(t,this)}`];return t.hasMcuTempSensor&&(o.push(""),o.push(`[temperature_sensor ${t.name.replace(/\s/g,"_")}_${this.getToolCommand()}]`),o.push("sensor_type: temperature_mcu"),o.push(`sensor_mcu: ${this.getToolboardName()}`)),null!=t.ADXL345SPI&&(o.push(""),o.push(`[adxl345 ${this.getToolboardName()}]`),o.push("axes_map: x, z, y # Assumes back-facing vertical toolboard mounting"),o.push(`cs_pin: ${this.isToolboardPinInverted(t.ADXL345SPI.cs_pin)?"!":""}${this.getPinPrefix()}${t.ADXL345SPI.cs_pin}`),"hardware"in t.ADXL345SPI?o.push(`spi_bus: ${t.ADXL345SPI.hardware.bus}`):(o.push(`spi_software_mosi_pin: ${this.isToolboardPinInverted(t.ADXL345SPI.software.mosi)?"!":""}${this.getPinPrefix()}${t.ADXL345SPI.software.mosi}`),o.push(`spi_software_miso_pin: ${this.isToolboardPinInverted(t.ADXL345SPI.software.miso)?"!":""}${this.getPinPrefix()}${t.ADXL345SPI.software.miso}`),o.push(`spi_software_sclk_pin: ${this.isToolboardPinInverted(t.ADXL345SPI.software.sclk)?"!":""}${this.getPinPrefix()}${t.ADXL345SPI.software.sclk}`))),null!=t.LIS2DW&&(o.push(""),o.push(`[lis2dw ${this.getToolboardName()}]`),o.push("axes_map: x, z, y # Assumes back-facing vertical toolboard mounting"),o.push(`cs_pin: ${this.isToolboardPinInverted(t.LIS2DW.cs_pin)?"!":""}${this.getPinPrefix()}${t.LIS2DW.cs_pin}`),"hardware"in t.LIS2DW?o.push(`spi_bus: ${t.LIS2DW.hardware.bus}`):(o.push(`spi_software_mosi_pin: ${this.isToolboardPinInverted(t.LIS2DW.software.mosi)?"!":""}${this.getPinPrefix()}${t.LIS2DW.software.mosi}`),o.push(`spi_software_miso_pin: ${this.isToolboardPinInverted(t.LIS2DW.software.miso)?"!":""}${this.getPinPrefix()}${t.LIS2DW.software.miso}`),o.push(`spi_software_sclk_pin: ${this.isToolboardPinInverted(t.LIS2DW.software.sclk)?"!":""}${this.getPinPrefix()}${t.LIS2DW.software.sclk}`))),null!=t.outputPins&&t.outputPins.forEach(e=>{o.push(""),o.push(`[output_pin ${e.name}]`),o.push(`pin: ${this.isToolboardPinInverted(e.pin)?"!":""}${this.getPinPrefix()}${e.pin}`),o.push(`value: ${e.value}`)}),null!=t.customSections&&Object.keys(t.customSections).forEach(e=>{if(null==t.customSections)return;let r=t.customSections[e];o.push(""),o.push(`[${e}${r.name?` ${r.name}`:""}]`),null!=r.comments&&r.comments.forEach(e=>{o.push(`# ${e}`)}),Object.keys(r.parameters).forEach(t=>{if(null==this.toolboardPins)return;let i=r.parameters[t];if(null==i)throw Error(`Parameter "${t}" has no value in custom section "${e}"`);"string"==typeof i&&(t.endsWith("_pin")||"pin"===t||Object.values(this.toolboardPins).includes(i))?o.push(`${t}: ${this.isToolboardPinInverted(i)?"!":""}${this.getPinPrefix()}${i}`):"boolean"==typeof i||"true"===i.toString().trim().toLowerCase()||"false"===i.toString().trim().toLowerCase()?o.push(`${t}: ${!0===i||"true"===i.toString().trim().toLowerCase()?"True":"False"}`):o.push(`${t}: ${i}`)})}),o.join("\n")}renderHotend(e){let r=[],t=readInclude(`hotends/${this.getHotend().id}.cfg`);t=replaceLinesStartingWith(t=stripIncludes(t=stripCommentLines(t)),"[extruder]",`[${this.getExtruderAxis()}]`),t=replaceLinesStartingWith(t,"heater_pin",`heater_pin: ${this.getToolheadPin(this.getExtruderAxis(),"_heater_pin")}`),t=replaceLinesStartingWith(t,"sensor_pin",`sensor_pin: ${this.getToolheadPin(this.getExtruderAxis(),"_sensor_pin")}`);let o=this.getToolboard()?.alternativePT1000Resistor??e.alternativePT1000Resistor,i=this.getToolboard()?.thermistorPullup??e.thermistorPullup,n="PT1000"===this.getThermistor()&&null!=o?o:i;return t=t.split("\n").some(e=>e.trim().startsWith("pullup_resistor"))?replaceLinesStartingWith(t,"pullup_resistor",`pullup_resistor: ${n}`):replaceLinesStartingWith(t,"sensor_type",`sensor_type: ${this.getThermistor()}
pullup_resistor: ${n}`),4700===n&&(t=replaceLinesStartingWith(t,"pullup_resistor: 4700",null)),t=t.split("\n").some(e=>e.trim().startsWith("nozzle_diameter"))?replaceLinesStartingWith(t,"nozzle_diameter",`nozzle_diameter: ${this.getNozzle().diameter}`):replaceLinesStartingWith(t,`[${this.getExtruderAxis()}]`,`[${this.getExtruderAxis()}]
nozzle_diameter: ${this.getNozzle().diameter}`),r.push(`# ${this.getToolCommand()} ${this.getHotend().title} definition (from RatOS/hotends/${this.getHotend().id}.cfg)`),r.push(t.trim()),r.join("\n")}renderExtruder(){let e=[];e.push(`# ${this.getToolCommand()} ${this.getExtruder().title} definition (from RatOS/extruders/${this.getExtruder().id}.cfg)`);let r=stripCommentLines(stripIncludes(stripDriverSections(readInclude(`extruders/${this.getExtruder().id}.cfg`))));return e.push((r=replaceLinesStartingWith(r,"[extruder]",`[${this.getExtruderAxis()}]`)).trim()),e.join("\n")}renderPartFan(e=!1,r){let t=[];if(e){let e=`part_fan_${this.getShortToolName()}`;t.push(`[fan_generic ${e}]`)}else t.push("[fan]");switch(this.getPartFan().id){case"2pin":this.requireControlboardPin("fan_part_cooling_pin"),t.push(`# 2-pin fan connected to 2-pin header on ${r.name} - input voltage pwm`),t.push(`pin: ${this.controlboardPins?.fan_part_cooling_pin}`);break;case"4pin":this.requireControlboardPin("fan_part_cooling_pin"),t.push(`# 4-pin fan connected to 2-pin header on ${r.name} - digital pwm`),t.push(`pin: !${this.controlboardPins?.fan_part_cooling_pin}`),t.push("cycle_time:  0.00004");break;case"4pin-dedicated":this.requireControlboardPin("4p_fan_part_cooling_pin"),t.push(`# 4-pin fan connected to 4-pin header on ${r.name} - digital pwm`),t.push(`pin: ${this.controlboardPins?.["4p_fan_part_cooling_pin"]}`),t.push("cycle_time:  0.00004"),this.controlboardPins?.["4p_fan_part_cooling_tach_pin"]!=null&&(t.push(`tachometer_pin: ^${this.controlboardPins?.["4p_fan_part_cooling_tach_pin"]}`),t.push("tachometer_poll_interval: 0.0005"));break;case"2pin-toolboard":this.requireToolboardPin("fan_part_cooling_pin"),t.push(`# 2-pin fan connected to 2-pin header on T${this.getTool()} (${this.getToolboard()?.name}) - input voltage pwm`),t.push(`pin: ${this.isToolboardPinInverted(this.toolboardPins?.fan_part_cooling_pin)?"!":""}${this.getPinPrefix()}${this.toolboardPins?.fan_part_cooling_pin}`);break;case"4pin-toolboard":this.requireToolboardPin("fan_part_cooling_pin"),t.push(`# 4-pin fan connected to 2-pin header on T${this.getTool()} (${this.getToolboard()?.name}) - digital pwm`),t.push(`pin: ${this.isToolboardPinInverted(this.toolboardPins?.fan_part_cooling_pin)?"":"!"}${this.getPinPrefix()}${this.toolboardPins?.fan_part_cooling_pin}`),t.push("cycle_time:  0.00004");break;case"4pin-dedicated-toolboard":this.requireToolboardPin("4p_fan_part_cooling_pin"),t.push(`# 4-pin fan connected to 4-pin header on T${this.getTool()} (${this.getToolboard()?.name}) - digital pwm`),t.push(`pin: ${this.isToolboardPinInverted(this.toolboardPins?.["4p_fan_part_cooling_pin"])?"!":""}${this.getPinPrefix()}${this.toolboardPins?.["4p_fan_part_cooling_pin"]}`),t.push("cycle_time:  0.00004"),this.toolboardPins?.["4p_fan_part_cooling_tach_pin"]!=null&&(t.push(`tachometer_pin: ^${this.isToolboardPinInverted(this.toolboardPins?.["4p_fan_part_cooling_tach_pin"])?"!":""}${this.toolboardPins?.["4p_fan_part_cooling_tach_pin"]}`),t.push("tachometer_poll_interval: 0.0005"));break;default:throw Error(`Unsupported part cooling fan option "${this.getHotendFan().title}"`)}return t.join("\n")}renderHotendFan(e){let r=[`[heater_fan toolhead_cooling_fan${this.getTool()>0?`_${this.getShortToolName()}`:""}]`,`heater: ${this.getExtruderAxis().toLocaleLowerCase()}`];switch(this.getHotendFan().id){case"2pin":this.requireControlboardPin("fan_toolhead_cooling_pin"),r.push(`# 2-pin fan connected to 2-pin header on ${e.name} - input voltage pwm`),r.push(`pin: ${this.controlboardPins?.fan_toolhead_cooling_pin}`);break;case"4pin":this.requireControlboardPin("fan_toolhead_cooling_pin"),r.push(`# 4-pin fan connected to 2-pin header on ${e.name} - digital pwm`),r.push(`pin: !${this.controlboardPins?.fan_toolhead_cooling_pin}`),r.push("cycle_time:  0.00004");break;case"4pin-dedicated":this.requireControlboardPin("4p_toolhead_cooling_tach_pin"),r.push(`# 4-pin fan connected to 4-pin header on ${e.name} - digital pwm`),r.push(`pin: ${this.controlboardPins?.["4p_toolhead_cooling_tach_pin"]}`),r.push("cycle_time:  0.00004"),this.controlboardPins?.["4p_toolhead_cooling_tach_pin"]!=null&&(r.push(`tachometer_pin: ^${this.controlboardPins?.["4p_toolhead_cooling_tach_pin"]}`),r.push("tachometer_poll_interval: 0.0005"));break;case"2pin-toolboard":this.requireToolboardPin("fan_toolhead_cooling_pin"),r.push(`# 2-pin fan connected to 2-pin header on T${this.getTool()} (${this.getToolboard()?.name}) - input voltage pwm`),r.push(`pin: ${this.isToolboardPinInverted(this.toolboardPins?.fan_toolhead_cooling_pin)?"!":""}${this.getPinPrefix()}${this.toolboardPins?.fan_toolhead_cooling_pin}`);break;case"4pin-toolboard":this.requireToolboardPin("fan_toolhead_cooling_pin"),r.push(`# 4-pin fan connected to 2-pin header on T${this.getTool()} (${this.getToolboard()?.name}) - digital pwm`),r.push(`pin: ${this.isToolboardPinInverted(this.toolboardPins?.fan_toolhead_cooling_pin)?"":"!"}${this.getPinPrefix()}${this.toolboardPins?.fan_toolhead_cooling_pin}`),r.push("cycle_time:  0.00004");break;case"4pin-dedicated-toolboard":this.requireToolboardPin("4p_toolhead_cooling_pin"),r.push(`# 4-pin fan connected to 4-pin header on T${this.getTool()} (${this.getToolboard()?.name}) - digital pwm`),r.push(`pin: ${this.isToolboardPinInverted(this.toolboardPins?.["4p_toolhead_cooling_pin"])?"!":""}${this.getPinPrefix()}${this.toolboardPins?.["4p_toolhead_cooling_pin"]}`),r.push("cycle_time:  0.00004"),this.toolboardPins?.["4p_toolhead_cooling_tach_pin"]!=null&&(r.push(`tachometer_pin: ^${this.isToolboardPinInverted(this.toolboardPins?.["4p_toolhead_cooling_tach_pin"])?"!":""}${this.toolboardPins?.["4p_toolhead_cooling_tach_pin"]}`),r.push("tachometer_poll_interval: 0.0005"));break;default:throw Error(`Unsupported hotend fan option "${this.getHotendFan().title}"`)}return r.join("\n")}renderToolheadMacro(){let e=null;if(this.getMotionAxis()===s.x?e=-1*this.printer.bedMargin.x[0]+2:this.getMotionAxis()===s.dual_carriage&&(e=this.size.x+this.printer.bedMargin.x[1]-2),null==e||isNaN(e))throw getLogger().debug("renderToolheadMacro:",this.printer.bedMargin.x[0],this.size,this.printer.bedMargin.x[1]),Error(`Failed to generate parking position for toolhead ${this.getToolCommand()}. Generated: ${e}`);let r=[`[gcode_macro ${this.getToolCommand()}]`,"variable_join: 0","variable_remap: 0",'variable_alert: ""','variable_filament_name: ""','variable_filament_type: ""',"variable_filament_temp: 0",'variable_runout_sensor: ""',`variable_active: ${0===this.getTool()?"True":"False"}`,`variable_color: "${0===this.getTool()?"7bff33":"0ea5e9"}"              # Used in frontends`,`variable_hotend_type: "${this.getHotend().flowType.toUpperCase()}"`,`variable_has_cht_nozzle: ${"CHT"===this.getNozzle().type?"True":"False"}`,"variable_cooling_position_to_nozzle_distance: 40                             # heatbreak length from cold zone to nozzle","variable_tooolhead_sensor_to_extruder_gear_distance: 15                      # distance in mm from the sensor to the extruder gear","variable_extruder_gear_to_cooling_position_distance: 30                      # distance in mm from the extruder gear to the end of the hotend cold zone","variable_filament_loading_nozzle_offset: -5","variable_filament_grabbing_length: 5","variable_filament_grabbing_speed: 1","variable_enable_insert_detection: True                                       # enables filament sensor insert detection ","variable_enable_runout_detection: True                                       # enables filament sensor runout detection ","variable_enable_clog_detection: True                                         # enables filament sensor clog detection ","variable_unload_after_runout: True                                           # unload filament after a runout has been detected","variable_purge_after_load: 0","variable_purge_before_unload: 0","variable_extruder_load_speed: 60","variable_filament_load_speed: 10","variable_standby: False","variable_temperature_offset: 0                                               # hotend temperature offset","variable_has_oozeguard: False                                                # toolhead has a oozeguard","variable_has_front_arm_nozzle_wiper: False                                   # toolhead has front arm nozzle wipers"];return"hybrid-corexy-idex"==this.printer.kinematics?r.push(`variable_loading_position: ${0===this.getTool()?e+25:e-25} # filament load x position`,`variable_parking_position: ${e} # parking x position`,"variable_resume_after_insert: True                                           # resumes the print after inserting new filament"):r.push("variable_resume_after_insert: False                                          # resumes the print after inserting new filament"),r.push("gcode:",`	{% set x = params.X|default(-1.0)|float %}`,`	{% set y = params.Y|default(-1.0)|float %}`,`	{% set z = params.Z|default(0.0)|float %}`,`	{% set s = params.S|default(1)|int %}`,`	{% if printer["gcode_macro _SELECT_TOOL"] is defined %}`,`		_SELECT_TOOL T=${this.getTool()} X={x} Y={y} Z={z} TOOLSHIFT={s}`,`	{% endif %}`),r.join("\n")}};let constructKlipperConfigUtils=async e=>{let r=e.toolheads.reduce((e,r)=>e+(r.toolboard?.driverCount??0),0),t=null!=e.controlboard.extruderlessConfig?1:0,o=e.printer.driverCountRequired>e.controlboard.driverCount,i=await parseBoardPinConfig(e.controlboard,o),n=await Promise.all(e.toolheads.map(async r=>{if(null==r.toolboard&&o)throw Error("A toolboard is required when using an extruderless controlboard configuration (your controlboard alone does not have enough drivers for this printer). Please add a toolboard to your configuration.");return await ToolheadGenerator.fromConfig(r,i,e.printer,e.size)}));return{extruderLessConfigBonus:t,isExtruderlessBoard:o,toolboardDriverCount:r,getControlboardPins:()=>({...i}),requireControlboardPin(e){if(null==this.getControlboardPins()[e])throw Error(`The controlboard has no "${e}" defined in its config.`)},isExtruderToolheadAxis:e=>n.some(r=>r.getExtruderAxis()===e),getToolhead:e=>{let r="number"==typeof e?n.find(r=>r.getTool()===e):n.find(r=>r.getExtruderAxis()===e||r.getMotionAxis()===e);if(null==r)throw Error(`No toolhead found for tool/axis ${e}`);return r},renderCommentHeader(e,r=[]){let t="------------------------------------------------------------------------------------------------------------",o=(t.length-e.length-2)/2,i=`#${"-".repeat(Math.floor(o))} ${e} ${"-".repeat(Math.ceil(o))}`;return[i,...r.length?r.concat(`#${t}`):[]]},getToolheads:()=>n.slice(),getRail(r){let t=e.rails.find(e=>e.axis===r);if(null==t)throw Error(`No rail found for axis ${r}`);return t},getRailPinValue(r,t,o=["controlboard","toolboard"],n=!0){let a=this.printerAxisToPinAliasPrefix(r)+"_"+(t.startsWith("_")?t.substring(1):t),s=null,l=this.getRail(r),d=this.isExtruderToolheadAxis(r)?this.getToolhead(r):null;if(this.isExtruderToolheadAxis(r)&&o.includes("toolboard")&&d?.hasToolboard())s=n?d.getToolheadPin(r,t):d.getPinFromToolboardAlias(a);else if(o.includes("controlboard")){let r=t.startsWith("_")?t.substring(1):t;if(null!=e.controlboard.motorSlots&&null!=l.motorSlot&&r in e.controlboard.motorSlots[l.motorSlot]){if(null==(s=e.controlboard.motorSlots[l.motorSlot][r]))throw Error(`Motor slot was selected, but pin ${r} wasn't found in motor slot config.`)}else s=i[a]}if(null==s)throw Error(`Pin name "${a}" constructed from axis "${r}" and alias "${t}" not found in board pin configs.`);return s},getAxisStepperName:e=>e===s.extruder?"extruder":e===s.extruder1?"extruder1":e===s.dual_carriage?"dual_carriage":"stepper_"+e,getAxisDriverType(e){return this.getRail(e).driver.type.toLowerCase()},getAxisDriverVariables(r,t=!1,o=[]){let i=e.rails.filter(e=>(t?e.axis.startsWith(r):e.axis===r)||o.includes(e.axis)),n=[];return n.push(`variable_${r}_driver_types: [${i.map(e=>`"${e.driver.type.toLowerCase()}"`).join(", ")}]`),n.push(`variable_${r}_axes: [${i.map(e=>`"${e.axis}"`).join(", ")}]`),n.join("\n")},isSensorless:e=>n.find(r=>r.getMotionAxis()===e)?.getXEndstop().id==="sensorless"||e===s.y&&n.some(e=>"sensorless"===e.getYEndstop().id),getAxisHomingSpeed(e){let r=this.getRail(e),t=this.isSensorless(e)?50:r.homingSpeed;return t},getAxisDriverSectionName(e){return`${this.getAxisDriverType(e)} ${this.getAxisStepperName(e)}`},getAxisVirtualEndstop(e){return`${this.getAxisDriverType(e)}_${this.getAxisStepperName(e)}:virtual_endstop`},getAxisDriverStallGuardThreshold(e,r){let t=this.getRail(e);return(r=Math.max(0,Math.min(1,r)),["TMC2130","TMC5160","TMC2240"].includes(t.driver.type))?`driver_SGT: ${Math.round(127*r)-64} # Lower value = higher sensitity, range -64 to 63`:`driver_SGTHRS: ${Math.round(255*r)} # Lower value = lower sensitivity, range 0 to 255`},getAxisDriverDiagConfig(e){return"UART"===this.getRail(e).driver.protocol?`diag_pin: ^${this.printerAxisToPinAliasPrefix(e)}_diag_pin`:"SPI"===this.getRail(e).driver.protocol?`diag1_pin: ^!${this.printerAxisToPinAliasPrefix(e)}_diag_pin`:""},getAxisDriverHomingCurrent(e,r){let t=this.getRail(e);return r=Math.max(0,Math.min(1,r)),.71*t.stepper.maxPeakCurrent*r},getExtruderPinPrefix(e=0){let r=this.getToolhead(e);if(null==r)throw Error(`No toolhead found for tool ${e}`);return r.getPinPrefix()},formatInlineComments(e,r="#"){let t=e.reduce((e,t)=>Math.max(e,t.substring(0,t.indexOf(r)).trim().length),0);return e.map(e=>{let o=e.indexOf(r),i=e.lastIndexOf(r);if((-1===o||e.trim().startsWith(r))&&i===o)return e;o!==i&&(o=e.indexOf(r,o+1));let n=e.substring(o),a=e.substring(0,o).trim(),s=t-a.length+2;return a+" ".repeat(s)+" "+n})},isPrinterAxis:e=>Object.values(s).includes(e),pinAliasPrefixToPrinterAxis(e){let r=I.safeParse(e);return r.success?r.data:null},printerAxisToPinAliasPrefix(e){let r=D.safeParse(e);if(r.success){if("e1"===r.data){if(this.getToolhead(1).hasToolboard())return"e";throw Error("No toolboard found for T1, e1 prefix is not supported")}return r.data}return null},getMotorComments(r,t,o){let i="object"==typeof r?r:e.rails.find(e=>e.axis===r);if(null==i)throw Error(`No rail found for axis ${r}`);let n=[`# ${i.axisDescription}`];if(!o){let r=this.isExtruderToolheadAxis(i.axis)?this.getToolhead(i.axis):null;r?.hasToolboard()?n.push(`# Connected to ${(r.getToolboard()||e.controlboard).name}`):i.motorSlot&&e.controlboard.motorSlots&&n.push(`# Connected to ${e.controlboard.motorSlots[i.motorSlot].title} on ${e.controlboard.manufacturer} ${e.controlboard.name}`),n.push(`# Driver: ${i.driver.title}`),n.push(`# Motor: ${i.stepper.title}`),n.push(`# Voltage: ${i.voltage}`)}return this.renderCommentHeader(t??i.axis.toUpperCase(),n)},getMotorPinComments(r,t,o){let i="object"==typeof r?r:e.rails.find(e=>e.axis===r);if(null==i)throw Error(`No rail found for axis ${r}`);let n=[];return i.motorSlot&&t.motorSlots&&n.push(`# Assigned to slot: "${t.motorSlots[i.motorSlot].title}"`),this.renderCommentHeader(o??i.axis.toUpperCase(),n)},getAccelWithType(r){let t="adxl345";if("controlboard"===r&&(e.controlboard?.ADXL345SPI!=null&&(t="adxl345"),e.controlboard?.LIS2DW!=null&&(t="lis2dw")),"toolboard_t0"===r||"toolboard_t1"===r){let e=n.find(e=>e.getToolboardName()===r)?.getToolboard();if(null==e)throw Error("No toolboard found for T0");null!=e.ADXL345SPI&&(t="adxl345"),null!=e.LIS2DW&&(t="lis2dw")}return"beacon"===r&&(t="beacon"),ej.parse({name:r,type:t})}}},constructKlipperConfigExtrasGenerator=(e,r)=>{let t=[],o=[];return{getFilesToWrite:()=>t.slice(),addFileToRender(e){t.push(e)},getReminders:()=>o.slice(),generateSaveVariables(r){let t=h.parse(process.env),o=["[Variables]"];return o.push("idex_applied_offset = 1",`idex_xcontrolpoint = ${r?.xcontrolpoint??e.size.x/2}`,"idex_xoffset = 0.0",`idex_ycontrolpoint = ${r?.ycontrolpoint??50}`,"idex_yoffset = 0.0",`idex_zcontrolpoint = ${r?.zcontrolpoint??50}`,"idex_zoffset = 0.0",`idex_zoffsetcontrolpoint = ${r?.zoffsetcontrolpoint??25}`,"nozzle_expansion_applied_offset = 0","nozzle_expansion_coefficient_t0 = 0.06","nozzle_expansion_coefficient_t1 = 0.06"),[{fileName:"ratos-variables.cfg",content:o.join("\n"),overwrite:!1}].map(e=>(this.addFileToRender(e),`[save_variables]
filename: ${v().join(t.KLIPPER_CONFIG_PATH,e.fileName)}`))},generateSensorlessHomingIncludes(){let t=[];if(r.isSensorless(s.x)&&t.push({fileName:"sensorless-homing-x.cfg",content:sensorlessXTemplate(e,r),overwrite:!1}),r.isSensorless(s.y)&&t.push({fileName:"sensorless-homing-y.cfg",content:sensorlessYTemplate(e,r),overwrite:!1}),t.length>0){let e=[];e.push("# REMEMBER TO TUNE SENSORLESS HOMING BEFORE ATTEMPTING TO PRINT!"),e.push("# You'll find instructions in the generated sensorless-homing-*.cfg file(s),","# where you should keep your sensorless homing settings."),this.addReminder(e.join("\n"))}return t.map(e=>(this.addFileToRender(e),`[include ${e.fileName}]`)).join("\n")},addReminder(e){o.push(e)}}},constructKlipperConfigHelpers=async(e,r,t)=>({renderToolboards(){return t.getToolheads().map(e=>e.renderToolboard(this.renderBoardPinAlias)).join("\n")},renderControlboard(){let r=["",this.renderBoardPinAlias(e.controlboard.id,e.controlboard),"","[mcu]",`serial: ${getBoardSerialPath(e.controlboard)}`];return e.controlboard.hasMcuTempSensor&&(r.push(""),r.push(`[temperature_sensor ${e.controlboard.name.replace(/\s/g,"_")}]`),r.push("sensor_type: temperature_mcu")),null!=e.controlboard.ADXL345SPI&&(r.push(""),r.push("[adxl345 controlboard]"),r.push(`cs_pin: ${e.controlboard.ADXL345SPI.cs_pin}`),"hardware"in e.controlboard.ADXL345SPI?r.push(`spi_bus: ${e.controlboard.ADXL345SPI.hardware.bus}`):(r.push(`spi_software_mosi_pin: ${e.controlboard.ADXL345SPI.software.mosi}`),r.push(`spi_software_miso_pin: ${e.controlboard.ADXL345SPI.software.miso}`),r.push(`spi_software_sclk_pin: ${e.controlboard.ADXL345SPI.software.sclk}`))),null!=e.controlboard.LIS2DW&&(r.push(""),r.push("[lis2dw controlboard]"),r.push(`cs_pin: ${e.controlboard.LIS2DW.cs_pin}`),"hardware"in e.controlboard.LIS2DW?r.push(`spi_bus: ${e.controlboard.LIS2DW.hardware.bus}`):(r.push(`spi_software_mosi_pin: ${e.controlboard.LIS2DW.software.mosi}`),r.push(`spi_software_miso_pin: ${e.controlboard.LIS2DW.software.miso}`),r.push(`spi_software_sclk_pin: ${e.controlboard.LIS2DW.software.sclk}`))),null!=e.controlboard.outputPins&&e.controlboard.outputPins.forEach(e=>{r.push(""),r.push(`[output_pin ${e.name}]`),r.push(`pin: ${e.pin}`),r.push(`value: ${e.value}`)}),r.join("\n")},renderBoards(){if(e.printer.driverCountRequired>e.controlboard.driverCount&&e.controlboard.driverCount+t.toolboardDriverCount+t.extruderLessConfigBonus<e.printer.driverCountRequired)throw Error("Your control and toolboard combination does not make up enough drivers for this printer.");let r=["[include RatOS/boards/rpi/config.cfg]",this.renderControlboard(),this.renderToolboards()];return r.join("\n")},renderStepperSections(){return e.rails.map(e=>this.renderStepperSection(e)).join("\n")},renderMotorSections(){let r=e.rails.map(e=>t.getMotorComments(e).join("\n")+"\n"+this.renderDriverSection(e,!0)+"\n"+this.renderStepperSection(e,!0));return r.push(this.renderBoardQuirks()),r.join("\n")},renderStepperSection(r,o=!1){let i="object"==typeof r?r:e.rails.find(e=>e.axis===r);if(null==i)throw Error(`No rail found for axis ${r}`);let n=o?[]:t.getMotorComments(i);if(n.push(`[${t.getAxisStepperName(i.axis)}]`,`step_pin: ${t.getRailPinValue(i.axis,"_step_pin")}`,`dir_pin: ${t.getRailPinValue(i.axis,"_dir_pin")}`,`enable_pin: !${t.getRailPinValue(i.axis,"_enable_pin")}`,`microsteps: ${i.microstepping}`,`full_steps_per_rotation: ${i.stepper.fullStepsPerRotation}`),i.axis===s.extruder||i.axis===s.extruder1){let e=t.getToolhead(i.axis);if(null==e)throw Error(`No toolhead found for ${i.axis}`);n.push(`rotation_distance: ${eg(e.getExtruder().id)}`)}else n.push(`rotation_distance: ${i.rotationDistance}`);if(i.axis===s.z&&n.push("position_min: -5"),[s.x,s.y,s.z,s.dual_carriage].includes(i.axis)&&n.push(`homing_speed: ${t.getAxisHomingSpeed(i.axis)}`),null!=i.gearRatio&&n.push(`gear_ratio: ${i.gearRatio}`),i.axis===s.z){let r=e.toolheads.find(e=>null!=e.probe);r?.probe!=null&&n.push("endstop_pin: probe:z_virtual_endstop")}return n.join("\n")+"\n"},renderUserStepperSections(r){return t.formatInlineComments(e.rails.map(e=>{let t=r[e.axis],{directionInverted:o,rotationComment:i,additionalLines:n}=t??{},a=null!=t&&"limits"in t?t.limits:null,s=null!=t&&"safeDistance"in t?t.safeDistance:void 0;return this.renderUserStepperSection(e.axis,o,a,s,i,n)}).join("\n").split("\n")).join("\n")},renderUserStepperSection(r,o=!1,i,n,a,l){let d="object"==typeof r?r:e.rails.find(e=>e.axis===r);if(null==d)throw Error(`No rail found for axis ${r}`);let c=o?`# Remove ! in front of pin name to reverse the direction of ${t.getAxisStepperName(d.axis)}`:`# Add ! in front of pin name to reverse the direction of ${t.getAxisStepperName(d.axis)}`,p="";(d.axis===s.extruder||d.axis===s.extruder1)&&(p=t.getExtruderPinPrefix(d.axis));let u=t.getMotorComments(d,void 0,!0).concat([`[${t.getAxisStepperName(d.axis)}]`,`dir_pin: ${o?"!":""}${p}${t.printerAxisToPinAliasPrefix(d.axis)}_dir_pin ${c}`]);if(d.axis===s.extruder||d.axis===s.extruder1){let e=t.getToolhead(d.axis);if(null==e)throw Error(`No toolhead found for ${d.axis}`);u.push(`rotation_distance: ${eg(e.getExtruder().id)} # ${e.getExtruder().title} default`)}else u.push(`rotation_distance: ${d.rotationDistance} ${a?`# ${a}`:""}`);if([s.x,s.y,s.z].includes(d.axis)&&u.push(`homing_speed: ${t.getAxisHomingSpeed(d.axis)}`),i){let r=d.axis!==s.y?e.printer.bedMargin.x[0]:e.printer.bedMargin.y[0],t=d.axis!==s.y?e.printer.bedMargin.x[1]:e.printer.bedMargin.y[1];Object.entries("function"==typeof i?i({min:r,max:t}):i).forEach(([e,r])=>{u.push(`position_${e}: ${d.axis===s.z&&"min"===e?Math.min(r,-5):r}`)})}return n&&u.push(`safe_distance: ${n}`),null!=l&&u.push(...l),u.join("\n")+"\n"},renderDriverSections(){let r=e.rails.map(e=>this.renderDriverSection(e));return r.push(this.renderBoardQuirks()),r.join("\n")},renderDriverSection(r,o=!1){let i="object"==typeof r?r:e.rails.find(e=>e.axis===r);if(null==i)throw Error(`No rail found for axis ${r}`);let n=findPreset(i.stepper,i.driver,i.voltage,i.current),a=o?[]:t.getMotorComments(i);if(a.push(`[${t.getAxisDriverSectionName(i.axis)}]`,`stealthchop_threshold: ${e.stealthchop?"9999999":e.standstillStealth?"1":"0"}`,`interpolate: ${i.microstepping<64||e.stealthchop?"True":"False"}`),"UART"===i.driver.protocol){if(i.motorSlot&&!(t.isExtruderToolheadAxis(i.axis)&&t.getToolhead(i.axis).hasToolboard())){let r=e.controlboard.motorSlots?.[i.motorSlot];if(null==r||!hasUART(e.controlboard.motorSlots?.[i.motorSlot]))throw Error(`No controlboard motor slot UART pins defined for motor slot ${i.motorSlot}`);Object.entries(W.parse(r)).forEach(([e,r])=>{a.push(`${e}: ${r}`)})}else a.push(`uart_pin: ${t.getRailPinValue(i.axis,"_uart_pin")}`)}if("SPI"===i.driver.protocol){if(i.motorSlot){let r=e.controlboard.motorSlots?.[i.motorSlot];if(null==r||!hasSPI(e.controlboard.motorSlots?.[i.motorSlot]))throw Error(`No controlboard motor slot SPI pins defined for motor slot ${i.motorSlot}`);Object.entries(V.parse(r)).forEach(([e,r])=>{a.push(`${e}: ${r}`)})}else{let r=t.getRailPinValue(i.axis,"_uart_pin");try{r=t.getRailPinValue(i.axis,"_cs_pin")}catch{}if(a.push(`cs_pin: ${r}`),t.isExtruderToolheadAxis(i.axis)){let e=t.getToolhead(i.axis).getToolboard();e?.stepperSPI!=null?"hardware"in e.stepperSPI?a.push(`spi_bus: ${e.stepperSPI.hardware.bus}`):(a.push(`spi_software_mosi_pin: ${t.getToolhead(i.axis).getPinPrefix()}${e.stepperSPI.software.mosi}`),a.push(`spi_software_miso_pin: ${t.getToolhead(i.axis).getPinPrefix()}${e.stepperSPI.software.miso}`),a.push(`spi_software_sclk_pin: ${t.getToolhead(i.axis).getPinPrefix()}${e.stepperSPI.software.sclk}`)):(a.push(`spi_software_mosi_pin: ${t.getToolhead(i.axis).getPinPrefix()}stepper_spi_mosi_pin`),a.push(`spi_software_miso_pin: ${t.getToolhead(i.axis).getPinPrefix()}stepper_spi_miso_pin`),a.push(`spi_software_sclk_pin: ${t.getToolhead(i.axis).getPinPrefix()}stepper_spi_sclk_pin`))}else null!=e.controlboard.stepperSPI?"hardware"in e.controlboard.stepperSPI?a.push(`spi_bus: ${e.controlboard.stepperSPI.hardware.bus}`):(a.push(`spi_software_mosi_pin: ${e.controlboard.stepperSPI.software.mosi}`),a.push(`spi_software_miso_pin: ${e.controlboard.stepperSPI.software.miso}`),a.push(`spi_software_sclk_pin: ${e.controlboard.stepperSPI.software.sclk}`)):(a.push("spi_software_mosi_pin: stepper_spi_mosi_pin"),a.push("spi_software_miso_pin: stepper_spi_miso_pin"),a.push("spi_software_sclk_pin: stepper_spi_sclk_pin"))}}if(n){let{driver:e,voltage:r,...t}=n;Object.entries(t).forEach(([e,r])=>{a.push(`${e}: ${r}`)})}else a.push(`run_current: ${i.current}`),"senseResistor"in i.driver&&a.push(`sense_resistor: ${i.driver.senseResistor}`);return a.join("\n")+"\n"},renderSpeedLimits(){let r=e.performanceMode&&e.printer.speedLimits.performance&&!e.stealthchop?e.printer.speedLimits.performance:e.printer.speedLimits.basic;return`[printer]
max_velocity: ${e.stealthchop?135:r.velocity}
max_accel: ${r.accel/(e.stealthchop?2:1)}
minimum_cruise_ratio: ${e.stealthchop?.25:.5}
max_z_velocity: ${e.stealthchop?10:r.z_velocity}
max_z_accel: ${r.z_accel}
square_corner_velocity: ${r.square_corner_velocity}

[gcode_macro RatOS]
variable_macro_travel_speed: ${this.getMacroTravelSpeed()}
variable_macro_travel_accel: ${this.getMacroTravelAccel()}`},getMacroTravelSpeed(){let r=e.performanceMode&&e.printer.speedLimits.performance?e.printer.speedLimits.performance:e.printer.speedLimits.basic;return e.stealthchop?"135":r.travel_velocity},getMacroTravelAccel(){let r=e.performanceMode&&e.printer.speedLimits.performance?e.printer.speedLimits.performance:e.printer.speedLimits.basic;return e.stealthchop?"1000":r.travel_accel},renderBoardQuirks(){let r=[];return e.controlboard.hasQuirksFiles&&(r.push("# Include controlboard quirk file"),t.getToolhead(s.extruder)?.getToolboard()!=null?r.push(`[include RatOS/boards/${e.controlboard.id}/quirks-toolboard.cfg]`):r.push(`[include RatOS/boards/${e.controlboard.id}/quirks.cfg]`)),t.getToolheads().forEach(e=>{let t=e.getToolboard();t?.hasQuirksFiles&&(r.push("# Include toolboard quirk file"),r.push(`[include RatOS/boards/${t.id}/quirks.cfg]`))}),r.join("\n")},renderHotend:()=>t.getToolheads().map(r=>r.renderHotend(e.controlboard)).join("\n"),renderExtruder:()=>t.getToolheads().map(e=>e.renderExtruder()).join("\n"),renderInputShaper(e){let r=[],o=t.getToolhead(s.x);[o.getYAccelerometerName(),o.getXAccelerometerName()].includes("rpi")&&(r.push("[include RatOS/sensors/rpi-adxl345.cfg]"),r.push(""));let i=t.getAccelWithType(o.getXAccelerometerName()),n=t.getAccelWithType(o.getYAccelerometerName());return r.push("[resonance_tester]"),"beacon"===i.type?r.push(`accel_chip_x: ${i.type}`):r.push(`accel_chip_x: ${i.type} ${i.name}`),"beacon"===n.type?r.push(`accel_chip_y: ${n.type}`):r.push(`accel_chip_y: ${n.type} ${n.name}`),r.push("probe_points:"),r.push(`	${e.x/2},${e.y/2},20`),r.join("\n")},renderProbeIncludes(){let e=[],r=t.getToolheads().find(e=>null!=e.getProbe());return r&&e.push(`[include RatOS/z-probe/${r.getProbe()?.id+".cfg"}]`),e.push(this.renderProbePinSection(!0)),e.join("\n")},renderProbePinSection(e=!1){let o=[],i=t.getToolheads().find(e=>null!=e.getProbe());if(i)switch(i.getProbe()?.id){case"bltouch":let n=i.getPinPrefix()+(e?i.getPinFromAlias("bltouch_control_pin"):"bltouch_control_pin"),a=i.getPinPrefix()+(e?i.getPinFromAlias("bltouch_sensor_pin"):"bltouch_sensor_pin");o.push("# BLTouch configuration"),o.push("[bltouch]"),o.push("control_pin: "+n),o.push("sensor_pin: ^"+a),e||o.push("z_offset: 0");break;case"beacon":if(!e){let e=[];e.push("# REMEMBER TO CALIBRATE YOUR BEACON!"),e.push("# Run BEACON_RATOS_CALIBRATE for automatic calibration."),r.addReminder(e.join("\n"))}break;default:let s=i.getPinPrefix()+(e?i.getPinFromAlias("probe_pin"):"probe_pin");o.push("# Probe configuration"),o.push("[probe]"),e||o.push("z_offset: 0.0 # Will be commented out after a successful PROBE_CALIBRATE and SAVE_CONFIG"),o.push(`pin: ^${s}# For NPN NC probes such as the Super Pinda / Vinda / SupCR / Decoprobe probes.`),e||(o.push(`#pin: ^!${s} # NPN NO (refer to the specs of your probe)`),o.push(`#pin: ${s} # PNP NO (refer to the specs of your probe)`),o.push(`#pin: !${s} # PNP NC (refer to the specs of your probe)`))}return o.join("\n")},renderZOffsetGuidance(r=""){let t=[];return e.toolheads.some(e=>e.probe?.id==="beacon")?(t.push("Z-offset calibration: run BEACON_RATOS_CALIBRATE to automatically calibrate your beacon for scan and contact."),t.push(`${r}IMPORTANT: Ensure the beacon is properly mounted and the nozzle and meltzone is clean by unloading`),t.push(`${r}the filament (if it's loaded) and make sure there's no ooze or gunk on the nozzle when the hotend is at printing temperature.`)):t.push("Z-offset calibration: https://www.klipper3d.org/Probe_Calibrate.html#calibrating-probe-z-offset"),t.join("\n")},renderEndstopSection(o){let i=[],n=t.getToolheads(),a="sensorless";if(n.forEach(e=>{if("sensorless"!==e.getXEndstop().id&&(i.push(""),i.push("# Physical X endstop configuration"),i.push(`[${e.getMotionStepperName()}]`),i.push(`endstop_pin: ${e.getXEndstopPin()}`),i.push("[gcode_macro RatOS]"),i.push('variable_homing_x: "endstop"')),"sensorless"!==e.getYEndstop().id){if("sensorless"==a)a=e.getYEndstopPin();else if(a!==e.getYEndstopPin())throw Error("Multiple toolheads configured with different y endstops is currently not supported.")}}),"sensorless"!==a&&(i.push(""),i.push("# Physical Y endstop configuration"),i.push("[stepper_y]"),i.push(`endstop_pin: ${a}`),i.push("[gcode_macro RatOS]"),i.push('variable_homing_y: "endstop"')),n.some(e=>"sensorless"===e.getXEndstop().id||"sensorless"===e.getYEndstop().id)){let n=e.printer.defaults.rails.find(e=>e.axis===s.x),a=e.printer.defaults.rails.find(e=>e.axis===s.dual_carriage),l=e.printer.defaults.rails.find(e=>e.axis===s.y);i.push(""),n&&l&&null!=o&&matchesDefaultRail(t.getRail(s.x),deserializePrinterRailDefinition(n),e.performanceMode)&&matchesDefaultRail(t.getRail(s.y),deserializePrinterRailDefinition(l),e.performanceMode)&&(null==a||matchesDefaultRail(t.getRail(s.dual_carriage),deserializePrinterRailDefinition(a),e.performanceMode))?i.push(`[include ${o}]`):i.push(r.generateSensorlessHomingIncludes())}if(t.getToolheads().every(e=>null==e.getProbe())){i.push(""),i.push("# Physical Z endstop configuration"),i.push("[stepper_z]");try{i.push(`endstop_pin: ${t.getRailPinValue(s.z,"_endstop_pin")}`)}catch(e){try{i.push(`endstop_pin: ${t.getRailPinValue(s.z,"_diag_pin")}`)}catch(e){i.push("# endstop_pin: <pin> # Override this with the correct pin in printer.cfg")}}i.push("position_endstop: -0.1"),i.push("second_homing_speed: 3.0"),i.push("homing_retract_dist: 3.0")}return i.join("\n")},renderMacroVariableOverrides(r){let o=[`variable_bed_margin_x: [${e.printer.bedMargin.x[0]}, ${e.printer.bedMargin.x[1]}]`,`variable_bed_margin_y: [${e.printer.bedMargin.y[0]}, ${e.printer.bedMargin.y[1]}]`],i=t.getToolheads(),n=i.some(e=>e.getMotionAxis()===s.dual_carriage);if(n){let e=i.find(e=>null!=e.getProbe())?.getTool();o.push(`variable_default_toolhead: ${e}                             # the toolhead with the z-probe, 0=left 1=right toolhead`);let r=`${t.getToolhead(0).getXAccelerometer()?.accelerometerType??"adxl345"} ${t.getToolhead(0).getYAccelerometerName()}`,n=`${t.getToolhead(1).getXAccelerometer()?.accelerometerType??"adxl345"} ${t.getToolhead(1).getYAccelerometerName()}`;o.push(`variable_adxl_chip: ["${r}", "${n}"]           # toolheads adxl chip names`),o.push(`variable_toolchange_travel_speed: ${this.getMacroTravelSpeed()}     # parking travel speed`),o.push(`variable_toolchange_travel_accel: ${this.getMacroTravelAccel()}     # parking travel accel`),o.push("variable_shaper_x_freq: [0, 0, 0, 0]                    # shaper frequency [T0, T1, COPY, MIRROR]"),o.push("variable_shaper_y_freq: [0, 0, 0, 0]                    # shaper frequency [T0, T1, COPY, MIRROR]"),o.push('variable_shaper_x_type: ["mzv", "mzv", "mzv", "mzv"]    # shaper frequency algorythm [T0, T1, COPY, MIRROR]'),o.push('variable_shaper_y_type: ["mzv", "mzv", "mzv", "mzv"]    # shaper frequency algorythm [T0, T1, COPY, MIRROR]')}return o.push(t.getAxisDriverVariables(s.x,"hybrid-corexy"!==e.printer.kinematics)),o.push(t.getAxisDriverVariables(s.y,!0,"hybrid-corexy"===e.printer.kinematics?[s.x1]:[])),o.push(t.getAxisDriverVariables(s.z,!0)),t.formatInlineComments(o).join("\n")},renderSaveVariables:e=>r.generateSaveVariables(e).join("\n"),renderControllerFan(){let r=[];if("none"===e.controllerFan.id)return r.push("# No controller fan configured"),r.join("\n");switch(r.push("[controller_fan controller_fan]"),e.controllerFan.id){case"2pin":t.requireControlboardPin("fan_controller_board_pin"),r.push(`# 2-pin fan connected to 2-pin header on ${e.controlboard.name} - input voltage pwm`),r.push(`pin: ${t.getControlboardPins().fan_controller_board_pin}`);break;case"4pin":t.requireControlboardPin("fan_controller_board_pin"),r.push(`# 4-pin fan connected to 2-pin header on ${e.controlboard.name} - digital pwm`),r.push(`pin: !${t.getControlboardPins().fan_controller_board_pin}`),r.push("cycle_time:  0.00004");break;case"4pin-dedicated":t.requireControlboardPin("4p_controller_board_pin"),r.push(`# 4-pin fan connected to 4-pin header on ${e.controlboard.name} - digital pwm`),r.push(`pin: ${t.getControlboardPins()["4p_controller_board_pin"]}`),r.push("cycle_time:  0.00004"),null!=t.getControlboardPins()["4p_controller_board_tach_pin"]&&(r.push(`tachometer_pin: ^${t.getControlboardPins()["4p_controller_board_tach_pin"]}`),r.push("tachometer_poll_interval: 0.0005"));break;default:throw Error(`Unsupported controller fan option "${e.controllerFan.title}"`)}return r.join("\n")},renderFans(){let r=[],o=t.getToolheads().filter(e=>e.getPartFan()).length>1;return r.push("# Part cooling fan"),o&&(r.push("# Multiple toolheads with part cooling fans configured"),r.push("# [fan] will use an unused io pin, proxy m106 settings to active toolhead via macro."),r.push("[fan]"),r.push("pin: rpi:gpio4         # sacrifical part fan, use this to independently control your both toolhead part fans")),r.push(t.getToolheads().map(r=>r.renderPartFan(o,e.controlboard)).join("\n")),r.push(""),r.push("# Hotend cooling fan"),r.push(t.getToolheads().map(r=>r.renderHotendFan(e.controlboard)).join("\n")),r.push(""),r.push("# Controller cooling fan"),r.push(this.renderControllerFan()),r.join("\n")},renderBoardPinAlias(e,r,o,i){let n=r.isToolboard?"toolboard":"controlboard",a=r.isToolboard?o?.getToolboardPins():t.getControlboardPins();if(null==a)throw Error(`No pins found for ${r.name}.`);let s={},l=Object.keys(O).map(e=>{let r=e.split("_"),o="dual"===r[0]?r[0]+"_"+r[1]:r[0],i=t.pinAliasPrefixToPrinterAxis(o);if(t.isPrinterAxis(i)&&-1!==Object.keys(U.shape).indexOf(e.replace(o+"_","")))try{let r=t.getRailPinValue(i,e.replace(o,""),[n],!1);return null==s[i]&&(s[i]=[]),s[i]?.push(`${e}=${r}`),null}catch(e){return null}return null==a[e]?e+"=null":e+"="+a[e]}).filter(Boolean),d=[`[board_pins ${e}]`];null!=i&&d.push(`mcu: ${i}`);let c=[];return Object.entries(s).forEach(([e,o])=>{null!=o&&t.isPrinterAxis(e)&&(c.push(t.getMotorPinComments(e,r,`${e.toUpperCase()} motor pins`).join("\n	")),c.push(o.join(",\n	")+","))}),d.push("aliases:",`	${c.join("\n	")}
	${t.renderCommentHeader("GENERAL PINS")}
	${l.join(",\n	")}`),d.join("\n")},renderBase:()=>"[include RatOS/homing.cfg]\n[include RatOS/macros.cfg]\n[include RatOS/shell-macros.cfg]",renderReminders:()=>r.getReminders().join("\n"),renderMacros:()=>t.formatInlineComments(t.getToolheads().flatMap(e=>e.renderToolheadMacro().split("\n"))).join("\n"),uncommentIf:e=>!0===e?"":"#"});var e2=t(44924),e4=t(80051),e5=t.n(e4);let e3=e5().forwardRef(({className:e,...r},t)=>c.jsx("strong",{ref:t,className:(0,e2.cn)("font-semibold",e),...r}));(0,e2.h)(e3,"Strong"),c.Fragment;let partFanOptions=(e,r)=>{let t=[];return(null==r||r?.axis===s.x||r?.axis===null)&&(t.push({id:"2pin",title:"Input Voltage PWM",badge:[{color:"purple",children:e?.controlboard?.name??"Control Board"}]}),t.push({id:"4pin",title:"Digital PWM on 2-pin port",badge:[{color:"purple",children:e?.controlboard?.name??"Control Board"}]})),e?.controlboard?.fourPinFanConnectorCount!=null&&e.controlboard.fourPinFanConnectorCount>0&&t.push({id:"4pin-dedicated",title:"Digital PWM on 4-pin port",badge:[{color:"purple",children:e.controlboard.name}]}),r?.toolboard!=null&&(t.push({id:"2pin-toolboard",title:"Input Voltage PWM",badge:[{color:"sky",children:`${r.toolboard.name}${null!=r.toolNumber&&` T${r.toolNumber}`}`}]}),t.push({id:"4pin-toolboard",title:"Digital PWM on 2-pin port",badge:[{color:"sky",children:`${r.toolboard.name}${null!=r.toolNumber&&` T${r.toolNumber}`}`}]}),r?.toolboard.fourPinFanConnectorCount!=null&&r.toolboard.fourPinFanConnectorCount>0&&t.push({id:"4pin-dedicated-toolboard",title:"Digital PWM on 4-pin port",badge:[{color:"sky",children:`${r.toolboard.name}${null!=r.toolNumber&&` T${r.toolNumber}`}`}]})),t},hotendFanOptions=(e,r)=>{let t=[];return(null==r||r?.axis===s.x)&&(t.push({id:"2pin",title:"Input Voltage PWM",badge:[{color:"purple",children:e?.controlboard?.name??"Control Board"}]}),t.push({id:"4pin",title:"Digital PWM on 2-pin port",badge:[{color:"purple",children:e?.controlboard?.name??"Control Board"}]})),(e?.controlboard?.fourPinFanConnectorCount!=null&&e.controlboard.fourPinFanConnectorCount>2||e?.controlboard?.fourPinFanConnectorCount!=null&&e.controlboard.fourPinFanConnectorCount>1&&e.controllerFan?.id!=="4pin-dedicated")&&t.push({id:"4pin-dedicated",title:"Digital PWM on 4-pin port",badge:[{color:"purple",children:e?.controlboard?.name??"Control Board"}]}),r?.toolboard!=null&&(t.push({id:"2pin-toolboard",title:"Input Voltage PWM",badge:[{color:"sky",children:`${r.toolboard.name}${null!=r.toolNumber&&` T${r.toolNumber}`}`}]}),t.push({id:"4pin-toolboard",title:"Digital PWM on 2-pin port",badge:[{color:"sky",children:`${r.toolboard.name}${null!=r.toolNumber&&` T${r.toolNumber}`}`}]}),r?.toolboard.fourPinFanConnectorCount!=null&&r.toolboard.fourPinFanConnectorCount>1&&t.push({id:"4pin-dedicated-toolboard",title:"Digital PWM on 4-pin port",badge:[{color:"sky",children:`${r.toolboard.name}${null!=r.toolNumber&&` T${r.toolNumber}`}`}]})),t},controllerFanOptions=(e,r)=>{let t=[{id:"2pin",title:"Input Voltage PWM",badge:[{color:"purple",children:e?.controlboard?.name??"Control Board"}]},{id:"4pin",title:"Digital PWM on 2-pin port",badge:[{color:"purple",children:e?.controlboard?.name??"Control Board"}]}];return(e?.controlboard?.fourPinFanConnectorCount!=null&&e.controlboard.fourPinFanConnectorCount>2||e?.controlboard?.fourPinFanConnectorCount!=null&&e.controlboard.fourPinFanConnectorCount>1&&!r?.some(e=>e?.hotendFan?.id==="4pin-dedicated"))&&t.push({id:"4pin-dedicated",title:"Digital PWM on 4-pin port",badge:[{color:"purple",children:e?.controlboard?.name??"Control Board"}]}),t.push({id:"none",title:"No fan"}),t};var e6=t(85525);let runSudoScript=(e,...r)=>{let t=getScriptRoot();return new Promise((o,i)=>{try{let n=(0,x.spawn)("sudo",[v().join(t,e),...r]),a="",s="";n.stdout.on("data",e=>{a+=e}),n.stderr.on("data",e=>{s+=e}),n.on("error",e=>{i(e)}),n.on("exit",e=>{0===e?o({stdout:a,stderr:s}):i("An error occured while attempting to run script: \n"+a+"\n"+s)}),n.on("close",e=>{0===e?o({stderr:s,stdout:a}):i(s)})}catch(e){if(e instanceof Error)return i(e.message);i("An error occured while attempting to run script")}})},e9=e6.rN.context().meta().create(),e8=e9.router,e7=e9.procedure,re=e9.middleware;var rr=t(74658);let rt=g.z.object({eventtime:g.z.number()}),ro=rt.extend({status:g.z.object({print_stats:g.z.object({state:g.z.union([g.z.literal("paused"),g.z.literal("printing"),g.z.literal("complete"),g.z.literal("error"),g.z.literal("canceled"),g.z.literal("standby")]).optional()})})}),ri=g.z.object({result:rt.passthrough()});!function(e){e[e.MOONRAKER_OFFLINE=0]="MOONRAKER_OFFLINE",e[e.MOONRAKER_INTERNAL_ERROR=1]="MOONRAKER_INTERNAL_ERROR"}(d||(d={}));let parseMoonrakerHTTPResponse=async(e,r)=>{if(200!==e.status){let r=await e.json();if(getLogger().error(r,"Moonraker internal error"),null!=r&&"object"==typeof r&&"error"in r&&"string"==typeof r.error){let e=Error(r.error);throw e.cause=1,e}let t=Error("Error fetching moonraker response");throw t.cause=0,t}let t=await e.json();try{let e=ri.parse(t);return{...e,result:r.parse(e.result)}}catch(e){throw getLogger().error("Error parsing moonraker response"),getLogger().error(t),e}},queryPrinterState=async()=>{try{let e=await fetch("http://localhost:7125/printer/objects/query?print_stats");if(e)return(await parseMoonrakerHTTPResponse(e,ro)).result.status.print_stats.state}catch(e){if(e instanceof Error&&(e.cause===d.MOONRAKER_OFFLINE||e.cause===d.MOONRAKER_INTERNAL_ERROR));else if(e instanceof g.jm);else throw e}return"error"},klipperRestart=async(e=!1)=>!!(e||["error","complete","canceled","standby",void 0].includes(await queryPrinterState()))&&(await fetch("http://localhost:7125/printer/restart",{method:"POST"}),!0),rn=g.z.object({boardPath:g.z.string().optional(),toolhead:eD.optional(),controlboard:K.optional()}),detect=(e,r)=>u().existsSync(getBoardSerialPath(e,r)),getBoards=async()=>{let e=el.get("boards");if(null!=e&&e.length>0)return e.map(e=>(e.detected=detect(e),e));let r=await (0,rr.zA)(`${process.env.RATOS_CONFIGURATION_PATH}/boards/*/board-definition.json`),t=r.map(e=>""===e.trim()?null:{...JSON.parse(u().readFileSync(e).toString()),path:Z.parse(e.replace("board-definition.json",""))}).filter(Boolean).map(e=>{e.detected=detect(e);try{return ee.parse(e)}catch(r){throw new e6.bR({code:"INTERNAL_SERVER_ERROR",message:`Invalid board definition for ${e.name} in ${e.path}`,cause:r})}});return el.set("boards",t),t},updateDetectionStatus=async(e,r)=>e.map(e=>(e.detected=detect(e,r),e)),compileFirmware=async(e,r,t)=>{let o=null,i=h.parse(process.env);try{let n=v().join(i.KLIPPER_DIR,".config");if(await (0,ei.copyFile)(v().join(e.path,"firmware.config"),n),e.isHost||await replaceInFileByLine(n,/CONFIG_USB_SERIAL_NUMBER=".+"/g,`CONFIG_USB_SERIAL_NUMBER="${getBoardChipId(e,r)}"`),t)return(0,p.readFileSync)(n).toString();let a=e.firmwareBinaryName,s=v().extname(a),l=v().join(i.KLIPPER_DIR,"out",`klipper${s}`),d=v().join(i.RATOS_DATA_DIR,a);if((0,p.existsSync)(d)&&await (0,ei.unlink)(d),o=await runSudoScript("klipper-compile.sh"),(0,p.existsSync)(l))await (0,ei.copyFile)(l,d);else if(!e.isHost)throw Error(`Could not find compiled firmware at ${l}`);return o}catch(t){let r=t instanceof Error?t.message:t;throw new e6.bR({code:"INTERNAL_SERVER_ERROR",message:`Could not compile firmware for ${e.name}: ${r} 

 ${o?.stdout}`,cause:t})}},getBoardsWithoutHost=e=>e.filter(e=>!e.isHost),getToolboards=e=>g.z.array(eo).parse(e.filter(e=>e.isToolboard)),getBoardsWithDriverCount=(e,r)=>e.filter(e=>e.driverCount>=r||null!=e.extruderlessConfig&&e.driverCount>=r-1),ra=re(async({ctx:e,next:r,meta:t,rawInput:o})=>{let i=null,n=null,a=rn.safeParse(o);try{i=await getBoards();try{n=a.success&&a.data.toolhead?new ToolheadHelper(await deserializeToolheadConfiguration(a.data.toolhead,{controlboard:a.data.controlboard},i)):void 0,i=await updateDetectionStatus(i,n)}catch(e){if(e instanceof g.jm)throw new e6.bR({code:"INTERNAL_SERVER_ERROR",message:`Toolhead configuration cannot be deserialized, please check the configuration.
${Object.entries(e.flatten().fieldErrors).map(([e,r])=>`${e}: ${r}`).join("\n")}`,cause:e});throw new e6.bR({code:"INTERNAL_SERVER_ERROR",message:"Toolhead configuration cannot be deserialized, please check the configuration.",cause:e})}t?.includeHost!==!0&&(i=getBoardsWithoutHost(i))}catch(e){if(e instanceof e6.bR)throw e;throw new e6.bR({code:"INTERNAL_SERVER_ERROR",message:`Invalid board definition(s) in ${process.env.RATOS_CONFIGURATION_PATH}/boards.`,cause:e})}let s=null;if(t?.boardRequired&&(!a.success||null==a.data.boardPath))throw new e6.bR({code:"PRECONDITION_FAILED",message:"boardPath parameter missing."});if(a.success&&null!=a.data.boardPath&&null==(s=i.find(e=>e.path===a.data.boardPath)))throw new e6.bR({code:"PRECONDITION_FAILED",message:`No supported board exists for the path ${a.data.boardPath}`});return r({ctx:{...e,boards:i,board:s,toolhead:n}})}),rs=e7.use(ra);e8({boards:rs.input(g.z.object({boardFilters:g.z.object({toolboard:g.z.boolean().optional(),driverCountRequired:g.z.number().optional()}).optional(),toolhead:eD.optional(),controlboard:K.optional()})).output(g.z.array(ee)).query(({ctx:e,input:r})=>{let t=e.boards;return r.boardFilters?.toolboard===!0&&(t=getToolboards(t)),r.boardFilters?.driverCountRequired!=null&&(t=getBoardsWithDriverCount(t,r.boardFilters.driverCountRequired)),t}),detect:rs.input(rn).meta({boardRequired:!0}).query(({ctx:e,input:r})=>{if(null==e.board)throw new e6.bR({code:"PRECONDITION_FAILED",message:`No supported board exists for the path ${r.boardPath}`});return detect(e.board,e.toolhead)}),unidentifiedDevices:rs.input(rn).query(async({ctx:e})=>{let r=e.boards.filter(e=>e.detected).map(r=>u().realpathSync(getBoardSerialPath(r,e.toolhead)));return(await (0,rr.zA)("/dev/serial/by-id/usb-Klipper*")).filter(e=>!r.includes(u().realpathSync(e)))}),boardVersion:rs.input(rn).meta({boardRequired:!0}).query(async({ctx:e,input:r})=>{if(null==e.board)throw new e6.bR({code:"PRECONDITION_FAILED",message:`No supported board exists for the path ${r.boardPath}`});if(null==process.env.KLIPPER_ENV||""===process.env.KLIPPER_ENV.trim())throw new e6.bR({code:"PRECONDITION_FAILED",message:"Environment variable KLIPPER_ENV is missing"});if(null==process.env.KLIPPER_DIR||""===process.env.KLIPPER_DIR.trim())throw new e6.bR({code:"PRECONDITION_FAILED",message:"Environment variable KLIPPER_DIR is missing"});let t=await queryPrinterState();if(!["error","complete","canceled","standby",void 0].includes(t))throw new e6.bR({code:"PRECONDITION_FAILED",message:`Printer is busy, board cannot be queried at this time without interrupting operations. Klipper print state reported as "${t}".`});let o=getScriptRoot(),i={stdout:""},n=null;try{await fetch("http://127.0.0.1:7125/machine/services/stop?service=klipper",{method:"POST"}),i=await (0,T.promisify)(x.exec)(`${v().join(process.env.KLIPPER_ENV,"bin","python")} ${v().join(o,"check-version.py")} ${getBoardSerialPath(e.board,e.toolhead)}`,{env:{KLIPPER_DIR:process.env.KLIPPER_DIR,NODE_ENV:"production"}})}catch(e){n=e}finally{await fetch("http://127.0.0.1:7125/machine/services/start?service=klipper",{method:"POST"})}if(n)throw new e6.bR({code:"INTERNAL_SERVER_ERROR",cause:n});return i.stdout.match(/Version:\s(v\d+\.\d+\.\d+-\d+-\w+)/)?.[1]}),compile:rs.input(g.z.object({boardPath:g.z.string(),toolhead:eD.optional()})).meta({boardRequired:!0}).mutation(async({ctx:e,input:r})=>{if(null==e.board)throw new e6.bR({code:"PRECONDITION_FAILED",message:`No supported board exists for the path ${r.boardPath}`});return await compileFirmware(e.board,e.toolhead),"success"}),reversePinLookup:rs.meta({boardRequired:!0}).input(g.z.object({axis:g.z.nativeEnum(s),canUseExtruderlessConfigs:g.z.boolean(),boardPath:g.z.string()})).query(async({ctx:e,input:r})=>{if(null==e.board)return;let t=null!=e.board.extruderlessConfig&&r.canUseExtruderlessConfigs,o=await parseBoardPinConfig(e.board,t),i=r.axis===s.z?"z0":r.axis===s.extruder?"e":s.extruder1===r.axis?"e1":r.axis;return reversePinLookup({step_pin:o[`${i}_step_pin`],dir_pin:o[`${i}_dir_pin`]},e.board)??null}),flashAllConnected:rs.meta({boardRequired:!1,includeHost:!0}).mutation(async({ctx:e})=>{let r=await getLastPrinterSettings(),t=r.toolheads.map(e=>new ToolheadHelper(e)),o=e.boards.flatMap(e=>{if(e.flashScript&&e.compileScript&&!0!==e.disableAutoFlash){if(detect(e))return{board:e,toolhead:null};let r=t.map(r=>detect(e,r)?{board:e,toolhead:r}:null).filter(Boolean);return r}return null}).filter(Boolean),i=[];for(let e of o)try{let r=er.parse(e.board);await compileFirmware(e.board,e.toolhead);let t=null;try{let o=v().join(r.path.replace(`${process.env.RATOS_CONFIGURATION_PATH}/boards/`,""),r.flashScript);t=e.toolhead?await runSudoScript("flash-path.sh",getBoardSerialPath(e.board,e.toolhead)):await runSudoScript("board-script.sh",o)}catch(o){let r=o instanceof Error?o.message:o;throw new e6.bR({code:"INTERNAL_SERVER_ERROR",message:`Could not flash firmware to ${e.board.name}: 

 ${t?.stdout??r}`,cause:o})}i.push({board:e.board,result:"success",message:`${e.board.manufacturer} ${e.board.name} on ${e.toolhead?` ${e.toolhead.getToolCommand()}`:""} was successfully flashed.`})}catch(t){let r=t instanceof Error?t.message:t;i.push({board:e.board,result:"error",message:"string"==typeof r?r:`Unknown error occured while flashing ${e.board.manufacturer} ${e.board.name} on ${e.toolhead?` ${e.toolhead.getToolCommand}`:""}`})}let n=i.filter(e=>"success"===e.result).length,a=`${n}/${o.length} connected board(s) flashed successfully.
`;return i.map(e=>{"error"===e.result?a+=`${e.board.manufacturer} ${e.board.name} failed to flash: ${e.message}
`:a+=`${e.board.manufacturer} ${e.board.name} was successfully flashed.
`}),{report:a,flashResults:i}}),flashViaPath:rs.input(g.z.object({boardPath:g.z.string(),flashPath:g.z.string().optional(),toolhead:eD.optional()})).meta({boardRequired:!0}).mutation(async({ctx:e,input:r})=>{if(null==e.board)throw new e6.bR({code:"PRECONDITION_FAILED",message:`No supported board exists for the path ${r.boardPath}`});if(null==e.board.flashScript)throw new e6.bR({code:"PRECONDITION_FAILED",message:`${e.board.name} does not support automatic flashing via serial path.`});if(r.flashPath&&!u().existsSync(r.flashPath))throw new e6.bR({code:"PRECONDITION_FAILED",message:`The path ${r.flashPath} does not exist.`});await compileFirmware(e.board,e.toolhead);let t=null;try{let o=v().join(e.board.path.replace(`${process.env.RATOS_CONFIGURATION_PATH}/boards/`,""),e.board.flashScript);t=r.flashPath?await runSudoScript("flash-path.sh",getBoardSerialPath(e.board,e.toolhead),r.flashPath):e.toolhead?await runSudoScript("flash-path.sh",getBoardSerialPath(e.board,e.toolhead)):await runSudoScript("board-script.sh",o)}catch(o){let r=o instanceof Error?o.message:o;throw new e6.bR({code:"INTERNAL_SERVER_ERROR",message:`Could not flash firmware to ${e.board.name}: 

 ${t?.stdout??r}`,cause:o})}if(!detect(e.board,e.toolhead))throw new e6.bR({code:"INTERNAL_SERVER_ERROR",message:`Could not flash firmware to ${e.board.name}, device did not show up at expected path.: 

 ${t.stdout}`});return"success"}),dfuDetect:rs.input(rn).meta({boardRequired:!0}).query(async({ctx:e,input:r})=>{let t=parseInt((await (0,T.promisify)(x.exec)('lsusb | grep "0483:df11" | wc -l')).stdout,10);if(1===t)return!0;if(t>1)throw new e6.bR({code:"PRECONDITION_FAILED",message:"Multiple DFU devices detected, please disconnect the other devices."});return!1}),dfuFlash:rs.input(rn).meta({boardRequired:!0}).mutation(async({ctx:e,input:r})=>{if(null!=e.board){if(null==e.board.dfu)throw new e6.bR({code:"PRECONDITION_FAILED",message:"Board does not support DFU."});try{await compileFirmware(e.board,e.toolhead)}catch(t){let r=t instanceof Error?t.message:t;throw new e6.bR({code:"INTERNAL_SERVER_ERROR",message:`Could not compile firmware for ${e.board.name}: 

 ${r}`,cause:t})}try{let r=await runSudoScript("dfu-flash.sh",getBoardSerialPath(e.board,e.toolhead));return r.stdout}catch(e){throw new e6.bR({code:"INTERNAL_SERVER_ERROR",message:"Failed to flash device",cause:e})}}})});let hasBeaconAccel=()=>{try{let e=(0,p.existsSync)("/dev/beacon")?(0,x.execSync)('udevadm info /dev/beacon | grep "ID_MODEL="').toString().trim():null;if(e&&e.endsWith("RevH"))return!0}catch(e){}return!1},xAccelerometerOptions=(e,r)=>{let t=[{id:"none",title:"None"},{id:"sbc",title:"Wired to Host Computer"}];return(e?.controlboard?.ADXL345SPI!=null||e?.controlboard?.LIS2DW!=null)&&t.push({id:"controlboard",title:"Wired to Controlboard"}),r?.toolboard!=null&&(null!=r.toolboard.ADXL345SPI||null!=r.toolboard.LIS2DW)&&t.push({id:"toolboard",title:"Integrated on toolboard"}),hasBeaconAccel()&&t.push({id:"beacon",title:"Beacon"}),t},yAccelerometerOptions=(e,r)=>{let t=[{id:"none",title:"None"},{id:"sbc",title:"Wired to Host Computer"}];return(e?.controlboard?.ADXL345SPI!=null||e?.controlboard?.LIS2DW!=null)&&t.push({id:"controlboard",title:"Wired to Controlboard"}),r?.toolboard!=null&&(null!=r.toolboard.ADXL345SPI||null!=r.toolboard.LIS2DW)&&t.push({id:"toolboard",title:"Integrated on toolboard"}),hasBeaconAccel()&&t.push({id:"beacon",title:"Beacon"}),t};var rl=t(97175);let rd=(0,rl.createProxy)(String.raw`/home/runner/work/RatOS-configurator/RatOS-configurator/src/hooks/usePrinterConfiguration.tsx`),{__esModule:rc,$$typeof:rp}=rd;rd.default,rd.PerformanceModeState,rd.StealthchopState,rd.StandstillStealthState,rd.ControllerFanState,rd.PrinterConfigurationState,rd.LoadablePrinterConfigurationState;let ru=rd.serializePrinterConfiguration;rd.serializePartialPrinterConfiguration,rd.useSerializedPrinterConfiguration,rd.usePrinterConfiguration;var rg=t(79812),rh=t.n(rg);function isNodeError(e){return e instanceof Error}let rm=(n=async(e,r)=>{let t=el.get(e);if(null!=t)return g.z.array(r).parse(t);let o=await (0,rr.zA)(`${process.env.RATOS_CONFIGURATION_PATH}/${e}/*.cfg`),i=(await Promise.all(o.map(e=>e.trim()).filter(e=>""!==e).map(async e=>{let t=await parseMetadata(e,r);return null==t?(getLogger().warn(`No metadata present in ${e} skipping..`),null):t}))).filter(e=>null!=e);return el.set(e,i),i},async(e,r)=>{let t=el.get(`${e}`);if(null==t){let t=ed.get(`${e}`);null==t&&(t=n(e,r),ed.set(`${e}`,t));let o=await t;return el.set(`${e}`,o),o}return t}),serializedPartialConfigFromPrinterDefinition=e=>e1.parse({printer:e.id,controlboard:e.defaults.board}),getPrinters=async(e=!1)=>{let r=(0,rr.zA)(`${process.env.RATOS_CONFIGURATION_PATH}/printers/*/printer-definition.json`),t=await rm("hotends",eT),o=await getBoards(),i={},n=(await Promise.all((await r).map(async e=>""===e.trim()?null:{...JSON.parse((await (0,ei.readFile)(e)).toString()),path:e.replace("printer-definition.json",""),id:e.replace("/printer-definition.json","").split("/").pop()}))).filter(Boolean);n.forEach(r=>{let n=serializedPartialConfigFromPrinterDefinition(r);i[r.id]=r.defaults.toolheads.map(async r=>{let i=(await t).find(e=>e.id===r.hotend);if(null==r.thermistor&&null!=i&&(r.thermistor=i.thermistor),null==r.nozzle&&(r.nozzle=getDefaultNozzle()),e){let e=await deserializeToolheadConfiguration(r,n,o);r=e}return r})});let a={};return await Promise.all(Object.keys(i).map(async e=>{let r=i[e];a[e]=await Promise.all(r)})),g.z.array(e?eU:eV).parse(n.map(e=>(e.defaults.toolheads=a[e.id],e)))},isPrinterCfgInitialized=async()=>{let e=h.parse(process.env);try{await (0,ei.access)(v().join(e.KLIPPER_CONFIG_PATH,"printer.cfg"),p.constants.F_OK)}catch(e){if(isNodeError(e)&&"ENOENT"===e.code)return!1;throw e}let r=await (0,ei.readFile)(v().join(e.KLIPPER_CONFIG_PATH,"printer.cfg"));return -1===r.indexOf("[include RatOS/printers/initial-setup.cfg]")},deserializeToolheadConfiguration=async(e,r,t)=>{let o=null==t?await getBoards():t,i=o.find(e=>e.id===r.controlboard),n=getToolboards(o),a=await rm("hotends",eT),s=await rm("extruders",eP),l=await rm("z-probe",eS),d=n.find(r=>r.id===e.toolboard)??null,c=xAccelerometerOptions({controlboard:i},{toolboard:d}),p=yAccelerometerOptions({controlboard:i},{toolboard:d}),u={...e,toolboard:d,hotend:a.find(r=>r.id===e.hotend),extruder:s.find(r=>r.id===e.extruder),probe:l.find(r=>r.id===e.probe),thermistor:ex.find(r=>r===e.thermistor),xEndstop:xEndstopOptions({controlboard:i},{toolboard:d,axis:e.axis}).find(r=>r.id===e.xEndstop),yEndstop:yEndstopOptions({controlboard:i},{toolboard:d,axis:e.axis}).find(r=>r.id===e.yEndstop),xAccelerometer:c.find(r=>r.id===e.xAccelerometer)??(d&&(null!=d.ADXL345SPI||d.LIS2DW)?c.find(e=>"toolboard"===e.id):null),yAccelerometer:p.find(r=>r.id===e.yAccelerometer)??(d&&(null!=d.ADXL345SPI||d.LIS2DW)?p.find(e=>"toolboard"===e.id):null),partFan:partFanOptions({controlboard:i},{toolboard:d,axis:e.axis}).find(r=>r.id===e.partFan),hotendFan:hotendFanOptions({controlboard:i},{toolboard:d,axis:e.axis}).find(r=>r.id===e.hotendFan)};return eF.parse(u)},deserializePartialToolheadConfiguration=async(e,r,t)=>{t=t??await getBoards();let o=t.find(e=>e.id===r?.controlboard),i=getToolboards(t),n=await rm("hotends",eT),a=await rm("extruders",eP),l=await rm("z-probe",eS),d=i.find(r=>r.id===e?.toolboard);return eI.parse({...e,toolboard:d??null,hotend:n.find(r=>r.id===e?.hotend),extruder:a.find(r=>r.id===e?.extruder),probe:l.find(r=>r.id===e?.probe),thermistor:ex.find(r=>r===e?.thermistor),xEndstop:xEndstopOptions({controlboard:o},{toolboard:d,axis:e?.axis??s.x}).find(r=>r.id===e?.xEndstop),yEndstop:yEndstopOptions({controlboard:o},{toolboard:d,axis:e?.axis??s.x}).find(r=>r.id===e?.yEndstop),xAccelerometer:xAccelerometerOptions({controlboard:o},{toolboard:d}).find(r=>r.id===e?.xAccelerometer),yAccelerometer:yAccelerometerOptions({controlboard:o},{toolboard:d}).find(r=>r.id===e?.yAccelerometer),partFan:partFanOptions({controlboard:o},{toolboard:d,axis:e?.axis??s.x}).find(r=>r.id===e?.partFan),hotendFan:hotendFanOptions({controlboard:o},{toolboard:d,axis:e?.axis??s.x}).find(r=>r.id===e?.hotendFan)})},deserializePartialPrinterConfiguration=async e=>{let r=await getBoards(),t=r.find(r=>r.id===e?.controlboard),o=e?.toolheads==null?void 0:await Promise.all(e.toolheads.map(async t=>await deserializePartialToolheadConfiguration(t,e,r)));return e0.parse({toolheads:o,printer:(await getPrinters()).find(r=>r.id===e?.printer),size:e?.size,controllerFan:controllerFanOptions({controlboard:t}).find(r=>r.id===e?.controllerFan),controlboard:t,performanceMode:e?.performanceMode,stealthchop:e?.stealthchop,standstillStealth:e?.standstillStealth,rails:e?.rails?.map(e=>deserializePrinterRail(e))})},deserializePrinterConfiguration=async e=>{let r=await getBoards(),t=r.find(r=>r.id===e?.controlboard),o=null==e.toolheads?void 0:await Promise.all(e.toolheads.map(t=>deserializeToolheadConfiguration(t,e,r)));return eQ.parse({toolheads:o,printer:(await getPrinters()).find(r=>r.id===e?.printer),size:e?.size,controllerFan:controllerFanOptions({controlboard:t}).find(r=>r.id===e?.controllerFan),controlboard:t,performanceMode:e?.performanceMode,stealthchop:e?.stealthchop,standstillStealth:e?.standstillStealth,rails:e?.rails.map(e=>deserializePrinterRail(e))})},getTimeStamp=()=>{let e=new Date,r=String(e.getDate()).padStart(2,"0"),t=String(e.getMonth()+1).padStart(2,"0"),o=e.getFullYear(),i=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0"),a=String(e.getSeconds()).padStart(2,"0");return`${o}${t}${r}_${i}${n}${a}`},portModifications=async(e,r)=>{if((0,p.existsSync)(e)){let t=await searchFileByLine(e,"#*# <---------------------- SAVE_CONFIG ---------------------->");!1!==t&&(r+="\n\n"+await extractLinesFromFile(e,t)+"\n")}return r},getFilesToWrite=async(e,r)=>{let o=await constructKlipperConfigUtils(e),i=constructKlipperConfigExtrasGenerator(e,o),n=await constructKlipperConfigHelpers(e,i,o),a=h.parse(process.env),{template:s,initialPrinterCfg:l}=await t(26004)(`./${e.printer.template.replace("-printer.template.cfg",".ts")}`),d=s(e,n).trim(),c=await portModifications(v().join(a.KLIPPER_CONFIG_PATH,"printer.cfg"),l(e,n).trim()),u=i.getFilesToWrite();return[{fileName:"RatOS.cfg",content:d,overwrite:!0,order:0},{fileName:"printer.cfg",order:1,content:c,overwrite:!await isPrinterCfgInitialized()}].concat(u).map(e=>{let t={...e,exists:!1,diskContent:null};return(r?.includes(t.fileName)||r?.includes("*"))&&(t.overwrite=!0),t.exists=(0,p.existsSync)(v().join(a.KLIPPER_CONFIG_PATH,t.fileName)),t.exists&&(t.diskContent=(0,p.readFileSync)(v().join(a.KLIPPER_CONFIG_PATH,t.fileName),"utf-8"),(0,p.existsSync)(v().join(a.RATOS_DATA_DIR,`last-${t.fileName}`))&&(t.lastSavedContent=(0,p.readFileSync)(v().join(a.RATOS_DATA_DIR,`last-${t.fileName}`),"utf-8"))),t})},generateKlipperConfiguration=async(e,r,t)=>{let o=h.parse(process.env),i=await getFilesToWrite(e,r),n=await Promise.all(i.map(async e=>{let r="created",i=v().join(o.KLIPPER_CONFIG_PATH,e.fileName),n=v().join(o.RATOS_DATA_DIR,`last-${e.fileName}`);try{if(await (0,ei.access)(i,p.constants.F_OK),!e.overwrite)return{fileName:e.fileName,action:"skipped"};{if(e.exists&&e.diskContent===e.content)return{fileName:e.fileName,action:"unchanged"};let t=`${e.fileName.split(".").slice(0,-1).join(".")}-${getTimeStamp()}.cfg`;try{await (0,ei.copyFile)(i,v().join(o.KLIPPER_CONFIG_PATH,t));let r=await (0,rr.zA)(v().join(o.KLIPPER_CONFIG_PATH,`${e.fileName.split(".").slice(0,-1).join(".")}-+([0-9])_+([0-9]).cfg`));if(r.length>0){let e=r.sort((e,r)=>{let t=new Date(e.split("-").slice(-1)[0].split(".cfg")[0]),o=new Date(r.split("-").slice(-1)[0].split(".cfg")[0]);return t.getTime()-o.getTime()});e.length>5&&await Promise.all(e.reverse().slice(0,e.length-5).map(e=>(getLogger().info(`Removing old backup: ${e}`),(0,ei.unlink)(e))))}}catch(r){return{fileName:e.fileName,action:"error",err:r}}r="overwritten"}}catch(r){if(!isNodeError(r)||"ENOENT"!==r.code)return{fileName:e.fileName,action:"error",err:r}}try{if(t?.includes(e.fileName))return{fileName:e.fileName,action:"skipped"};return await (0,ei.writeFile)(i,e.content),await (0,ei.writeFile)(n,e.content),{fileName:e.fileName,action:r}}catch(r){return{fileName:e.fileName,action:"error",err:r}}})),a=n.filter(e=>"error"===e.action);if(a.length>0)throw a.map(e=>getLogger().error(e)),Error("Something went wrong when saving the configuration. The following files couldn't be written: "+a.map(e=>e.fileName).join(", "));try{await savePrinterSettings(ru(e))}catch(e){throw Error("Couldn't backup your current printer settings to disk, but your klipper configuration has been generated.")}return n},compareSettings=async e=>{let r=h.parse(process.env),t=hasLastPrinterSettings()?await getFilesToWrite(await getLastPrinterSettings()):[],o=await getFilesToWrite(await deserializePrinterConfiguration(e)),i=await Promise.all(o.filter(e=>!e.exists||!t.some(r=>r.fileName===e.fileName)).map(async e=>{let r=new Date().getTime()+rh()(e);await (0,ei.writeFile)(`/tmp/ratos-added-new-${r}.cfg`,e.content);let t=await new Promise((e,t)=>{(0,x.exec)(`git diff --minimal --no-index /dev/null /tmp/ratos-added-new-${r}.cfg`,(r,o,i)=>{""==o.trim()&&t(i),e(o)})});return{fileName:e.fileName,diff:t,exists:e.exists,diskContent:e.diskContent??null,overwrite:e.overwrite,order:e.order,state:"created"}})),n=await Promise.all(t.filter(e=>e.exists&&!o.some(r=>r.fileName===e.fileName)).map(async e=>{let r=new Date().getTime()+rh()(e);await (0,ei.writeFile)(`/tmp/ratos-removed-old-${r}.cfg`,e.content);let t=await new Promise((e,t)=>{(0,x.exec)(`git diff --minimal --no-index /tmp/ratos-removed-old-${r}.cfg /dev/null`,(r,o,i)=>{""==o.trim()&&t(i),e(o)})});return{fileName:e.fileName,diff:t,exists:e.exists,diskContent:e.diskContent??null,overwrite:e.overwrite,order:e.order,state:"removed"}})),a=await Promise.all(o.filter(e=>e.exists&&t.some(r=>r.fileName===e.fileName&&(r.content!==e.content||null!=e.lastSavedContent&&r.content!==e.lastSavedContent))).map(async e=>{let o=t.find(r=>r.fileName===e.fileName);if(null==o)throw Error("This should never happen.");let i=new Date().getTime()+rh()(e),n=v().resolve(v().join(r.KLIPPER_CONFIG_PATH,o.fileName));o.exists||(n=`/tmp/ratos-changed-old-${i}.cfg`,await (0,ei.writeFile)(n,o.content)),await (0,ei.writeFile)(`/tmp/ratos-changed-new-${i}.cfg`,e.content);let a=await new Promise((e,r)=>{(0,x.exec)(`git diff --minimal --no-index ${n} /tmp/ratos-changed-new-${i}.cfg`,(t,o,i)=>{""==o.trim()&&r(i),e(o)})});return{fileName:e.fileName,diff:a,exists:e.exists,overwrite:e.overwrite,diskContent:e.diskContent??null,changedOnDisk:o.diskContent!==o.content,changedFromConfig:o.content!==e.content||null!=e.lastSavedContent&&o.content!==e.lastSavedContent,order:e.order,state:"changed"}})),s=await Promise.all(o.filter(e=>e.exists&&t.some(r=>r.fileName===e.fileName&&r.content===e.content&&(null==e.lastSavedContent||r.content===e.lastSavedContent))).map(async e=>{let o=t.find(r=>r.fileName===e.fileName);if(null==o)throw Error("This should never happen.");let i=null;if(o.diskContent!==o.content){let t=new Date().getTime()+rh()(e),n=v().resolve(v().join(r.KLIPPER_CONFIG_PATH,o.fileName));o.exists||(n=`/tmp/ratos-changed-old-${t}.cfg`,await (0,ei.writeFile)(n,o.content)),await (0,ei.writeFile)(`/tmp/ratos-changed-new-${t}.cfg`,e.content),i=await new Promise((e,r)=>{(0,x.exec)(`git diff --minimal --no-index ${n} /tmp/ratos-changed-new-${t}.cfg`,(t,o,i)=>{""==o.trim()&&r(i),e(o)})})}return{fileName:e.fileName,diff:i,exists:e.exists,overwrite:e.overwrite,diskContent:e.diskContent??null,changedOnDisk:o.diskContent!==o.content,changedFromConfig:o.content!==e.content||null!=e.lastSavedContent&&o.content!==e.lastSavedContent,order:e.order,state:"unchanged"}})),l=i.concat(n).concat(a).concat(s).sort((e,r)=>{if(null!=e.order||null!=r.order){if((e.order??9999)>(r.order??9999))return 1;if((e.order??9999)<(r.order??9999))return -1}return o.findIndex(r=>r.fileName===e.fileName)<o.findIndex(e=>e.fileName===r.fileName)?-1:o.findIndex(r=>r.fileName===e.fileName)>o.findIndex(e=>e.fileName===r.fileName)?1:e.fileName<r.fileName?-1:e.fileName>r.fileName?1:0});return l},loadSerializedConfig=async e=>{let r=await deserializePrinterConfiguration(await readSerializedConfig(e));return r},readSerializedConfig=async e=>{let r=await (0,ei.readFile)(e),t=eJ.parse(JSON.parse(r.toString()));return t},regenerateKlipperConfiguration=async(e,r,t)=>await generateKlipperConfiguration(await getLastPrinterSettings(e),r,t),getToolhead=async(e,r,t)=>{let o=extractToolheadFromPrinterConfiguration(r,await deserializePartialPrinterConfiguration(e??{}))??null;return null==o?null:!0===t?o.serialize():o},getToolheads=async(e,r)=>{let t=extractToolheadsFromPrinterConfiguration(await deserializePartialPrinterConfiguration(e??{}))??null;return null==t?null:!0===r?t.map(e=>e.serialize()):t};e8({getSavedConfig:e7.output(eJ.nullable()).query(async e=>{let r=await getLastPrinterSettings(void 0,!0);return r}),getSavedPrinterName:e7.output(g.z.string().nullable()).query(async e=>{let r=await getLastPrinterSettings(void 0,!0),t=(await getPrinters()).find(e=>e.id===r.printer);return null==t?null:t.manufacturer+" "+t.name}),printers:e7.output(g.z.array(eU)).query(async()=>(await getPrinters(!0)).sort((e,r)=>"Rat Rig"===e.manufacturer&&("Rat Rig"!==r.manufacturer||r.description.indexOf("Discontinued")>-1)?-1:e.name.localeCompare(r.name))),printer:e7.input(g.z.string()).output(eU.nullable()).query(async e=>{let r=(await getPrinters()).find(r=>r.id===e.input);return r?(r.defaults.toolheads=await Promise.all(r.defaults.toolheads.map(e=>deserializeToolheadConfiguration(e,serializedPartialConfigFromPrinterDefinition(r)))),eU.parse(r)):null}),hotends:e7.output(g.z.array(eT)).query(()=>rm("hotends",eT)),extruders:e7.output(g.z.array(eP)).query(()=>rm("extruders",eP)),probes:e7.output(g.z.array(eS)).query(()=>rm("z-probe",eS)),thermistors:e7.query(()=>ex.map(stringToTitleObject)),xEndstops:e7.input(g.z.object({config:e1.nullable(),toolOrAxis:eM})).output(g.z.array(eC)).query(async e=>xEndstopOptions(await deserializePartialPrinterConfiguration(e.input.config??{}),(await getToolhead(e.input.config,e.input.toolOrAxis))?.getConfig())),yEndstops:e7.input(g.z.object({config:e1.nullable(),toolOrAxis:eM})).output(g.z.array(eC)).query(async e=>yEndstopOptions(await deserializePartialPrinterConfiguration(e.input.config??{}),(await getToolhead(e.input.config,e.input.toolOrAxis))?.getConfig())),partFanOptions:e7.input(g.z.object({config:e1.nullable(),toolOrAxis:eM})).output(g.z.array(eE)).query(async e=>partFanOptions(await deserializePartialPrinterConfiguration(e.input.config??{}),(await getToolhead(e.input.config,e.input.toolOrAxis))?.getConfig())),hotendFanOptions:e7.input(g.z.object({config:e1.nullable(),toolOrAxis:eM})).output(g.z.array(eE)).query(async e=>hotendFanOptions(await deserializePartialPrinterConfiguration(e.input.config??{}),(await getToolhead(e.input.config,e.input.toolOrAxis))?.getConfig())),controllerFanOptions:e7.input(g.z.object({config:e1.nullable()})).output(g.z.array(eE)).query(async e=>controllerFanOptions(await deserializePartialPrinterConfiguration(e.input.config??{}),(await getToolheads(e.input.config))?.map(e=>e.getConfig()))),xAccelerometerOptions:e7.input(g.z.object({config:e1.nullable(),toolOrAxis:eM})).output(g.z.array(eN)).query(async e=>xAccelerometerOptions(await deserializePartialPrinterConfiguration(e.input.config??{}),(await getToolhead(e.input.config,e.input.toolOrAxis))?.getConfig())),yAccelerometerOptions:e7.input(g.z.object({config:e1.nullable(),toolOrAxis:eM})).output(g.z.array(eN)).query(async e=>yAccelerometerOptions(await deserializePartialPrinterConfiguration(e.input.config??{}),(await getToolhead(e.input.config,e.input.toolOrAxis))?.getConfig())),deserializeToolheadConfiguration:e7.input(g.z.object({config:eD,printerConfig:e1.optional()})).query(async e=>await deserializeToolheadConfiguration(e.input.config,e.input.printerConfig??{})),printercfgStatus:e7.query(async()=>({isInitialized:await isPrinterCfgInitialized()})),regenerateConfiguration:e7.input(g.z.object({overwriteFiles:g.z.array(g.z.string()).optional(),skipFiles:g.z.array(g.z.string()).optional()})).mutation(async({input:e})=>{let r=await regenerateKlipperConfiguration(void 0,e.overwriteFiles,e.skipFiles);return r.some(e=>"created"===e.action||"overwritten"===e.action)&&klipperRestart(),r}),getFilesToWrite:e7.input(g.z.object({config:eJ})).mutation(async e=>{let{config:r}=e.input;return await compareSettings(r)}),saveConfiguration:e7.input(g.z.object({config:eJ,overwriteFiles:g.z.array(g.z.string()).optional(),skipFiles:g.z.array(g.z.string()).optional()})).mutation(async e=>{let{config:r,overwriteFiles:t,skipFiles:o}=e.input,i=await deserializePrinterConfiguration(r),n=await generateKlipperConfiguration(i,t,o);return klipperRestart(),n}),flashBeacon:e7.mutation(async()=>{let e=h.parse(process.env),r=await runSudoScript(v().relative(getScriptRoot(),v().join(e.RATOS_CONFIGURATION_PATH,"scripts","beacon-update.sh")));if(r.stderr)throw Error(r.stderr);return r.stdout})});let rf=h.parse(process.env),rb=v().join(rf.RATOS_DATA_DIR,"last-printer-settings.json"),getLastPrinterSettings=async(e,r)=>{let t=e??rb;if(!(0,p.existsSync)(t))throw Error("Couldn't find printer settings file: "+t);return r?await readSerializedConfig(t):await loadSerializedConfig(t)},savePrinterSettings=async e=>await (0,ei.writeFile)(v().join(rf.RATOS_DATA_DIR,"last-printer-settings.json"),JSON.stringify(e)),hasLastPrinterSettings=()=>(0,p.existsSync)(rb),r_=(0,rl.createProxy)(String.raw`/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/_hooks/navigation.ts`),{__esModule:rx,$$typeof:rz}=r_;r_.default,r_.useLocalPathname,r_.useIsRouteActive,r_.useNavigation;let rv=r_.Redirecter;var ry=t(25609),rT=t(51990),rw=t.n(rT);t(3134);var rP=t(45650);let rS={title:{template:"%s - RatOS Configurator",default:"RatOS Configurator"}};function RootLayout({children:e}){return(0,rP.headers)().get("x-configurator"),c.jsx("html",{className:(0,ry.dV)("scrollable dark h-full overflow-y-scroll",rw().variable,rw().className),suppressHydrationWarning:!0,children:c.jsx("body",{className:"h-full bg-zinc-100 antialiased dark:bg-background",style:{marginRight:"0 !important"},children:c.jsx(rv,{hasLastPrinterSettings:hasLastPrinterSettings(),children:e})})})}},43962:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>Loading});var o=t(8632),i=t(23805);function Loading(){return o.jsx(i.I,{})}},4278:(e,r,t)=>{"use strict";t.r(r),t.d(r,{$$typeof:()=>a,__esModule:()=>n,default:()=>l});var o=t(97175);let i=(0,o.createProxy)(String.raw`/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/template.tsx`),{__esModule:n,$$typeof:a}=i,s=i.default,l=s},23805:(e,r,t)=>{"use strict";t.d(r,{I:()=>FullLoadScreen});var o=t(8632),i=t(25609);let Spinner=e=>(0,o.jsxs)("svg",{className:(0,i.m6)("h-5 w-5 animate-spin text-black/50 dark:text-white/50",e.noMargin?"":"-ml-1 mr-3",e.className),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-20",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:e.strokeWidth??4}),o.jsx("circle",{className:"opacity-100",cx:"12",cy:"12",r:"10",strokeDasharray:10*Math.PI/3,strokeLinecap:"round",stroke:"currentColor",strokeWidth:e.strokeWidth??4})]}),FullLoadScreen=e=>o.jsx("div",{className:(0,i.dV)("flex h-full w-full flex-1 items-center justify-center",e.className),children:o.jsx(Spinner,{className:"h-8 w-8"})})},44924:(e,r,t)=>{"use strict";t.d(r,{cn:()=>cn,h:()=>setDisplayName});var o=t(1418),i=t(25609);function cn(...e){return(0,i.m6)((0,o.clsx)(e))}function setDisplayName(e,r){e.displayName=r}},28361:(e,r,t)=>{"use strict";t.d(r,{Z:()=>o});let o={src:"/configure/_next/static/media/logo-white.6051cbc7.svg",height:443,width:1728,blurWidth:0,blurHeight:0}},3134:()=>{}};