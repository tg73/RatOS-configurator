"use strict";exports.id=3025,exports.ids=[3025,6523,2515],exports.modules={45488:(e,r,t)=>{t.d(r,{N:()=>i});let i={timestamp:!0,level:"info"}},22353:(e,r,t)=>{t.d(r,{M_:()=>searchFileByLine,Sw:()=>extractLinesFromFile,u5:()=>replaceInFileByLine,xg:()=>getScriptRoot});var i=t(57147),n=t(73292),a=t(22037),o=t(14521),l=t(36523);let getScriptRoot=()=>process.env.RATOS_SCRIPT_DIR??__dirname.split("configurator/")[0]+"configurator/scripts/",replaceInFileByLine=async(e,r,t)=>{if(!(0,i.existsSync)(e))throw Error("File does not exist: "+e);let s=(0,i.createReadStream)(e,{highWaterMark:1048576}),c=(0,i.createWriteStream)(e+".tmp",{flags:"w"}),p=(0,o.createInterface)({input:s,crlfDelay:1/0}),u=new Promise((e,r)=>{p.on("close",()=>{e(null)})}),f=0,w=0,g=0;try{for await(let i of p){g++;let n=i;r instanceof Function?n=r(i,g):null===t?(r instanceof RegExp?i.match(r):i.includes(r))&&(n=null):null==t?(0,l.getLogger)().warn(`replaceInFileByLine (${e}): replacer wasn't provided, writing line as is`):n=i.replace(r,t),null!==n?(c.write(n+a.EOL),n!==i&&f++):w++}}catch(r){throw(0,l.getLogger)().error(`replaceInFileByLine (${e}): error encountered during replace operation, original file will not be changed. ${r instanceof Error?r.message:r instanceof String?r:"Unknown error"}`),s.destroy(),c.destroy(),r}finally{p.close(),await u,await new Promise((e,r)=>{c.close(t=>{if(t)throw r(t);e(null)})}),await new Promise((e,r)=>{s.close(t=>{if(t)throw r(t);e(null)})})}return f+w>0&&await (0,n.copyFile)(e+".tmp",e),await (0,n.unlink)(e+".tmp"),{linesChanged:f,linesDeleted:w,linesTotal:g}},searchFileByLine=async(e,r)=>{if(!(0,i.existsSync)(e))throw Error("File does not exist: "+e);let t=(0,i.createReadStream)(e),n=(0,o.createInterface)({input:t,crlfDelay:1/0}),a=!1,l=0;for await(let e of n)!a&&(l++,(r instanceof RegExp?e.match(r):e.includes(r))&&(a=l));return await new Promise((e,r)=>{t.close(t=>{if(t)throw r(t);e(null)})}),a},extractLinesFromFile=async(e,r,t)=>{if(!(0,i.existsSync)(e))throw Error("File does not exist: "+e);let n=(0,i.createReadStream)(e),a=(0,o.createInterface)({input:n,crlfDelay:1/0}),l=[],s=0;for await(let e of a)++s>=r&&s<=(t??1/0)&&l.push(e);return await new Promise((e,r)=>{n.close(t=>{if(t)throw r(t);e(null)})}),l.join("\n")}},36523:(e,r,t)=>{t.d(r,{getLogger:()=>getLogger});var i=t(58545),n=t.n(i),a=t(81115),o=t(45488);let l=null,getLogger=()=>{if(null!=l)return l;let e=a.serverSchema.parse(process.env),r={target:"pino/file",options:{destination:e.LOG_FILE,append:!0}};return l=n()({...o.N,transport:r})}},98765:(e,r,t)=>{t.d(r,{$y:()=>o,Nd:()=>a,qR:()=>l});var i=t(56368);let n=i.initTRPC.context().meta().create(),a=n.router,o=n.procedure,l=n.middleware}};