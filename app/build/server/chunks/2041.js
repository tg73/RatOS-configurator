"use strict";exports.id=2041,exports.ids=[2041],exports.modules={16350:(e,r,a)=>{a.d(r,{z:()=>createADXL345Stream});var t=a(83926),s=a(89799),i=a(41060),n=a(46891),p=a(90345),o=a(1458),l=a(57314);let c=0,getSensorEndpoint=e=>{switch(e.type){case"adxl345":return"adxl345/dump_adxl345";case"beacon":return"beacon/dump_accel";case"lis2dw":return"lis2dw/dump_lis2dw";default:throw Error("Sensor type not supported. Must be 'adxl345', 'beacon', or 'lis2dw'")}},isSuccessResponse=e=>null!=e&&"object"==typeof e&&!("error"in e),isKlipperAccelSubscriptionResponse=e=>s.NI.safeParse(e).success,isKlipperAccelSubscriptionData=e=>isSuccessResponse(e)&&null!=e.params&&"data"in e.params&&Array.isArray(e.params.data)&&Array.isArray(e.params.data[0])&&4===e.params.data[0].length,isBeaconAccelSubscriptionData=e=>isSuccessResponse(e)&&null!=e.params&&Array.isArray(e.params)&&Array.isArray(e.params[0])&&4===e.params[0].length,detrendFloatSignal=e=>{let r=e.reduce((e,r)=>e+r,0)/e.length;for(let a=0;a<e.length;a++)e[a]-=r;return e},detrendBatch=e=>{let r=detrendFloatSignal(e.map(e=>e[1])),a=detrendFloatSignal(e.map(e=>e[2])),t=detrendFloatSignal(e.map(e=>e[3]));return e.map((e,s)=>[e[0],r[s],a[s],t[s]])},createADXL345Stream=(e,r)=>{let a=(0,l.jZ)({url:e,deserializer:e=>{try{return JSON.parse(e.data,(e,r,a)=>"0"===e&&"number"==typeof r&&a?.source!=null?(0,i.Z)(r):r)}catch(e){return(0,t.j)().error(e,"Error parsing JSON from klipper socket"),null}}}),s=a.multiplex(()=>({jsonrpc:"2.0",method:getSensorEndpoint(r),params:{sensor:r.name,response_template:{}},id:++c}),()=>null,e=>{if("result"in e&&isKlipperAccelSubscriptionResponse(e.result))return e.result.header,!1;if(isKlipperAccelSubscriptionData(e)||isBeaconAccelSubscriptionData(e))return!0;if(!isSuccessResponse(e))throw(0,t.j)().error(e,"Error in response from adxl345 subscription on klipper socket"),Error(`${e.error.error}: ${e.error.message}`);return!1}).pipe((0,n.B)(),(0,p.h)(e=>isKlipperAccelSubscriptionData(e)||isBeaconAccelSubscriptionData(e)),(0,o.U)(e=>{if(isBeaconAccelSubscriptionData(e))return{overflows:0,errors:0,data:detrendBatch(e.params)};if(isKlipperAccelSubscriptionData(e))return{...e.params,data:detrendBatch(e.params.data)};throw Error("Got invalid data from klipper accelerometer subscription.")}),(0,n.B)());return s.subscribe(),{dataStream$:s,close:()=>{a.complete.bind(a)()}}}},52485:(e,r,a)=>{a.d(r,{q:()=>createSignalBuffers});var t=a(41060),s=a(46891),i=a(328),n=a(94933),p=a(1458),o=a(68653),l=a(6704),c=a(95754),u=a(22212),d=a(22663),m=a(50509),b=a(63969),S=a(86619);let f=[100,200,400,800,1600,3200,6400,12800,25600,51200],createSignalBuffers=async e=>{let r=e.pipe((0,s.B)()),a=await (0,i.z)(r.pipe((0,n.P)(),(0,p.U)(e=>(0,t.Z)(e.data[0][0]).decimalPlaces(0,t.Z.ROUND_FLOOR).toNumber()))),h=performance.now(),A=r.pipe((0,o.b)(e=>(0,l.x)((0,c.D)(e.data),u.z)),(0,p.U)(([e,r,s,i])=>[(0,t.Z)(e).minus(a).shiftedBy(3),r,s,i]),(0,s.B)()),g=A.pipe((0,d.e)(1e3),(0,p.U)(e=>e.length<1?1:Math.floor(e.length/e[e.length-1][0].minus(e[0][0]).shiftedBy(-3).toNumber())),(0,m.x)(),(0,s.B)()),B=(0,l.x)(A.pipe((0,o.b)(e=>{let r=performance.now()-h,a=e[0].toNumber();return r<a?(0,b.of)(e).pipe((0,S.g)(a-r)):(0,b.of)(e)})),u.z),y=g.pipe((0,p.U)(e=>f.reduce((r,a)=>Math.abs(a-e)<Math.abs(r-e)?a:r,f[0])),(0,m.x)(),(0,s.B)());return{timeStamp:a,signal$:A,timeMappedSignal$:B,specSampleRate$:y,sampleRate$:g}}}};