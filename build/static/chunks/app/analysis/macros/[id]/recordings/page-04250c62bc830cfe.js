(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5795],{35825:function(e,r,n){Promise.resolve().then(n.bind(n,53901)),Promise.resolve().then(n.bind(n,56445))},53901:function(e,r,n){"use strict";n.r(r),n.d(r,{default:function(){return MacroRecordings},metadata:function(){return C}});var a=n(72612),i=n(23071),l=n(79978),o=n(39634),s=n(39164),t=n(41087),c=n(16195),d=n(65523),m=n(8058),u=n(31517),g=n(90077),h=n(94809),p=n(64827),x=n(79293),f=n(63562),b=n(94787),j=n(98948);function RecordingBulkActions(e){let{selection:r,onUpdate:n}=e,[i,l]=(0,s.useState)(!1),o=x.SX.analysis.deleteRecordings.useMutation();return(0,a.jsxs)("div",{className:"flex justify-end",children:[(0,a.jsxs)(p.h_,{children:[(0,a.jsx)(p.$F,{asChild:!0,children:(0,a.jsxs)(h.z,{variant:"plain",size:"sm",className:"flex data-[state=open]:bg-muted",children:[(0,a.jsx)(g.AjK,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Open menu"})]})}),(0,a.jsx)(p.AW,{align:"end",className:"w-[160px]",children:(0,a.jsxs)(p.Xi,{onClick:()=>l(!0),disabled:0===r.rows.length,children:["Delete ",r.rows.length>0?r.rows.length:""," ",1===r.rows.length?"Recording":"Recordings"]})})]}),(0,a.jsx)(f.aR,{open:i,children:(0,a.jsxs)(f._T,{children:[(0,a.jsxs)(f.fY,{children:[(0,a.jsx)(f.f$,{children:"Are you sure?"}),(0,a.jsxs)(f.yT,{children:["This action cannot be undone. This will permanently delete the ",r.flatRows.length," selected recordings."]})]}),(0,a.jsxs)(f.xo,{children:[(0,a.jsx)(f.le,{onClick:()=>l(!1),children:"Cancel"}),(0,a.jsx)(f.OL,{variant:"danger",onClick:async()=>{l(!1);try{var e;let n=await o.mutateAsync({macroId:r.rows[0].original.macroId,recordingIds:r.flatRows.map(e=>e.original.id)});if(n.success){n.recordingsRemoved!==r.flatRows.length&&((0,j.j)().error(n,"Failed to delete one or more macros"),b.A.error("Failed to delete one or more macros",{description:"An unknown error occurred and some of the recordings you marked for deletion seem to have disappeared from the database. This shouldn't happen. Please contact support."})),b.A.success("Recordings deleted!",{description:"".concat(n.recordingsRemoved," recording(s) were successfully deleted.")});return}(0,j.j)().error(n,"Failed to delete recordings"),b.A.error("Failed to delete recordings",{description:'\n												<div>\n													<p>An error occurred while deleting the selected recordings.</p>\n													<pre class="text-wrap mt-4 text-rose-400 font-medium whitespace-pre-wrap">'.concat(null!==(e=n.msg)&&void 0!==e?e:"Unknown error","</pre>\n												</div>\n											")})}catch(e){(0,j.j)().error({ids:r.rows.map(e=>e.original.id),macroId:r.rows[0].original.macroId,error:e},"Failed to delete recordings"),b.A.error("Failed to delete recordings",{description:'\n											<div>\n												<p>An error occurred while deleting the recordings.</p>\n												<pre class="text-wrap mt-4 text-rose-400 font-medium whitespace-pre-wrap">'.concat(e instanceof Error?e.message:e instanceof String?e:"Unknown error","</pre>\n											</div>\n										")})}null==n||n()},children:"Continue"})]})]})})]})}var w=n(82157),y=n.n(w);t.Zr.defaultLocale="en-GB";let R=t.ou.local().locale,v=[{id:"select",size:30,minSize:30,header:e=>{let{table:r}=e;return(0,a.jsx)(i.X,{checked:r.getIsAllPageRowsSelected()||r.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:e=>r.toggleAllPageRowsSelected(!!e),"aria-label":"Select all"})},cell:e=>{let{row:r}=e;return(0,a.jsx)(i.X,{checked:r.getIsSelected(),onCheckedChange:e=>r.toggleSelected(!!e),"aria-label":"Select row"})},enableSorting:!1,enableHiding:!1},{accessorKey:"macroRecordingRunId",header:"Macro Run ID",enableGrouping:!0,enableHiding:!1,enableSorting:!1},{id:"date",size:200,accessorKey:"startTimeStamp",header:e=>{let{column:r}=e;return(0,a.jsx)(l.p,{column:r,title:"Date"})},cell:e=>{let{row:r}=e,n=r.getLeafRows();0===n.length&&(n=[r]);let i=t.ou.fromMillis(n[0].original.startTimeStamp),l=t.ou.fromMillis(n[n.length-1].original.endTimeStamp),o=i.equals(l)?i.toFormat("yyyy-MM-dd HH:mm"):"".concat(i.toFormat("yyyy-MM-dd HH:mm")," - ").concat(l.toFormat("HH:mm")),s=t.ou.fromMillis(r.original.startTimeStamp).setLocale(R).toLocaleString({dateStyle:"long",timeStyle:"short"});return(0,a.jsx)("div",{className:"flex min-w-0",children:(0,a.jsx)("span",{title:o,className:"min-w-0 truncate",children:s})})},enableSorting:!0,sortingFn:(e,r)=>e.original.startTimeStamp-r.original.startTimeStamp,sortDescFirst:!0},{accessorKey:"name",size:600,header:e=>{let{column:r}=e;return(0,a.jsx)(l.p,{column:r,title:"Recording"})},cell:e=>{let{row:r}=e,n=[],i=[],l=r.getLeafRows();return 0===l.length&&(l=[r]),l.forEach(e=>{if(i.push(e.original.name),!n.find(r=>r.accel===e.original.accelerometer))switch(e.original.accelerometer){case"controlboard":n.push({accel:e.original.accelerometer,label:e.original.recordingHardwareName,color:"purple",icon:c.Z});break;case"rpi":n.push({accel:e.original.accelerometer,label:e.original.recordingHardwareName,color:"gray",icon:d.Z});break;case"toolboard_t0":n.push({accel:e.original.accelerometer,label:"".concat(e.original.recordingHardwareName," T0"),color:"sky",icon:m.Z});break;case"toolboard_t1":n.push({accel:e.original.accelerometer,label:"".concat(e.original.recordingHardwareName," T1"),color:"pink",icon:m.Z});break;case"beacon":n.push({accel:e.original.accelerometer,label:e.original.recordingHardwareName,color:"green",icon:u.Z})}}),(0,a.jsxs)("div",{className:"flex min-w-0 max-w-fit items-center gap-2 truncate font-medium",children:[n.map(e=>(0,a.jsx)(o.Ct,{color:e.color,children:e.label},e.label)),(0,a.jsx)(y(),{href:"/analysis/macros/".concat(r.original.macroId,"/recordings/").concat(r.original.macroRecordingRunId),className:"truncate font-medium hover:text-brand-400",children:i.length>1?i.slice(0,-1).join(", ")+" & "+i.slice(-1):i[0]})]})},filterFn:(e,r,n)=>{let a="".concat(e.original.name," ").concat(e.original.accelerometer," ").concat(e.original.recordingHardwareName);return Array.isArray(n)&&n.flat().some(e=>a.includes(e))},getFacetedOptions:()=>[{label:"Control Board",value:"controlboard",icon:c.Z},{label:"Host",value:"rpi",icon:d.Z},{label:"Tool Board T0",value:"toolboard_t0",icon:m.Z},{label:"Tool Board T1",value:"toolboard_t1",icon:m.Z},{label:"Beacon",value:"beacon",icon:u.Z}]},{id:"duration",size:200,header:e=>{let{column:r}=e;return(0,a.jsx)(l.p,{column:r,title:"Duration"})},cell:e=>{let{row:r}=e,n=r.getLeafRows();0===n.length&&(n=[r]);let i=t.nL.fromMillis(n[n.length-1].original.endTimeStamp-n[0].original.startTimeStamp).shiftTo("minutes","seconds").toHuman({unitDisplay:"short",maximumSignificantDigits:2});return(0,a.jsx)("div",{className:"flex min-w-0",children:(0,a.jsx)("span",{className:"min-w-0 truncate",children:i})})}},{id:"actions",size:25,header:e=>{let{table:r}=e;return(0,a.jsx)(RecordingBulkActions,{selection:r.getSelectedRowModel()})},cell:e=>{let{row:r}=e;return null}}];var S=n(58486),k=n(58818),N=n(74755),M=n(24360);/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let T=(0,M.Z)("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),C={title:"Macros",description:"User-modifiable macros for resonance analysis"};function MacroRecordings(e){var r;let{id:n}=e,[i]=x.SX.analysis.getRecordings.useSuspenseQuery({macroId:n}),[l]=x.SX.analysis.findMacro.useSuspenseQuery({id:n});(0,k.Ty)("Analysis Recordings",(0,s.useCallback)(e=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(e.MenubarMenu,{children:[(0,a.jsx)(e.MenubarTrigger,{className:"cursor-pointer",asChild:!0,children:(0,a.jsxs)("span",{onClick:()=>window.history.back(),children:[(0,a.jsx)(e.MenubarIcon,{Icon:N.Z}),(0,a.jsx)("span",{className:"hidden lg:inline",children:"Back"})]})}),(0,a.jsx)(e.MenubarContent,{className:"hidden"})]}),(0,a.jsxs)(e.MenubarMenu,{children:[(0,a.jsx)(e.MenubarTrigger,{asChild:!0,className:"cursor-pointer",children:(0,a.jsxs)(y(),{href:"/analysis/macros/".concat(n,"/edit"),children:[(0,a.jsx)(e.MenubarIcon,{Icon:T}),(0,a.jsx)("span",{className:"hidden lg:inline",children:"Edit"})]})}),(0,a.jsx)(e.MenubarContent,{className:"hidden"})]})]}),[n]));let o=i.result.map(e=>e.macroRecordingRunId).filter((e,r,n)=>n.indexOf(e)===r);return(0,a.jsxs)("div",{className:"flex h-full flex-1 flex-col space-y-8 p-8",children:[(0,a.jsx)("div",{className:"flex items-center justify-between space-y-2",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold tracking-tight",children:["Recordings for ",l.name]}),(0,a.jsxs)("p",{className:"text-base font-medium text-muted-foreground",children:["You have recorded ",i.result.length," sequence(s) over a total of ",o.length," run",1===o.length?"":"s"," for this macro so far."]})]})}),(0,a.jsx)(S.w,{data:null!==(r=i.result)&&void 0!==r?r:[],columns:v,initialGrouping:["macroRecordingRunId"],initialColumnVisibility:{macroRecordingRunId:!1},initialSorting:[{desc:!0,id:"date"}]})]})}}},function(e){e.O(0,[6545,9996,966,8965,5360,3790,453,2705,9754,3150,5591,6645,1778,1563,8367,7433,907,1087,9146,2842,4595,7652,6375,8888,3942,9321,8458,1744],function(){return e(e.s=35825)}),_N_E=e.O()}]);
//# sourceMappingURL=page-04250c62bc830cfe.js.map