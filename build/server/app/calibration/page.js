(()=>{var e={};e.id=8723,e.ids=[8723],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},38316:e=>{"use strict";e.exports=require("zod")},39491:e=>{"use strict";e.exports=require("assert")},50852:e=>{"use strict";e.exports=require("async_hooks")},14300:e=>{"use strict";e.exports=require("buffer")},32081:e=>{"use strict";e.exports=require("child_process")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},73292:e=>{"use strict";e.exports=require("fs/promises")},98188:e=>{"use strict";e.exports=require("module")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},14521:e=>{"use strict";e.exports=require("readline")},12781:e=>{"use strict";e.exports=require("stream")},71576:e=>{"use strict";e.exports=require("string_decoder")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},26144:e=>{"use strict";e.exports=require("vm")},71267:e=>{"use strict";e.exports=require("worker_threads")},16537:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GlobalError:()=>r.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>x,tree:()=>c});var n=i(30584),a=i(72023),s=i(16443),r=i.n(s),o=i(32055),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);i.d(t,l);let c=["",{children:["calibration",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(i.bind(i,46419)),"/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/calibration/page.tsx"]}]},{layout:[()=>Promise.resolve().then(i.bind(i,96217)),"/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/calibration/layout.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(i.bind(i,33374))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(i.bind(i,69113)),"/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/layout.tsx"],template:[()=>Promise.resolve().then(i.bind(i,4278)),"/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/template.tsx"],error:[()=>Promise.resolve().then(i.bind(i,43086)),"/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/error.tsx"],loading:[()=>Promise.resolve().then(i.bind(i,43962)),"/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/loading.tsx"],"not-found":[()=>Promise.resolve().then(i.t.bind(i,10540,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(i.bind(i,33374))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/calibration/page.tsx"],u="/calibration/page",m={require:i,loadChunk:()=>Promise.resolve()},x=new n.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/calibration/page",pathname:"/calibration",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},80348:(e,t,i)=>{Promise.resolve().then(i.bind(i,95729))},98966:(e,t,i)=>{"use strict";i.d(t,{k:()=>useGcodeCommand});var n=i(51495),a=i(99234);let useGcodeCommand=()=>{let e=(0,a.xH)("printer.gcode.script");return(0,n.useCallback)(async(t,...i)=>{let n=[t[0]];i.forEach((e,i)=>{n.push(e.toString(),t[i+1])});let a=n.join("");console.log(a);let s=await e.mutateAsync({script:a});console.log(s)},[])}},95729:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Page});var n=i(96603),a=i(41891),s=i(51495),r=i.n(s),o=i(83926),l=i(61418),c=i(55260),d=i(64933),u=i(18339),m=i(76871),x=i(19815);let p={pixelPrMm:160,outerNozzleDiameter:1,flipVertical:!1,flipHorizontal:!1},VaocSettingsDialog=e=>{let{settings:t,setSettings:i,isSettingsFetched:a}=e,r=(0,s.useRef)(!1),[o,h]=(0,s.useState)(a?t.pixelPrMm.toFixed(2):null),[f,g]=(0,s.useState)(a?t.outerNozzleDiameter.toFixed(2):null),b=(0,u.N)(i,200);return(0,s.useEffect)(()=>{a&&!1===r.current&&(h(t?.pixelPrMm.toFixed(2)??p.pixelPrMm.toFixed(2)),g(t?.outerNozzleDiameter.toFixed(2)??p.outerNozzleDiameter.toFixed(2)),r.current=!0)},[t,a]),(0,n.jsxs)(x.l,{className:(0,l.m6)("absolute left-5 top-1/2 max-h-[50%] w-80 -translate-y-1/2 scale-100 overflow-y-auto rounded-md border-y border-r border-zinc-800 bg-zinc-100 p-5 shadow-lg transition-all dark:bg-zinc-900/70",e.isVisible?"translate-x-0 opacity-100":"pointer-events-none -translate-x-8 opacity-0",e.className),onWheel:e=>{e.stopPropagation()},children:[(0,n.jsxs)("h3",{className:"flex flex-1 items-center justify-between text-base font-medium leading-7 text-zinc-900 dark:text-zinc-100",children:[n.jsx("span",{children:"Camera Settings"}),n.jsx(m,{className:"h-5 w-5 cursor-pointer",onClick:()=>e.toggle(!e.isVisible)})]}),(0,n.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-4 border-t border-zinc-100 pt-4 dark:border-zinc-800",children:[n.jsx(c.o,{label:"Pixel per mm",type:"number",value:o??"",placeholder:a?void 0:"Loading...",onChange:e=>{let t=parseFloat(e);h(e),isNaN(t)||b(e=>({...e??{},pixelPrMm:t}))},error:isNaN(parseFloat(o??""))?"Not a valid number":void 0}),n.jsx(c.o,{label:"Outer Nozzle Diameter",type:"number",step:.1,value:f??"",placeholder:a?void 0:"Loading...",onChange:e=>{let t=parseFloat(e);g(e),isNaN(t)||b(e=>({...e??{},outerNozzleDiameter:t}))},error:isNaN(parseFloat(f??""))?"Not a valid number":void 0}),n.jsx(d.Z,{label:"Flip vertical",onChange:e=>i({...t??p,flipVertical:e??!1}),description:"Whether to flip the camera vertically",value:t?.flipVertical??p.flipVertical}),n.jsx(d.Z,{label:"Flip horizontal",onChange:e=>i({...t??p,flipHorizontal:e??!1}),description:"Whether to flip the camera horizontally",value:t?.flipHorizontal??p.flipHorizontal})]})]})};var h=i(99234),f=i(24240);i(39686);let parseOptions=e=>{let t=e.matchAll(/- available option:\s(\w+)\s.+(\[-?\d+\.\.\d+\])/g),i=[];for(let e of t){let[t,n]=e[2].slice(1,-1).split("..").map(e=>parseInt(e,10)),a=i.find(t=>t.key===e[1]);a&&"max"in a&&a.max&&a.max<=n||i.push({key:e[1],min:t,max:["redbalance","bluebalance","greenbalance"].includes(e[1])?2e3:n})}let n=e.matchAll(/- available option:\s(\w+)\s.+(\[-?\d+\.\d+\.\.\d+\.\d+\])/g);for(let e of n){let[t,n]=e[2].slice(1,-1).split("..").map(e=>parseFloat(e)),a=i.find(t=>t.key===e[1]);a&&"max"in a&&a.max&&a.max<=n||i.push({key:e[1],float:!0,min:t,max:["redbalance","bluebalance","greenbalance"].includes(e[1])?2e3:n})}let a=e.matchAll(/- available option:\s(\w+)\s.+(\[false\.\.true\])/g);for(let e of a)i.push({key:e[1],toggle:!0});return i};var g=i(73992),b=i(41620);i(30928);var v=i(63728),y=i(54743),j=i(98966),w=i(25973),k=i(13836);let getCameraUrl=()=>{let e=(0,b.X)();return null==e||""==e.trim()?"/webcam":`http://${e}/webcam`},useUIState=()=>{throw Error("Can't use useUIState on the server")},useSpatialMapping=e=>{let{videoRef:t,containerRef:i,zoom:n,windowSize:a,settings:r}=e,[o,l]=(0,s.useState)([0,0]),c=(0,s.useCallback)(e=>{let i=t.current?.videoWidth??1,a=o[0];return e*n*(a>0&&i>0?a/i:1)},[t,o,n]),d=(0,s.useCallback)(e=>{let i=t.current?.videoWidth??1,a=o[0];return e/n/(a>0&&i>0?a/i:1)},[o,t,n]),u=(0,s.useCallback)(e=>c(e)*(r?.pixelPrMm??0),[c,r?.pixelPrMm,a]),m=(0,s.useCallback)(e=>d(e)/(r?.pixelPrMm??0),[d,r?.pixelPrMm]);return(0,w.Z)(i,e=>{if(e.contentRect.width>0&&e.contentRect.height>0)l([e.contentRect.width,e.contentRect.height]);else{let e=i.current?.getBoundingClientRect();e&&l([e?.width,e?.height])}}),{toScreen:u,toMillimeters:m,containerSize:o}},useGestures=e=>{let{gestureRef:t,setZoom:i,isConnected:n,canMove:a,toScreen:r,toMillimeters:o,zoom:l}=e,[c,d]=(0,s.useState)(null),[u,m]=(0,s.useState)({x:!1,y:!1}),x=(0,j.k)();return(0,y.useGesture)({onDrag:e=>{if(e.dragging)d([e.offset[0],e.offset[1]]),m({x:e._movementBound[0],y:e._movementBound[1]});else{let e=o(c?.[0]??0),t=-1*o(c?.[1]??0);x`_VAOC_MOVE X=${e} Y=${t}`,d(null),m({x:!1,y:!1})}},onPinch:e=>{i(t=>Math.max(Math.min(t*e.offset[0],10),1))},onWheel:e=>{0!=e.delta[1]&&!1!=e.wheeling&&!1!=e.intentional&&(e.delta[1]<0?i(e=>Math.max(.85*e,1)):i(e=>Math.min(1.15*e,10)))}},{target:t,enabled:n,drag:{enabled:a,from:()=>[0,0],bounds:{left:-r(1),right:r(1),top:-r(1),bottom:r(1)},rubberband:!0},wheel:{axis:"y",rubberband:!1},pinch:{scaleBounds:{min:1,max:10},pinchOnWheel:!1,rubberband:!0}}),{scaledDragOffset:{x:null==c?0:c[0]/l,y:null==c?0:c[1]/l},dragOffset:{x:null==c?0:c[0],y:null==c?0:c[1]},isDragging:null!=c,dragOutside:u}},useCrossHairState=e=>{let{toScreen:t,settings:i,containerSize:n}=e,a=e.snapshotDuration??200,r=(0,h.hS)("configfile"),o=(0,h.Q)(e=>({active:e["gcode_macro T0"].active}),"gcode_macro T0"),l=(0,h.Q)(e=>({active:e["gcode_macro T1"].active}),"gcode_macro T1"),c=o?.active?0:l?.active?1:0,[d]=(0,v.S)([e.isLockingCoordinates],a,!0),[u]=(0,v.I)([e.isLockingCoordinates],a-10,10,!0),m=r.data?.configfile.settings[0===c?"extruder":"extruder1"]?.nozzle_diameter,x=(0,s.useMemo)(()=>t((m??.4)/2),[m,t]),{outerNozzleDiameter:p}=i,f=e.isConnected&&null!=p&&null!=m,g=(0,s.useMemo)(()=>d?x:t(p?p/2:1),[t,d,x,p]),b=(0,s.useMemo)(()=>e.isConnected?g/n[0]*100:0,[e.isConnected,g,n]),y=(0,s.useMemo)(()=>e.isConnected?g/n[1]*100:0,[e.isConnected,g,n]),j=(0,s.useMemo)(()=>t(.01),[t]);return{canRender:f,nozzleRadius:isNaN(x)?0:x,outerNozzleRadius:isNaN(g)?0:g,outerNozzleRadiusPercentWidth:isNaN(b)?0:b,outerNozzleRadiusPercentHeight:isNaN(y)?0:y,crosshairStrokeWidth:isNaN(j)?0:j,delayedIsLockingCoordinates:u}},useVideoState=()=>{let[e,t]=(0,s.useState)(getCameraUrl());(0,s.useEffect)(()=>{e!==getCameraUrl()&&t(getCameraUrl())},[e]);let[i,n]=(0,s.useState)(null),[a,r]=(0,s.useState)(null),o=(0,s.useCallback)(e=>{e.framesPerSecond&&n(e.framesPerSecond),e.frameHeight&&e.frameWidth&&r(e.frameWidth/e.frameHeight)},[]);return{url:e,setUrl:t,fps:i,aspectRatio:a,onStreamStats:o}},useStreamSettings=({url:e,isConnected:t,settings:i,saveSettings:n,isInitialLoading:a,isFetched:r})=>{let[l,c]=(0,s.useState)([]),d=(0,s.useRef)(i);d.current=i;let u=(0,s.useMemo)(()=>l.map(e=>(e.value=d.current?.[e.key]?.value??e.value,"max"in e&&"ExposureTime"===e.key&&(e.min=0,e.max=6e4),e)),[l]),m=(0,s.useCallback)(async t=>{let i=await fetch(`${e}/option?compressionquality=${t}`);c(parseOptions(await i.text()))},[e]),x=(0,s.useCallback)(async(t,i)=>{let s=l.find(e=>e.key===t);if(null==s)throw Error(`Invalid option ${t}`);if(s&&"toggle"in s&&"boolean"!=typeof i)throw Error(`Expect a boolean value for ${t}, got ${i}`);if(s&&"max"in s&&("number"!=typeof i||s.min>i||s.max<i))throw Error(`Value ${i} is out of range for ${t}`);try{let s="boolean"==typeof i?i?1:0:i,r=await fetch(`${e}/option?${t}=${s.toString()}`);return r.ok&&!1===a&&((0,o.j)().info("saving",t,i,d.current,(0,g.T)(d.current??{},{[t]:{value:i}})),await n((0,g.T)(d.current??{},{[t]:{value:i}}))),r.ok}catch(e){return!1}},[l,e,a,n]);return(0,s.useEffect)(()=>{if(t&&m(100),t&&r&&null!=d.current)for(let t in d.current){let i=d.current[t]?.value,n="boolean"==typeof i?i?1:0:i;null!=n&&fetch(`${e}/option?${t}=${n.toString()}`)}},[r,e,t,m]),{options:u,setOption:x}};var C=i(88737),N=i(76690);let ExposureIcon=e=>(0,n.jsxs)("svg",{viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg",className:e.className,children:[n.jsx("path",{fill:"currentColor",d:"M456,40H56A16,16,0,0,0,40,56V456a16,16,0,0,0,16,16H456a16,16,0,0,0,16-16V56A16,16,0,0,0,456,40ZM72,72H417.373L72,417.373ZM440,440H94.627L440,94.627Z"}),n.jsx("polygon",{fill:"currentColor",points:"336 368 336 408 368 408 368 368 408 368 408 336 368 336 368 296 336 296 336 336 296 336 296 368 336 368"}),n.jsx("rect",{width:"112",height:"32",x:"112",y:"136",fill:"currentColor"})]});var z=i(94408),S=i(13738),V=i(18354),_=i(15998);let FocusControls=e=>{let t=(0,j.k)(),i=(0,h.Q)(e=>({z:e.motion_report.live_position?.[2]}),"motion_report");return n.jsx("div",{className:(0,l.m6)("scroll absolute left-0 right-0 transform-gpu overflow-y-auto rounded-md border-y border-r border-zinc-800 bg-zinc-100 font-mono shadow-lg transition-all dark:bg-zinc-900/70",e.isVisible?" -translate-y-full opacity-100":"pointer-events-none  -translate-y-[95%]  opacity-0",e.className),onWheel:e=>{e.stopPropagation()},children:(0,n.jsxs)("ol",{className:"flex flex-col divide-y divide-zinc-200 dark:divide-zinc-800",children:[n.jsx("li",{className:(0,l.dV)("flex"),children:n.jsx("div",{className:(0,l.dV)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z1`,type:"button",className:(0,l.m6)("flex flex-1 items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-700 hover:text-zinc-900 dark:text-zinc-300 dark:hover:text-zinc-100"),children:[(0,n.jsxs)("span",{className:"relative inline h-5 w-5 flex-shrink-0",children:[n.jsx(z.Z,{className:"absolute top-0.5 h-5 w-5","aria-hidden":"true"}),n.jsx(z.Z,{className:"absolute -top-1 h-5 w-5","aria-hidden":"true"})]}),n.jsx("span",{className:"inline",children:"+1.00"})]})})}),n.jsx("li",{className:(0,l.dV)("flex"),children:n.jsx("div",{className:(0,l.dV)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z0.5`,type:"button",className:(0,l.m6)("flex flex-1 items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-700 hover:text-zinc-900 dark:text-zinc-300 dark:hover:text-zinc-100"),children:[n.jsx(z.Z,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),n.jsx("span",{className:"inline",children:"+0.50"})]})})}),n.jsx("li",{className:(0,l.dV)("flex"),children:n.jsx("div",{className:(0,l.dV)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z0.1`,type:"button",className:(0,l.m6)("flex flex-1 items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-700 hover:text-zinc-900 dark:text-zinc-300 dark:hover:text-zinc-100"),children:[n.jsx(S.Z,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),n.jsx("span",{className:"inline",children:"+0.10"})]})})}),n.jsx("li",{className:(0,l.dV)("flex"),children:n.jsx("div",{className:(0,l.dV)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z0.05`,type:"button",className:(0,l.m6)("flex flex-1 items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-700 hover:text-zinc-900 dark:text-zinc-300 dark:hover:text-zinc-100"),children:[n.jsx(S.Z,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),n.jsx("span",{className:"inline",children:"+0.05"})]})})}),n.jsx("li",{className:(0,l.dV)("flex"),children:n.jsx("div",{className:(0,l.dV)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z0.01`,type:"button",className:(0,l.m6)("flex flex-1 items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-700 hover:text-zinc-900 dark:text-zinc-300 dark:hover:text-zinc-100"),children:[n.jsx(S.Z,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),n.jsx("span",{className:"inline",children:"+0.01"})]})})}),n.jsx("li",{className:(0,l.dV)("flex"),children:n.jsx("div",{className:(0,l.dV)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("span",{className:(0,l.m6)("flex flex-1 cursor-default items-center justify-center space-x-2 whitespace-nowrap bg-brand-500 px-5 py-3 text-sm font-medium text-zinc-900"),children:[n.jsx("span",{className:"inline h-5 w-5 flex-shrink-0 font-sans text-base font-semibold leading-[18px]",children:"Z"})," ",(0,n.jsxs)("span",{className:"inline",children:[(i?.z??0)>=0&&"+",i?.z?.toFixed(2)??"??"]})]})})}),n.jsx("li",{className:(0,l.dV)("flex"),children:n.jsx("div",{className:(0,l.dV)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z-0.01`,type:"button",className:(0,l.m6)("flex flex-1 items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-700 hover:text-zinc-900 dark:text-zinc-300 dark:hover:text-zinc-100"),children:[n.jsx(V.Z,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),n.jsx("span",{className:"inline",children:"-0.01"})]})})}),n.jsx("li",{className:(0,l.dV)("flex"),children:n.jsx("div",{className:(0,l.dV)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z-0.05`,type:"button",className:(0,l.m6)("flex flex-1 items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-700 hover:text-zinc-900 dark:text-zinc-300 dark:hover:text-zinc-100"),children:[n.jsx(V.Z,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),n.jsx("span",{className:"inline",children:"-0.05"})]})})}),n.jsx("li",{className:(0,l.dV)("flex"),children:n.jsx("div",{className:(0,l.dV)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z-0.1`,type:"button",className:(0,l.m6)("flex flex-1 items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-700 hover:text-zinc-900 dark:text-zinc-300 dark:hover:text-zinc-100"),children:[n.jsx(V.Z,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),n.jsx("span",{className:"inline",children:"-0.10"})]})})}),n.jsx("li",{className:(0,l.dV)("flex"),children:n.jsx("div",{className:(0,l.dV)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z-0.5`,type:"button",className:(0,l.m6)("flex flex-1 items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-700 hover:text-zinc-900 dark:text-zinc-300 dark:hover:text-zinc-100"),children:[n.jsx(_.Z,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),n.jsx("span",{className:"inline",children:"-0.50"})]})})}),n.jsx("li",{className:(0,l.dV)("flex"),children:n.jsx("div",{className:(0,l.dV)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z-1.0`,type:"button",className:(0,l.m6)("flex flex-1 items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-700 hover:text-zinc-900 dark:text-zinc-300 dark:hover:text-zinc-100"),children:[(0,n.jsxs)("span",{className:"relative inline h-5 w-5 flex-shrink-0",children:[n.jsx(_.Z,{className:"absolute bottom-0.5 h-5 w-5","aria-hidden":"true"}),n.jsx(_.Z,{className:"absolute -bottom-1 h-5 w-5","aria-hidden":"true"})]}),n.jsx("span",{className:"inline",children:"-1.00"})]})})})]})})};var O=i(15611);let R={duration:150},Button=e=>{let[t]=(0,O.u)(),[i,a]=r().useState(!1),o=(0,u.N)(a,200),c=(0,s.useCallback)(async()=>{e.onClick&&!e.isLoading&&(o(!0),await e.onClick(),o(!1))},[o,e]);return(0,n.jsxs)("li",{className:(0,l.dV)("relative flex"),children:["before"===e.subButtonPosition&&n.jsx("ol",{ref:t,className:"flex divide-x divide-zinc-200 dark:divide-zinc-800",children:e.children}),n.jsx("div",{className:(0,l.dV)("flex items-center",e.isActive&&"dark:bg-zinc-800"),children:(0,n.jsxs)("button",{onClick:c,type:"button",title:e.title,className:(0,l.m6)("flex items-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-700 transition-transform hover:text-black active:scale-95 dark:text-zinc-300 dark:hover:text-white",e.isActive?"hover:text-brand:600 text-brand-600 dark:text-brand-500 dark:hover:text-brand-500":"",e.hidden?"hidden":"",e.className),children:[e.icon&&(e.isLoading||i)&&n.jsx(f.$,{noMargin:!0,className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),e.icon&&!e.isLoading&&n.jsx(e.icon,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),e.name&&n.jsx("span",{className:"inline",children:e.name})]})}),null!=e.subButtonPosition&&"before"!==e.subButtonPosition&&n.jsx("ol",{ref:t,className:"flex divide-x divide-zinc-200 dark:divide-zinc-800",children:e.children}),null==e.subButtonPosition&&e.children&&e.children]},e.id)};function Toolbar(e){let[t]=(0,O.u)(R);return n.jsx("nav",{className:(0,l.m6)("flex select-none overflow-hidden rounded-md border border-zinc-200 bg-white shadow dark:border-zinc-800 dark:bg-zinc-900/80",e.className),"aria-label":"Breadcrumb",children:n.jsx("ol",{role:"list",className:"flex divide-x divide-zinc-200 dark:divide-zinc-800",ref:t,children:e.buttons.map(t=>{let i=e.subButtons?.filter(e=>e.parent===t.id);return t.hidden?null:(0,s.createElement)(Button,{...t,key:t.id},null!=i&&i.length>0&&t.isActive?i.map(e=>e.hidden?null:(0,s.createElement)(Button,{...e,key:e.id})):t.children)})})})}var A=i(35235);let Slider=({onChange:e,min:t,max:i,initialValue:a,step:r,isBoolean:o})=>{let[l,c]=(0,s.useState)(a??t),d=(0,u.N)((0,s.useCallback)(t=>{e?.(t)},[e]),100),m=(0,s.useCallback)(e=>{let t=r?parseFloat(e.target.value):parseInt(e.target.value,10);c(t),d(t)},[d,r]);return(0,n.jsxs)("div",{className:"relative mb-6",children:[n.jsx("input",{type:"range",value:l,onChange:m,min:t,max:i,step:r??1,className:"h-2 w-full cursor-pointer appearance-none rounded-lg bg-zinc-200 dark:bg-zinc-700"}),n.jsx("span",{className:"absolute -bottom-6 start-0 text-sm text-zinc-500 dark:text-zinc-400",children:o?"Off":`Min (${t})`}),!o&&n.jsx("span",{className:"absolute -bottom-6 start-1/3 -translate-x-1/2 text-sm text-zinc-500 dark:text-zinc-400 rtl:translate-x-1/2",children:(i/3).toFixed(2)}),!o&&n.jsx("span",{className:"absolute -bottom-6 start-2/3 -translate-x-1/2 text-sm text-zinc-500 dark:text-zinc-400 rtl:translate-x-1/2",children:(i/3*2).toFixed(2)}),n.jsx("span",{className:"absolute -bottom-6 end-0 text-sm text-zinc-500 dark:text-zinc-400",children:o?"On":`Max (${i})`})]})};var P=i(39238);let StreamSettingsDialog=e=>{let{url:t,isConnected:i,isAdvancedVisible:a,isColorVisible:s,isExposureVisible:r}=e,[o,c,d]=(0,h.Fu)("RatOS","camera-stream-settings"),{options:u,setOption:m}=useStreamSettings({url:t,isConnected:i,settings:o,saveSettings:c,isInitialLoading:d.isInitialLoading,isFetched:d.isFetched}),[p]=(0,O.u)();return n.jsx(x.l,{className:(0,l.dV)("absolute bottom-24 left-1/4 right-1/4 max-h-[50%] overflow-y-scroll overscroll-contain rounded-md bg-zinc-900/70",e.className),children:(0,n.jsxs)(P.E.div,{ref:p,children:[r&&u.filter(e=>e.key.toLowerCase().includes("gain")||e.key.toLowerCase().includes("exposure")||e.key.startsWith("Ae")||e.key.toLowerCase().includes("brightness")).filter(e=>"ColourGains"!==e.key).map(e=>(0,n.jsxs)("div",{className:"p-4",children:[n.jsx("label",{className:"block text-center text-base font-semibold capitalize text-zinc-200",children:e.key}),n.jsx(Slider,{isBoolean:"toggle"in e,min:"toggle"in e?0:"min"in e?e.min:0,initialValue:!0===e.value?1:!1===e.value?0:e.value,max:"toggle"in e?1:"max"in e?e.max:0,step:"float"in e&&e.float?"any":1,onChange:t=>m(e.key,"toggle"in e?!!t:t)})]},e.key)),s&&u.filter(e=>e.key.toLowerCase().includes("saturation")||e.key.toLowerCase().includes("contrast")||e.key.startsWith("Awb")).map(e=>(0,n.jsxs)("div",{className:"p-4",children:[n.jsx("label",{className:"block text-center text-base font-semibold capitalize text-zinc-200",children:e.key}),n.jsx(Slider,{isBoolean:"toggle"in e,min:"toggle"in e?0:"min"in e?e.min:0,initialValue:!0===e.value?1:!1===e.value?0:e.value,max:"toggle"in e?1:"max"in e?e.max:0,step:"float"in e&&e.float?"any":1,onChange:t=>m(e.key,"toggle"in e?!!t:t)})]},e.key)),a&&u.map(e=>(0,n.jsxs)("div",{className:"p-4",children:[n.jsx("label",{className:"block text-center text-base font-semibold capitalize text-zinc-200",children:e.key}),n.jsx(Slider,{isBoolean:"toggle"in e,min:"toggle"in e?0:"min"in e?e.min:0,initialValue:!0===e.value?1:!1===e.value?0:e.value,max:"toggle"in e?1:"max"in e?e.max:0,step:"float"in e&&e.float?"any":1,onChange:t=>m(e.key,"toggle"in e?!!t:t)})]},e.key))]})})},EnterFullscreenIcon=e=>n.jsx("svg",{...e,viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M2 2.5C2 2.22386 2.22386 2 2.5 2H5.5C5.77614 2 6 2.22386 6 2.5C6 2.77614 5.77614 3 5.5 3H3V5.5C3 5.77614 2.77614 6 2.5 6C2.22386 6 2 5.77614 2 5.5V2.5ZM9 2.5C9 2.22386 9.22386 2 9.5 2H12.5C12.7761 2 13 2.22386 13 2.5V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3H9.5C9.22386 3 9 2.77614 9 2.5ZM2.5 9C2.77614 9 3 9.22386 3 9.5V12H5.5C5.77614 12 6 12.2239 6 12.5C6 12.7761 5.77614 13 5.5 13H2.5C2.22386 13 2 12.7761 2 12.5V9.5C2 9.22386 2.22386 9 2.5 9ZM12.5 9C12.7761 9 13 9.22386 13 9.5V12.5C13 12.7761 12.7761 13 12.5 13H9.5C9.22386 13 9 12.7761 9 12.5C9 12.2239 9.22386 12 9.5 12H12V9.5C12 9.22386 12.2239 9 12.5 9Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"})}),ExitFullscreenIcon=e=>n.jsx("svg",{...e,viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M5.5 2C5.77614 2 6 2.22386 6 2.5V5.5C6 5.77614 5.77614 6 5.5 6H2.5C2.22386 6 2 5.77614 2 5.5C2 5.22386 2.22386 5 2.5 5H5V2.5C5 2.22386 5.22386 2 5.5 2ZM9.5 2C9.77614 2 10 2.22386 10 2.5V5H12.5C12.7761 5 13 5.22386 13 5.5C13 5.77614 12.7761 6 12.5 6H9.5C9.22386 6 9 5.77614 9 5.5V2.5C9 2.22386 9.22386 2 9.5 2ZM2 9.5C2 9.22386 2.22386 9 2.5 9H5.5C5.77614 9 6 9.22386 6 9.5V12.5C6 12.7761 5.77614 13 5.5 13C5.22386 13 5 12.7761 5 12.5V10H2.5C2.22386 10 2 9.77614 2 9.5ZM9 9.5C9 9.22386 9.22386 9 9.5 9H12.5C12.7761 9 13 9.22386 13 9.5C13 9.77614 12.7761 10 12.5 10H10V12.5C10 12.7761 9.77614 13 9.5 13C9.22386 13 9 12.7761 9 12.5V9.5Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"})});var T=i(12727),M=i(55467),Z=i(97269),E=i(82961),F=i(87333),$=i(65674),L=i(44506),H=i(46156),G=i(89530),q=i(21089),D=i(11476),B=i(71521),W=i(67415);let useToolbarState=e=>{let[t,i]=(0,s.useState)(!1),[n,a]=(0,s.useState)(!1),[r,o]=(0,s.useState)(!1),[l,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!1),[m,x]=(0,s.useState)(!1),[p,f]=(0,s.useState)(!1),[g,b]=(0,s.useState)(!1),[y,j]=(0,s.useState)(!1),[w,k]=(0,v.S)([e.zoom],2e3,!0),C=(0,s.useCallback)(()=>{b(e=>!e),k()},[k]),N=(0,h.Q)(e=>({x:e.motion_report.live_position?.[0],y:e.motion_report.live_position?.[1],z:e.motion_report.live_position?.[2]}),"motion_report"),z=(0,h.Q)(e=>({active:e["gcode_macro T0"].active}),"gcode_macro T0"),S=(0,h.Q)(e=>({active:e["gcode_macro T1"].active}),"gcode_macro T1"),{isVaocStarted:V}=(0,h.Q)(e=>({isVaocStarted:e["gcode_macro _VAOC"].is_started}),"gcode_macro _VAOC")??{isVaocStarted:!1},{hasZOffsetProbe:_}=(0,h.Q)(e=>({hasZOffsetProbe:null!=e.configfile.settings.z_offset_probe}),"configfile")??{hasZOffsetProbe:!1};return{livePosition:N,tool:z?.active?"T0":S?.active?"T1":null,isStartingVaoc:t,setIsStartingVaoc:i,isSettingsVisible:n,setIsSettingsVisible:a,isExposureVisible:r,setIsExposureVisible:o,isColorVisible:l,setIsColorVisible:c,isFocusVisible:d,setIsFocusVisible:u,isAdvancedVisible:m,setIsAdvancedVisible:x,light:p,setLight:f,isVaocStarted:V,isZoomExpanded:w||g,toggleIsZoomExpanded:C,hasZOffsetProbe:_,isZOffsetProbeVisible:_&&V,isCameraControlsVisible:y,setIsCameraControlsVisible:j}},Toolbars=e=>{let{canMove:t,isLockingCoordinates:i,setIsLockingCoordinates:a,zoom:r,setZoom:o,fps:l,url:c,isConnected:d,setSettings:u,settings:m,isSettingsFetched:x,isFullscreened:p}=e,{tool:h,isStartingVaoc:f,setIsStartingVaoc:g,isSettingsVisible:b,setIsSettingsVisible:y,isExposureVisible:w,setIsExposureVisible:k,isColorVisible:z,setIsColorVisible:S,isFocusVisible:V,setIsFocusVisible:_,isAdvancedVisible:O,setIsAdvancedVisible:R,light:P,setLight:I,isVaocStarted:X,isZoomExpanded:U,toggleIsZoomExpanded:Q,isZOffsetProbeVisible:Y,isCameraControlsVisible:J,setIsCameraControlsVisible:K}=useToolbarState({zoom:r}),ee=(0,j.k)(),et=(0,s.useCallback)(async(e,t)=>{try{let i=await e();return t?.success&&await t?.success?.(),i}catch(i){let e=t?.fallbackDescription??"Unknown error occured. Please try again.";i instanceof Error&&(e=i.message),D.A.error(t?.title??"Couldn't execute VAOC command",{description:`
				<div>
					<pre class="text-wrap mt-4 text-rose-400 font-medium whitespace-pre-wrap">${e}</pre>
				</div>
				`}),t?.error&&await t?.error?.()}finally{t?.always&&await t?.always()}},[]),[ei]=(0,v.S)([i],200,!0),[en,ea]=(0,s.useState)(!1),[es,er]=(0,s.useState)(!1),eo=[{icon:X?T.Z:M.Z,id:"start/stop",name:X?void 0:"Start Calibration",title:X?"Stop calibration":"Start calibration",onClick:async()=>{f||(X&&p&&e.toggleFullscreen?.(!1),g(!0),X&&(a(!0),await et(()=>ee`_VAOC_SET_TOOL`,{always:async()=>{a(!1)}})),et(()=>X?ee`_VAOC_END`:ee`_VAOC_START`,{always:async()=>{g(!1)},title:`Couldn't ${X?"stop":"start"} VAOC`,fallbackDescription:`Unknown error occured while ${X?"stopping":"starting"} VAOC. Please try again.`}))},isActive:X},{name:"T0",id:"t0",hidden:!X,title:"Switch to tool 0 (T0)",onClick:async()=>{a(!0),await et(()=>ee`_VAOC_SET_TOOL`,{always:async()=>{a(!1)}}),await et(()=>ee`_VAOC_LOAD_TOOL T=0`)},isActive:"T0"===h},{name:"T1",id:"t1",hidden:!X,title:"Switch to tool 1 (T1)",onClick:async()=>{a(!0),await et(()=>ee`_VAOC_SET_TOOL`,{always:async()=>{a(!1)}}),await et(()=>ee`_VAOC_LOAD_TOOL T=1`)},isActive:"T1"===h}],el=[{icon:Z.Z,id:"zoom",title:`${U?"Hide":"Show"} zoom controls`,subButtonPosition:"before",className:"font-mono",name:r>=10?"MAX!":(0,n.jsxs)(n.Fragment,{children:[n.jsx(A.ZP,{preserveValue:!0,start:0,end:Math.round(100*r),duration:.15}),"%"]}),onClick:()=>{Q()},isActive:U},{icon:P?E.Z:F.Z,id:"light",title:`${P?"Turn off":"Turn on"} the LEDs`,onClick:async()=>{let e=!P;await et(()=>ee`_VAOC_SWITCH_LED STATE=${e?1:0}`,{success:async()=>{I(e)}})},isActive:P},{icon:p?ExitFullscreenIcon:EnterFullscreenIcon,id:"fullscreen",title:`${p?"Exit":"Enter"} fullscreen mode`,onClick:()=>{e.toggleFullscreen&&e.toggleFullscreen()},isActive:p}],ec=(0,s.useMemo)(()=>[{name:"Settings",icon:$.Z,id:"settings",title:"Show camera settings dialog",onClick:()=>{y(e=>!e)},isActive:b},{name:"Calibrate Thermal Expansion",icon:L.Z,hidden:!X,isLoading:es||en,id:"calibrate-thermal-expansion",title:"Calibrates the thermal expansion coefficient for both toolheads",onClick:async()=>{er(!0)},isActive:t},{name:"Calibrate Z-offsets",icon:H.Z,title:"Probe the z endstop to set the Z offset for both hotends",id:"z-probe",hidden:!Y,onClick:async()=>{await et(()=>ee`_VAOC_CALIBRATE_Z_OFFSET`)},isActive:!1}],[b,X,es,en,t,Y,y,et,ee]),ed=(0,s.useMemo)(()=>{let e=[{icon:G.Z,name:n.jsx("span",{children:null==l?"Loading...":(0,n.jsxs)("span",{children:[n.jsx(A.ZP,{start:0,preserveValue:!0,duration:1,end:l})," FPS"]})}),className:"font-mono",id:"settings",subButtonPosition:"before",title:`${J?"Hide":"Show"} camera controls`,onClick:()=>{J?(_(!1),k(!1),S(!1),R(!1)):_(!1),K(e=>!e)},isActive:J},{icon:q.Z,id:"focus",hidden:!1,name:"Z Focus",title:`${V?"Hide":"Show"} focus controls`,children:n.jsx(FocusControls,{isVisible:V,toggle:_}),onClick:()=>{_(e=>!e),K(!1),k(!1),S(!1),R(!1)},isActive:V}];return e},[l,J,V,R,K,S,k,_]),eu=(0,s.useMemo)(()=>{let e=[{icon:ExposureIcon,id:"exposure",parent:"settings",hidden:z||O||V,title:`${w?"Hide":"Show"} exposure controls`,name:"Exposure",onClick:()=>{k(e=>!e),S(!1),R(!1),_(!1)},isActive:w},{icon:C,id:"color",parent:"settings",title:`${z?"Hide":"Show"} color controls`,hidden:w||O||V,name:"Color",onClick:()=>{S(e=>!e),k(!1),R(!1),_(!1)},isActive:z},{icon:N,id:"advanced-camera-controls",parent:"settings",title:`${O?"Hide":"Show"} advanced camera controls`,name:"Advanced",hidden:w||z||V,onClick:()=>{R(e=>!e),k(!1),S(!1),_(!1)},isActive:O}];return e.reverse()},[z,O,w,V,_,k,S,R]),em=es?n.jsx(B.u,{title:"Make sure nozzles are clean",body:"Clean nozzles and empty meltzones are important for accuracy",content:n.jsx(W.j,{title:"Important for accuracy",children:"Before proceeding, make sure that the nozzle is clean on both toolheads and that no filament is left in the meltzone. Oozing filament or dirty nozzles will cause inaccurate results."}),buttonLabel:"They're clean, i promise!",dismissText:"Abort",onClick:async()=>{ea(!0),await et(()=>ee`_VAOC_CALIBRATE_TEMP_OFFSET`,{title:"Failed thermal expansion calibration",fallbackDescription:"Unknown error occured while calibrating thermal expansion. Please try again.",always:async()=>{ea(!1)}})},onClose:()=>{setTimeout(()=>er(!1),200)}}):null;return(0,n.jsxs)(n.Fragment,{children:[n.jsx(Toolbar,{className:"pointer-events-auto absolute left-5 top-5",buttons:eo}),n.jsx(Toolbar,{className:"pointer-events-auto absolute bottom-5 right-5 overflow-visible",buttons:ed,subButtons:eu}),n.jsx(Toolbar,{className:"pointer-events-auto absolute right-5 top-5",buttons:el,subButtons:[{name:"1X",id:"1x",parent:"zoom",title:"Set zoom to 1X (100%)",className:"font-mono",onClick:()=>{o(()=>1)},isActive:!1},{name:"2X",id:"2x",parent:"zoom",title:"Set zoom to 2X (200%)",className:"font-mono",onClick:()=>{o(()=>2)},isActive:!1},{name:"4X",id:"4x",parent:"zoom",title:"Set zoom to 4X (400%)",className:"font-mono",onClick:()=>{o(()=>4)},isActive:!1}]}),n.jsx(Toolbar,{className:"pointer-events-auto absolute bottom-5 left-5",buttons:ec}),n.jsx(VaocSettingsDialog,{className:"pointer-events-auto",isVisible:b,toggle:y,settings:m,isSettingsFetched:x,setSettings:u}),n.jsx(StreamSettingsDialog,{className:"pointer-events-auto",url:c,isConnected:d,isExposureVisible:w,isColorVisible:z,isAdvancedVisible:O}),em]})},SafetyVisualization=({gestureState:e})=>(0,n.jsxs)(n.Fragment,{children:[n.jsx("div",{className:(0,l.dV)("absolute inset-0",e.dragOutside.x&&e.dragOutside.x>0?"left-0 right-2/3 bg-gradient-to-r from-red-500/70 to-red-500/0":"left-2/3 right-0 bg-gradient-to-l from-red-500/70 to-red-500/0"),style:{opacity:e.dragOutside.x?Math.abs(e.dragOutside.x-e.dragOffset.x)/200:0,transform:`translateX(${e.scaledDragOffset.x}px) translateY(${e.scaledDragOffset.y}px)`}}),n.jsx("div",{className:(0,l.dV)("absolute inset-0",e.dragOutside.y&&e.dragOutside.y>0?"bottom-2/3 top-0 bg-gradient-to-b from-red-500/70 to-red-500/0":"bottom-0 top-2/3 bg-gradient-to-t from-red-500/70 to-red-500/0"),style:{opacity:e.dragOutside.y?Math.abs(e.dragOutside.y-e.dragOffset.y)/200:0,transform:`translateX(${e.scaledDragOffset.x}px) translateY(${e.scaledDragOffset.y}px)`}})]}),FillViewport=e=>n.jsx("div",{className:(0,l.dV)("pointer-events-none absolute inset-0 flex items-center justify-center",e.className),children:e.children}),FillVideoFrame=e=>n.jsx("div",{className:(0,l.dV)("pointer-events-none absolute inset-0 top-1/2 -translate-y-1/2 transition-all",e.className),style:e.videoAspectRatio?{aspectRatio:Math.max(e.videoAspectRatio/e.zoom,e.containerAspectRatio)}:{},children:e.children}),CrossHair=e=>{let{canRender:t,outerNozzleRadius:i,nozzleRadius:a,outerNozzleRadiusPercentWidth:s,outerNozzleRadiusPercentHeight:r,crosshairStrokeWidth:o,delayedIsLockingCoordinates:c}=useCrossHairState(e);return n.jsx(FillViewport,{children:(0,n.jsxs)("svg",{width:"100%",height:"100%",children:[(0,n.jsxs)("g",{className:(0,l.dV)(e.isConnected&&i>0?"opacity-100":"opacity-0"),children:[n.jsx("rect",{x:"50%",y:t?`${50-r}%`:"50%",height:t?`${2*r}%`:0,width:t?o:0,shapeRendering:"geometricPrecision",className:"fill-brand-500 transition-all ease-in-out",style:{transform:`translateX(-${o/2})`}}),n.jsx("rect",{x:t?`${50-s}%`:"50%",y:"50%",width:t?`${2*s}%`:0,height:t?o:0,shapeRendering:"geometricPrecision",className:"fill-brand-500 transition-all ease-in-out",style:{transform:`translateY(-${o/2})`}})]}),n.jsx("circle",{cx:"50%",cy:"50%",r:t?c?i:1.5*i:0,fill:"none",className:(0,l.dV)("ease-out",c?"fill-brand-300":"fill-brand-300/0 transition-all duration-700"),shapeRendering:"geometricPrecision",strokeWidth:0}),n.jsx("circle",{cx:"50%",cy:"50%",r:t?a:0,fill:"none",className:(0,l.dV)("stroke-brand-500 transition-all ease-in-out",e.isConnected&&i>0?"opacity-100":"opacity-0"),shapeRendering:"geometricPrecision",strokeWidth:o}),n.jsx("circle",{cx:"50%",cy:"50%",r:t?i:0,fill:"none",className:(0,l.dV)("stroke-brand-500 transition-all ease-in-out",e.isConnected&&i>0?"opacity-100":"opacity-0"),shapeRendering:"geometricPrecision",strokeWidth:o})]})})},VAOC=()=>{let e=useVideoState(),{videoRef:t,connectionState:i}=function(e,t){let i=(0,s.useRef)(null),n=(0,s.useRef)(null),a=(0,s.useRef)(null),r=(0,s.useRef)(e),l=(0,s.useRef)(!1),[c,d]=(0,s.useState)(null),u=(0,s.useRef)(null),m=(0,s.useCallback)(e=>{if(e.candidate)return fetch(r.current,{body:JSON.stringify({type:"remote_candidate",id:u.current,candidates:[e.candidate]}),headers:{"Content-Type":"application/json"},method:"POST"}).catch(function(e){window.console.error(e)})},[]),x=(0,s.useCallback)(async()=>{a.current&&(a.current.close(),a.current=null),l.current=!0;try{d("new");var t={sdpSemantics:"unified-plan"};document.getElementById("use-stun")&&document.getElementById("use-stun").checked&&(t.iceServers=[{urls:["stun:stun.l.google.com:19302"]}]);let r=new URLSearchParams(e),o=Object.fromEntries(r.entries()),l=await fetch(e,{body:JSON.stringify({type:"request",res:o.res}),headers:{"Content-Type":"application/json"},method:"POST"});if(l.ok){let r=await l.json();r.iceServers&&(t.iceServers=r.iceServers),a.current=new RTCPeerConnection(t),a.current.addTransceiver("video",{direction:"recvonly"}),a.current.addEventListener("track",function(e){if("video"==e.track.kind){if(i.current)i.current.srcObject=e.streams[0];else throw Error("No video ref to set src on")}else n.current&&(n.current.srcObject=e.streams[0])}),a.current.addEventListener("connectionstatechange",()=>{let e=a.current?.connectionState;d(e??null)}),u.current=r.id,await a.current.setRemoteDescription(r);let o=await a.current.createAnswer();await a.current.setLocalDescription(o),await new Promise(function(e){if(null==a.current)throw Error("peerConnection.current is null");"complete"===a.current.iceGatheringState?e(null):a.current.addEventListener("icegatheringstatechange",function checkState(){if(null==a.current)throw Error("peerConnection.current is null");"complete"===a.current.iceGatheringState&&(a.current.removeEventListener("icegatheringstatechange",checkState),e(null))})}),a.current.addEventListener("icecandidate",m);var s=a.current.localDescription;if(null==s)throw Error("No offer from peerConnection");await fetch(e,{body:JSON.stringify({type:s.type,id:u.current,sdp:s.sdp}),headers:{"Content-Type":"application/json"},method:"POST"})}else d("failed")}catch(e){(0,o.j)().error(e,"Couldn't connect to WebRTC"),d("failed")}finally{l.current=!1}},[m,e]);return(0,s.useEffect)(()=>{if(t){let e=setInterval(async()=>{if(a.current){let e=await a.current.getStats();e.forEach(e=>{"inbound-rtp"===e.type&&"video"===e.kind&&t?.(e)})}},1e3);return()=>clearInterval(e)}},[t]),(0,s.useEffect)(()=>{e&&!1===l.current?x():a.current&&!1===l.current&&a.current.close()},[x,e]),(0,s.useEffect)(()=>{if(["failed","disconnected"].includes(c??"")){let e=setTimeout(()=>{x()},5e3);return()=>clearTimeout(e)}},[x,c]),{videoRef:i,audioRef:n,connectionState:c,close:(0,s.useCallback)(()=>{a.current?.close()},[])}}(e.url+"/webrtc",e.onStreamStats),a="connected"===i,[r,c,d]=(0,h.Fu)("RatOS","camera-settings",p),u=useUIState(),m=useSpatialMapping({settings:r,containerRef:u.containerRef,videoRef:t,windowSize:u.windowSize,zoom:u.zoom}),x=useGestures({setZoom:u.setZoom,canMove:u.canMove,gestureRef:t,isConnected:a,toMillimeters:m.toMillimeters,toScreen:m.toScreen,zoom:u.zoom}),g=u.zoom*(r?.flipHorizontal?-1:1),b=u.zoom*(r?.flipVertical?-1:1),v=x.scaledDragOffset.x*(r?.flipHorizontal?-1:1),y=x.scaledDragOffset.y*(r?.flipVertical?-1:1);return n.jsx("div",{className:(0,l.dV)(u.isFullscreened?"h-full":"h-[calc(100vh_-_64px)]","flex w-full select-none items-center"),ref:u.rootRef,children:(0,n.jsxs)("div",{className:"relative mx-auto flex h-full max-h-full min-h-[50vh] min-w-[50vw] max-w-fit items-center overflow-hidden object-contain shadow-lg",ref:u.containerRef,children:[n.jsx("video",{ref:t,className:(0,l.m6)("h-full max-h-full w-full min-w-full max-w-full transform-gpu touch-none",u.canMove&&"cursor-move",!x.isDragging&&"transition-transform ease-in-out"),style:{transform:`scale3d(${g}, ${b}, 1) translate3d(${v}px, ${y}px, 0)`},autoPlay:!0,muted:!0,playsInline:!0}),n.jsx(FillVideoFrame,{videoAspectRatio:e.aspectRatio??0,containerAspectRatio:u.containerAspectRatio,zoom:u.zoom,children:n.jsx(SafetyVisualization,{gestureState:x})}),n.jsx(CrossHair,{isConnected:a&&null!=e.aspectRatio,isLockingCoordinates:u.isLockingCoordinates,settings:r,toScreen:m.toScreen,containerSize:m.containerSize}),(0,n.jsxs)(FillViewport,{children:[n.jsx("h3",{className:(0,l.m6)("absolute inset-0 flex items-center justify-center text-xl font-semibold text-rose-500 transition-all dark:text-rose-500","failed"===i?"animate-pulse opacity-100":"opacity-0"),children:n.jsx("div",{className:"flex aspect-square h-[30svh] w-[30svh] items-center justify-center",children:"Webcam stream not found"})}),n.jsx(f.$,{noMargin:!0,strokeWidth:1,className:(0,l.m6)("h-[40svh] w-[40svh] animate-spin text-inherit transition-all","text-lime-500 dark:text-lime-500",("connected"===i||"failed"===i)&&null!=e.aspectRatio&&"opacity-0","failed"===i&&"text-rose-500 dark:text-rose-500","connecting"===i&&"text-brand-500 dark:text-brand-500","closed"===i&&"text-yellow-500 dark:text-yellow-500","disconnected"===i&&"text-amber-500 dark:text-amber-500","new"===i&&"text-sky-500 dark:text-sky-500")})]}),n.jsx(FillVideoFrame,{videoAspectRatio:e.aspectRatio??0,containerAspectRatio:u.containerAspectRatio,zoom:u.zoom,className:(0,l.dV)(null!=e.aspectRatio?"opacity-100":"opacity-0"),children:n.jsx(Toolbars,{zoom:u.zoom,toggleFullscreen:k.Z.isEnabled?u.toggleFullscreen:null,isFullscreened:u.isFullscreened,setZoom:u.setZoom,setIsLockingCoordinates:u.setIsLockingCoordinates,setCanMove:u.setCanMove,canMove:u.canMove,fps:e.fps??0,isConnected:a,isLockingCoordinates:u.isLockingCoordinates,url:e.url,setSettings:c,settings:r,isSettingsFetched:d.isFetched})})]})})};function Page(){let e=n.jsx("div",{className:"absolute inset-0 flex h-[calc(100vh_-_64px)] items-center justify-center",children:n.jsx(f.$,{className:"h-[40svh] w-[40svh] animate-spin transition-all dark:text-lime-400",noMargin:!0,strokeWidth:1})});return n.jsx("div",{className:"flex h-full w-full items-center @container",children:n.jsx(r().Suspense,{fallback:e,children:n.jsx(a.NoSSR,{fallback:e,children:n.jsx(VAOC,{})})})})}},19815:(e,t,i)=>{"use strict";i.d(t,{l:()=>ScrollContainer});var n=i(96603),a=i(61418);let ScrollContainer=e=>n.jsx("div",{...e,className:(0,a.m6)("scrollable",e.className)})},67415:(e,t,i)=>{"use strict";i.d(t,{j:()=>WarningMessage});var n=i(96603),a=i(59);i(51495);var s=i(29340);let WarningMessage=e=>n.jsx(s.j,{color:"yellow",Icon:a,title:e.title?"Warning: "+e.title:"Warning",className:e.className,children:e.children})},96217:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>WizardLayout});var n=i(8632),a=i(45650);function WizardLayout({children:e}){return(0,a.headers)().get("x-configurator"),n.jsx("main",{className:"",children:n.jsx("div",{className:"mx-auto max-w-full",children:e})})}},46419:(e,t,i)=>{"use strict";i.r(t),i.d(t,{$$typeof:()=>r,__esModule:()=>s,default:()=>l});var n=i(97175);let a=(0,n.createProxy)(String.raw`/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/calibration/page.tsx`),{__esModule:s,$$typeof:r}=a,o=a.default,l=o}};var t=require("../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),i=t.X(0,[7013,2689,8989,2828,1169,5197,1041,5235,9529,6852,7340,2017,6490,5260,3728,4933],()=>__webpack_exec__(16537));module.exports=i})();