(()=>{var e={};e.id=2490,e.ids=[2490],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},38316:e=>{"use strict";e.exports=require("zod")},39491:e=>{"use strict";e.exports=require("assert")},50852:e=>{"use strict";e.exports=require("async_hooks")},14300:e=>{"use strict";e.exports=require("buffer")},32081:e=>{"use strict";e.exports=require("child_process")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},73292:e=>{"use strict";e.exports=require("fs/promises")},98188:e=>{"use strict";e.exports=require("module")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},14521:e=>{"use strict";e.exports=require("readline")},12781:e=>{"use strict";e.exports=require("stream")},71576:e=>{"use strict";e.exports=require("string_decoder")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},26144:e=>{"use strict";e.exports=require("vm")},71267:e=>{"use strict";e.exports=require("worker_threads")},9016:(e,r,a)=>{"use strict";a.r(r),a.d(r,{GlobalError:()=>o.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>c});var t=a(30584),n=a(72023),s=a(16443),o=a.n(s),i=a(32055),l={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);a.d(r,l);let c=["",{children:["analysis",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,67011)),"/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/analysis/page.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,47318)),"/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/analysis/layout.tsx"],loading:[()=>Promise.resolve().then(a.bind(a,11988)),"/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/analysis/loading.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,33374))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(a.bind(a,69113)),"/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/layout.tsx"],template:[()=>Promise.resolve().then(a.bind(a,4278)),"/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/template.tsx"],error:[()=>Promise.resolve().then(a.bind(a,43086)),"/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/error.tsx"],loading:[()=>Promise.resolve().then(a.bind(a,43962)),"/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/loading.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,10540,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,33374))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/analysis/page.tsx"],u="/analysis/page",x={require:a,loadChunk:()=>Promise.resolve()},m=new t.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/analysis/page",pathname:"/analysis",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},87885:(e,r,a)=>{Promise.resolve().then(a.bind(a,3276)),Promise.resolve().then(a.bind(a,47994)),Promise.resolve().then(a.bind(a,41891))},98966:(e,r,a)=>{"use strict";a.d(r,{k:()=>useGcodeCommand});var t=a(51495),n=a(99234);let useGcodeCommand=()=>{let e=(0,n.xH)("printer.gcode.script");return(0,t.useCallback)(async(r,...a)=>{let t=[r[0]];a.forEach((e,a)=>{t.push(e.toString(),r[a+1])});let n=t.join("");console.log(n);let s=await e.mutateAsync({script:n});console.log(s)},[])}},3276:(e,r,a)=>{"use strict";a.r(r),a.d(r,{Analysis:()=>Analysis});var t=a(96603),n=a(51495),s=a.n(n),o=a(98966),i=a(61418),l=a(73835),c=a(24240),d=a(63147),u=a(43435),x=a(82251),m=a(47994),p=a(27334),h=a(88304),f=a(32519),g=a(72016),b=a(36986),y=a(86053),j=a(11476),w=a(83926),v=a(99234),S=a(73367),M=a(30413),_=a(39238),N=a(78438),I=a(368);let A={type:"spring",damping:40,stiffness:450},LiveGcodeResponse=e=>{let{lastMessage:r}=(0,v.oK)({passThroughUpdateMethods:["notify_gcode_response"]}),[a,s]=(0,n.useState)([]);(0,n.useEffect)(()=>{r&&"method"in r&&"notify_gcode_response"===r.method&&s(a=>a.concat(r.params).slice(-(e.lines??1)))},[r,e.lines]);let o=a.map(e=>e.split("\n").length).reduce((e,r)=>e+r,0);return t.jsx(M.M,{children:0!==a.length&&t.jsx(_.E.div,{className:(0,I.cn)("flex max-h-96 max-w-md",e.className),initial:{width:0,opacity:0},animate:{opacity:1,width:"100%"},exit:{width:0,opacity:0},transition:A,children:t.jsx(m.Card,{className:"flex flex-1 flex-col",children:(0,t.jsxs)(S.aY,{className:"grid flex-1 gap-2 overflow-hidden p-0 @sm:p-0",children:[t.jsx(S.ll,{className:"px-4 pt-4",children:"Console Output"}),t.jsx(S.SZ,{className:(0,i.dV)("scrollable max-h-max overflow-hidden px-4 pb-4 @sm:px-4",o>(e.lines??1)+2&&"overflow-y-scroll"),children:t.jsx(N.i,{transition:A,children:t.jsx(M.M,{children:a.map((e,r)=>{let a=e.replace(/^(\/\/ |echo: |!! )/gm,"");return t.jsx(_.E.div,{transition:A,className:(0,i.dV)("whitespace-pre-wrap font-mono text-sm",e.trim().startsWith("!!")&&"text-rose-500"),initial:{opacity:0,translateY:50,height:0},animate:{opacity:1,translateY:0,height:"auto"},exit:{opacity:0,translateY:-50,height:0},dangerouslySetInnerHTML:{__html:a}},e)})})})})]})},"container")})})};d.SciChartSurface.configure({wasmUrl:"/configure/scichart2d.wasm",dataUrl:"/configure/scichart2d.data"});let useRealtimeAnalysisChart=(e,r="adxl345")=>{let[a,t]=(0,n.useState)(!1),[s,o]=(0,n.useState)(!1),i=(0,x.YC)(),l=(0,b.useRecoilValue)(y.OS),c=e??i[0].getYAccelerometerName(),u=("controlboard"===c?l?.name:"toolboard_t0"===c?i[0]?.getToolboard()?.name:"toolboard_t1"===c?i[1]?.getToolboard()?.name:"rpi"===c?"Raspberry Pi":"beacon"===c?"Beacon":"N/A")??"N/A",m=(0,p.ZA)(),h=(0,p.QR)("x"),g=(0,p.QR)("y"),v=(0,p.QR)("z"),S=h.data.current?.yAxis??null,M=g.data.current?.yAxis??null,_=v.data.current?.yAxis??null,N=(0,n.useMemo)(()=>[S,M,_],[S,M,_]),I=(0,f.Tv)(N,new d.NumberRange(-5e3,5e3),1e3),A=m.surface.current?.yAxes.getById(p.ck)??null,R=(0,f.Tv)(A,p.as),C=(0,n.useRef)(async e=>{}),k=(0,n.useCallback)(async e=>{t(r=>(!1===r&&!0===e&&(q.current=performance.now()),e)),e||await C.current(e);let r=h.data.current?.signalData.count()??0,a=m.surface.current?.renderableSeries.getById("total").dataSeries.count()??0;h.data.current?.signalData.clear(),g.data.current?.signalData.clear(),v.data.current?.signalData.clear(),h.data.current?.historyData.clear(),g.data.current?.historyData.clear(),v.data.current?.historyData.clear(),h.data.current?.signalData.appendRange(Array(r).fill(0).map((e,r)=>r),Array(r).fill(0)),g.data.current?.signalData.appendRange(Array(r).fill(0).map((e,r)=>r),Array(r).fill(0)),v.data.current?.signalData.appendRange(Array(r).fill(0).map((e,r)=>r),Array(r).fill(0)),h.surface.current?.invalidateElement(),g.surface.current?.invalidateElement(),v.surface.current?.invalidateElement();let n=m.data.current?.animationSeries;null!=n&&(n.x.clear(),n.y.clear(),n.z.clear(),n.total.clear(),n.x.appendRange(Array(a).fill(0).map((e,r)=>r*(200/a)),Array(a).fill(0)),n.y.appendRange(Array(a).fill(0).map((e,r)=>r*(200/a)),Array(a).fill(0)),n.z.appendRange(Array(a).fill(0).map((e,r)=>r*(200/a)),Array(a).fill(0)),n.total.appendRange(Array(a).fill(0).map((e,r)=>r*(200/a)),Array(a).fill(0)),m.surface.current?.renderableSeries.getById("x").runAnimation(new d.LineAnimation({duration:200,ease:d.easing.inOutQuad,dataSeries:n.x})),m.surface.current?.renderableSeries.getById("y").runAnimation(new d.LineAnimation({duration:200,ease:d.easing.inOutQuad,dataSeries:n.y})),m.surface.current?.renderableSeries.getById("z").runAnimation(new d.LineAnimation({duration:200,ease:d.easing.inOutQuad,dataSeries:n.z})),m.surface.current?.renderableSeries.getById("total").runAnimation(new d.MountainAnimation({duration:200,ease:d.easing.inOutQuad,dataSeries:n.total})),R(new d.NumberRange(0,0)),e&&await C.current(e))},[m.data,m.surface,R,h.data,h.surface,g.data,g.surface,v.data,v.surface]),q=(0,n.useRef)(performance.now()),O=(0,n.useCallback)(e=>{let r=m.surface.current;if(null==r)return;let a=performance.now()-q.current;if(q.current=performance.now(),200>e.total.frequencies.reduce((e,r)=>e+r,0))return;let t=m.data.current?.animationSeries;if(null==t)throw Error("No animation data series");e.x.frequencies.length!==e.x.estimates.length&&(0,w.j)().warn(`X estimates and frequencies are not the same length (${e.x.estimates.length} vs ${e.x.frequencies.length})`),e.y.frequencies.length!==e.y.estimates.length&&(0,w.j)().warn(`Y estimates and frequencies are not the same length (${e.y.estimates.length} vs ${e.y.frequencies.length})`),e.z.frequencies.length!==e.z.estimates.length&&(0,w.j)().warn(`Z estimates and frequencies are not the same length (${e.z.estimates.length} vs ${e.z.frequencies.length})`),e.total.frequencies.length!==e.total.estimates.length&&(0,w.j)().warn(`Total estimates and frequencies are not the same length  (${e.total.estimates.length} vs ${e.total.frequencies.length})`),e.x.frequencies.length!==r.renderableSeries.getById("x").dataSeries.count()&&((0,w.j)().warn(`X frequencies are not the same length as the data series (${e.x.estimates.length} vs ${r.renderableSeries.getById("x").dataSeries.count()})`),r.renderableSeries.getById("x").dataSeries.clear(),r.renderableSeries.getById("y").dataSeries.clear(),r.renderableSeries.getById("z").dataSeries.clear(),r.renderableSeries.getById("total").dataSeries.clear(),r.renderableSeries.getById("x").dataSeries.appendRange(e.x.frequencies,Array(e.x.frequencies.length).fill(0)),r.renderableSeries.getById("y").dataSeries.appendRange(e.y.frequencies,Array(e.y.frequencies.length).fill(0)),r.renderableSeries.getById("z").dataSeries.appendRange(e.z.frequencies,Array(e.z.frequencies.length).fill(0)),r.renderableSeries.getById("total").dataSeries.appendRange(e.total.frequencies,Array(e.total.frequencies.length).fill(0))),t.x.clear(),t.y.clear(),t.z.clear(),t.total.clear(),t.x.appendRange(e.x.frequencies,e.x.estimates),t.y.appendRange(e.y.frequencies,e.y.estimates),t.z.appendRange(e.z.frequencies,e.z.estimates),t.total.appendRange(e.total.frequencies,e.total.estimates),r.renderableSeries.getById("x").runAnimation(new d.LineAnimation({duration:Math.max(a,100),ease:d.easing.inOutQuad,dataSeries:t.x})),r.renderableSeries.getById("y").runAnimation(new d.LineAnimation({duration:Math.max(a,100),ease:d.easing.inOutQuad,dataSeries:t.y})),r.renderableSeries.getById("z").runAnimation(new d.LineAnimation({duration:Math.max(a,100),ease:d.easing.inOutQuad,dataSeries:t.z})),r.renderableSeries.getById("total").runAnimation(new d.MountainAnimation({duration:Math.max(a,100),ease:d.easing.inOutQuad,dataSeries:t.total})),R(new d.NumberRange(e.total.powerRange.min,e.total.powerRange.max))},[m.data,m.surface,R]),P=(0,n.useCallback)(async([e,r,a,t])=>{h.data.current?.signalData.appendRange(e,r),g.data.current?.signalData.appendRange(e,a),v.data.current?.signalData.appendRange(e,t),h.data.current?.historyData.appendRange(e,r),g.data.current?.historyData.appendRange(e,a),v.data.current?.historyData.appendRange(e,t),I()},[I,h.data,g.data,v.data]),D=(0,n.useCallback)(e=>{k(!1),(0,w.j)().error(e),j.A.error("Error during accelerometer data streaming",{description:e.message})},[k]),{startAccumulation:T,stopAccumulation:E,streamStarted:z,streamStopped:Z}=(0,f.ck)(a,c,P,O,D);return C.current=(0,n.useCallback)(async e=>(o(!0),!1===e)?Z().finally(()=>{o(!1)}):z().finally(()=>{o(!1)}),[z,Z]),(0,n.useMemo)(()=>({isChartEnabled:a,isLoading:s,setIsChartEnabled:k,streamStarted:z,streamStopped:Z,psds:{startAccumulation:T,stopAccumulation:E},currentAccelerometer:c,currentAccelerometerHardwareName:u,chartProps:{xSignalChart:h,ySignalChart:g,zSignalChart:v,psdChart:m}}),[a,s,k,z,Z,T,E,c,u,h,g,v,m])},R=s().memo(({xSignalChart:e,ySignalChart:r,zSignalChart:a,psdChart:n})=>(0,t.jsxs)("div",{className:"flex max-h-full min-h-full flex-col space-y-4 @container",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4 @screen-lg:grid-cols-3",children:[(0,t.jsxs)(m.Card,{className:"flex max-h-32 min-h-32 overflow-hidden @screen-lg:max-h-72 @screen-lg:min-h-72",children:[(0,t.jsxs)("h3",{className:"text-md absolute left-0 right-0 top-0 flex items-center space-x-2 p-4 font-semibold",children:[t.jsx("div",{className:(0,i.dV)("flex-none rounded-full bg-yellow-400/10 p-1 text-yellow-400"),children:t.jsx("div",{className:"h-2 w-2 rounded-full bg-current"})}),t.jsx("span",{className:"text-zinc-100",children:"X Signal"})]}),t.jsx(h.iB,{...e.forwardProps,className:"flex-1 rounded-lg",fallback:t.jsx(g.I,{className:"ml-[150px]"})})]}),(0,t.jsxs)(m.Card,{className:"flex max-h-32 min-h-32 overflow-hidden @screen-lg:max-h-72 @screen-lg:min-h-72",children:[(0,t.jsxs)("h3",{className:"text-md absolute left-0 right-0 top-0 flex items-center space-x-2 p-4 font-semibold",children:[t.jsx("div",{className:(0,i.dV)("flex-none rounded-full bg-sky-400/10 p-1 text-sky-400"),children:t.jsx("div",{className:"h-2 w-2 rounded-full bg-current"})}),t.jsx("span",{className:"text-zinc-100",children:"Y Signal"})]}),t.jsx(h.iB,{...r.forwardProps,className:"flex-1 rounded-lg",fallback:t.jsx(g.I,{className:"ml-[150px]"})})]}),(0,t.jsxs)(m.Card,{className:"flex max-h-32 min-h-32 overflow-hidden @screen-lg:max-h-72 @screen-lg:min-h-72",children:[(0,t.jsxs)("h3",{className:"text-md absolute left-0 right-0 top-0 flex items-center space-x-2 p-4 font-semibold",children:[t.jsx("div",{className:(0,i.dV)("flex-none rounded-full bg-rose-400/10 p-1 text-rose-400"),children:t.jsx("div",{className:"h-2 w-2 rounded-full bg-current"})}),t.jsx("span",{className:"text-zinc-100",children:"Z Signal"})]}),t.jsx(h.iB,{...a.forwardProps,className:"flex-1 rounded-lg",fallback:t.jsx(g.I,{className:"ml-[150px]"})})]})]}),(0,t.jsxs)(m.Card,{className:"relative flex flex-1 overflow-hidden",children:[t.jsx(h.iB,{...n.forwardProps,className:"flex-1",fallback:t.jsx(g.I,{className:"ml-[150px]"})}),t.jsx(LiveGcodeResponse,{className:"absolute right-4 top-4"})]})]}));var C=a(36731),k=a.n(C),q=a(76461),O=a(65995),P=a(32518),D=a(67174),T=a(35061),E=a(68579),z=a(23152),Z=a(99966),B=a(52680),V=a(11951),$=a(55467),Y=a(70815),X=a(11294),Q=a(39763),F=a(21138),L=a(42446),G=a(51873),H=a(54670),U=a(58709),K=a(81297),W=a(67758),J=a(69678),ee=a(37424),er=a(6663),ea=a(64730);let et=n.forwardRef(({className:e,...r},a)=>(0,t.jsxs)(ea.fC,{ref:a,className:(0,I.cn)("relative flex w-full touch-none select-none items-center",e),...r,children:[t.jsx(ea.fQ,{className:(0,I.cn)("relative h-1.5 w-full grow rounded-full bg-zinc-400/10","dark:before:pointer-events-none dark:before:absolute dark:before:-inset-[1px] dark:before:rounded-full dark:before:transition-all","dark:before:shadow-[0px_-1px_0px_0px_hsl(var(--zinc-400)_/_15%)_inset,_inset_0px_1px_2px_0px_rgba(0,0,0,0.55)]"),children:t.jsx(ea.e6,{className:(0,I.cn)("absolute h-full rounded-full bg-brand-400/80","dark:before:pointer-events-none dark:before:absolute dark:before:-inset-[1px] dark:before:rounded-full dark:before:transition-all","dark:before:shadow-[inset_0px_-1px_0px_0px_hsl(var(--brand-200)_/_20%),_inset_0px_1px_2px_0px_rgba(0,0,0,0.55)]")})}),t.jsx(ea.bU,{className:(0,I.cn)("block h-4 w-4 rounded-full border border-zinc-700 bg-zinc-700 shadow transition-colors","focus-visible:outline-none focus-visible:ring-0 disabled:pointer-events-none disabled:opacity-50","shadow-[0px_0px_0px_1px_rgba(9,9,11,0.07),0px_2px_2px_0px_rgba(9,9,11,0.05)] dark:shadow-[0px_0px_0px_1px_rgba(255,255,255,0.03)]","dark:before:inset-px dark:before:rounded-full","dark:before:pointer-events-none dark:before:absolute dark:before:shadow-[0px_2px_8px_0px_hsl(var(--zinc-900)),_0px_1px_0px_0px_hsl(var(--zinc-400)_/_20%)_inset]")})]}));(0,I.h)(et,ea.fC.displayName);var en=a(4854),es=a(41620);d.SciChartSurface.configure({wasmUrl:"/configure/scichart2d.wasm",dataUrl:"/configure/scichart2d.data"});let useOscillator=(e,r=!1)=>{let[a,t]=(0,n.useState)(0),s=(0,n.useRef)(a);s.current=a;let[o,i]=(0,n.useState)("x"),l=(0,n.useRef)(o);l.current=o;let c=(0,n.useRef)(!1),d=(0,n.useRef)(r);d.current=r;let u=(0,n.useCallback)(async()=>{if(s.current<=0||c.current)return;let r=500/s.current,a=Math.floor(Math.max(250,500-500%r)),t="a"===l.current?"1,1":"b"===l.current?"1,-1":l.current,n=performance.now();try{if(!d.current){c.current=!1;return}c.current=!0,await e`
			OSCILLATE FREQ=${s.current} TIME=${a/1e3} AXIS=${t}
			`,c.current=!1;let r=performance.now()-n;s.current>0&&r>a?setTimeout(()=>{u()},1):setTimeout(()=>{u()},a-r)}catch(e){c.current=!1,(0,w.j)().error(e,"Failed to oscillate"),j.A.error("Failed to oscillate",{description:`
					<div>
						<p>An error occurred while trying to oscillate the printer:</p>
						<pre class="text-wrap mt-4 text-rose-400 font-medium whitespace-pre-wrap">${e instanceof Error?e.message:e instanceof String?e:"Unknown error"}</pre>
					</div>
				`})}},[e]);return(0,n.useEffect)(()=>{a>0&&!c.current&&r&&u()},[u,a,r]),{frequency:a,setFrequency:t,axis:o,setAxis:i}},eo={onError(e,r){(0,w.j)().error("Failed to save macro sequence recording",{error:e,variables:{...r,psd:"removed from log.."}})}},Analysis=()=>{let[e]=q.SX.analysis.getMacros.useSuspenseQuery({limit:10}),r=(0,P.useRouter)(),a=(0,x.YC)(),s=(0,n.useMemo)(()=>a.some(e=>"beacon"===e.getYAccelerometerName()||"beacon"===e.getXAccelerometerName()),[a]),[d,m]=(0,n.useState)(a[0].getYAccelerometerName()),{isChartEnabled:p,isLoading:h,setIsChartEnabled:f,streamStarted:g,streamStopped:b,chartProps:y,psds:v,currentAccelerometer:S,currentAccelerometerHardwareName:M}=useRealtimeAnalysisChart(d),{mutateAsync:_}=q.SX.analysis.saveRecording.useMutation(eo),N=(0,n.useRef)(p);N.current=p;let[I,A]=(0,n.useState)(!1),[C,ea]=(0,n.useState)(!1),ei=(0,n.useRef)(null),el=(0,o.k)(),{frequency:ec,setFrequency:ed,axis:eu,setAxis:ex}=useOscillator(el,p&&!C),em=(0,n.useRef)(new AbortController),ep=(0,n.useCallback)((e,...r)=>async()=>{em.current=new AbortController;let a=N.current;ed(0),ea(!0);try{await e(em.current.signal,...r)}catch(e){em.current.signal.aborted||e instanceof DOMException&&"AbortError"===e.name?((0,w.j)().info(e,"Macro run aborted"),j.A.info("Macro run aborted",{description:"The macro run was aborted"})):((0,w.j)().error("Macro run failed",e),j.A.error("Macro failed",{description:e instanceof Error?e.message:e instanceof String?e:"An unknown error occurred while running the macro"}))}finally{ea(!1),A(!1),a?f(!0):f(!1),ei.current=null}},[ed,f]),eh=(0,n.useMemo)(()=>I?t.jsx(l.jXb,{className:"h-4 w-4 scale-150 text-red-400"}):C?t.jsx(c.$,{noMargin:!0,className:"h-4 w-4 group-data-[state=open]:text-white"}):t.jsx(D.Z,{className:"h-5 w-5 text-white group-data-[state=open]:text-white lg:text-white/60"}),[C,I]),ef=(0,n.useCallback)(e=>ep(async a=>{ei.current=e;let t=O.Z(),n=[],s=e.sequences.map(r=>async()=>{if(a.aborted)throw new DOMException("Macro run aborted by user","AbortError");let s=new Date().getTime();if(m(r.recording?.accelerometer),await f(!0),r.recording?.capturePSD&&((0,w.j)().info("Starting PSD accumulation"),await v.startAccumulation(),A(!0)),a.aborted)throw await v.stopAccumulation(),A(!1),new DOMException("Macro run aborted by user","AbortError");if(await el`
						${r.gcode}
						M400
					`,r.recording?.capturePSD){let o;(0,w.j)().info("Stopping PSD accumulation");let i=await v.stopAccumulation();if(A(!1),a.aborted)throw new DOMException("Macro run aborted by user","AbortError");let l=await fetch(`http://${(0,es.X)()}/printer/objects/query?toolhead=square_corner_velocity`);if(l.ok){let e=await l.json();e?.result?.status?.toolhead?.square_corner_velocity!=null?o=e.result.status.toolhead.square_corner_velocity:(0,w.j)().warn(e,"Failed to get square corner velocity from moonraker")}n.push(_({recording:{id:O.Z(),macroRecordingRunId:t,macroId:e.id,sequenceId:r.id,startTimeStamp:s,scv:o,endTimeStamp:new Date().getTime(),psd:i,name:r.name,accelerometer:S,recordingHardwareName:M}}))}await f(!1)});if(await s.reduce((e,r)=>e.then(r),Promise.resolve()),a.aborted)throw new DOMException("Macro run aborted by user","AbortError");let o=j.A.loading("Saving recordings...",{description:"Please wait for recordings to be saved."});try{await Promise.all(n),j.A.success("Macro run completed",{id:o,description:`Macro "${e.name}" completed successfully`,action:{label:"View Result",onClick:()=>r.push(`/analysis/macros/${e.id}/recordings/${t}`)}})}catch(r){j.A.error("Macro run failed",{id:o,description:`An error occurred while saving macro result data for "${e.name}"`})}}),[ep,f,el,v,_,S,M,r]);return(0,u.Ty)("analysis",(0,n.useCallback)(r=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(r.MenubarMenu,{children:[(0,t.jsxs)(r.MenubarTrigger,{className:"flex-nowrap whitespace-nowrap text-nowrap",children:[h?t.jsx(c.$,{noMargin:!0,className:"size-4 text-white transition-colors group-data-[state=open]:text-white lg:text-white/60"}):t.jsx(r.MenubarIcon,{Icon:T.Z,className:(0,i.dV)(p&&"text-brand-400 lg:text-brand-400")})," ",t.jsx("span",{className:"hidden lg:inline",children:"Stream"})]}),(0,t.jsxs)(r.MenubarContent,{onCloseAutoFocus:e=>e.preventDefault(),children:[(0,t.jsxs)(r.MenubarSub,{children:[(0,t.jsxs)(r.MenubarSubTrigger,{children:[t.jsx(r.MenubarContentIcon,{Icon:E.Z})," Accelerometer"]}),t.jsx(r.MenubarSubContent,{children:(0,t.jsxs)(r.MenubarRadioGroup,{value:d,onValueChange:e=>m(e),children:[(0,t.jsxs)(r.MenubarRadioItem,{value:"rpi",className:(0,i.dV)("rpi"===d&&"font-semibold text-brand-400"),onSelect:e=>e.preventDefault(),children:[t.jsx(r.MenubarContentIcon,{Icon:z.Z}),"Host"]}),(0,t.jsxs)(r.MenubarRadioItem,{value:"controlboard",className:(0,i.dV)("controlboard"===d&&"font-semibold text-brand-400"),onSelect:e=>e.preventDefault(),children:[t.jsx(r.MenubarContentIcon,{Icon:Z.Z}),"Control Board"]}),a[0].hasToolboard()&&(0,t.jsxs)(r.MenubarRadioItem,{value:"toolboard_t0",className:(0,i.dV)("toolboard_t0"===d&&"font-semibold text-brand-400"),onSelect:e=>e.preventDefault(),children:[t.jsx(r.MenubarContentIcon,{Icon:B.Z}),"Toolboard T0"]}),a.length>1&&a[1].hasToolboard()&&(0,t.jsxs)(r.MenubarRadioItem,{value:"toolboard_t1",className:(0,i.dV)("toolboard_t1"===d&&"font-semibold text-brand-400"),onSelect:e=>e.preventDefault(),children:[t.jsx(r.MenubarContentIcon,{Icon:B.Z}),"Toolboard T1"]}),s&&(0,t.jsxs)(r.MenubarRadioItem,{value:"beacon",className:(0,i.dV)("beacon"===d&&"font-semibold text-brand-400"),onSelect:e=>e.preventDefault(),children:[t.jsx(r.MenubarContentIcon,{Icon:V.Z}),"Beacon"]})]})})]}),t.jsx(r.MenubarSeparator,{}),(0,t.jsxs)(r.MenubarItem,{disabled:p||C,onClick:async()=>{f(!0)},children:[t.jsx(r.MenubarContentIcon,{Icon:$.Z})," Start"]}),(0,t.jsxs)(r.MenubarItem,{disabled:!p||C,onClick:async()=>{f(!1)},children:[t.jsx(r.MenubarContentIcon,{Icon:Y.Z})," Stop"]})]})]}),(0,t.jsxs)(r.MenubarMenu,{children:[(0,t.jsxs)(r.MenubarTrigger,{className:"flex-nowrap whitespace-nowrap text-nowrap",children:[t.jsx(r.MenubarIcon,{Icon:X.Z})," ",t.jsx("span",{className:"hidden lg:inline",children:"Tools"})]}),(0,t.jsxs)(r.MenubarContent,{onCloseAutoFocus:e=>e.preventDefault(),children:[(0,t.jsxs)(r.MenubarItem,{disabled:C,onSelect:ep(async()=>{await el`MAYBE_HOME`}),children:[t.jsx(r.MenubarContentIcon,{Icon:Q.Z}),"Home Printer"]}),t.jsx(r.MenubarSeparator,{}),(0,t.jsxs)(r.MenubarSub,{children:[(0,t.jsxs)(r.MenubarSubTrigger,{children:[t.jsx(r.MenubarContentIcon,{Icon:F.Z})," Toolhead Oscillator"]}),(0,t.jsxs)(r.MenubarSubContent,{children:[t.jsx(r.MenubarLabel,{children:"Oscillation Direction"}),(0,t.jsxs)(r.MenubarRadioGroup,{value:eu,onValueChange:e=>ex(e),children:[(0,t.jsxs)(r.MenubarRadioItem,{value:"x",className:(0,i.dV)("x"===eu&&ec>0&&"font-semibold text-brand-400"),onSelect:e=>e.preventDefault(),children:[t.jsx(r.MenubarContentIcon,{Icon:L.Z})," ",(0,t.jsxs)("div",{children:["Oscillate X",t.jsx("div",{className:"text-xs text-muted-foreground",children:"This isolates the X belt on bedslingers."})]})]}),(0,t.jsxs)(r.MenubarRadioItem,{value:"y",className:(0,i.dV)("y"===eu&&ec>0&&"font-semibold text-brand-400"),onSelect:e=>e.preventDefault(),children:[t.jsx(r.MenubarContentIcon,{Icon:G.Z})," ",(0,t.jsxs)("div",{children:["Oscillate Y",t.jsx("div",{className:"text-xs text-muted-foreground",children:"This isolates the Y belt on bedslingers."})]})]}),(0,t.jsxs)(r.MenubarRadioItem,{value:"a",className:(0,i.dV)("a"===eu&&ec>0&&"font-semibold text-brand-400"),onSelect:e=>e.preventDefault(),children:[t.jsx(r.MenubarContentIcon,{Icon:H.Z})," ",(0,t.jsxs)("div",{children:["Oscillate X+Y",t.jsx("div",{className:"text-xs text-muted-foreground",children:"This isolates the A belt on CoreXY."})]})]}),(0,t.jsxs)(r.MenubarRadioItem,{value:"b",className:(0,i.dV)("b"===eu&&ec>0&&"font-semibold text-brand-400"),onSelect:e=>e.preventDefault(),children:[t.jsx(r.MenubarContentIcon,{Icon:U.Z})," ",(0,t.jsxs)("div",{children:["Oscillate X-Y",t.jsx("div",{className:"text-xs text-muted-foreground",children:"This isolates the B belt on CoreXY."})]})]})]}),t.jsx(r.MenubarSeparator,{}),t.jsx(r.MenubarLabel,{children:"Oscillation Frequency"}),(0,t.jsxs)("div",{className:"min-w-48 p-4",children:[(0,t.jsxs)("h3",{className:"-mt-2 text-center text-2xl font-medium tracking-tight",children:[t.jsx(en.I,{type:"number",size:1,max:200,min:0,onKeyUp:e=>e.stopPropagation(),onKeyDown:e=>e.stopPropagation(),className:"m-0 inline min-w-0 border-none bg-transparent p-0 text-right font-mono text-3xl font-medium tracking-tight",value:ec.toFixed(1),style:{width:ec.toFixed(1).length+"rem"},onChange:e=>ed(parseFloat(e.target.value))}),"Hz"]}),t.jsx(et,{min:0,className:"mt-4",max:200,value:[ec],onValueChange:e=>ed(e[0]),step:.1})]})]})]})]})]}),(0,t.jsxs)(r.MenubarMenu,{children:[(0,t.jsxs)(r.MenubarTrigger,{className:"flex-nowrap whitespace-nowrap text-nowrap",children:[eh," ",t.jsx("span",{className:"hidden lg:inline",children:"Macros"})]}),(0,t.jsxs)(r.MenubarContent,{onCloseAutoFocus:e=>e.preventDefault(),children:[t.jsx(r.MenubarItem,{disabled:C,asChild:!0,className:"pr-8",children:(0,t.jsxs)(k(),{href:"/analysis/macros/new",children:[t.jsx(r.MenubarContentIcon,{Icon:K.Z})," New Macro",t.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:t.jsx(W.Z,{className:"h-4 w-4"})})]})}),t.jsx(r.MenubarItem,{disabled:C,asChild:!0,className:"pr-8",children:(0,t.jsxs)(k(),{href:"/analysis/macros",children:[t.jsx(r.MenubarContentIcon,{Icon:J.Z})," Macro Overview",t.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:t.jsx(W.Z,{className:"h-4 w-4"})})]})}),t.jsx(r.MenubarSeparator,{}),(0,t.jsxs)(r.MenubarSub,{children:[(0,t.jsxs)(r.MenubarSubTrigger,{children:[t.jsx(r.MenubarContentIcon,{Icon:$.Z})," Execute Macro"]}),t.jsx(r.MenubarSubContent,{className:"max-w-80",children:e.result?.map(e=>t.jsxs(r.MenubarItem,{disabled:C,onSelect:ef(e),className:i.dV(ei.current?.id===e.id&&"text-brand-400 opacity-100 lg:text-brand-400"),children:[ei.current?.id===e.id?eh:t.jsx(r.MenubarContentIcon,{Icon:ee.Z}),t.jsxs("div",{children:[e.name,t.jsx("div",{className:"text-xs text-muted-foreground",children:e.description})]})]},e.id))})]}),(0,t.jsxs)(r.MenubarItem,{disabled:!C,onClick:()=>em.current.abort(),children:[t.jsx(r.MenubarContentIcon,{Icon:er.Z,className:(0,i.dV)(C&&"text-red-400")}),"Abort ",ei.current?.name||"Macro"]})]})]})]}),[h,p,d,a,s,C,ep,eu,ec,eh,e.result,f,el,ex,ed,ef])),t.jsx(R,{...y})}},67011:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>Page,metadata:()=>u});var t=a(8632);a(80051);var n=a(97175);let s=(0,n.createProxy)(String.raw`/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/analysis/analysis.tsx`),{__esModule:o,$$typeof:i}=s;s.default;let l=s.Analysis;var c=a(3747),d=a(11988);let u={title:"Resonance Analysis",description:"Real time accelerometer data"};function Page(){return t.jsx(c.r,{fallback:t.jsx(d.default,{}),children:t.jsx("div",{className:"h-full p-4 @container",children:t.jsx(l,{})})})}}};var r=require("../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),a=r.X(0,[7013,2689,8989,2828,1169,5005,8909,4620,9061,6851,5995,6020,7340,2017,6490,2251,9751,2041,3709,8328],()=>__webpack_exec__(9016));module.exports=a})();