"use strict";exports.id=8717,exports.ids=[8717],exports.modules={38717:(e,r,a)=>{a.d(r,{v:()=>MacroForm});var s=a(96603),l=a(99966),t=a(23152),o=a(52680),i=a(11951),n=a(55428),c=a(36707),d=a(55309),x=a(19623),m=a(4854),p=a(1453),u=a(51495),f=a(368);let h=u.forwardRef(({className:e,...r},a)=>s.jsx("textarea",{className:(0,f.cn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground","focus:border-brand-400/70 focus:outline-none focus:ring-1 focus:ring-transparent disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...r}));(0,f.h)(h,"Textarea");var g=a(61709);let b=(0,g.j)(["relative rounded-lg p-4 bg-white dark:bg-zinc-900/60","shadow-[0px_0px_0px_1px_rgba(9,9,11,0.07),0px_2px_2px_0px_rgba(9,9,11,0.05)] dark:shadow-[0px_0px_0px_1px_rgba(255,255,255,0.05)]","dark:before:-inset-px dark:before:rounded-xl dark:before:-mt-2.5","dark:before:pointer-events-none dark:before:absolute dark:before:shadow-[0px_2px_8px_0px_rgba(0,_0,_0,_0.20),_0px_1px_0px_0px_rgba(255,_255,_255,_0.09)_inset]"]),Fieldset=e=>s.jsx("fieldset",{...e,className:b({className:e.className}),children:e.children});var j=a(61331),v=a(47994),N=a(73057),w=a(48182);let _=u.forwardRef(({className:e,...r},a)=>s.jsx(w.fC,{className:(0,f.cn)("peer relative inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-all data-[state=checked]:bg-brand-400/80 data-[state=unchecked]:bg-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-0 disabled:cursor-not-allowed disabled:opacity-50","dark:before:pointer-events-none dark:before:absolute dark:before:-inset-[2px] dark:before:rounded-full dark:before:transition-all","dark:before:shadow-[0px_-1px_0px_0px_hsl(var(--zinc-400)_/_15%)_inset,_inset_0px_1px_2px_0px_rgba(0,0,0,0.55)]","data-[state=checked]:dark:before:shadow-[inset_0px_-1px_0px_0px_hsl(var(--brand-200)_/_50%),_inset_0px_1px_2px_0px_rgba(0,0,0,0.55)]",e),...r,ref:a,children:s.jsx(w.bU,{className:(0,f.cn)("pointer-events-none block h-4 w-4 rounded-full bg-zinc-800 shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0","shadow-[0px_0px_0px_1px_rgba(9,9,11,0.07),0px_2px_2px_0px_rgba(9,9,11,0.05)] dark:shadow-[0px_0px_0px_1px_rgba(255,255,255,0.03)]","dark:before:inset-px dark:before:rounded-full","dark:before:pointer-events-none dark:before:absolute dark:before:shadow-[0px_2px_8px_0px_hsl(var(--zinc-900)),_0px_1px_0px_0px_hsl(var(--zinc-400)_/_20%)_inset]")})}));(0,f.h)(_,w.fC.displayName);var y=a(56970),k=a(68567),C=a(65995),z=a(78438),M=a(37832),S=a(4097),F=a(30413),R=a(39238),D=a(73835),P=a(41726);let ResizablePanelGroup=({className:e,...r})=>s.jsx(P.eh,{className:(0,f.cn)("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",e),...r}),I=P.s_,ResizableHandle=({withHandle:e,className:r,...a})=>s.jsx(P.OT,{className:(0,f.cn)("relative flex w-px items-center justify-center bg-zinc-400/20 after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 [&[data-panel-group-direction=vertical]>div]:rotate-90",r),...a,children:e&&s.jsx("div",{className:"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border",children:s.jsx(D.W1P,{className:"h-2.5 w-2.5"})})});var A=a(27334),q=a(32519),T=a(63147),L=a(88304),E=a(32012),G=a.n(E);T.SciChartSurface.configure({wasmUrl:"/configure/scichart2d.wasm",dataUrl:"/configure/scichart2d.data"});let MacroChartPreview=({sequences:e})=>{let r=e?.map(e=>e.recording?.capturePSD?{accel:e.recording.accelerometer,color:e.recording.color,name:e.name}:null).filter(Boolean)??[],a=(0,u.useRef)(r),l=(0,u.useCallback)(e=>{if(2===r.length){let a=10*Math.random()*50+184,s=10*Math.random()*400+900,l=10*Math.random()*50+184,t=10*Math.random()*400+900,o=2+3*Math.random(),i=2+3*Math.random(),n=new T.FastBandRenderableSeries(e.webAssemblyContext2D,{dataSeries:new T.XyyDataSeries(e.webAssemblyContext2D,{containsNaN:!1,isSorted:!0,xValues:Array(130).fill(0).map((e,r)=>200/130*r),yValues:Array(130).fill(0).map((e,r)=>Math.max(0,r<50&&r>25||r>70?(140-r)*5*(Math.cos(r/o)*a+s):30*r*(Math.sin(r/o)*a+s))),y1Values:Array(130).fill(0).map((e,r)=>Math.max(0,r<50&&r>25||r>70?(140-r)*5*(Math.cos(r/i)*l+t):10*r*(Math.sin(r/i)*l*3+t)))}),fill:N.DN[r[1].color??"sky"][600]+22,fillY1:N.DN[r[0].color??"rose"][600]+22,stroke:N.DN[r[0].color??"rose"][400],strokeY1:N.DN[r[1].color??"sky"][400],strokeThickness:4,yAxisId:A.ck});n.rolloverModifierProps.tooltipColor=r[0].color??"zinc",n.rolloverModifierProps.tooltipTitle=r[0].name+" Power",n.rolloverModifierProps1.tooltipColor=r[1].color??"zinc",n.rolloverModifierProps1.tooltipTitle=r[1].name+" Power",n.animation=new T.WaveAnimation({duration:500}),e.renderableSeries.add(n)}else r.forEach(r=>{let a=1e3*Math.random()*50+184,s=1e3*Math.random()*400+900,l=2+3*Math.random(),t=new T.FastMountainRenderableSeries(e.webAssemblyContext2D,{dataSeries:new T.XyDataSeries(e.webAssemblyContext2D,{containsNaN:!1,isSorted:!0,xValues:Array(130).fill(0).map((e,r)=>200/130*r),yValues:Array(130).fill(0).map((e,r)=>Math.max(0,r<50&&r>25||r>70?(140-r)*5*(Math.cos(r/l)*a+s):30*r*(Math.sin(r/l)*a+s)))}),stroke:N.DN[r.color??"brand"][400],fill:N.DN[r.color??"brand"][600]+11,strokeThickness:4,yAxisId:A.ck});t.rolloverModifierProps.tooltipColor=r.color??"zinc",t.rolloverModifierProps.tooltipTitle=r.name+" Power",t.animation=new T.WaveAnimation({duration:500}),e.renderableSeries.add(t)});let a=e.yAxes.getById(A.ck);if(a){let r=new T.NumberRange(0,0);e.renderableSeries.asArray().forEach(e=>{r=r.union(e.getYRange(e.getXRange(),!1))}),r=r.growBy(new T.NumberRange(0,.1)),a.visibleRange=r}e.chartModifiers.add(new T.RolloverModifier({showRolloverLine:!0,showTooltip:!1,yAxisId:A.ck})),e.chartModifiers.add(new T.CursorModifier({crosshairStroke:N.DN.sky[400],crosshairStrokeThickness:1,showXLine:!0,showYLine:!0,tooltipLegendTemplate:A.to,tooltipLegendOffsetX:16,tooltipLegendOffsetY:16,yAxisId:A.ck,showTooltip:!1,axisLabelFill:N.DN.zinc[900],axisLabelStroke:N.DN.zinc[100]}))},[r]),t=(0,q.Q8)(A.OH,l);return(0,u.useEffect)(()=>{0!=r.length&&!1===G()(r,a.current)&&(t.surface.current&&(t.surface.current?.renderableSeries.clear(),t.surface.current?.chartModifiers.clear(),l(t.surface.current),t.surface.current.invalidateElement()),a.current=r)},[t.surface,r,l]),s.jsx(L.iB,{...t.forwardProps,className:"flex-1"})};var X=a(19815);let $=Object.keys(N.DN).map(e=>({label:e,value:e,color:N.DN[e][500]})),MacroSequence=({value:e,children:r})=>{let a=(0,M.o)(),l=(0,u.useCallback)(e=>{["input","textarea"].includes(e.target?.tagName?.toLowerCase())||(e.stopPropagation(),e.preventDefault(),a.start(e))},[a]);return s.jsx(S.t.Item,{as:"div",className:"grid w-full items-start gap-6",dragListener:!1,dragControls:a,value:e,exit:{opacity:0,scale:1,y:-10,transition:{duration:.2}},initial:{opacity:0,scale:1,y:-10},animate:{opacity:1,scale:1,y:0,transition:{delay:.2,staggerChildren:.2}},children:s.jsx(Fieldset,{className:"grid gap-6 p-4",onPointerDown:l,children:r})})},useFormValues=()=>{let{getValues:e}=(0,k.Gc)();return{...(0,k.qo)(),...e()}},MacroForm=({form:e,submit:r,isNew:a})=>{let f=(0,u.useMemo)(()=>[{label:"Control Board",value:"controlboard",description:"Record data with an ADXL345 connected to the main control board",icon:l.Z},{label:"Host",value:"rpi",description:"Record data with an ADXL345 connected to the Raspberry Pi or other host computer",icon:t.Z},{label:"Tool Board T0",value:"toolboard_t0",description:"Record data with an ADXL345 on the toolboard on toolhead T0",icon:o.Z},{label:"Tool Board T1",value:"toolboard_t1",description:"Record data with an ADXL345 on the toolboard on toolhead T1",icon:o.Z},{label:"Beacon",value:"beacon",description:"Record data with the Beacon accelerometer",icon:i.Z}],[]),g=(0,k.Dq)({control:e.control,name:"sequences",keyName:"key",shouldUnregister:!0}),b=(0,u.useCallback)(e=>{e.forEach((e,r)=>g.update(r,e))},[g]),N=useFormValues();if(null!=g.fields)return(0,s.jsxs)("div",{className:"flex max-h-[calc(100vh_-_56px)] min-h-full w-full flex-col",children:[(0,s.jsxs)("header",{className:"sticky top-14 z-10 flex flex-grow-0 items-center gap-1 border-b border-zinc-100/10 bg-zinc-700/25 px-4 py-4 backdrop-blur-sm",children:[(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx(y.Wi,{control:e.control,name:"name",render:({field:e})=>(0,s.jsxs)(y.xJ,{className:"flex flex-row items-center justify-between",children:[s.jsx(y.NI,{className:"flex flex-1",children:s.jsx(m.I,{className:"dark:focus-ring-0 flex h-auto flex-1 border-none p-0 text-xl font-medium focus:ring-0 focus:ring-offset-0",type:"text",autoComplete:"off","aria-autocomplete":"none",autoCapitalize:"on",placeholder:"Enter macro name...",...e})}),s.jsx(y.zG,{})]})}),s.jsx(y.Wi,{control:e.control,name:"description",render:({field:e})=>(0,s.jsxs)(y.xJ,{className:"flex flex-row items-center justify-between",children:[s.jsx(y.NI,{className:"flex flex-1",children:s.jsx(m.I,{placeholder:"Enter a description...",autoComplete:"off","aria-autocomplete":"none",autoCapitalize:"off",className:"font-regular dark:focus-ring-0 flex h-auto flex-1 border-none p-0 text-base text-muted-foreground focus:ring-0 focus:ring-offset-0 dark:text-muted-foreground",...e})}),s.jsx(y.zG,{})]})})]}),s.jsx("div",{className:"ml-auto flex flex-row flex-nowrap items-center gap-2",children:(0,s.jsxs)(x.z,{variant:"primary",size:"sm",className:"ml-auto text-sm",onClick:r,disabled:!e.formState.isDirty,children:[s.jsx(n.Z,{className:"size-3.5"}),a?"Create":"Save"]})})]}),(0,s.jsxs)(ResizablePanelGroup,{direction:"horizontal",className:"flex max-h-full flex-1",children:[s.jsx(I,{defaultSize:35,className:"flex",minSize:20,children:(0,s.jsxs)(X.l,{className:"flex-1 overflow-y-scroll p-4",children:[s.jsx(S.t.Group,{axis:"y",as:"div",className:"relative flex flex-col items-start gap-4",values:g.fields??[],onReorder:b,children:g.fields.map((r,a)=>s.jsx(MacroSequence,{value:r,children:(0,s.jsxs)(s.Fragment,{children:[s.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:N.sequences[a]?.name??r.name??`Sequence ${a+1}`}),s.jsx("div",{className:"absolute -right-2 -top-5",children:s.jsx(x.z,{variant:"danger",size:"icon-xs",onClick:()=>g.remove(a),children:s.jsx(c.Z,{className:"size-3"})})}),s.jsx("input",{type:"hidden",...e.register(`sequences.${a}.id`)}),s.jsx("div",{className:"grid gap-3",children:s.jsx(y.Wi,{control:e.control,name:`sequences.${a}.name`,render:({field:e})=>(0,s.jsxs)(y.xJ,{children:[s.jsx(y.lX,{className:"text-base",children:"Sequence name"}),s.jsx(y.NI,{children:s.jsx(m.I,{type:"text",...e})}),s.jsx(y.zG,{})]})})}),s.jsx("div",{className:"grid gap-3",children:s.jsx(y.Wi,{control:e.control,name:`sequences.${a}.gcode`,render:({field:e})=>(0,s.jsxs)(y.xJ,{children:[s.jsx(y.lX,{className:"text-base",children:"G-code"}),s.jsx(y.NI,{children:s.jsx(h,{id:"temperature",placeholder:"; Example \nOSCILLATE FREQ=60 TIME=1",...e})}),s.jsx(y.zG,{})]})})}),(0,s.jsxs)("div",{className:"grid gap-3 rounded-lg border p-4 @container",children:[s.jsx(y.Wi,{control:e.control,name:`sequences.${a}.recording.capturePSD`,render:({field:e})=>(0,s.jsxs)(y.xJ,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)("div",{className:"space-y-0.5",children:[s.jsx(y.lX,{className:"text-base",children:"Record resonances"}),s.jsx(y.pf,{className:"font-medium",children:"Enable the calculation and persistence of power spectral density."})]}),s.jsx(y.NI,{children:s.jsx(_,{checked:e.value,onCheckedChange:e.onChange})}),s.jsx(y.zG,{})]})}),s.jsx(z.i,{children:s.jsx(F.M,{children:r.recording?.capturePSD&&(0,s.jsxs)(R.E.div,{exit:{opacity:0,scale:1,y:-10,transition:{duration:.2}},initial:{opacity:0,scale:1,y:-10},animate:{opacity:1,scale:1,y:0,transition:{delay:.2,staggerChildren:.2}},className:"grid gap-3 @xs:grid-cols-2",children:[s.jsx(y.Wi,{control:e.control,name:`sequences.${a}.recording.accelerometer`,render:({field:e})=>(0,s.jsxs)(y.xJ,{children:[s.jsx(y.lX,{children:"Accelerometer"}),s.jsx(y.NI,{children:(0,s.jsxs)(p.Ph,{onValueChange:e.onChange,value:e.value,children:[s.jsx(p.i4,{id:"model",className:"items-start [&_[data-description]]:hidden",children:s.jsx(p.ki,{placeholder:"Select an accelerometer..."})}),s.jsx(p.Bw,{children:f.map(({label:e,value:r,icon:a,description:l})=>s.jsx(p.Ql,{value:r,children:(0,s.jsxs)("div",{className:"flex items-start gap-1 text-muted-foreground",children:[s.jsx(a,{className:"size-5 shrink-0"}),(0,s.jsxs)("div",{className:"grid gap-0.5",children:[s.jsx("p",{children:s.jsx("span",{className:"font-medium text-foreground",children:e})}),s.jsx("p",{className:"text-sm","data-description":!0,children:l})]})]})},e))})]})}),s.jsx(y.zG,{})]})}),s.jsx(y.Wi,{control:e.control,name:`sequences.${a}.recording.color`,render:({field:e})=>(0,s.jsxs)(y.xJ,{children:[s.jsx(y.lX,{children:"Sequence Color"}),s.jsx(y.NI,{children:(0,s.jsxs)(p.Ph,{onValueChange:e.onChange,value:e.value,children:[s.jsx(p.i4,{id:"sequence-color",className:"items-start",children:s.jsx(p.ki,{placeholder:"Select a color..."})}),s.jsx(p.Bw,{children:$.map(({label:e,color:r,value:a})=>s.jsx(p.Ql,{value:a,children:(0,s.jsxs)("div",{className:"flex items-start gap-2 text-muted-foreground",children:[s.jsx("div",{className:"size-5 rounded",style:{backgroundColor:r}}),s.jsx("div",{className:"grid gap-0.5",children:s.jsx("p",{children:s.jsx("span",{className:"font-medium capitalize text-foreground",children:e})})})]})},a))})]})}),s.jsx(y.zG,{})]})})]})})})]})]})},r.id??r.key))}),(0,s.jsxs)(x.z,{variant:"outline",className:"mt-4 w-full justify-center text-center",onClick:()=>{let e={gcode:"",name:`Sequence ${g.fields.length}`,recording:{capturePSD:!1},id:C.Z()};g.append(e)},children:[s.jsx(d.Z,{className:"flex size-4"}),s.jsx("span",{children:"Add new sequence"})]})]})}),s.jsx(ResizableHandle,{withHandle:!0}),s.jsx(I,{className:"mt-[9px] flex p-4",defaultSize:65,minSize:20,children:(0,s.jsxs)(v.Card,{className:"sticky top-0 flex min-h-72 w-full flex-1",children:[s.jsx(j.Ct,{color:"sky",className:"absolute right-3 top-3",children:"Graph Example Preview"}),s.jsx("div",{className:"flex flex-1",children:s.jsx(MacroChartPreview,{sequences:N.sequences})})]})})]})]})}},19815:(e,r,a)=>{a.d(r,{l:()=>ScrollContainer});var s=a(96603),l=a(61418);let ScrollContainer=e=>s.jsx("div",{...e,className:(0,l.m6)("scrollable",e.className)})},56970:(e,r,a)=>{a.d(r,{NI:()=>h,Wi:()=>FormField,l0:()=>x,lX:()=>f,pf:()=>g,xJ:()=>u,zG:()=>b});var s=a(96603),l=a(51495),t=a(40147),o=a(68567),i=a(368),n=a(61095),c=a(30413),d=a(39238);let x=o.RV,m=l.createContext({}),FormField=({...e})=>s.jsx(m.Provider,{value:{name:e.name},children:s.jsx(o.Qr,{...e})}),useFormField=()=>{let e=l.useContext(m),r=l.useContext(p),{getFieldState:a,formState:s}=(0,o.Gc)(),t=a(e.name,s);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=r;return{id:i,name:e.name,formItemId:`${i}-form-item`,formDescriptionId:`${i}-form-item-description`,formMessageId:`${i}-form-item-message`,...t}},p=l.createContext({}),u=l.forwardRef(({className:e,...r},a)=>{let t=l.useId();return s.jsx(p.Provider,{value:{id:t},children:s.jsx("div",{ref:a,className:(0,i.cn)("space-y-2",e),...r})})});(0,i.h)(u,"FormItem");let f=l.forwardRef(({className:e,...r},a)=>{let{error:l,formItemId:t}=useFormField();return s.jsx(n._,{ref:a,className:(0,i.cn)(l&&"text-destructive",e),htmlFor:t,...r})});(0,i.h)(f,"FormLabel");let h=l.forwardRef(({...e},r)=>{let{error:a,formItemId:l,formDescriptionId:o,formMessageId:i}=useFormField();return s.jsx(t.g7,{ref:r,id:l,"aria-describedby":a?`${o} ${i}`:`${o}`,"aria-invalid":!!a,...e})});(0,i.h)(h,"FormControl");let g=l.forwardRef(({className:e,...r},a)=>{let{formDescriptionId:l}=useFormField();return s.jsx("p",{ref:a,id:l,className:(0,i.cn)("text-[0.8rem] font-medium text-muted-foreground",e),...r})});(0,i.h)(g,"FormDescription");let b=l.forwardRef(({className:e,children:r,...a},l)=>{let{error:t,formMessageId:o}=useFormField(),n=t?String(t?.message):r;return n?s.jsx(c.M,{children:s.jsx(d.E.p,{exit:{opacity:0,scale:1,y:-10,transition:{duration:.2}},initial:{opacity:0,scale:1,y:-10},animate:{opacity:1,scale:1,y:0,transition:{delay:.2,staggerChildren:.2}},ref:l,id:o,...a,className:(0,i.cn)("text-[0.8rem] font-medium text-destructive",e),children:n})}):null});(0,i.h)(b,"FormMessage")},61095:(e,r,a)=>{a.d(r,{_:()=>c});var s=a(96603),l=a(51495),t=a(45197),o=a(61709),i=a(368);let n=(0,o.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=l.forwardRef(({className:e,...r},a)=>s.jsx(t.f,{ref:a,className:(0,i.cn)(n(),e),...r}));(0,i.h)(c,t.f.displayName)}};