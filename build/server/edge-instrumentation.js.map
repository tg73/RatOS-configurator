{"version":3,"file":"edge-instrumentation.js","mappings":"gIAAO,IAAMA,SAAW,UAmExB","sources":["webpack://_N_E/./instrumentation.ts","webpack://_N_E/<anon>"],"sourcesContent":["export const register = async () => {\n\tif (process.env.NEXT_RUNTIME === 'nodejs') {\n\t\tconst { getLogger } = await import('./server/helpers/logger');\n\t\tconst { existsSync, mkdirSync } = await import('fs');\n\t\tconst { regenerateKlipperConfiguration } = await import('./server/routers/printer');\n\t\tconst { serverSchema } = await import('./env/schema.mjs');\n\t\tconst { symlinkKlippyExtensions } = await import('./server/routers/klippy-extensions');\n\t\tconst { symlinkMoonrakerExtensions } = await import('./server/routers/moonraker-extensions');\n\t\tconst { klipperRestart } = await import('./server/helpers/klipper');\n\t\tconst dns = await import('dns');\n\t\tdns.setDefaultResultOrder('ipv4first');\n\t\tconst logger = getLogger();\n\n\t\tconst environment = serverSchema.parse(process.env);\n\t\tconst dataDir = environment.RATOS_DATA_DIR;\n\t\tif (!existsSync(dataDir)) {\n\t\t\tlogger.info('Creating RatOS data directory..');\n\t\t\tmkdirSync(dataDir);\n\t\t}\n\t\ttry {\n\t\t\tlogger.info('Symlinking klippy extensions...');\n\t\t\tlogger.info((await symlinkKlippyExtensions()).report);\n\t\t} catch (e) {\n\t\t\tif (e instanceof Error) {\n\t\t\t\tlogger.error(`Failed to symlink klippy extensions: ${e.message}`);\n\t\t\t}\n\t\t}\n\t\ttry {\n\t\t\tlogger.info('Symlinking moonraker extensions...');\n\t\t\tlogger.info((await symlinkMoonrakerExtensions()).report);\n\t\t} catch (e) {\n\t\t\tif (e instanceof Error) {\n\t\t\t\tlogger.error(`Failed to symlink moonraker extensions: ${e.message}`);\n\t\t\t}\n\t\t}\n\t\ttry {\n\t\t\tlogger.info('Regenerating last known config...');\n\t\t\tconst res = await regenerateKlipperConfiguration();\n\t\t\tif (res.some((r) => r.action === 'created' || r.action === 'overwritten')) {\n\t\t\t\tres.forEach((r) => {\n\t\t\t\t\tif (r.action === 'created' || r.action === 'overwritten') {\n\t\t\t\t\t\tlogger.info(`File ${r.fileName} ${r.action}.`);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlogger.info('Configuration changed, restarting klipper..');\n\t\t\t\ttry {\n\t\t\t\t\tconst restarted = await klipperRestart();\n\t\t\t\t\tif (restarted) {\n\t\t\t\t\t\tlogger.info('Klipper restarted!');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlogger.info(`Klipper was in a busy state. Please restart manually.`);\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (e instanceof Error) {\n\t\t\t\t\t\tlogger.error(`Failed to restart klipper: ${e.message}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlogger.info('No configuration changes detected.');\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif (e instanceof Error) {\n\t\t\t\tlogger.error(`Failed to regenerate config: ${e.message}`);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t}\n};\n"],"names":["register"],"sourceRoot":""}